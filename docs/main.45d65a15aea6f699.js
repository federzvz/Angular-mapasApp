(self.webpackChunkAngular_mapasApp=self.webpackChunkAngular_mapasApp||[]).push([[179],{782:(nr,Qt,Be)=>{"use strict";var ge=Be(481),re=Be(256),Wt=Be(944);const u=[{path:"mapas",loadChildren:()=>Be.e(161).then(Be.bind(Be,161)).then(ut=>ut.MapasModule)},{path:"**",redirectTo:"mapas"}];let Ae=(()=>{class ut{}return ut.\u0275fac=function(dt){return new(dt||ut)},ut.\u0275mod=re.oAB({type:ut}),ut.\u0275inj=re.cJS({imports:[Wt.Bz.forRoot(u),Wt.Bz]}),ut})();var hn=Be(898);var nt=Be(895);const Mt=function(ut){return[ut]};function Ct(ut,bn){if(1&ut&&(re.TgZ(0,"li",2),re._uU(1),re.qZA()),2&ut){const dt=bn.$implicit;re.Q6J("routerLink",re.VKq(2,Mt,dt.ruta)),re.xp6(1),re.hij(" ",dt.nombre," ")}}let ft=(()=>{class ut{constructor(){this.menuItems=[{ruta:"/mapas/fullscreen",nombre:"FullScreen"},{ruta:"/mapas/zoom-range",nombre:"Zoom Range"},{ruta:"/mapas/marcadores",nombre:"Marcadores"},{ruta:"/mapas/propiedades",nombre:"Propiedades"}]}}return ut.\u0275fac=function(dt){return new(dt||ut)},ut.\u0275cmp=re.Xpm({type:ut,selectors:[["app-menu"]],decls:2,vars:1,consts:[[1,"list-group"],["class","list-group-item","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item",3,"routerLink"]],template:function(dt,dn){1&dt&&(re.TgZ(0,"ul",0),re.YNc(1,Ct,2,4,"li",1),re.qZA()),2&dt&&(re.xp6(1),re.Q6J("ngForOf",dn.menuItems))},dependencies:[nt.sg,Wt.rH,Wt.Od]}),ut})(),Tt=(()=>{class ut{ngOnInit(){hn.accessToken="pk.eyJ1IjoiZmVkZXJ6dnoiLCJhIjoiY2w1dTU0YXRlMDB2ejNjcGI1em1yYTRydyJ9.sl1BCfhc9op_T3uRqcWwng"}}return ut.\u0275fac=function(dt){return new(dt||ut)},ut.\u0275cmp=re.Xpm({type:ut,selectors:[["app-root"]],decls:2,vars:0,template:function(dt,dn){1&dt&&re._UZ(0,"app-menu")(1,"router-outlet")},dependencies:[Wt.lC,ft]}),ut})(),wn=(()=>{class ut{}return ut.\u0275fac=function(dt){return new(dt||ut)},ut.\u0275mod=re.oAB({type:ut,bootstrap:[Tt]}),ut.\u0275inj=re.cJS({imports:[ge.b2,Ae]}),ut})();(0,re.G48)(),ge.q6().bootstrapModule(wn).catch(ut=>console.error(ut))},898:function(nr){nr.exports=function(){"use strict";var Qt,Be,ge;function re(u,Ae){if(Qt)if(Be){var hn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Qt+")(sharedChunk); ("+Be+")(sharedChunk); self.onerror = null;",jt={};Qt(jt),ge=Ae(jt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ge.workerUrl=window.URL.createObjectURL(new Blob([hn],{type:"text/javascript"})))}else Be=Ae;else Qt=Ae}return re(0,function(u){var Ae=typeof self<"u"?self:{},hn=jt;function jt(n,e,r,s){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=r,this.p2y=s}jt.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},jt.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},jt.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},jt.prototype.solveCurveX=function(n,e){var r,s,c,f,m;for(void 0===e&&(e=1e-6),c=n,m=0;m<8;m++){if(f=this.sampleCurveX(c)-n,Math.abs(f)<e)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=f/y}if((c=n)<(r=0))return r;if(c>(s=1))return s;for(;r<s;){if(f=this.sampleCurveX(c),Math.abs(f-n)<e)return c;n>f?r=c:s=c,c=.5*(s-r)+r}return c},jt.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var nt=Mt;function Mt(n,e){this.x=n,this.y=e}Mt.prototype={clone:function(){return new Mt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(n,e){var r=Math.cos(n),s=Math.sin(n),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Mt.convert=function(n){return n instanceof Mt?n:Array.isArray(n)?new Mt(n[0],n[1]):n};const Ct=Math.PI/180,ft=180/Math.PI;function Tt(n){return n*Ct}function wn(n){return n*ft}const ut=[[0,0],[1,0],[1,1],[0,1]];function bn(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function dt(n,e,r,s){const c=new hn(n,e,r,s);return function(f){return c.solve(f)}}const dn=dt(.25,.1,.25,1);function Xt(n,e,r){return Math.min(r,Math.max(e,n))}function Hn(n,e,r){return(r=Xt((r-n)/(e-n),0,1))*r*(3-2*r)}function Zt(n,e,r){const s=r-e,c=((n-e)%s+s)%s+e;return c===e?r:c}function Bt(n,e,r){if(!n.length)return r(null,[]);let s=n.length;const c=new Array(n.length);let f=null;n.forEach((m,y)=>{e(m,(b,w)=>{b&&(f=b),c[y]=w,0==--s&&r(f,c)})})}function Nt(n){const e=[];for(const r in n)e.push(n[r]);return e}function gt(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}let rr=1;function wt(){return rr++}function Ft(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Mn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function qe(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Ke(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Qe(n,e){return-1!==n.indexOf(e,n.length-e.length)}function ot(n,e,r){const s={};for(const c in n)s[c]=e.call(r||this,n[c],c,n);return s}function at(n,e,r){const s={};for(const c in n)e.call(r||this,n[c],c,n)&&(s[c]=n[c]);return s}function Rt(n){return Array.isArray(n)?n.map(Rt):"object"==typeof n&&n?ot(n,Rt):n}const Ln={};function fn(n){Ln[n]||(typeof console<"u"&&console.warn(n),Ln[n]=!0)}function Zn(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function Dn(n){let e=0;for(let r,s,c=0,f=n.length,m=f-1;c<f;m=c++)r=n[c],s=n[m],e+=(s.x-r.x)*(r.y+s.y);return e}function _r(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function jr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,f)=>{const m=c||f;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ir=null;function Yr(n){if(null==ir){const e=n.navigator?n.navigator.userAgent:null;ir=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ir}function Ri(n){try{const e=Ae[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ki(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const dr=Ae.performance;function An(n){const e=n?n.url.toString():void 0;return dr.getEntriesByName(e)}let En,io,Sr,oo;const ci={now:()=>void 0!==Sr?Sr:Ae.performance.now(),setNow(n){Sr=n},restoreNow(){Sr=void 0},frame(n){const e=Ae.requestAnimationFrame(n);return{cancel:()=>Ae.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:s}=n;oo||(oo=Ae.document.createElement("canvas"));const c=oo.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return(r>oo.width||s>oo.height)&&(oo.width=r,oo.height=s),c.clearRect(-e,-e,r+2*e,s+2*e),c.drawImage(n,0,0,r,s),c.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:n=>(En||(En=Ae.document.createElement("a")),En.href=n,En.href),get devicePixelRatio(){return Ae.devicePixelRatio},get prefersReducedMotion(){return!!Ae.matchMedia&&(null==io&&(io=Ae.matchMedia("(prefers-reduced-motion: reduce)")),io.matches)}};let Xi;const Vn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Xi){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Xi=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{Xi=n}}return Xi},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ci={supported:!1,testSupport:function(n){!$i&&Fi&&(Bo?Ii(n):Yn=n)}};let Yn,Fi,$i=!1,Bo=!1;function Ii(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Fi),n.isContextLost())return;Ci.supported=!0}catch{}n.deleteTexture(e),$i=!0}Ae.document&&(Fi=Ae.document.createElement("img"),Fi.onload=function(){Yn&&Ii(Yn),Yn=null,Bo=!0},Fi.onerror=function(){$i=!0,Yn=null},Fi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ts="01",Jt="NO_ACCESS_TOKEN";function ui(n){return 0===n.indexOf("mapbox:")}function vr(n){return Vn.API_URL_REGEX.test(n)}const an=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gn(n){const e=n.match(an);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function No(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function mi(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Ae.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ar{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=mi(Vn.ACCESS_TOKEN);let s="";return s=r&&r.u?Ae.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(c,f)=>String.fromCharCode(Number("0x"+f)))):Vn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=Ri("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=Ae.localStorage.getItem(r);c&&(this.eventData=JSON.parse(c));const f=Ae.localStorage.getItem(s);f&&(this.anonId=f)}catch{fn("Unable to read from LocalStorage")}}saveEventData(){const e=Ri("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Ae.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Ae.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{fn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,c){if(!Vn.EVENTS_URL)return;const f=gn(Vn.EVENTS_URL);f.params.push(`access_token=${c||Vn.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.2",skuId:ts,userId:this.anonId},y=r?gt(m,r):m,b={url:No(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=Ne(b,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Uo=new class extends ar{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Vn.EVENTS_URL&&Vn.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>ui(r)||vr(r))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=mi(Vn.ACCESS_TOKEN),r=e?e.u:Vn.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;qe(this.anonId)||(this.anonId=Ft(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||f.getDate()!==m.getDate()}else s=!0;s?this.postEvent(c,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=c,this.eventData.tokenU=r)},n):this.processRequests()}},Si=Uo.postTurnstileEvent.bind(Uo),gi=new class extends ar{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,r,s){this.skuToken=e,this.errorCb=s,Vn.EVENTS_URL&&(r||Vn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Jt)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),qe(this.anonId)||(this.anonId=Ft()),this.postEvent(r,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},Pn=gi.postMapLoadEvent.bind(gi),Aa=new class extends ar{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,r,s){if(!Vn.API_URL||!Vn.SESSION_PATH)return;const c=gn(Vn.API_URL+Vn.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||Vn.ACCESS_TOKEN||""}`);const f={url:No(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=tt(f,m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,r,s){this.skuToken=e,this.errorCb=s,Vn.SESSION_PATH&&Vn.API_URL&&(r||Vn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Jt)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},xr=Aa.getSessionAPI.bind(Aa),Oi=new Set;let Fn,In=500,po=50,Gr={};function To(n){const e=$(n);let r,s;e&&e.forEach(f=>{const m=f.split("=");"language"===m[0]?r=m[1]:"worldview"===m[0]&&(s=m[1])});let c="mapbox-tiles";return r&&(c+=`-${r}`),s&&(c+=`-${s}`),c}function le(n){Ae.caches&&!Gr[n]&&(Gr[n]=Ae.caches.open(n))}function $(n){const e=n.indexOf("?");return e>0?n.slice(e+1).split("&"):[]}function Z(n){const e=n.indexOf("?");if(e<0)return n;const r=$(n).filter(s=>{const c=s.split("=");return"language"===c[0]||"worldview"===c[0]});return r.length?`${n.slice(0,e)}?${r.join("&")}`:n.slice(0,e)}let ce=1/0;const ye={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ye);class Te extends Error{constructor(e,r,s){401===r&&vr(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ze=_r()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ae.location.protocol?Ae.parent:Ae).location.href,Oe=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(ze())&&!/^\w+:/.test(r))){if(Ae.fetch&&Ae.Request&&Ae.AbortController&&Ae.Request.prototype.hasOwnProperty("signal"))return function(s,c){const f=new Ae.AbortController,m=new Ae.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:ze(),signal:f.signal});let y=!1,b=!1;const w=(S=m.url).indexOf("sku=")>0&&vr(S);var S;"json"===s.type&&m.headers.set("Accept","application/json");const R=(N,G,q)=>{if(b)return;if(N&&"SecurityError"!==N.message&&fn(N),G&&q)return k(G);const ie=Date.now();Ae.fetch(m).then(ue=>{if(ue.ok){const Ee=w?ue.clone():null;return k(ue,Ee,ie)}return c(new Te(ue.statusText,ue.status,s.url))}).catch(ue=>{20!==ue.code&&c(new Error(ue.message))})},k=(N,G,q)=>{("arrayBuffer"===s.type?N.arrayBuffer():"json"===s.type?N.json():N.text()).then(ie=>{b||(G&&q&&function(ue,Ee,we){const Ce=To(ue.url);if(le(Ce),!Gr[Ce])return;const Pe={status:Ee.status,statusText:Ee.statusText,headers:new Ae.Headers};Ee.headers.forEach((Xe,ct)=>Pe.headers.set(ct,Xe));const Fe=jr(Ee.headers.get("Cache-Control")||"");if(Fe["no-store"])return;Fe["max-age"]&&Pe.headers.set("Expires",new Date(we+1e3*Fe["max-age"]).toUTCString());const Ze=Pe.headers.get("Expires");Ze&&(new Date(Ze).getTime()-we<42e4||function(Xe,ct){if(void 0===Fn)try{new Response(new ReadableStream),Fn=!0}catch{Fn=!1}Fn?ct(Xe.body):Xe.blob().then(ct)}(Ee,Xe=>{const ct=new Ae.Response(Xe,Pe);le(Ce),Gr[Ce]&&Gr[Ce].then(yt=>yt.put(Z(ue.url),ct)).catch(yt=>fn(yt.message))}))}(m,G,q),y=!0,c(null,ie,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(ie=>{b||c(new Error(ie.message))})};return w?function(N,G){const q=To(N.url);if(le(q),!Gr[q])return G(null);const ie=Z(N.url);Gr[q].then(ue=>{ue.match(ie).then(Ee=>{const we=function(Ce){if(!Ce)return!1;const Pe=new Date(Ce.headers.get("Expires")||0),Fe=jr(Ce.headers.get("Cache-Control")||"");return Pe>Date.now()&&!Fe["no-cache"]}(Ee);ue.delete(ie),we&&ue.put(ie,Ee.clone()),G(null,Ee,we)}).catch(G)}).catch(G)}(m,R):R(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(n,e);if(_r()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(s,c){const f=new Ae.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const m in s.headers)f.setRequestHeader(m,s.headers[m]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let m=f.response;if("json"===s.type)try{m=JSON.parse(f.response)}catch(y){return c(y)}c(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else c(new Te(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(n,e)},Ie=function(n,e){return Oe(gt(n,{type:"arrayBuffer"}),e)},Ne=function(n,e){return Oe(gt(n,{method:"POST"}),e)},tt=function(n,e){return Oe(gt(n,{method:"GET"}),e)};function At(n){const e=Ae.document.createElement("a");return e.href=n,e.protocol===Ae.document.location.protocol&&e.host===Ae.document.location.host}const ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let he,se;he=[],se=0;const Me=function(n,e){if(Ci.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),se>=Vn.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return he.push(f),f}se++;let r=!1;const s=()=>{if(!r)for(r=!0,se--;he.length&&se<Vn.MAX_PARALLEL_IMAGE_REQUESTS;){const f=he.shift(),{requestParameters:m,callback:y,cancelled:b}=f;b||(f.cancel=Me(m,y).cancel)}},c=Ie(n,(f,m,y,b)=>{s(),f?e(f):m&&(Ae.createImageBitmap?function(w,S){const R=new Ae.Blob([new Uint8Array(w)],{type:"image/png"});Ae.createImageBitmap(R).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,S)=>e(w,S,y,b)):function(w,S){const R=new Ae.Image,k=Ae.URL;R.onload=()=>{S(null,R),k.revokeObjectURL(R.src),R.onload=null,Ae.requestAnimationFrame(()=>{R.src=ve})},R.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Ae.Blob([new Uint8Array(w)],{type:"image/png"});R.src=w.byteLength?k.createObjectURL(N):ve}(m,(w,S)=>e(w,S,y,b)))});return{cancel:()=>{c.cancel(),s()}}};function Ue(n,e,r){r[n]&&-1!==r[n].indexOf(e)||(r[n]=r[n]||[],r[n].push(e))}function Et(n,e,r){if(r&&r[n]){const s=r[n].indexOf(e);-1!==s&&r[n].splice(s,1)}}class rt{constructor(e,r={}){gt(this,r),this.type=e}}class $t extends rt{constructor(e,r={}){super("error",gt({error:e},r))}}class nn{on(e,r){return this._listeners=this._listeners||{},Ue(e,r,this._listeners),this}off(e,r){return Et(e,r,this._listeners),Et(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ue(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){"string"==typeof e&&(e=new rt(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of c)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)Et(s,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(gt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof $t&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Hr(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}function Tn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function xn(n){if(Array.isArray(n))return n.map(xn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=xn(n[r]);return e}return Tn(n)}class Mr extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var _i=Mr;class yi{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new yi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Bn=yi;const Do={kind:"null"},Ot={kind:"number"},$n={kind:"string"},_n={kind:"boolean"},fr={kind:"color"},so={kind:"object"},mn={kind:"value"},ei={kind:"collator"},Yi={kind:"formatted"},Co={kind:"resolvedImage"};function qn(n,e){return{kind:"array",itemType:n,N:e}}function Ar(n){if("array"===n.kind){const e=Ar(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const ql=[Do,Ot,$n,_n,fr,Yi,so,qn(mn),Co];function Vo(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Vo(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const r of ql)if(!Vo(r,e))return null}return`Expected ${Ar(n)} but found ${Ar(e)} instead.`}function ds(n,e){return e.some(r=>r.kind===n.kind)}function zi(n,e){return e.some(r=>"null"===r?null===n:"array"===r?Array.isArray(n):"object"===r?n&&!Array.isArray(n)&&"object"==typeof n:r===typeof n)}function mo(n){var e={exports:{}};return n(e,e.exports),e.exports}var ns=mo(function(n,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function c(y){return s("%"===y[y.length-1]?parseFloat(y)/100*255:parseInt(y))}function f(y){return(b="%"===y[y.length-1]?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function m(y,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(b-y)*w*6:2*w<1?b:3*w<2?y+(b-y)*(2/3-w)*6:y}try{e.parseCSSColor=function(y){var b,w=y.replace(/ /g,"").toLowerCase();if(w in r)return r[w].slice();if("#"===w[0])return 4===w.length?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===w.length&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var S=w.indexOf("("),R=w.indexOf(")");if(-1!==S&&R+1===w.length){var k=w.substr(0,S),N=w.substr(S+1,R-(S+1)).split(","),G=1;switch(k){case"rgba":if(4!==N.length)return null;G=f(N.pop());case"rgb":return 3!==N.length?null:[c(N[0]),c(N[1]),c(N[2]),G];case"hsla":if(4!==N.length)return null;G=f(N.pop());case"hsl":if(3!==N.length)return null;var q=(parseFloat(N[0])%360+360)%360/360,ie=f(N[1]),ue=f(N[2]),Ee=ue<=.5?ue*(ie+1):ue+ie-ue*ie,we=2*ue-Ee;return[s(255*m(we,Ee,q+1/3)),s(255*m(we,Ee,q)),s(255*m(we,Ee,q-1/3)),G];default:return null}}return null}}catch{}});class Jn{constructor(e,r,s,c=1){this.r=e,this.g=r,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Jn)return e;if("string"!=typeof e)return;const r=ns.parseCSSColor(e);return r?new Jn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${c})`}toArray(){const{r:e,g:r,b:s,a:c}=this;return 0===c?[0,0,0,0]:[255*e/c,255*r/c,255*s/c,c]}toArray01(){const{r:e,g:r,b:s,a:c}=this;return 0===c?[0,0,0,0]:[e/c,r/c,s/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:c}=this;return[e,r,s,c]}}Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1),Jn.blue=new Jn(0,0,1,1);var Zr=Jn;class Pr{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gi{constructor(e,r,s,c,f){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=f}}class Kr{constructor(e){this.sections=e}static fromString(e){return new Kr([new Gi(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Kr?e:Kr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class vi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new vi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Hi(n,e,r,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,r,s]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pr(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Zr||n instanceof Pr||n instanceof Kr||n instanceof vi)return!0;if(Array.isArray(n)){for(const e of n)if(!pr(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!pr(n[e]))return!1;return!0}return!1}function Fr(n){if(null===n)return Do;if("string"==typeof n)return $n;if("boolean"==typeof n)return _n;if("number"==typeof n)return Ot;if(n instanceof Zr)return fr;if(n instanceof Pr)return ei;if(n instanceof Kr)return Yi;if(n instanceof vi)return Co;if(Array.isArray(n)){const e=n.length;let r;for(const s of n){const c=Fr(s);if(r){if(r===c)continue;r=mn;break}r=c}return qn(r||mn,e)}return so}function fs(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof Zr||n instanceof Kr||n instanceof vi?n.toString():JSON.stringify(n)}class pl{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(2!==e.length)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!pr(e[1]))return r.error("invalid value");const s=e[1];let c=Fr(s);const f=r.expectedType;return"array"!==c.kind||0!==c.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(c=f),new pl(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Zr?["rgba"].concat(this.value.toArray()):this.value instanceof Kr?this.value.serialize():this.value}}var Io=pl,xi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const ml={string:$n,number:Ot,boolean:_n,object:so};class ps{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const f=e[0];if("array"===f){let y,b;if(e.length>2){const w=e[1];if("string"!=typeof w||!(w in ml)||"object"===w)return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=ml[w],c++}else y=mn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}s=qn(y,b)}else s=ml[f];const m=[];for(;c<e.length;c++){const y=r.parse(e[c],c,mn);if(!y)return null;m.push(y)}return new ps(s,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!Vo(this.type,Fr(s)))return s;if(r===this.args.length-1)throw new xi(`Expected value to be of type ${Ar(this.type)}, but found ${Ar(Fr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){r.push(s.kind);const c=e.N;("number"==typeof c||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(s=>s.serialize()))}}var jo=ps;class $o{constructor(e){this.type=Yi,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return r.error("First argument must be an image or text section.");const c=[];let f=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(f&&"object"==typeof y&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,Ot),!b))return null;let w=null;if(y["text-font"]&&(w=r.parse(y["text-font"],1,qn($n)),!w))return null;let S=null;if(y["text-color"]&&(S=r.parse(y["text-color"],1,fr),!S))return null;const R=c[c.length-1];R.scale=b,R.font=w,R.textColor=S}else{const b=r.parse(e[m],1,mn);if(!b)return null;const w=b.type.kind;if("string"!==w&&"value"!==w&&"null"!==w&&"resolvedImage"!==w)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new $o(c)}evaluate(e){return new Kr(this.sections.map(r=>{const s=r.content.evaluate(e);return Fr(s)===Co?new Gi("",s,null,null,null):new Gi(fs(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class Pa{constructor(e){this.type=Co,this.input=e}static parse(e,r){if(2!==e.length)return r.error("Expected two arguments.");const s=r.parse(e[1],1,$n);return s?new Pa(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=vi.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Wl={"to-boolean":_n,"to-color":fr,"to-number":Ot,"to-string":$n};class Ra{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return r.error("Expected one argument.");const c=Wl[s],f=[];for(let m=1;m<e.length;m++){const y=r.parse(e[m],m,mn);if(!y)return null;f.push(y)}return new Ra(c,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof Zr)return r;if("string"==typeof r){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Hi(r[0],r[1],r[2],r[3]),!s))return new Zr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new xi(s||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const s of this.args){if(r=s.evaluate(e),null===r)return 0;const c=Number(r);if(!isNaN(c))return c}throw new xi(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?Kr.fromString(fs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?vi.fromString(fs(this.args[0].evaluate(e))):fs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new $o([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Pa(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var oa=Ra;const ka=["Unknown","Point","LineString","Polygon"];var Rc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ka[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Zr.parse(n)),e}};class sa{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],c=sa.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=m.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let b=null;for(const[w,S]of y){b=new K(r.registry,r.path,null,r.scope);const R=[];let k=!1;for(let N=1;N<e.length;N++){const G=e[N],q=Array.isArray(w)?w[N-1]:w.type,ie=b.parse(G,1+R.length,q);if(!ie){k=!0;break}R.push(ie)}if(!k)if(Array.isArray(w)&&w.length!==R.length)b.error(`Expected ${w.length} arguments, but found ${R.length} instead.`);else{for(let N=0;N<R.length;N++){const G=Array.isArray(w)?w[N]:w.type,q=R[N];b.concat(N+1).checkSubtype(G,q.type)}if(0===b.errors.length)return new sa(s,f,S,R)}}if(1===y.length)r.errors.push(...b.errors);else{const w=(y.length?y:m).map(([R])=>{return k=R,Array.isArray(k)?`(${k.map(Ar).join(", ")})`:`(${Ar(k.type)}...)`;var k}).join(" | "),S=[];for(let R=1;R<e.length;R++){const k=r.parse(e[R],1+S.length);if(!k)return null;S.push(Ar(k.type))}r.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,r){sa.definitions=r;for(const s in r)e[s]=sa}}var So=sa;class ms{constructor(e,r,s){this.type=ei,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(2!==e.length)return r.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,_n);if(!c)return null;const f=r.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,_n);if(!f)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,$n),!m)?null:new ms(c,f,m)}evaluate(e){return new Pr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ki=8192;function Go(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function aa(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function gl(n,e){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*Ki),Math.round(s*c*Ki)]}function _l(n,e,r){const s=n[0]-e[0],c=n[1]-e[1],f=n[0]-r[0],m=n[1]-r[1];return s*m-f*c==0&&s*f<=0&&c*m<=0}function Ho(n,e){let r=!1;for(let m=0,y=e.length;m<y;m++){const b=e[m];for(let w=0,S=b.length;w<S-1;w++){if(_l(n,b[w],b[w+1]))return!1;(c=b[w])[1]>(s=n)[1]!=(f=b[w+1])[1]>s[1]&&s[0]<(f[0]-c[0])*(s[1]-c[1])/(f[1]-c[1])+c[0]&&(r=!r)}}var s,c,f;return r}function yl(n,e){for(let r=0;r<e.length;r++)if(Ho(n,e[r]))return!0;return!1}function gs(n,e,r,s){const c=s[0]-r[0],f=s[1]-r[1],m=(n[0]-r[0])*f-c*(n[1]-r[1]),y=(e[0]-r[0])*f-c*(e[1]-r[1]);return m>0&&y<0||m<0&&y>0}function vl(n,e,r){for(const w of r)for(let S=0;S<w.length-1;++S)if((y=[(m=w[S+1])[0]-(f=w[S])[0],m[1]-f[1]])[0]*(b=[(c=e)[0]-(s=n)[0],c[1]-s[1]])[1]-y[1]*b[0]!=0&&gs(s,c,f,m)&&gs(f,m,s,c))return!0;var s,c,f,m,y,b;return!1}function Xl(n,e){for(let r=0;r<n.length;++r)if(!Ho(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(vl(n[r],n[r+1],e))return!1;return!0}function Yl(n,e){for(let r=0;r<e.length;r++)if(Xl(n,e[r]))return!0;return!1}function _s(n,e,r){const s=[];for(let c=0;c<n.length;c++){const f=[];for(let m=0;m<n[c].length;m++){const y=gl(n[c][m],r);Go(e,y),f.push(y)}s.push(f)}return s}function go(n,e,r){const s=[];for(let c=0;c<n.length;c++){const f=_s(n[c],e,r);s.push(f)}return s}function La(n,e,r,s){if(n[0]<r[0]||n[0]>r[2]){const c=.5*s;let f=n[0]-r[0]>c?-s:r[0]-n[0]>c?s:0;0===f&&(f=n[0]-r[2]>c?-s:r[2]-n[0]>c?s:0),n[0]+=f}Go(e,n)}function Fa(n,e,r,s){const c=Math.pow(2,s.z)*Ki,f=[s.x*Ki,s.y*Ki],m=[];if(!n)return m;for(const y of n)for(const b of y){const w=[b.x+f[0],b.y+f[1]];La(w,e,r,c),m.push(w)}return m}function la(n,e,r,s){const c=Math.pow(2,s.z)*Ki,f=[s.x*Ki,s.y*Ki],m=[];if(!n)return m;for(const b of n){const w=[];for(const S of b){const R=[S.x+f[0],S.y+f[1]];Go(e,R),w.push(R)}m.push(w)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const w of b)La(w,e,r,c)}var y;return m}class ti{constructor(e,r){this.type=_n,this.geojson=e,this.geometries=r}static parse(e,r){if(2!==e.length)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(pr(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let c=0;c<s.features.length;++c){const f=s.features[c].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new ti(s,s.features[c].geometry)}else if("Feature"===s.type){const c=s.geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new ti(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new ti(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(r,s){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if("Polygon"===s.type){const y=_s(s.coordinates,f,m),b=Fa(r.geometry(),c,f,m);if(!aa(c,f))return!1;for(const w of b)if(!Ho(w,y))return!1}if("MultiPolygon"===s.type){const y=go(s.coordinates,f,m),b=Fa(r.geometry(),c,f,m);if(!aa(c,f))return!1;for(const w of b)if(!yl(w,y))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(r,s){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if("Polygon"===s.type){const y=_s(s.coordinates,f,m),b=la(r.geometry(),c,f,m);if(!aa(c,f))return!1;for(const w of b)if(!Xl(w,y))return!1}if("MultiPolygon"===s.type){const y=go(s.coordinates,f,m),b=la(r.geometry(),c,f,m);if(!aa(c,f))return!1;for(const w of b)if(!Yl(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Fs=ti;function Mo(n){if(n instanceof So&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Fs)return!1;let e=!0;return n.eachChild(r=>{e&&!Mo(r)&&(e=!1)}),e}function ao(n){if(n instanceof So&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(r=>{e&&!ao(r)&&(e=!1)}),e}function Os(n,e){if(n instanceof So&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!Os(s,e)&&(r=!1)}),r}class or{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(2!==e.length||"string"!=typeof e[1])return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new or(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Qr=or;class z{constructor(e,r=[],s,c=new Bn,f=[]){this.registry=e,this.path=r,this.key=r.map(m=>`[${m}]`).join(""),this.scope=c,this.errors=f,this.expectedType=s}parse(e,r,s,c,f={}){return r?this.concat(r,s,c)._parse(e,f):this._parse(e,f)}_parse(e,r){function s(c,f,m){return"assert"===m?new jo(f,[c]):"coerce"===m?new oa(f,[c]):c}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if("string"!=typeof c)return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,b=m.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else m=s(m,y,r.typeAnnotation||"coerce");else m=s(m,y,r.typeAnnotation||"assert")}if(!(m instanceof Io)&&"resolvedImage"!==m.type.kind&&B(m)){const y=new Rc;try{m=new Io(m.type,m.evaluate(y))}catch(b){return this.error(b.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new z(this.registry,c,r||null,f,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new _i(s,e))}checkSubtype(e,r){const s=Vo(e,r);return s&&this.error(s),s}}var K=z;function B(n){if(n instanceof Qr)return B(n.boundExpression);if(n instanceof So&&"error"===n.name||n instanceof ms||n instanceof Fs)return!1;const e=n instanceof oa||n instanceof jo;let r=!0;return n.eachChild(s=>{r=e?r&&B(s):r&&s instanceof Io}),!!r&&Mo(n)&&Os(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function J(n,e){const r=n.length-1;let s,c,f=0,m=r,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),s=n[y],c=n[y+1],s<=e){if(y===r||e<c)return y;f=y+1}else{if(!(s>e))throw new xi("Input is not a number.");m=y-1}return 0}class Le{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,f]of s)this.labels.push(c),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ot);if(!s)return null;const c=[];let f=null;r.expectedType&&"value"!==r.expectedType.kind&&(f=r.expectedType);for(let m=1;m<e.length;m+=2){const y=1===m?-1/0:e[m],b=e[m+1],w=m,S=m+1;if("number"!=typeof y)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const R=r.parse(b,S,f);if(!R)return null;f=f||R.type,c.push([y,R])}return new Le(f,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const f=r.length;return c>=r[f-1]?s[f-1].evaluate(e):s[J(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var st=Le;function Je(n,e,r){return n*(1-r)+e*r}var Yt=Object.freeze({__proto__:null,number:Je,color:function(n,e,r){return new Zr(Je(n.r,e.r,r),Je(n.g,e.g,r),Je(n.b,e.b,r),Je(n.a,e.a,r))},array:function(n,e,r){return n.map((s,c)=>Je(s,e[c],r))}});const wr=4/29,yn=6/29,ni=3*yn*yn,Rr=Math.PI/180,un=180/Math.PI;function Zo(n){return n>.008856451679035631?Math.pow(n,1/3):n/ni+wr}function _o(n){return n>yn?n*n*n:ni*(n-wr)}function ys(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Bi(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Oa(n){const e=Bi(n.r),r=Bi(n.g),s=Bi(n.b),c=Zo((.4124564*e+.3575761*r+.1804375*s)/.95047),f=Zo((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*f-16,a:500*(c-f),b:200*(f-Zo((.0193339*e+.119192*r+.9503041*s)/1.08883)),alpha:n.a}}function ca(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*_o(e),r=.95047*_o(r),s=1.08883*_o(s),new Zr(ys(3.2404542*r-1.5371385*e-.4985314*s),ys(-.969266*r+1.8760108*e+.041556*s),ys(.0556434*r-.2040259*e+1.0572252*s),n.alpha)}function xl(n,e,r){const s=e-n;return n+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const bl={forward:Oa,reverse:ca,interpolate:function(n,e,r){return{l:Je(n.l,e.l,r),a:Je(n.a,e.a,r),b:Je(n.b,e.b,r),alpha:Je(n.alpha,e.alpha,r)}}},_t={forward:function(n){const{l:e,a:r,b:s}=Oa(n),c=Math.atan2(s,r)*un;return{h:c<0?c+360:c,c:Math.sqrt(r*r+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Rr,r=n.c;return ca({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:xl(n.h,e.h,r),c:Je(n.c,e.c,r),l:Je(n.l,e.l,r),alpha:Je(n.alpha,e.alpha,r)}}};var Kn=Object.freeze({__proto__:null,lab:bl,hcl:_t});class za{constructor(e,r,s,c,f){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,r,s,c){let f=0;if("exponential"===e.name)f=ua(r,e.base,s,c);else if("linear"===e.name)f=ua(r,1,s,c);else if("cubic-bezier"===e.name){const m=e.controlPoints;f=new hn(m[0],m[1],m[2],m[3]).solve(ua(r,1,s,c))}return f}static parse(e,r){let[s,c,f,...m]=e;if(!Array.isArray(c)||0===c.length)return r.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){const w=c[1];if("number"!=typeof w)return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if("cubic-bezier"!==c[0])return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(4!==w.length||w.some(S=>"number"!=typeof S||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Ot),!f)return null;const y=[];let b=null;"interpolate-hcl"===s||"interpolate-lab"===s?b=fr:r.expectedType&&"value"!==r.expectedType.kind&&(b=r.expectedType);for(let w=0;w<m.length;w+=2){const S=m[w],R=m[w+1],k=w+3,N=w+4;if("number"!=typeof S)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const G=r.parse(R,N,b);if(!G)return null;b=b||G.type,y.push([S,G])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new za(b,s,c,f,y):r.error(`Type ${Ar(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const f=r.length;if(c>=r[f-1])return s[f-1].evaluate(e);const m=J(r,c),y=za.interpolationFactor(this.interpolation,c,r[m],r[m+1]),b=s[m].evaluate(e),w=s[m+1].evaluate(e);return"interpolate"===this.operator?Yt[this.type.kind.toLowerCase()](b,w,y):"interpolate-hcl"===this.operator?_t.reverse(_t.interpolate(_t.forward(b),_t.forward(w),y)):bl.reverse(bl.interpolate(bl.forward(b),bl.forward(w),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function ua(n,e,r,s){const c=s-r,f=n-r;return 0===c?0:1===e?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}var yr=za;class Kl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&"value"!==c.kind&&(s=c);const f=[];for(const y of e.slice(1)){const b=r.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,f.push(b)}const m=c&&f.some(y=>Vo(c,y.type));return new Kl(m?mn:s,f)}evaluate(e){let r,s=null,c=0;for(const f of this.args){if(c++,s=f.evaluate(e),s&&s instanceof vi&&!s.available&&(r||(r=s),s=null,c===this.args.length))return r;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Ba=Kl;class Ao{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if("string"!=typeof m)return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=r.parse(e[f+1],f+1);if(!y)return null;s.push([m,y])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new Ao(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}var wl=Ao;class zs{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ot),c=r.parse(e[2],2,qn(r.expectedType||mn));return s&&c?new zs(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new xi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new xi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new xi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var rh=zs;class Ql{constructor(e,r){this.type=_n,this.needle=e,this.haystack=r}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,mn),c=r.parse(e[2],2,mn);return s&&c?ds(s.type,[_n,$n,Ot,Do,mn])?new Ql(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!zi(r,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Fr(r))} instead.`);if(!zi(s,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${Ar(Fr(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var kc=Ql;class qo{constructor(e,r,s){this.type=Ot,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,mn),c=r.parse(e[2],2,mn);if(!s||!c)return null;if(!ds(s.type,[_n,$n,Ot,Do,mn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(s.type)} instead`);if(4===e.length){const f=r.parse(e[3],3,Ot);return f?new qo(s,c,f):null}return new qo(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!zi(r,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Fr(r))} instead.`);if(!zi(s,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${Ar(Fr(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ni=qo;class Zi{constructor(e,r,s,c,f,m){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=f,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&"value"!==r.expectedType.kind&&(c=r.expectedType);const f={},m=[];for(let w=2;w<e.length-1;w+=2){let S=e[w];const R=e[w+1];Array.isArray(S)||(S=[S]);const k=r.concat(w);if(0===S.length)return k.error("Expected at least one branch label.");for(const G of S){if("number"!=typeof G&&"string"!=typeof G)return k.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,Fr(G)))return null}else s=Fr(G);if(void 0!==f[String(G)])return k.error("Branch labels must be unique.");f[String(G)]=m.length}const N=r.parse(R,w,c);if(!N)return null;c=c||N.type,m.push(N)}const y=r.parse(e[1],1,mn);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,c);return b?"value"!==y.type.kind&&r.concat(1).checkSubtype(s,y.type)?null:new Zi(s,c,y,f,m,b):null}evaluate(e){const r=this.input.evaluate(e);return(Fr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],c={};for(const m of r){const y=c[this.cases[m]];void 0===y?(c[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[y][1].push(m)}const f=m=>"number"===this.inputType.kind?Number(m):m;for(const[m,y]of s)e.push(1===y.length?f(y[0]):y.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var Lc=Zi;class Bs{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&"value"!==r.expectedType.kind&&(s=r.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const y=r.parse(e[m],m,_n);if(!y)return null;const b=r.parse(e[m+1],m+1,s);if(!b)return null;c.push([y,b]),s=s||b.type}const f=r.parse(e[e.length-1],e.length-1,s);return f?new Bs(s,c,f):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var rs=Bs;class El{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,mn),c=r.parse(e[2],2,Ot);if(!s||!c)return null;if(!ds(s.type,[qn(mn),$n,mn]))return r.error(`Expected first argument to be of type array or string, but found ${Ar(s.type)} instead`);if(4===e.length){const f=r.parse(e[3],3,Ot);return f?new El(s.type,s,c,f):null}return new El(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!zi(r,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${Ar(Fr(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Fc=El;function yu(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Jl(n,e,r,s){return 0===s.compare(e,r)}function Ns(n,e,r){const s="=="!==n&&"!="!==n;return class fx{constructor(f,m,y){this.type=_n,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument="value"===f.type.kind||"value"===m.type.kind}static parse(f,m){if(3!==f.length&&4!==f.length)return m.error("Expected two or three arguments.");const y=f[0];let b=m.parse(f[1],1,mn);if(!b)return null;if(!yu(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Ar(b.type)}'.`);let w=m.parse(f[2],2,mn);if(!w)return null;if(!yu(y,w.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Ar(w.type)}'.`);if(b.type.kind!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return m.error(`Cannot compare types '${Ar(b.type)}' and '${Ar(w.type)}'.`);s&&("value"===b.type.kind&&"value"!==w.type.kind?b=new jo(w.type,[b]):"value"!==b.type.kind&&"value"===w.type.kind&&(w=new jo(b.type,[w])));let S=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return m.error("Cannot use collator to compare non-string types.");if(S=m.parse(f[3],3,ei),!S)return null}return new fx(b,w,S)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const b=Fr(m),w=Fr(y);if(b.kind!==w.kind||"string"!==b.kind&&"number"!==b.kind)throw new xi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=Fr(m),w=Fr(y);if("string"!==b.kind||"string"!==w.kind)return e(f,m,y)}return this.collator?r(f,m,y,this.collator.evaluate(f)):e(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const ec=Ns("==",function(n,e,r){return e===r},Jl),Us=Ns("!=",function(n,e,r){return e!==r},function(n,e,r,s){return!Jl(0,e,r,s)}),tc=Ns("<",function(n,e,r){return e<r},function(n,e,r,s){return s.compare(e,r)<0}),vu=Ns(">",function(n,e,r){return e>r},function(n,e,r,s){return s.compare(e,r)>0}),Tl=Ns("<=",function(n,e,r){return e<=r},function(n,e,r,s){return s.compare(e,r)<=0}),ha=Ns(">=",function(n,e,r){return e>=r},function(n,e,r,s){return s.compare(e,r)>=0});class nc{constructor(e,r,s,c,f){this.type=$n,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,r){if(3!==e.length)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ot);if(!s)return null;const c=e[2];if("object"!=typeof c||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=r.parse(c.locale,1,$n),!f))return null;let m=null;if(c.currency&&(m=r.parse(c.currency,1,$n),!m))return null;let y=null;if(c["min-fraction-digits"]&&(y=r.parse(c["min-fraction-digits"],1,Ot),!y))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,Ot),!b)?null:new nc(s,f,m,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Dl{constructor(e){this.type=Ot,this.input=e}static parse(e,r){if(2!==e.length)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?r.error(`Expected argument of type string or array, but found ${Ar(s.type)} instead.`):new Dl(s):null}evaluate(e){const r=this.input.evaluate(e);if("string"==typeof r||Array.isArray(r))return r.length;throw new xi(`Expected value to be of type string or array, but found ${Ar(Fr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Vs={"==":ec,"!=":Us,">":vu,"<":tc,">=":ha,"<=":Tl,array:jo,at:rh,boolean:jo,case:rs,coalesce:Ba,collator:ms,format:$o,image:Pa,in:kc,"index-of":Ni,interpolate:yr,"interpolate-hcl":yr,"interpolate-lab":yr,length:Dl,let:wl,literal:Io,match:Lc,number:jo,"number-format":nc,object:jo,slice:Fc,step:st,string:jo,"to-boolean":oa,"to-color":oa,"to-number":oa,"to-string":oa,var:Qr,within:Fs};function rc(n,[e,r,s,c]){e=e.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const f=c?c.evaluate(n):1,m=Hi(e,r,s,f);if(m)throw new xi(m);return new Zr(e/255*f,r/255*f,s/255*f,f)}function Na(n,e){return n in e}function Oc(n,e){const r=e[n];return void 0===r?null:r}function da(n){return{type:n}}So.register(Vs,{error:[{kind:"error"},[$n],(n,[e])=>{throw new xi(e.evaluate(n))}],typeof:[$n,[mn],(n,[e])=>Ar(Fr(e.evaluate(n)))],"to-rgba":[qn(Ot,4),[fr],(n,[e])=>e.evaluate(n).toArray()],rgb:[fr,[Ot,Ot,Ot],rc],rgba:[fr,[Ot,Ot,Ot,Ot],rc],has:{type:_n,overloads:[[[$n],(n,[e])=>Na(e.evaluate(n),n.properties())],[[$n,so],(n,[e,r])=>Na(e.evaluate(n),r.evaluate(n))]]},get:{type:mn,overloads:[[[$n],(n,[e])=>Oc(e.evaluate(n),n.properties())],[[$n,so],(n,[e,r])=>Oc(e.evaluate(n),r.evaluate(n))]]},"feature-state":[mn,[$n],(n,[e])=>Oc(e.evaluate(n),n.featureState||{})],properties:[so,[],n=>n.properties()],"geometry-type":[$n,[],n=>n.geometryType()],id:[mn,[],n=>n.id()],zoom:[Ot,[],n=>n.globals.zoom],pitch:[Ot,[],n=>n.globals.pitch||0],"distance-from-center":[Ot,[],n=>n.distanceFromCenter()],"heatmap-density":[Ot,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ot,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Ot,[],n=>n.globals.skyRadialProgress||0],accumulated:[mn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Ot,da(Ot),(n,e)=>{let r=0;for(const s of e)r+=s.evaluate(n);return r}],"*":[Ot,da(Ot),(n,e)=>{let r=1;for(const s of e)r*=s.evaluate(n);return r}],"-":{type:Ot,overloads:[[[Ot,Ot],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Ot],(n,[e])=>-e.evaluate(n)]]},"/":[Ot,[Ot,Ot],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Ot,[Ot,Ot],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Ot,[],()=>Math.LN2],pi:[Ot,[],()=>Math.PI],e:[Ot,[],()=>Math.E],"^":[Ot,[Ot,Ot],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Ot,[Ot],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Ot,[Ot],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Ot,[Ot],(n,[e])=>Math.log(e.evaluate(n))],log2:[Ot,[Ot],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Ot,[Ot],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Ot,[Ot],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Ot,[Ot],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Ot,[Ot],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Ot,[Ot],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Ot,[Ot],(n,[e])=>Math.atan(e.evaluate(n))],min:[Ot,da(Ot),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Ot,da(Ot),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Ot,[Ot],(n,[e])=>Math.abs(e.evaluate(n))],round:[Ot,[Ot],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ot,[Ot],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Ot,[Ot],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[_n,[$n,mn],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[_n,[mn],(n,[e])=>n.id()===e.value],"filter-type-==":[_n,[$n],(n,[e])=>n.geometryType()===e.value],"filter-<":[_n,[$n,mn],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[_n,[mn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[_n,[$n,mn],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[_n,[mn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[_n,[$n,mn],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[_n,[mn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[_n,[$n,mn],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[_n,[mn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[_n,[mn],(n,[e])=>e.value in n.properties()],"filter-has-id":[_n,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[_n,[qn($n)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[_n,[qn(mn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[_n,[$n,qn(mn)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[_n,[$n,qn(mn)],(n,[e,r])=>function(s,c,f,m){for(;f<=m;){const y=f+m>>1;if(c[y]===s)return!0;c[y]>s?m=y-1:f=y+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:_n,overloads:[[[_n,_n],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[da(_n),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:_n,overloads:[[[_n,_n],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[da(_n),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[_n,[_n],(n,[e])=>!e.evaluate(n)],"is-supported-script":[_n,[$n],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[$n,[$n],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[$n,[$n],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[$n,da(mn),(n,e)=>e.map(r=>fs(r.evaluate(n))).join("")],"resolved-locale":[$n,[ei],(n,[e])=>e.evaluate(n).resolvedLocale()]});var bi=Vs;function vs(n){return{result:"success",value:n}}function Or(n){return{result:"error",value:n}}function Ua(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function Cl(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function ic(n){return!!n.expression&&n.expression.interpolated}function Qn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function oc(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function ih(n){return n}function Il(n,e){const r="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],c=s||!(s||void 0!==n.property),f=n.type||(ic(e)?"exponential":"interval");if(r&&((n=Hr({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],Zr.parse(w[1])])),n.default=Zr.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Kn[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,y,b;if("exponential"===f)m=xu;else if("interval"===f)m=xs;else if("categorical"===f){m=Sl,y=Object.create(null);for(const w of n.stops)y[w[0]]=w[1];b=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);m=bu}if(s){const w={},S=[];for(let N=0;N<n.stops.length;N++){const G=n.stops[N],q=G[0].zoom;void 0===w[q]&&(w[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},S.push(q)),w[q].stops.push([G[0].value,G[1]])}const R=[];for(const N of S)R.push([w[N].zoom,Il(w[N],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:yr.interpolationFactor.bind(void 0,k),zoomStops:R.map(N=>N[0]),evaluate:({zoom:N},G)=>xu({stops:R,base:n.base},e,N).evaluate(N,G)}}if(c){const w="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:yr.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(n,e,S,y,b)}}return{kind:"source",evaluate(w,S){const R=S&&S.properties?S.properties[n.property]:void 0;return void 0===R?Qi(n.default,e.default):m(n,e,R,y,b)}}}function Qi(n,e,r){return void 0!==n?n:void 0!==e?e:void 0!==r?r:void 0}function Sl(n,e,r,s,c){return Qi(typeof r===c?s[r]:void 0,n.default,e.default)}function xs(n,e,r){if("number"!==Qn(r))return Qi(n.default,e.default);const s=n.stops.length;if(1===s||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const c=J(n.stops.map(f=>f[0]),r);return n.stops[c][1]}function xu(n,e,r){const s=void 0!==n.base?n.base:1;if("number"!==Qn(r))return Qi(n.default,e.default);const c=n.stops.length;if(1===c||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];const f=J(n.stops.map(S=>S[0]),r),m=function(S,R,k,N){const G=N-k,q=S-k;return 0===G?0:1===R?q/G:(Math.pow(R,q)-1)/(Math.pow(R,G)-1)}(r,s,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],b=n.stops[f+1][1];let w=Yt[e.type]||ih;if(n.colorSpace&&"rgb"!==n.colorSpace){const S=Kn[n.colorSpace];w=(R,k)=>S.reverse(S.interpolate(S.forward(R),S.forward(k),m))}return"function"==typeof y.evaluate?{evaluate(...S){const R=y.evaluate.apply(void 0,S),k=b.evaluate.apply(void 0,S);if(void 0!==R&&void 0!==k)return w(R,k,m)}}:w(y,b,m)}function bu(n,e,r){return"color"===e.type?r=Zr.parse(r):"formatted"===e.type?r=Kr.fromString(r.toString()):"resolvedImage"===e.type?r=vi.fromString(r.toString()):Qn(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Qi(r,n.default,e.default)}class Po{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Rc,this._defaultValue=r?"color"===(s=r).type&&(oc(s.default)||Array.isArray(s.default))?new Zr(0,0,0,0):"color"===s.type?Zr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,f,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,f,m,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function bs(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in bi}function js(n,e){const r=new K(bi,[],e?function(c){const f={color:fr,string:$n,number:Ot,enum:$n,boolean:_n,formatted:Yi,resolvedImage:Co};return"array"===c.type?qn(f[c.value]||mn,c.length):f[c.type]}(e):void 0),s=r.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?vs(new Po(s,e)):Or(r.errors)}class Ml{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent="constant"!==e&&!ao(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,f,m)}evaluate(e,r,s,c,f,m){return this._styleExpression.evaluate(e,r,s,c,f,m)}}class ws{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent="camera"!==e&&!ao(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,f,m)}evaluate(e,r,s,c,f,m){return this._styleExpression.evaluate(e,r,s,c,f,m)}interpolationFactor(e,r,s){return this.interpolationType?yr.interpolationFactor(this.interpolationType,e,r,s):0}}function $s(n,e){if("error"===(n=js(n,e)).result)return n;const r=n.value.expression,s=Mo(r);if(!s&&!Ua(e))return Or([new _i("","data expressions not supported")]);const c=Os(r,["zoom","pitch","distance-from-center"]);if(!c&&!Cl(e))return Or([new _i("","zoom expressions not supported")]);const f=Va(r);return f||c?f instanceof _i?Or([f]):f instanceof yr&&!ic(e)?Or([new _i("",'"interpolate" expressions cannot be used with this property')]):vs(f?new ws(s?"camera":"composite",n.value,f.labels,f instanceof yr?f.interpolation:void 0):new Ml(s?"constant":"source",n.value)):Or([new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Al{constructor(e,r){this._parameters=e,this._specification=r,Hr(this,Il(this._parameters,this._specification))}static deserialize(e){return new Al(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Va(n){let e=null;if(n instanceof wl)e=Va(n.result);else if(n instanceof Ba){for(const r of n.args)if(e=Va(r),e)break}else(n instanceof st||n instanceof yr)&&n.input instanceof So&&"zoom"===n.input.name&&(e=n);return e instanceof _i||n.eachChild(r=>{const s=Va(r);s instanceof _i?e=s:!e&&s?e=new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new _i("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Ht{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),null!=r&&r.__line__&&(this.line=r.__line__)}}function Wo(n){const e=n.key,r=n.value,s=n.valueSpec||{},c=n.objectElementValidators||{},f=n.style,m=n.styleSpec;let y=[];const b=Qn(r);if("object"!==b)return[new Ht(e,r,`object expected, ${b} found`)];for(const w in r){const S=w.split(".")[0],R=s[S]||s["*"];let k;c[S]?k=c[S]:s[S]?k=wi:c["*"]?k=c["*"]:s["*"]&&(k=wi),k?y=y.concat(k({key:(e&&`${e}.`)+w,value:r[w],valueSpec:R,style:f,styleSpec:m,object:r,objectKey:w},r)):y.push(new Ht(e,r[w],`unknown property "${w}"`))}for(const w in s)c[w]||s[w].required&&void 0===s[w].default&&void 0===r[w]&&y.push(new Ht(e,r,`missing required property "${w}"`));return y}function Gs(n){const e=n.value,r=n.valueSpec,s=n.style,c=n.styleSpec,f=n.key,m=n.arrayElementValidator||wi;if("array"!==Qn(e))return[new Ht(f,e,`array expected, ${Qn(e)} found`)];if(r.length&&e.length!==r.length)return[new Ht(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ht(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};c.$version<7&&(y.function=r.function),"object"===Qn(r.value)&&(y=r.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(m({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:s,styleSpec:c,key:`${f}[${w}]`}));return b}function Es(n){const e=n.key,r=n.value,s=n.valueSpec;let c=Qn(r);if("number"===c&&r!=r&&(c="NaN"),"number"!==c)return[new Ht(e,r,`number expected, ${c} found`)];if("minimum"in s){let f=s.minimum;if("array"===Qn(s.minimum)&&(f=s.minimum[n.arrayIndex]),r<f)return[new Ht(e,r,`${r} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===Qn(s.maximum)&&(f=s.maximum[n.arrayIndex]),r>f)return[new Ht(e,r,`${r} is greater than the maximum value ${f}`)]}return[]}function ja(n){const e=n.valueSpec,r=Tn(n.value.type);let s,c,f,m={};const y="categorical"!==r&&void 0===n.value.property,b=!y,w="array"===Qn(n.value.stops)&&"array"===Qn(n.value.stops[0])&&"object"===Qn(n.value.stops[0][0]),S=Wo({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(N){if("identity"===r)return[new Ht(N.key,N.value,'identity function may not have a "stops" property')];let G=[];const q=N.value;return G=G.concat(Gs({key:N.key,value:q,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:R})),"array"===Qn(q)&&0===q.length&&G.push(new Ht(N.key,q,"array must have at least one stop")),G},default:function(N){return wi({key:N.key,value:N.value,valueSpec:e,style:N.style,styleSpec:N.styleSpec})}}});return"identity"===r&&y&&S.push(new Ht(n.key,n.value,'missing required property "property"')),"identity"===r||n.value.stops||S.push(new Ht(n.key,n.value,'missing required property "stops"')),"exponential"===r&&n.valueSpec.expression&&!ic(n.valueSpec)&&S.push(new Ht(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!Ua(n.valueSpec)?S.push(new Ht(n.key,n.value,"property functions not supported")):y&&!Cl(n.valueSpec)&&S.push(new Ht(n.key,n.value,"zoom functions not supported"))),"categorical"!==r&&!w||void 0!==n.value.property||S.push(new Ht(n.key,n.value,'"property" property is required')),S;function R(N){let G=[];const q=N.value,ie=N.key;if("array"!==Qn(q))return[new Ht(ie,q,`array expected, ${Qn(q)} found`)];if(2!==q.length)return[new Ht(ie,q,`array length 2 expected, length ${q.length} found`)];if(w){if("object"!==Qn(q[0]))return[new Ht(ie,q,`object expected, ${Qn(q[0])} found`)];if(void 0===q[0].zoom)return[new Ht(ie,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new Ht(ie,q,"object stop key must have value")];const ue=Tn(q[0].zoom);if("number"!=typeof ue)return[new Ht(ie,q[0].zoom,"stop zoom values must be numbers")];if(f&&f>ue)return[new Ht(ie,q[0].zoom,"stop zoom values must appear in ascending order")];ue!==f&&(f=ue,c=void 0,m={}),G=G.concat(Wo({key:`${ie}[0]`,value:q[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:Es,value:k}}))}else G=G.concat(k({key:`${ie}[0]`,value:q[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},q));return bs(xn(q[1]))?G.concat([new Ht(`${ie}[1]`,q[1],"expressions are not allowed in function stops.")]):G.concat(wi({key:`${ie}[1]`,value:q[1],valueSpec:e,style:N.style,styleSpec:N.styleSpec}))}function k(N,G){const q=Qn(N.value),ie=Tn(N.value),ue=null!==N.value?N.value:G;if(s){if(q!==s)return[new Ht(N.key,ue,`${q} stop domain type must match previous stop domain type ${s}`)]}else s=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof ie&&"string"!=typeof ie&&"boolean"!=typeof ie)return[new Ht(N.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==r){let Ee=`number expected, ${q} found`;return Ua(e)&&void 0===r&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ht(N.key,ue,Ee)]}return"categorical"!==r||"number"!==q||"number"==typeof ie&&isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==r&&"number"===q&&"number"==typeof ie&&"number"==typeof c&&void 0!==c&&ie<c?[new Ht(N.key,ue,"stop domain values must appear in ascending order")]:(c=ie,"categorical"===r&&ie in m?[new Ht(N.key,ue,"stop domain values must be unique")]:(m[ie]=!0,[])):[new Ht(N.key,ue,`integer expected, found ${String(ie)}`)]}}function is(n){const e=("property"===n.expressionContext?$s:js)(xn(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new Ht(`${n.key}${s.key}`,n.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!r.outputDefined())return[new Ht(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!ao(r))return[new Ht(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return Pl(r,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Os(r,["zoom","feature-state"]))return[new Ht(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!Mo(r))return[new Ht(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pl(n,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)r.delete(c);if(0===r.size)return[];const s=[];return n instanceof So&&r.has(n.name)?[new Ht(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(c=>{s.push(...Pl(c,e))}),s)}function $a(n){const e=n.key,r=n.value,s=n.valueSpec,c=[];return Array.isArray(s.values)?-1===s.values.indexOf(Tn(r))&&c.push(new Ht(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(s.values).indexOf(Tn(r))&&c.push(new Ht(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Ts(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ts(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ds(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ts(n)||(n=fa(n));const r=n;let s=!0;try{s=function(w){if(!Is(w))return w;let S=xn(w);return sc(S),S=Cs(S),S}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const c=ke[`filter_${e}`],f=js(s,c);let m=null;if("error"===f.result)throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,S,R)=>f.value.evaluate(w,S,{},R);let y=null,b=null;if(s!==r){const w=js(r,c);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,R,k,N,G)=>w.value.evaluate(S,R,{},k,void 0,void 0,N,G),b=!Mo(w.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:Ga(s),needFeature:!!b}}function Cs(n){if(!Array.isArray(n))return n;const e=function(r){if(oh.has(r[0]))for(let s=1;s<r.length;s++)if(Is(r[s]))return!0;return r}(n);return!0===e?e:e.map(r=>Cs(r))}function sc(n){let e=!1;const r=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||Is(n[s]),r.push(n[s+1]);r.push(n[n.length-1])}else if("match"===n[0]){e=e||Is(n[1]);for(let s=2;s<n.length-1;s+=2)r.push(n[s+1]);r.push(n[n.length-1])}else if("step"===n[0]){e=e||Is(n[1]);for(let s=1;s<n.length-1;s+=2)r.push(n[s+1])}e&&(n.length=0,n.push("any",...r));for(let s=1;s<n.length;s++)sc(n[s])}function Is(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let r=1;r<n.length;r++)if(Is(n[r]))return!0;return!1}const oh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wu(n,e){return n<e?-1:n>e?1:0}function Ga(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Ga(n[e]))return!0;return!1}function fa(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?qr(n[1],n[2],"=="):"!="===e?pa(qr(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?qr(n[1],n[2],e):"any"===e?(r=n.slice(1),["any"].concat(r.map(fa))):"all"===e?["all"].concat(n.slice(1).map(fa)):"none"===e?["all"].concat(n.slice(1).map(fa).map(pa)):"in"===e?hi(n[1],n.slice(2)):"!in"===e?pa(hi(n[1],n.slice(2))):"has"===e?Ha(n[1]):"!has"===e?pa(Ha(n[1])):"within"!==e||n;var r}function qr(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function hi(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(wu)]]:["filter-in-small",n,["literal",e]]}}function Ha(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function pa(n){return["!",n]}function Hs(n){return Ts(xn(n.value))?is(Hr({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):ma(n)}function ma(n){const e=n.value,r=n.key;if("array"!==Qn(e))return[new Ht(r,e,`array expected, ${Qn(e)} found`)];const s=n.styleSpec;let c,f=[];if(e.length<1)return[new Ht(r,e,"filter array must have at least 1 element")];switch(f=f.concat($a({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Tn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Tn(e[1])&&f.push(new Ht(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new Ht(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Qn(e[1]),"string"!==c&&f.push(new Ht(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=Qn(e[m]),"$type"===Tn(e[1])?f=f.concat($a({key:`${r}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==c&&"number"!==c&&"boolean"!==c&&f.push(new Ht(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(ma({key:`${r}[${m}]`,value:e[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Qn(e[1]),2!==e.length?f.push(new Ht(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==c&&f.push(new Ht(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Qn(e[1]),2!==e.length?f.push(new Ht(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==c&&f.push(new Ht(`${r}[1]`,e[1],`object expected, ${c} found`))}return f}function Zs(n,e){const r=n.key,s=n.style,c=n.styleSpec,f=n.value,m=n.objectKey,y=c[`${e}_${n.layerType}`];if(!y)return[];const b=m.match(/^(.*)-transition$/);if("paint"===e&&b&&y[b[1]]&&y[b[1]].transition)return wi({key:r,value:f,valueSpec:c.transition,style:s,styleSpec:c});const w=n.valueSpec||y[m];if(!w)return[new Ht(r,f,`unknown property "${m}"`)];let S;if("string"===Qn(f)&&Ua(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(f)))return[new Ht(r,f,`"${m}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const R=[];return"symbol"===n.layerType&&("text-field"===m&&s&&!s.glyphs&&R.push(new Ht(r,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===m&&oc(xn(f))&&"identity"===Tn(f.type)&&R.push(new Ht(r,f,'"text-font" does not support identity functions'))),R.concat(wi({key:n.key,value:f,valueSpec:w,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:m}))}function Eu(n){return Zs(n,"paint")}function Za(n){return Zs(n,"layout")}function zc(n){let e=[];const r=n.value,s=n.key,c=n.style,f=n.styleSpec;r.type||r.ref||e.push(new Ht(s,r,'either "type" or "ref" is required'));let m=Tn(r.type);const y=Tn(r.ref);if(r.id){const b=Tn(r.id);for(let w=0;w<n.arrayIndex;w++){const S=c.layers[w];Tn(S.id)===b&&e.push(new Ht(s,r.id,`duplicate layer id "${r.id}", previously used at line ${S.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new Ht(s,r[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{Tn(w.id)===y&&(b=w)}),b?b.ref?e.push(new Ht(s,r.ref,"ref cannot reference another ref layer")):m=Tn(b.type):"string"==typeof y&&e.push(new Ht(s,r.ref,`ref layer "${y}" not found`))}else if("background"!==m&&"sky"!==m)if(r.source){const b=c.sources&&c.sources[r.source],w=b&&Tn(b.type);b?"vector"===w&&"raster"===m?e.push(new Ht(s,r.source,`layer "${r.id}" requires a raster source`)):"raster"===w&&"raster"!==m?e.push(new Ht(s,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==w||r["source-layer"]?"raster-dem"===w&&"hillshade"!==m?e.push(new Ht(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==m||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===w&&b.lineMetrics||e.push(new Ht(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ht(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ht(s,r.source,`source "${r.source}" not found`))}else e.push(new Ht(s,r,'missing required property "source"'));return e=e.concat(Wo({key:s,value:r,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wi({key:`${s}.type`,value:r.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:b=>Hs(Hr({layerType:m},b)),layout:b=>Wo({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Za(Hr({layerType:m},w))}}),paint:b=>Wo({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Eu(Hr({layerType:m},w))}})}})),e}function qs(n){const e=n.value,r=n.key,s=Qn(e);return"string"!==s?[new Ht(r,e,`string expected, ${s} found`)]:[]}const ac={promoteId:function({key:n,value:e}){if("string"===Qn(e))return qs({key:n,value:e});{const r=[];for(const s in e)r.push(...qs({key:`${n}.${s}`,value:e[s]}));return r}}};function sh(n){const e=n.value,r=n.key,s=n.styleSpec,c=n.style;if(!e.type)return[new Ht(r,e,'"type" is required')];const f=Tn(e.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=Wo({key:r,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:ac}),m;case"geojson":if(m=Wo({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:ac}),e.cluster)for(const y in e.clusterProperties){const[b,w]=e.clusterProperties[y],S="string"==typeof b?[b,["accumulated"],["get",y]]:b;m.push(...is({key:`${r}.${y}.map`,value:w,expressionContext:"cluster-map"})),m.push(...is({key:`${r}.${y}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return m;case"video":return Wo({key:r,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return Wo({key:r,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new Ht(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $a({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function ga(n){const e=n.value,r=n.styleSpec,s=r.light,c=n.style;let f=[];const m=Qn(e);if(void 0===e)return f;if("object"!==m)return f=f.concat([new Ht("light",e,`object expected, ${m} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&s[b[1]]&&s[b[1]].transition?wi({key:y,value:e[y],valueSpec:r.transition,style:c,styleSpec:r}):s[y]?wi({key:y,value:e[y],valueSpec:s[y],style:c,styleSpec:r}):[new Ht(y,e[y],`unknown property "${y}"`)])}return f}function Ws(n){const e=n.value,r=n.key,s=n.style,c=n.styleSpec,f=c.terrain;let m=[];const y=Qn(e);if(void 0===e)return m;if("object"!==y)return m=m.concat([new Ht("terrain",e,`object expected, ${y} found`)]),m;for(const b in e){const w=b.match(/^(.*)-transition$/);m=m.concat(w&&f[w[1]]&&f[w[1]].transition?wi({key:b,value:e[b],valueSpec:c.transition,style:s,styleSpec:c}):f[b]?wi({key:b,value:e[b],valueSpec:f[b],style:s,styleSpec:c}):[new Ht(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=s.sources&&s.sources[e.source],w=b&&Tn(b.type);b?"raster-dem"!==w&&m.push(new Ht(r,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):m.push(new Ht(r,e.source,`source "${e.source}" not found`))}else m.push(new Ht(r,e,'terrain is missing required property "source"'));return m}function Tu(n){const e=n.value,r=n.style,s=n.styleSpec,c=s.fog;let f=[];const m=Qn(e);if(void 0===e)return f;if("object"!==m)return f=f.concat([new Ht("fog",e,`object expected, ${m} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&c[b[1]]&&c[b[1]].transition?wi({key:y,value:e[y],valueSpec:s.transition,style:r,styleSpec:s}):c[y]?wi({key:y,value:e[y],valueSpec:c[y],style:r,styleSpec:s}):[new Ht(y,e[y],`unknown property "${y}"`)])}return f}const yo={"*":()=>[],array:Gs,boolean:function(n){const e=n.value,r=n.key,s=Qn(e);return"boolean"!==s?[new Ht(r,e,`boolean expected, ${s} found`)]:[]},number:Es,color:function(n){const e=n.key,r=n.value,s=Qn(r);return"string"!==s?[new Ht(e,r,`color expected, ${s} found`)]:null===ns.parseCSSColor(r)?[new Ht(e,r,`color expected, "${r}" found`)]:[]},enum:$a,filter:Hs,function:ja,layer:zc,object:Wo,source:sh,light:ga,terrain:Ws,fog:Tu,string:qs,formatted:function(n){return 0===qs(n).length?[]:is(n)},resolvedImage:function(n){return 0===qs(n).length?[]:is(n)},projection:function(n){const e=n.value,r=n.styleSpec,s=r.projection,c=n.style;let f=[];const m=Qn(e);if("object"===m)for(const y in e)f=f.concat(wi({key:y,value:e[y],valueSpec:s[y],style:c,styleSpec:r}));else"string"!==m&&(f=f.concat([new Ht("projection",e,`object or string expected, ${m} found`)]));return f}};function wi(n){const e=n.value,r=n.valueSpec,s=n.styleSpec;return r.expression&&oc(Tn(e))?ja(n):r.expression&&bs(xn(e))?is(n):r.type&&yo[r.type]?yo[r.type](n):Wo(Hr({},n,{valueSpec:r.type?s[r.type]:r}))}function Ss(n){const e=n.value,r=n.key,s=qs(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new Ht(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new Ht(r,e,'"glyphs" url must include a "{range}" token'))),s}function Bc(n,e=ke){return Xo(wi({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Ss,"*":()=>[]}}))}const Nc=n=>Xo(Eu(n)),Uc=n=>Xo(Za(n));function Xo(n){return n.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Vc(n,e){let r=!1;if(e&&e.length)for(const s of e)n.fire(new $t(new Error(s.message))),r=!0;return r}var Xs=Ji;function Ji(n,e,r){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var c=new Int32Array(this.arrayBuffer);n=c[0],this.d=(e=c[1])+2*(r=c[2]);for(var f=0;f<this.d*this.d;f++){var m=c[3+f],y=c[3+f+1];s.push(m===y?null:c.subarray(m,y))}var b=c[3+s.length+1];this.keys=c.subarray(c[3+s.length],b),this.bboxes=c.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=r,this.scale=e/n,this.uid=0;var S=r/e*n;this.min=-S,this.max=n+S}Ji.prototype.insert=function(n,e,r,s,c){this._forEachCell(e,r,s,c,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c)},Ji.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ji.prototype._insertCell=function(n,e,r,s,c,f){this.cells[c].push(f)},Ji.prototype.query=function(n,e,r,s,c){var f=this.min,m=this.max;if(n<=f&&e<=f&&m<=r&&m<=s&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,r,s,this._queryCell,y,{},c),y},Ji.prototype._queryCell=function(n,e,r,s,c,f,m,y){var b=this.cells[c];if(null!==b)for(var w=this.keys,S=this.bboxes,R=0;R<b.length;R++){var k=b[R];if(void 0===m[k]){var N=4*k;(y?y(S[N+0],S[N+1],S[N+2],S[N+3]):n<=S[N+2]&&e<=S[N+3]&&r>=S[N+0]&&s>=S[N+1])?(m[k]=!0,f.push(w[k])):m[k]=!1}}},Ji.prototype._forEachCell=function(n,e,r,s,c,f,m,y){for(var b=this._convertToCellCoord(n),w=this._convertToCellCoord(e),S=this._convertToCellCoord(r),R=this._convertToCellCoord(s),k=b;k<=S;k++)for(var N=w;N<=R;N++){var G=this.d*N+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(N),this._convertFromCellCoord(k+1),this._convertFromCellCoord(N+1)))&&c.call(this,n,e,r,s,G,f,m,y))return}},Ji.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Ji.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Ji.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var c=new Int32Array(e+r+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var f=e,m=0;m<n.length;m++){var y=n[m];c[3+m]=f,c.set(y,f),f+=y.length}return c[3+n.length]=f,c.set(this.keys,f),c[3+n.length+1]=f+=this.keys.length,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer};const Ms={};function Ut(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Ms[e]={klass:n,omit:r.omit||[]}}Ut(Object,"Object"),Xs.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.push(r),{buffer:r}},Xs.deserialize=function(n){return new Xs(n.buffer)},Object.defineProperty(Xs,"name",{value:"Grid"}),Ut(Xs,"Grid"),Ut(Zr,"Color"),Ut(Error,"Error"),Ut(Te,"AJAXError"),Ut(vi,"ResolvedImage"),Ut(Al,"StylePropertyFunction"),Ut(Po,"StyleExpression",{omit:["_evaluator"]}),Ut(ws,"ZoomDependentExpression"),Ut(Ml,"ZoomConstantExpression"),Ut(So,"CompoundExpression",{omit:["_evaluate"]});for(const n in bi)Ms[bi[n]._classRegistryKey]||Ut(bi[n],`Expression${n}`);function lc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function cc(n){return Ae.ImageBitmap&&n instanceof Ae.ImageBitmap}function os(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(lc(n)||cc(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof Ae.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const s of n)r.push(os(s,e));return r}if("object"==typeof n){const r=n.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const f in n)n.hasOwnProperty(f)&&(Ms[s].omit.indexOf(f)>=0||(c[f]=os(n[f],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof n)}function uc(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||lc(n)||cc(n)||ArrayBuffer.isView(n)||n instanceof Ae.ImageData)return n;if(Array.isArray(n))return n.map(uc);if("object"==typeof n){const e=n.$name||"Object",{klass:r}=Ms[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const c of Object.keys(n))"$name"!==c&&(s[c]=uc(n[c]));return s}throw new Error("can't deserialize object of type "+typeof n)}class Du{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Er=n=>n>=1536&&n<=1791,Cu=n=>n>=1872&&n<=1919,hc=n=>n>=2208&&n<=2303,Iu=n=>n>=11904&&n<=12031,ah=n=>n>=12032&&n<=12255,qa=n=>n>=12272&&n<=12287,jc=n=>n>=12288&&n<=12351,$c=n=>n>=12352&&n<=12447,Ys=n=>n>=12448&&n<=12543,lh=n=>n>=12544&&n<=12591,M=n=>n>=12704&&n<=12735,C=n=>n>=12736&&n<=12783,D=n=>n>=12784&&n<=12799,L=n=>n>=12800&&n<=13055,U=n=>n>=13056&&n<=13311,X=n=>n>=13312&&n<=19903,pe=n=>n>=19968&&n<=40959,De=n=>n>=40960&&n<=42127,Ye=n=>n>=42128&&n<=42191,It=n=>n>=44032&&n<=55215,Rn=n=>n>=63744&&n<=64255,en=n=>n>=64336&&n<=65023,zr=n=>n>=65040&&n<=65055,Wr=n=>n>=65072&&n<=65103,Ro=n=>n>=65104&&n<=65135,Wa=n=>n>=65136&&n<=65279,Xa=n=>n>=65280&&n<=65519;function Ui(n){for(const e of n)if(t(e.charCodeAt(0)))return!0;return!1}function ss(n){for(const e of n)if(!h(e.charCodeAt(0)))return!1;return!0}function h(n){return!(Er(n)||Cu(n)||hc(n)||en(n)||Wa(n))}function t(n){return!(746!==n&&747!==n&&(n<4352||!(M(n)||lh(n)||Wr(n)&&!(n>=65097&&n<=65103)||Rn(n)||U(n)||Iu(n)||C(n)||!(!jc(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||X(n)||pe(n)||L(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||It(n)||$c(n)||qa(n)||(e=>e>=12688&&e<=12703)(n)||ah(n)||D(n)||Ys(n)&&12540!==n||!(!Xa(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Ro(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||zr(n)||(e=>e>=19904&&e<=19967)(n)||De(n)||Ye(n))));var e}function l(n){return!(t(n)||(e=n,(r=e)>=128&&r<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(r=>r>=8192&&r<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&9251!==e||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jc(e)||Ys(e)||(r=>r>=57344&&r<=63743)(e)||Wr(e)||Ro(e)||Xa(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,r}function p(n){return n>=1424&&n<=2303||en(n)||Wa(n)}function _(n,e){return!(!e&&p(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(r=n,r>=6016&&r<=6143));var r}function v(n){for(const e of n)if(p(e.charCodeAt(0)))return!0;return!1}const E="deferred",I="loading",A="loaded";let O=null,V="unavailable",H=null;const W=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(V="error"),O&&O(n)};function te(){ne.fire(new rt("pluginStateChange",{pluginStatus:V,pluginURL:H}))}const ne=new nn,Q=function(){return V},_e=function(){if(V!==E||!H)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");V=I,te(),H&&Ie({url:H},n=>{n?W(n):(V=A,te())})},ee={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>V===A||null!=ee.applyArabicShaping,isLoading:()=>V===I,setState(n){V=n.pluginStatus,H=n.pluginURL},isParsed:()=>null!=ee.applyArabicShaping&&null!=ee.processBidirectionalText&&null!=ee.processStyledBidirectionalText,getPluginURL:()=>H};class ae{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Du,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,s){for(const c of r)if(!_(c.charCodeAt(0),s))return!1;return!0}(e,ee.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class oe{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(oc(s))return new Al(s,c);if(bs(s)){const f=$s(s,c);if("error"===f.result)throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===c.type&&(f=Zr.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===r?e.specification.default:r,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class xe{constructor(e){this.property=e,this.value=new oe(e,void 0)}transitioned(e,r){return new fe(this.property,this.value,r,gt({},e.transition,this.transition),e.now)}untransitioned(){return new fe(this.property,this.value,null,{},0)}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Rt(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new xe(this._values[e].property)),this._values[e].value=new oe(this._values[e].property,null===r?void 0:Rt(r))}getTransition(e){return Rt(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new xe(this._values[e].property)),this._values[e].transition=Rt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(e[r]=s);const c=this.getTransition(r);void 0!==c&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new Se(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new Se(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class fe{constructor(e,r,s,c,f){const m=c.delay||0,y=c.duration||0;f=f||0,this.property=e,this.value=r,this.begin=f+m,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,f=this.value.possiblyEvaluate(e,r,s),m=this.prior;if(m){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return m.possiblyEvaluate(e,r,s);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,s),f,bn(y))}}return f}}class Se{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new $e(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Rt(this._values[e].value)}setValue(e,r){this._values[e]=new oe(this._values[e].property,null===r?void 0:Rt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new $e(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,r,s);return c}}class We{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class $e{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class je{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const c=Yt[this.specification.type];return c?c(e,r,s):e}}class be{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new We(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if("constant"!==e.value.kind||"constant"!==r.value.kind)return e;if(void 0===e.value.value||void 0===r.value.value)return new We(this,{kind:"constant",value:void 0},e.parameters);const c=Yt[this.specification.type];return c?new We(this,{kind:"constant",value:c(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,c,f,m){return"constant"===e.kind?e.value:e.evaluate(r,s,c,f,m)}}class ht extends be{possiblyEvaluate(e,r,s,c){if(void 0===e.value)return new We(this,{kind:"constant",value:void 0},r);if("constant"===e.expression.kind){const f=e.expression.evaluate(r,null,{},s,c),m="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,y=this._calculate(m,m,m,r);return new We(this,{kind:"constant",value:y},r)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new We(this,{kind:"constant",value:f},r)}return new We(this,e.expression,r)}evaluate(e,r,s,c,f,m){if("source"===e.kind){const y=e.evaluate(r,s,c,f,m);return this._calculate(y,y,y,r)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r,other:s}:{from:s,to:r,other:e}}interpolate(e){return e}}class lt{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(r,null,{},s,c);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new ae(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ae(Math.floor(r.zoom),r)),e.expression.evaluate(new ae(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class kt{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class et{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new ae(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new oe(c,void 0),m=this.defaultTransitionablePropertyValues[s]=new xe(c);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(r)}}}function rn(n,e){return 256*(n=Xt(Math.floor(n),0,255))+Xt(Math.floor(e),0,255)}Ut(be,"DataDrivenProperty"),Ut(je,"DataConstantProperty"),Ut(ht,"CrossFadedDataDrivenProperty"),Ut(lt,"CrossFadedProperty"),Ut(kt,"ColorRampProperty");const zt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lt{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function St(n,e=1){let r=0,s=0;return{members:n.map(c=>{const f=zt[c.type].BYTES_PER_ELEMENT,m=r=vn(r,Math.max(e,f)),y=c.components||1;return s=Math.max(s,f),r+=f*y,{name:c.name,type:c.type,components:y,offset:m}}),size:vn(r,Math.max(s,e)),alignment:e}}function vn(n,e){return Math.ceil(n/e)*e}class cn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}cn.prototype.bytesPerElement=4,Ut(cn,"StructArrayLayout2i4");class Un extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=c,e}}Un.prototype.bytesPerElement=6,Ut(Un,"StructArrayLayout3i6");class tn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=c,this.int16[m+3]=f,e}}tn.prototype.bytesPerElement=8,Ut(tn,"StructArrayLayout4i8");class Cn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,c,f,m,y)}emplace(e,r,s,c,f,m,y,b){const w=6*e,S=12*e,R=3*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.uint8[S+4]=c,this.uint8[S+5]=f,this.uint8[S+6]=m,this.uint8[S+7]=y,this.float32[R+2]=b,e}}Cn.prototype.bytesPerElement=12,Ut(Cn,"StructArrayLayout2i4ub1f12");class cr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,this.float32[m+3]=f,e}}cr.prototype.bytesPerElement=16,Ut(cr,"StructArrayLayout4f16");class Tr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y,b,w,S){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,s,c,f,m,y,b,w,S)}emplace(e,r,s,c,f,m,y,b,w,S,R){const k=10*e;return this.uint16[k+0]=r,this.uint16[k+1]=s,this.uint16[k+2]=c,this.uint16[k+3]=f,this.uint16[k+4]=m,this.uint16[k+5]=y,this.uint16[k+6]=b,this.uint16[k+7]=w,this.uint16[k+8]=S,this.uint16[k+9]=R,e}}Tr.prototype.bytesPerElement=20,Ut(Tr,"StructArrayLayout10ui20");class ii extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y,b){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,s,c,f,m,y,b)}emplace(e,r,s,c,f,m,y,b,w){const S=8*e;return this.uint16[S+0]=r,this.uint16[S+1]=s,this.uint16[S+2]=c,this.uint16[S+3]=f,this.uint16[S+4]=m,this.uint16[S+5]=y,this.uint16[S+6]=b,this.uint16[S+7]=w,e}}ii.prototype.bytesPerElement=16,Ut(ii,"StructArrayLayout8ui16");class kr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,f,m)}emplace(e,r,s,c,f,m,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+3]=f,this.int16[b+4]=m,this.int16[b+5]=y,e}}kr.prototype.bytesPerElement=12,Ut(kr,"StructArrayLayout6i12");class as extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y,b,w,S,R,k){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,s,c,f,m,y,b,w,S,R,k)}emplace(e,r,s,c,f,m,y,b,w,S,R,k,N){const G=12*e;return this.int16[G+0]=r,this.int16[G+1]=s,this.int16[G+2]=c,this.int16[G+3]=f,this.uint16[G+4]=m,this.uint16[G+5]=y,this.uint16[G+6]=b,this.uint16[G+7]=w,this.int16[G+8]=S,this.int16[G+9]=R,this.int16[G+10]=k,this.int16[G+11]=N,e}}as.prototype.bytesPerElement=24,Ut(as,"StructArrayLayout4i4ui4i24");class Ks extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,f,m)}emplace(e,r,s,c,f,m,y){const b=10*e,w=5*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.float32[w+2]=f,this.float32[w+3]=m,this.float32[w+4]=y,e}}Ks.prototype.bytesPerElement=20,Ut(Ks,"StructArrayLayout3i3f20");class _a extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}_a.prototype.bytesPerElement=4,Ut(_a,"StructArrayLayout1ul4");class $r extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y,b,w,S,R,k,N){const G=this.length;return this.resize(G+1),this.emplace(G,e,r,s,c,f,m,y,b,w,S,R,k,N)}emplace(e,r,s,c,f,m,y,b,w,S,R,k,N,G){const q=20*e,ie=10*e;return this.int16[q+0]=r,this.int16[q+1]=s,this.int16[q+2]=c,this.int16[q+3]=f,this.int16[q+4]=m,this.float32[ie+3]=y,this.float32[ie+4]=b,this.float32[ie+5]=w,this.float32[ie+6]=S,this.int16[q+14]=R,this.uint32[ie+8]=k,this.uint16[q+18]=N,this.uint16[q+19]=G,e}}$r.prototype.bytesPerElement=40,Ut($r,"StructArrayLayout5i4f1i1ul2ui40");class Br extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,c,f,m,y)}emplace(e,r,s,c,f,m,y,b){const w=8*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.int16[w+2]=c,this.int16[w+4]=f,this.int16[w+5]=m,this.int16[w+6]=y,this.int16[w+7]=b,e}}Br.prototype.bytesPerElement=16,Ut(Br,"StructArrayLayout3i2i2i16");class ur extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,f)}emplace(e,r,s,c,f,m){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=c,this.int16[b+6]=f,this.int16[b+7]=m,e}}ur.prototype.bytesPerElement=16,Ut(ur,"StructArrayLayout2f1f2i16");class Ei extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const m=12*e,y=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=s,this.float32[y+1]=c,this.float32[y+2]=f,e}}Ei.prototype.bytesPerElement=12,Ut(Ei,"StructArrayLayout2ub2f12");class qi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,e}}qi.prototype.bytesPerElement=12,Ut(qi,"StructArrayLayout3f12");class sr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=s,this.uint16[f+2]=c,e}}sr.prototype.bytesPerElement=6,Ut(sr,"StructArrayLayout3ui6");class vo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie,ue,Ee,we,Ce,Pe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie,ue,Ee,we,Ce,Pe)}emplace(e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie,ue,Ee,we,Ce,Pe,Fe){const Ze=30*e,Xe=15*e,ct=60*e;return this.int16[Ze+0]=r,this.int16[Ze+1]=s,this.int16[Ze+2]=c,this.float32[Xe+2]=f,this.float32[Xe+3]=m,this.uint16[Ze+8]=y,this.uint16[Ze+9]=b,this.uint32[Xe+5]=w,this.uint32[Xe+6]=S,this.uint32[Xe+7]=R,this.uint16[Ze+16]=k,this.uint16[Ze+17]=N,this.uint16[Ze+18]=G,this.float32[Xe+10]=q,this.float32[Xe+11]=ie,this.uint8[ct+48]=ue,this.uint8[ct+49]=Ee,this.uint8[ct+50]=we,this.uint32[Xe+13]=Ce,this.int16[Ze+28]=Pe,this.uint8[ct+58]=Fe,e}}vo.prototype.bytesPerElement=60,Ut(vo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class dc extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie,ue,Ee,we,Ce,Pe,Fe,Ze,Xe,ct,yt,Ve,it,xt,bt){const Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie,ue,Ee,we,Ce,Pe,Fe,Ze,Xe,ct,yt,Ve,it,xt,bt)}emplace(e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie,ue,Ee,we,Ce,Pe,Fe,Ze,Xe,ct,yt,Ve,it,xt,bt,Gt){const mt=38*e,Vt=19*e;return this.int16[mt+0]=r,this.int16[mt+1]=s,this.int16[mt+2]=c,this.float32[Vt+2]=f,this.float32[Vt+3]=m,this.int16[mt+8]=y,this.int16[mt+9]=b,this.int16[mt+10]=w,this.int16[mt+11]=S,this.int16[mt+12]=R,this.int16[mt+13]=k,this.uint16[mt+14]=N,this.uint16[mt+15]=G,this.uint16[mt+16]=q,this.uint16[mt+17]=ie,this.uint16[mt+18]=ue,this.uint16[mt+19]=Ee,this.uint16[mt+20]=we,this.uint16[mt+21]=Ce,this.uint16[mt+22]=Pe,this.uint16[mt+23]=Fe,this.uint16[mt+24]=Ze,this.uint16[mt+25]=Xe,this.uint16[mt+26]=ct,this.uint16[mt+27]=yt,this.uint16[mt+28]=Ve,this.uint32[Vt+15]=it,this.float32[Vt+16]=xt,this.float32[Vt+17]=bt,this.float32[Vt+18]=Gt,e}}dc.prototype.bytesPerElement=76,Ut(dc,"StructArrayLayout3i2f6i15ui1ul3f76");class Yo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Yo.prototype.bytesPerElement=4,Ut(Yo,"StructArrayLayout1f4");class fc extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,c,f,m,y)}emplace(e,r,s,c,f,m,y,b){const w=7*e;return this.float32[w+0]=r,this.float32[w+1]=s,this.float32[w+2]=c,this.float32[w+3]=f,this.float32[w+4]=m,this.float32[w+5]=y,this.float32[w+6]=b,e}}fc.prototype.bytesPerElement=28,Ut(fc,"StructArrayLayout7f28");class Rl extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,f)}emplace(e,r,s,c,f,m){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=c,this.float32[y+3]=f,this.float32[y+4]=m,e}}Rl.prototype.bytesPerElement=20,Ut(Rl,"StructArrayLayout5f20");class As extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=c,this.uint16[m+4]=f,e}}As.prototype.bytesPerElement=12,Ut(As,"StructArrayLayout1ul3ui12");class oi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}oi.prototype.bytesPerElement=4,Ut(oi,"StructArrayLayout2ui4");class xo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}xo.prototype.bytesPerElement=2,Ut(xo,"StructArrayLayout1ui2");class ya extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}ya.prototype.bytesPerElement=8,Ut(ya,"StructArrayLayout2f8");class Gc extends Lt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Gc.prototype.size=12;class bg extends kr{get(e){return new Gc(this,e)}}Ut(bg,"FillExtrusionExtArray");class ch extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ch.prototype.size=40;class uh extends $r{get(e){return new ch(this,e)}}Ut(uh,"CollisionBoxArray");class sf extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}sf.prototype.size=60;class af extends vo{get(e){return new sf(this,e)}}Ut(af,"PlacedSymbolArray");class lf extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}lf.prototype.size=76;class cf extends dc{get(e){return new lf(this,e)}}Ut(cf,"SymbolInstanceArray");class Fp extends Yo{getoffsetX(e){return this.float32[1*e+0]}}Ut(Fp,"GlyphOffsetArray");class Op extends Un{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ut(Op,"SymbolLineVertexArray");class zp extends Lt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zp.prototype.size=12;class Bp extends As{get(e){return new zp(this,e)}}Ut(Bp,"FeatureIndexArray");class Np extends Lt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Np.prototype.size=4;class kl extends oi{get(e){return new Np(this,e)}}Ut(kl,"FillExtrusionCentroidArray");class Su extends Lt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Su.prototype.size=12;class Up extends kr{get(e){return new Su(this,e)}}Ut(Up,"CircleGlobeExtArray");const yy=St([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),vy=St([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var wg=mo(function(n){n.exports=function(e,r){var s,c,f,m,y,b,w,S;for(c=e.length-(s=3&e.length),f=r,y=3432918353,b=461845907,S=0;S<c;)w=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,f=27492+(65535&(m=5*(65535&(f=(f^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&e.charCodeAt(S+2))<<16;case 2:w^=(255&e.charCodeAt(S+1))<<8;case 1:f^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),xy=mo(function(n){n.exports=function(e,r){for(var s,c=e.length,f=r^c,m=0;c>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:f^=(255&e.charCodeAt(m+2))<<16;case 2:f^=(255&e.charCodeAt(m+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(m)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Xh=wg,Vp=xy;Xh.murmur3=wg,Xh.murmur2=Vp;class Yh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(jp(e)),this.positions.push(r,s,c)}getPositions(e){const r=jp(e);let s=0,c=this.ids.length-1;for(;s<c;){const m=s+c>>1;this.ids[m]>=r?c=m:s=m+1}const f=[];for(;this.ids[s]===r;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return uf(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new Yh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function jp(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Xh(String(n))}function uf(n,e,r,s){for(;r<s;){const c=n[r+s>>1];let f=r-1,m=s+1;for(;;){do{f++}while(n[f]<c);do{m--}while(n[m]>c);if(f>=m)break;Kh(n,f,m),Kh(e,3*f,3*m),Kh(e,3*f+1,3*m+1),Kh(e,3*f+2,3*m+2)}m-r<s-m?(uf(n,e,r,m),r=m+1):(uf(n,e,m+1,s),s=m)}}function Kh(n,e,r){const s=n[e];n[e]=n[r],n[r]=s}Ut(Yh,"FeaturePositionMap");class pc{constructor(e,r){this.gl=e.gl,this.location=r}}class Qh extends pc{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class hh extends pc{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class hf extends pc{constructor(e,r){super(e,r),this.current=Zr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ya=new Float32Array(16),dh=new Float32Array(9),$p=new Float32Array(4);function Jh(n){return[rn(255*n.r,255*n.g),rn(255*n.b,255*n.a)]}class Mu{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return"color"===this.type?new hf(e,r):new Qh(e,r)}}class fh{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,s,c){const f="u_pattern_to"===c||"u_dash_to"===c?this.patternTo:"u_pattern_from"===c||"u_dash_from"===c?this.patternFrom:"u_pixel_ratio_to"===c?this.pixelRatioTo:"u_pixel_ratio_from"===c?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,r,s){return"u_pattern_from"===s||"u_pattern_to"===s||"u_dash_from"===s||"u_dash_to"===s?new hh(e,r):new Qh(e,r)}}class mc{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,f,m){const y=this.paintVertexArray.length,b=this.expression.evaluate(new ae(0),r,{},f,c,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,s,c,f){const m=this.expression.evaluate({zoom:0},s,c,void 0,f);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if("color"===this.type){const c=Jh(s);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ka{constructor(e,r,s,c,f,m){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,s,c,f,m){const y=this.expression.evaluate(new ae(this.zoom),r,{},f,c,m),b=this.expression.evaluate(new ae(this.zoom+1),r,{},f,c,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,b)}updatePaintArray(e,r,s,c,f){const m=this.expression.evaluate({zoom:this.zoom},s,c,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,f);this._setPaintValue(e,r,m,y)}_setPaintValue(e,r,s,c){if("color"===this.type){const f=Jh(s),m=Jh(c);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Xt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Qh(e,r)}}class Qa{constructor(e,r,s,c,f,m,y){this.expression=e,this.type=s,this.useIntegerZoom=c,this.zoom=f,this.layerId=y,this.paintVertexAttributes=("array"===s?vy:yy).members;for(let b=0;b<r.length;++b);this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,f,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:f,mid:m,max:y}=s,b=c[f],w=c[m],S=c[y];if(b&&w&&S)for(let R=e;R<r;R++)this._setPaintValue(this.zoomInPaintVertexArray,R,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,R,w,S)}_setPaintValue(e,r,s,c){e.emplace(r,s.tl[0],s.tl[1],s.br[0],s.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],s.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ja{constructor(e,r,s=(()=>!0)){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!s(f))continue;const m=e.paint.get(f);if(!(m instanceof We&&Ua(m.property.specification)))continue;const y=wy(f,e.type),b=m.value,w=m.property.specification.type,S=m.property.useIntegerZoom,R=m.property.specification["property-type"],k="cross-faded"===R||"cross-faded-data-driven"===R,N="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||N)if("source"===b.kind||N||k){const G=Hp(f,w,"source");this.binders[f]=k?new Qa(b,y,w,S,r,G,e.id):new mc(b,y,w,G),c.push(`/a_${f}`)}else{const G=Hp(f,w,"composite");this.binders[f]=new Ka(b,y,w,S,r,G),c.push(`/z_${f}`)}else this.binders[f]=k?new fh(b.value,y):new Mu(b.value,y,w),c.push(`/u_${f}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof mc||r instanceof Ka?r.maxValue:0}populatePaintArrays(e,r,s,c,f,m){for(const y in this.binders){const b=this.binders[y];(b instanceof mc||b instanceof Ka||b instanceof Qa)&&b.populatePaintArray(e,r,s,c,f,m)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof fh&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,f,m){let y=!1;for(const b in e){const w=r.getPositions(b);for(const S of w){const R=s.feature(S.index);for(const k in this.binders){const N=this.binders[k];if((N instanceof mc||N instanceof Ka||N instanceof Qa)&&!0===N.expression.isStateDependent){const G=c.paint.get(k);N.expression=G.value,N.updatePaintArray(S.start,S.end,R,e[b],f,m),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Mu||s instanceof fh)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof mc||s instanceof Ka||s instanceof Qa)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Mu||s instanceof fh||s instanceof Ka)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Mu||f instanceof fh||f instanceof Ka)for(const m of f.uniformNames)if(r[m]){const y=f.getBinding(e,r[m],m);s.push({name:m,property:c,binding:y})}}return s}setUniforms(e,r,s,c){for(const{name:f,property:m,binding:y}of r)this.binders[m].setUniform(y,c,s.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Qa){const c=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof mc||s instanceof Ka)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof mc||s instanceof Ka||s instanceof Qa)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof mc||r instanceof Ka||r instanceof Qa)&&r.destroy()}}}class Ll{constructor(e,r,s=(()=>!0)){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Ja(c,r,s);this.needsUpload=!1,this._featureMap=new Yh,this._bufferOffset=0}populatePaintArrays(e,r,s,c,f,m,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,c,f,m,y);void 0!==r.id&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c,f){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,c,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const by={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function wy(n,e){return by[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Gp={"line-pattern":{source:Tr,composite:Tr},"fill-pattern":{source:Tr,composite:Tr},"fill-extrusion-pattern":{source:Tr,composite:Tr},"line-dasharray":{source:ii,composite:ii}},Eg={color:{source:ya,composite:cr},number:{source:Yo,composite:ya}};function Hp(n,e,r){const s=Gp[n];return s&&s[r]||Eg[e][r]}Ut(Mu,"ConstantBinder"),Ut(fh,"CrossFadedConstantBinder"),Ut(mc,"SourceExpressionBinder"),Ut(Qa,"CrossFadedCompositeBinder"),Ut(Ka,"CompositeExpressionBinder"),Ut(Ja,"ProgramConfiguration",{omit:["_buffers"]}),Ut(Ll,"ProgramConfigurationSet");const ed="-transition";class va extends nn{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ge(r.layout)),r.paint)){this._transitionablePaint=new de(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $e(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){null!=r&&this._validate(Uc,`layers.${this.id}.layout.${e}`,e,r,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Qe(e,ed)?this._transitionablePaint.getTransition(e.slice(0,-ed.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(null!=r&&this._validate(Nc,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(Qe(e,ed))return this._transitionablePaint.setTransition(e.slice(0,-ed.length),r||void 0),!1;{const c=this._transitionablePaint._values[e],f="cross-faded-data-driven"===c.property.specification["property-type"],m=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),at(e,(r,s)=>!(void 0===r||"layout"===s&&!Object.keys(r).length||"paint"===s&&!Object.keys(r).length))}_validate(e,r,s,c,f={}){return(!f||!1!==f.validate)&&Vc(this,e.call(Bc,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof We&&Ua(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ds(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Zp=St([{name:"a_pos",components:2,type:"Int16"}],4),td=St([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class di{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let f=this.segments[this.segments.length-1];return e>di.MAX_VERTEX_ARRAY_LENGTH&&fn(`Max vertices per segment is ${di.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>di.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==c&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new di([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}di.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut(di,"SegmentVector");var pn=8192;class gc{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Dr?new Dr(e.lng,e.lat):Dr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Dr?new Dr(e.lng,e.lat):Dr.convert(e),this}extend(e){const r=this._sw,s=this._ne;let c,f;if(e instanceof Dr)c=e,f=e;else{if(!(e instanceof gc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(gc.convert(e)):this.extend(Dr.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Dr(c.lng,c.lat),this._ne=new Dr(f.lng,f.lat)),this}getCenter(){return new Dr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Dr(this.getWest(),this.getNorth())}getSouthEast(){return new Dr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Dr.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof gc?e:new gc(e)}}const Mi=6371008.8;class Dr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Dr(Zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,f=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return Mi*Math.acos(Math.min(f,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new gc(new Dr(this.lng-s,this.lat-r),new Dr(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Dr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Dr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Dr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const qp=2*Math.PI*Mi;function ph(n){return qp*Math.cos(n*Math.PI/180)}function _c(n){return(180+n)/360}function Hc(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Qs(n,e){return n/ph(e)}function ko(n){return 360*n-180}function Ai(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Wp(n,e){return n*ph(Ai(e))}const Fl=85.051129;class mh{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Dr.convert(e);return new mh(_c(s.lng),Hc(s.lat),Qs(r,s.lat))}toLngLat(){return new Dr(ko(this.x),Ai(this.y))}toAltitude(){return Wp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qp*(e=Ai(this.y),1/Math.cos(e*Math.PI/180));var e}}function Zc(n,e,r,s,c,f,m,y,b){const w=(e+s)/2,S=(r+c)/2,R=new nt(w,S);y(R),function(k,N,G,q,ie,ue){const Ee=G-ie,we=q-ue;return Math.abs((q-N)*Ee-(G-k)*we)/Math.hypot(Ee,we)}(R.x,R.y,f.x,f.y,m.x,m.y)>=b?(Zc(n,e,r,w,S,f,R,y,b),Zc(n,w,S,s,c,R,m,y,b)):n.push(m)}function nd(n,e,r){let s=n[0],c=s.x,f=s.y;e(s);const m=[s];for(let y=1;y<n.length;y++){const b=n[y],{x:w,y:S}=b;e(b),Zc(m,c,f,w,S,s,b,e,r),c=w,f=S,s=b}return m}function df(n,e,r,s,c){if(c(e,r)){const f=e.add(r).mult(.5);s(f),df(n,e,f,s,c),df(n,f,r,s,c)}else n.push(r)}function ff(n,e,r){let s=n[0];e(s);const c=[s];for(let f=1;f<n.length;f++){const m=n[f];e(m),df(c,s,m,e,r),s=m}return c}const qc=Math.pow(2,14)-1,Xp=-qc-1;function Tg(n,e){const r=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=Xt(r,Xp,qc),n.y=Xt(s,Xp,qc),(r<n.x||r>n.x+1||s<n.y||s>n.y+1)&&fn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ol(n,e,r){const s=n.loadGeometry(),c=n.extent,f=pn/c;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:w,projection:S}=r,R=k=>{const N=ko((e.x+k.x/c)/m),G=Ai((e.y+k.y/c)/m),q=S.project(N,G);k.x=(q.x*y-b)*c,k.y=(q.y*y-w)*c};for(let k=0;k<s.length;k++)if(1!==n.type)s[k]=nd(s[k],R,1);else{const N=[];for(const G of s[k])G.x<0||G.x>=c||G.y<0||G.y>=c||(R(G),N.push(G));s[k]=N}}for(const m of s)for(const y of m)Tg(y,f);return s}function yc(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ol(n):[]}}function rd(n,e,r,s,c){n.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}function id(n,e,r){n.emplaceBack(e.x,e.y,e.z,16384*r[0],16384*r[1],16384*r[2])}class pf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new cn,this.indexArray=new sr,this.segments=new di,this.programConfigurations=new Ll(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){const f=this.layers[0],m=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:R,sourceLayerIndex:k}of e){const N=this.layers[0]._featureFilter.needGeometry,G=yc(w,N);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),G,s))continue;const q=y?y.evaluate(G,{},s):void 0,ie={id:S,properties:w.properties,type:w.type,sourceLayerIndex:k,index:R,geometry:N?G.geometry:Ol(w,s,c),patterns:{},sortKey:q};m.push(ie)}y&&m.sort((w,S)=>w.sortKey-S.sortKey);let b=null;"globe"===c.projection.name&&(this.globeExtVertexArray=new Up,b=c.projection);for(const w of m){const{geometry:S,index:R,sourceLayerIndex:k}=w,N=e[R].feature;this.addFeature(w,S,R,r.availableImages,s,b),r.featureIndex.insert(N,S,R,k,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,td.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,c,f,m){for(const y of r)for(const b of y){const w=b.x,S=b.y;if(w<0||w>=pn||S<0||S>=pn)continue;if(m){const N=m.projectTilePoint(w,S,f),G=m.upVector(f,w,S),q=this.globeExtVertexArray;id(q,N,G),id(q,N,G),id(q,N,G),id(q,N,G)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=R.vertexLength;rd(this.layoutVertexArray,w,S,-1,-1),rd(this.layoutVertexArray,w,S,1,-1),rd(this.layoutVertexArray,w,S,1,1),rd(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,f)}}function Yp(n,e){for(let r=0;r<n.length;r++)if(zl(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(zl(n,e[r]))return!0;return!!gf(n,e)}function mf(n,e,r){return!!zl(n,e)||!!_f(e,n,r)}function Kp(n,e){if(1===n.length)return Lo(e,n[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(zl(n,s[c]))return!0}for(let r=0;r<n.length;r++)if(Lo(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(gf(n,e[r]))return!0;return!1}function Dg(n,e,r){if(n.length>1){if(gf(n,e))return!0;for(let s=0;s<e.length;s++)if(_f(e[s],n,r))return!0}for(let s=0;s<n.length;s++)if(_f(n[s],e,r))return!0;return!1}function gf(n,e){if(0===n.length||0===e.length)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],c=n[r+1];for(let f=0;f<e.length-1;f++)if(Qp(s,c,e[f],e[f+1]))return!0}return!1}function Qp(n,e,r,s){return Zn(n,r,s)!==Zn(e,r,s)&&Zn(n,e,r)!==Zn(n,e,s)}function _f(n,e,r){const s=r*r;if(1===e.length)return n.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Jp(n,e[c-1],e[c])<s)return!0;return!1}function Jp(n,e,r){const s=e.distSqr(r);if(0===s)return n.distSqr(e);const c=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/s;return n.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function Lo(n,e){let r,s,c,f=!1;for(let m=0;m<n.length;m++){r=n[m];for(let y=0,b=r.length-1;y<r.length;b=y++)s=r[y],c=r[b],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(f=!f)}return f}function zl(n,e){let r=!1;for(let s=0,c=n.length-1;s<n.length;c=s++){const f=n[s],m=n[c];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function yf(n,e,r,s,c){for(const m of n)if(e<=m.x&&r<=m.y&&s>=m.x&&c>=m.y)return!0;const f=[new nt(e,r),new nt(e,c),new nt(s,c),new nt(s,r)];if(n.length>2)for(const m of f)if(zl(n,m))return!0;for(let m=0;m<n.length-1;m++)if(vf(n[m],n[m+1],f))return!0;return!1}function vf(n,e,r){const s=r[0],c=r[2];if(n.x<s.x&&e.x<s.x||n.x>c.x&&e.x>c.x||n.y<s.y&&e.y<s.y||n.y>c.y&&e.y>c.y)return!1;const f=Zn(n,e,r[0]);return f!==Zn(n,e,r[1])||f!==Zn(n,e,r[2])||f!==Zn(n,e,r[3])}function Vi(n,e,r){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:r.programConfigurations.get(e.id).getMaxValue(n)}function vc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function od(n,e,r,s,c){if(!e[0]&&!e[1])return n;const f=nt.convert(e)._mult(c);"viewport"===r&&f._rotate(-s);const m=[];for(let y=0;y<n.length;y++)m.push(n[y].sub(f));return m}function em(n,e,r,s){const c=nt.convert(n)._mult(s);return"viewport"===e&&c._rotate(-r),c}Ut(pf,"CircleBucket",{omit:["layers"]});const Cg=new et({"circle-sort-key":new be(ke.layout_circle["circle-sort-key"])});var tm={paint:new et({"circle-radius":new be(ke.paint_circle["circle-radius"]),"circle-color":new be(ke.paint_circle["circle-color"]),"circle-blur":new be(ke.paint_circle["circle-blur"]),"circle-opacity":new be(ke.paint_circle["circle-opacity"]),"circle-translate":new je(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new je(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new je(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new je(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new be(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new be(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new be(ke.paint_circle["circle-stroke-opacity"])}),layout:Cg},sd=1e-6,Ko=typeof Float32Array<"u"?Float32Array:Array;function nm(){var n=new Ko(9);return Ko!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Qo(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xc(n,e,r){var s=e[0],c=e[1],f=e[2],m=e[3],y=e[4],b=e[5],w=e[6],S=e[7],R=e[8],k=e[9],N=e[10],G=e[11],q=e[12],ie=e[13],ue=e[14],Ee=e[15],we=r[0],Ce=r[1],Pe=r[2],Fe=r[3];return n[0]=we*s+Ce*y+Pe*R+Fe*q,n[1]=we*c+Ce*b+Pe*k+Fe*ie,n[2]=we*f+Ce*w+Pe*N+Fe*ue,n[3]=we*m+Ce*S+Pe*G+Fe*Ee,n[4]=(we=r[4])*s+(Ce=r[5])*y+(Pe=r[6])*R+(Fe=r[7])*q,n[5]=we*c+Ce*b+Pe*k+Fe*ie,n[6]=we*f+Ce*w+Pe*N+Fe*ue,n[7]=we*m+Ce*S+Pe*G+Fe*Ee,n[8]=(we=r[8])*s+(Ce=r[9])*y+(Pe=r[10])*R+(Fe=r[11])*q,n[9]=we*c+Ce*b+Pe*k+Fe*ie,n[10]=we*f+Ce*w+Pe*N+Fe*ue,n[11]=we*m+Ce*S+Pe*G+Fe*Ee,n[12]=(we=r[12])*s+(Ce=r[13])*y+(Pe=r[14])*R+(Fe=r[15])*q,n[13]=we*c+Ce*b+Pe*k+Fe*ie,n[14]=we*f+Ce*w+Pe*N+Fe*ue,n[15]=we*m+Ce*S+Pe*G+Fe*Ee,n}function Wc(n,e,r){var s,c,f,m,y,b,w,S,R,k,N,G,q=r[0],ie=r[1],ue=r[2];return e===n?(n[12]=e[0]*q+e[4]*ie+e[8]*ue+e[12],n[13]=e[1]*q+e[5]*ie+e[9]*ue+e[13],n[14]=e[2]*q+e[6]*ie+e[10]*ue+e[14],n[15]=e[3]*q+e[7]*ie+e[11]*ue+e[15]):(c=e[1],f=e[2],m=e[3],y=e[4],b=e[5],w=e[6],S=e[7],R=e[8],k=e[9],N=e[10],G=e[11],n[0]=s=e[0],n[1]=c,n[2]=f,n[3]=m,n[4]=y,n[5]=b,n[6]=w,n[7]=S,n[8]=R,n[9]=k,n[10]=N,n[11]=G,n[12]=s*q+y*ie+R*ue+e[12],n[13]=c*q+b*ie+k*ue+e[13],n[14]=f*q+w*ie+N*ue+e[14],n[15]=m*q+S*ie+G*ue+e[15]),n}function el(n,e,r){var s=r[0],c=r[1],f=r[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function ad(n,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[4],m=e[5],y=e[6],b=e[7],w=e[8],S=e[9],R=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*c+w*s,n[5]=m*c+S*s,n[6]=y*c+R*s,n[7]=b*c+k*s,n[8]=w*c-f*s,n[9]=S*c-m*s,n[10]=R*c-y*s,n[11]=k*c-b*s,n}function ld(n,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[0],m=e[1],y=e[2],b=e[3],w=e[8],S=e[9],R=e[10],k=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*c-w*s,n[1]=m*c-S*s,n[2]=y*c-R*s,n[3]=b*c-k*s,n[8]=f*s+w*c,n[9]=m*s+S*c,n[10]=y*s+R*c,n[11]=b*s+k*c,n}function rm(n,e,r){var s,c,f,m=r[0],y=r[1],b=r[2],w=Math.hypot(m,y,b);return w<sd?null:(m*=w=1/w,y*=w,b*=w,s=Math.sin(e),c=Math.cos(e),n[0]=m*m*(f=1-c)+c,n[1]=y*m*f+b*s,n[2]=b*m*f-y*s,n[3]=0,n[4]=m*y*f-b*s,n[5]=y*y*f+c,n[6]=b*y*f+m*s,n[7]=0,n[8]=m*b*f+y*s,n[9]=y*b*f-m*s,n[10]=b*b*f+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Au=xc;function xa(){var n=new Ko(3);return Ko!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function im(n){var e=new Ko(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function cd(n){return Math.hypot(n[0],n[1],n[2])}function gh(n,e,r){var s=new Ko(3);return s[0]=n,s[1]=e,s[2]=r,s}function Bl(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function om(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function ba(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function Pu(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function Ru(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function tl(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function _h(n,e,r,s){return n[0]=e[0]+r[0]*s,n[1]=e[1]+r[1]*s,n[2]=e[2]+r[2]*s,n}function Fo(n,e){var r=e[0],s=e[1],c=e[2],f=r*r+s*s+c*c;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Oo(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function xf(n,e,r){var s=e[0],c=e[1],f=e[2],m=r[0],y=r[1],b=r[2];return n[0]=c*b-f*y,n[1]=f*m-s*b,n[2]=s*y-c*m,n}function eo(n,e,r){var s=e[0],c=e[1],f=e[2],m=r[3]*s+r[7]*c+r[11]*f+r[15];return n[0]=(r[0]*s+r[4]*c+r[8]*f+r[12])/(m=m||1),n[1]=(r[1]*s+r[5]*c+r[9]*f+r[13])/m,n[2]=(r[2]*s+r[6]*c+r[10]*f+r[14])/m,n}function ud(n,e,r){var s=r[0],c=r[1],f=r[2],m=e[0],y=e[1],b=e[2],w=c*b-f*y,S=f*m-s*b,R=s*y-c*m,k=c*R-f*S,N=f*w-s*R,G=s*S-c*w,q=2*r[3];return S*=q,R*=q,N*=2,G*=2,n[0]=m+(w*=q)+(k*=2),n[1]=y+S+N,n[2]=b+R+G,n}var Xc,Ps=om,Ey=ba,ku=cd;function hd(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function bc(n,e,r){var s=e[0],c=e[1],f=e[2],m=e[3];return n[0]=r[0]*s+r[4]*c+r[8]*f+r[12]*m,n[1]=r[1]*s+r[5]*c+r[9]*f+r[13]*m,n[2]=r[2]*s+r[6]*c+r[10]*f+r[14]*m,n[3]=r[3]*s+r[7]*c+r[11]*f+r[15]*m,n}function sm(){var n=new Ko(4);return Ko!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function dd(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function am(n,e,r){r*=.5;var s=e[0],c=e[1],f=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return n[0]=s*b+m*y,n[1]=c*b+f*y,n[2]=f*b-c*y,n[3]=m*b-s*y,n}function lm(n,e,r){r*=.5;var s=e[0],c=e[1],f=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return n[0]=s*b-f*y,n[1]=c*b+m*y,n[2]=f*b+s*y,n[3]=m*b-c*y,n}xa(),Xc=new Ko(4),Ko!=Float32Array&&(Xc[0]=0,Xc[1]=0,Xc[2]=0,Xc[3]=0),xa(),gh(1,0,0),gh(0,1,0),sm(),sm(),nm();class bf{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const c=Oo(r,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/c;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,r,s){if(q=(N=this.pos)[0],ie=N[1],ue=N[2],Ee=(G=e)[0],we=G[1],Ce=G[2],Math.abs(q-Ee)<=sd*Math.max(1,Math.abs(q),Math.abs(Ee))&&Math.abs(ie-we)<=sd*Math.max(1,Math.abs(ie),Math.abs(we))&&Math.abs(ue-Ce)<=sd*Math.max(1,Math.abs(ue),Math.abs(Ce))||0===r)return s[0]=s[1]=s[2]=0,!1;var N,G,q,ie,ue,Ee,we,Ce;const[c,f,m]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],S=c*c+f*f+m*m,R=2*(y*c+b*f+w*m),k=R*R-4*S*(y*y+b*b+w*w-r*r);if(k<0){const N=Math.max(-R/2,0),G=y+c*N,q=b+f*N,ie=w+m*N,ue=Math.hypot(G,q,ie);return s[0]=G*r/ue,s[1]=q*r/ue,s[2]=ie*r/ue,!1}{const N=(-R-Math.sqrt(k))/(2*S);if(N<0){const G=Math.hypot(y,b,w);return s[0]=y*r/G,s[1]=b*r/G,s[2]=w*r/G,!1}return s[0]=y+c*N,s[1]=b+f*N,s[2]=w+m*N,!0}}}class wf{constructor(e,r,s,c,f){this.TL=e,this.TR=r,this.BR=s,this.BL=c,this.horizon=f}static fromInvProjectionMatrix(e,r,s){const c=[-1,1,1],f=[1,1,1],m=[1,-1,1],y=[-1,-1,1],b=eo(c,c,e),w=eo(f,f,e),S=eo(m,m,e),R=eo(y,y,e);return new wf(b,w,S,R,r/s)}}class Ef{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,s,c){const f=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=bc([],b,e),S=1/w[3]/r*f;return(R=w)[0]=(k=w)[0]*(N=[S,S,c?1/w[3]:S,S])[0],R[1]=k[1]*N[1],R[2]=k[2]*N[2],R[3]=k[3]*N[3],R;var R,k,N}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=Fo([],xf([],Ps([],m[b[0]],m[b[1]]),Ps([],m[b[2]],m[b[1]]))),S=-Oo(w,m[b[1]]);return w.concat(S)});return new Ef(m,y)}}class Rs{constructor(e,r){this.min=e,this.max=r,this.center=tl([],Bl([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=im(this.min),c=im(this.max);for(let f=0;f<r.length;f++)s[f]=r[f]?this.min[f]:this.center[f],c[f]=r[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Rs(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let m=0;for(let y=0;y<r.length;y++)m+=Oo(f,r[y])+f[3]>=0;if(0===m)return 0;m!==r.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][c]-this.min[c];f=Math.min(f,b),m=Math.max(m,b)}if(m<0||f>this.max[c]-this.min[c])return 0}return 1}}function Tf(n,e,r,s,c,f,m,y,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,S=r.projection.upVectorScale(w,r.center.lat,r.worldSize).metersToTile;for(const R of e)for(const k of R){const N=k.add(y),G=c&&r.elevation?r.elevation.exaggeration()*c.getElevationAt(N.x,N.y,!0):0,q=r.projection.projectTilePoint(N.x,N.y,w);if(G>0){const we=r.projection.upVector(w,N.x,N.y);q.x+=we[0]*S*G,q.y+=we[1]*S*G,q.z+=we[2]*S*G}const ie=f?N:Df(q.x,q.y,q.z,s),ue=f?n.tilespaceRays.map(we=>Ig(we,G)):n.queryGeometry.screenGeometry,Ee=bc([],[q.x,q.y,q.z,1],s);if(!m&&f?b*=Ee[3]/r.cameraToCenterDistance:m&&!f&&(b*=r.cameraToCenterDistance/Ee[3]),f){const we=Ai((k.y/pn+w.y)/(1<<w.z));b/=r.projection.pixelsPerMeter(we,1)/Qs(1,we)}if(mf(ue,ie,b))return!0}return!1}function Df(n,e,r,s){const c=bc([],[n,e,r,1],s);return new nt(c[0]/c[3],c[1]/c[3])}const Cf=gh(0,0,0),If=gh(0,0,1);function Ig(n,e){const r=xa();return Cf[2]=e,n.intersectsPlane(Cf,If,r),new nt(r[0],r[1])}class cm extends pf{}function Sf(n,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*r*s);return n.width=e,n.height=r,n.data=c,n}function Mf(n,e,r){const{width:s,height:c}=e;s===n.width&&c===n.height||(Nl(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,c)},r),n.width=s,n.height=c,n.data=e.data)}function Nl(n,e,r,s,c,f){if(0===c.width||0===c.height)return e;if(c.width>n.width||c.height>n.height||r.x>n.width-c.width||r.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,y=e.data;for(let b=0;b<c.height;b++){const w=((r.y+b)*n.width+r.x)*f,S=((s.y+b)*e.width+s.x)*f;for(let R=0;R<c.width*f;R++)y[S+R]=m[w+R]}return e}Ut(cm,"HeatmapBucket",{omit:["layers"]});class nl{constructor(e,r){Sf(this,e,1,r)}resize(e){Mf(this,new nl(e),1)}clone(){return new nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,f){Nl(e,r,s,c,f,1)}}class Jo{constructor(e,r){Sf(this,e,4,r)}resize(e){Mf(this,new Jo(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,f){Nl(e,r,s,c,f,4)}}Ut(nl,"AlphaImage"),Ut(Jo,"RGBAImage");var Sg={paint:new et({"heatmap-radius":new be(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new be(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new je(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new kt(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new je(ke.paint_heatmap["heatmap-opacity"])})};function um(n){const e={},r=n.resolution||256,s=n.clips?n.clips.length:1,c=n.image||new Jo({width:r,height:s}),f=(m,y,b)=>{e[n.evaluationKey]=b;const w=n.expression.evaluate(e);c.data[m+y+0]=Math.floor(255*w.r/w.a),c.data[m+y+1]=Math.floor(255*w.g/w.a),c.data[m+y+2]=Math.floor(255*w.b/w.a),c.data[m+y+3]=Math.floor(255*w.a)};if(n.clips)for(let m=0,y=0;m<s;++m,y+=4*r)for(let b=0,w=0;b<r;b++,w+=4){const S=b/(r-1),{start:R,end:k}=n.clips[m];f(y,w,R*(1-S)+k*S)}else for(let m=0,y=0;m<r;m++,y+=4)f(0,y,m/(r-1));return c}var fd={paint:new et({"hillshade-illumination-direction":new je(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new je(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new je(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new je(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new je(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new je(ke.paint_hillshade["hillshade-accent-color"])})};const Mg=St([{name:"a_pos",components:2,type:"Int16"}],4),{members:hm}=Mg;var yh=Lu,dm=Lu;function Lu(n,e,r){r=r||2;var s,c,f,m,y,b,w,S=e&&e.length,R=S?e[0]*r:n.length,k=Af(n,0,R,r,!0),N=[];if(!k||k.next===k.prev)return N;if(S&&(k=function(q,ie,ue,Ee){var we,Ce,Pe,Fe=[];for(we=0,Ce=ie.length;we<Ce;we++)(Pe=Af(q,ie[we]*Ee,we<Ce-1?ie[we+1]*Ee:q.length,Ee,!1))===Pe.next&&(Pe.steiner=!0),Fe.push(Pg(Pe));for(Fe.sort(vh),we=0;we<Fe.length;we++)ue=wa(ue=Ag(Fe[we],ue),ue.next);return ue}(n,e,k,r)),n.length>80*r){s=f=n[0],c=m=n[1];for(var G=r;G<R;G+=r)(y=n[G])<s&&(s=y),(b=n[G+1])<c&&(c=b),y>f&&(f=y),b>m&&(m=b);w=0!==(w=Math.max(f-s,m-c))?1/w:0}return wc(k,N,r,s,c,w),N}function Af(n,e,r,s,c){var f,m;if(c===zf(n,e,r,s)>0)for(f=e;f<r;f+=s)m=Js(f,n[f],n[f+1],m);else for(f=r-s;f>=e;f-=s)m=Js(f,n[f],n[f+1],m);return m&&Ff(m,m.next)&&(wh(m),m=m.next),m}function wa(n,e){if(!n)return n;e||(e=n);var r,s=n;do{if(r=!1,s.steiner||!Ff(s,s.next)&&0!==fi(s.prev,s,s.next))s=s.next;else{if(wh(s),(s=e=s.prev)===s.next)break;r=!0}}while(r||s!==e);return e}function wc(n,e,r,s,c,f,m){if(n){!m&&f&&function(S,R,k,N){var G=S;do{null===G.z&&(G.z=kf(G.x,G.y,R,k,N)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==S);G.prevZ.nextZ=null,G.prevZ=null,function(q){var ie,ue,Ee,we,Ce,Pe,Fe,Ze,Xe=1;do{for(ue=q,q=null,Ce=null,Pe=0;ue;){for(Pe++,Ee=ue,Fe=0,ie=0;ie<Xe&&(Fe++,Ee=Ee.nextZ);ie++);for(Ze=Xe;Fe>0||Ze>0&&Ee;)0!==Fe&&(0===Ze||!Ee||ue.z<=Ee.z)?(we=ue,ue=ue.nextZ,Fe--):(we=Ee,Ee=Ee.nextZ,Ze--),Ce?Ce.nextZ=we:q=we,we.prevZ=Ce,Ce=we;ue=Ee}Ce.nextZ=null,Xe*=2}while(Pe>1)}(G)}(n,s,c,f);for(var y,b,w=n;n.prev!==n.next;)if(y=n.prev,b=n.next,f?Pf(n,s,c,f):fm(n))e.push(y.i/r),e.push(n.i/r),e.push(b.i/r),wh(n),n=b.next,w=b.next;else if((n=b)===w){m?1===m?wc(n=pm(wa(n),e,r),e,r,s,c,f,2):2===m&&Rf(n,e,r,s,c,f):wc(wa(n),e,r,s,c,f,1);break}}}function fm(n){var e=n.prev,r=n,s=n.next;if(fi(e,r,s)>=0)return!1;for(var c=n.next.next;c!==n.prev;){if(Yc(e.x,e.y,r.x,r.y,s.x,s.y,c.x,c.y)&&fi(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function Pf(n,e,r,s){var c=n.prev,f=n,m=n.next;if(fi(c,f,m)>=0)return!1;for(var y=c.x>f.x?c.x>m.x?c.x:m.x:f.x>m.x?f.x:m.x,b=c.y>f.y?c.y>m.y?c.y:m.y:f.y>m.y?f.y:m.y,w=kf(c.x<f.x?c.x<m.x?c.x:m.x:f.x<m.x?f.x:m.x,c.y<f.y?c.y<m.y?c.y:m.y:f.y<m.y?f.y:m.y,e,r,s),S=kf(y,b,e,r,s),R=n.prevZ,k=n.nextZ;R&&R.z>=w&&k&&k.z<=S;){if(R!==n.prev&&R!==n.next&&Yc(c.x,c.y,f.x,f.y,m.x,m.y,R.x,R.y)&&fi(R.prev,R,R.next)>=0||(R=R.prevZ,k!==n.prev&&k!==n.next&&Yc(c.x,c.y,f.x,f.y,m.x,m.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;R&&R.z>=w;){if(R!==n.prev&&R!==n.next&&Yc(c.x,c.y,f.x,f.y,m.x,m.y,R.x,R.y)&&fi(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;k&&k.z<=S;){if(k!==n.prev&&k!==n.next&&Yc(c.x,c.y,f.x,f.y,m.x,m.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function pm(n,e,r){var s=n;do{var c=s.prev,f=s.next.next;!Ff(c,f)&&Of(c,s,s.next,f)&&bh(c,f)&&bh(f,c)&&(e.push(c.i/r),e.push(s.i/r),e.push(f.i/r),wh(s),wh(s.next),s=n=f),s=s.next}while(s!==n);return wa(s)}function Rf(n,e,r,s,c,f){var m=n;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&Lf(m,y)){var b=gm(m,y);return m=wa(m,m.next),b=wa(b,b.next),wc(m,e,r,s,c,f),void wc(b,e,r,s,c,f)}y=y.next}m=m.next}while(m!==n)}function vh(n,e){return n.x-e.x}function Ag(n,e){var r=function(f,m){var y,b=m,w=f.x,S=f.y,R=-1/0;do{if(S<=b.y&&S>=b.next.y&&b.next.y!==b.y){var k=b.x+(S-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(k<=w&&k>R){if(R=k,k===w){if(S===b.y)return b;if(S===b.next.y)return b.next}y=b.x<b.next.x?b:b.next}}b=b.next}while(b!==m);if(!y)return null;if(w===R)return y;var N,G=y,q=y.x,ie=y.y,ue=1/0;b=y;do{w>=b.x&&b.x>=q&&w!==b.x&&Yc(S<ie?w:R,S,q,ie,S<ie?R:w,S,b.x,b.y)&&(N=Math.abs(S-b.y)/(w-b.x),bh(b,f)&&(N<ue||N===ue&&(b.x>y.x||b.x===y.x&&mm(y,b)))&&(y=b,ue=N)),b=b.next}while(b!==G);return y}(n,e);if(!r)return e;var s=gm(r,n),c=wa(r,r.next);return wa(s,s.next),e===r?c:e}function mm(n,e){return fi(n.prev,n,e.prev)<0&&fi(e.next,n,n.next)<0}function kf(n,e,r,s,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*c)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Pg(n){var e=n,r=n;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==n);return r}function Yc(n,e,r,s,c,f,m,y){return(c-m)*(e-y)-(n-m)*(f-y)>=0&&(n-m)*(s-y)-(r-m)*(e-y)>=0&&(r-m)*(f-y)-(c-m)*(s-y)>=0}function Lf(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&Of(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(n,e)&&(bh(n,e)&&bh(e,n)&&function(r,s){var c=r,f=!1,m=(r.x+s.x)/2,y=(r.y+s.y)/2;do{c.y>y!=c.next.y>y&&c.next.y!==c.y&&m<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next}while(c!==r);return f}(n,e)&&(fi(n.prev,n,e.prev)||fi(n,e.prev,e))||Ff(n,e)&&fi(n.prev,n,n.next)>0&&fi(e.prev,e,e.next)>0)}function fi(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Ff(n,e){return n.x===e.x&&n.y===e.y}function Of(n,e,r,s){var c=xh(fi(n,e,r)),f=xh(fi(n,e,s)),m=xh(fi(r,s,n)),y=xh(fi(r,s,e));return c!==f&&m!==y||!(0!==c||!pd(n,r,e))||!(0!==f||!pd(n,s,e))||!(0!==m||!pd(r,n,s))||!(0!==y||!pd(r,e,s))}function pd(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function xh(n){return n>0?1:n<0?-1:0}function bh(n,e){return fi(n.prev,n,n.next)<0?fi(n,e,n.next)>=0&&fi(n,n.prev,e)>=0:fi(n,e,n.prev)<0||fi(n,n.next,e)<0}function gm(n,e){var r=new md(n.i,n.x,n.y),s=new md(e.i,e.x,e.y),c=n.next,f=e.prev;return n.next=e,e.prev=n,r.next=c,c.prev=r,s.next=r,r.prev=s,f.next=s,s.prev=f,s}function Js(n,e,r,s){var c=new md(n,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function wh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function md(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zf(n,e,r,s){for(var c=0,f=e,m=r-s;f<r;f+=s)c+=(n[m]-n[f])*(n[f+1]+n[m+1]),m=f;return c}function Rg(n,e,r,s,c){_m(n,e,r||0,s||n.length-1,c||ym)}function _m(n,e,r,s,c){for(;s>r;){if(s-r>600){var f=s-r+1,m=e-r+1,y=Math.log(f),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(f-b)/f)*(m-f/2<0?-1:1);_m(n,e,Math.max(r,Math.floor(e-m*b/f+w)),Math.min(s,Math.floor(e+(f-m)*b/f+w)),c)}var S=n[e],R=r,k=s;for(Eh(n,r,e),c(n[s],S)>0&&Eh(n,r,s);R<k;){for(Eh(n,R,k),R++,k--;c(n[R],S)<0;)R++;for(;c(n[k],S)>0;)k--}0===c(n[r],S)?Eh(n,r,k):Eh(n,++k,s),k<=e&&(r=k+1),e<=k&&(s=k-1)}}function Eh(n,e,r){var s=n[e];n[e]=n[r],n[r]=s}function ym(n,e){return n<e?-1:n>e?1:0}function Bf(n,e){const r=n.length;if(r<=1)return[n];const s=[];let c,f;for(let m=0;m<r;m++){const y=Dn(n[m]);0!==y&&(n[m].area=Math.abs(y),void 0===f&&(f=y<0),f===y<0?(c&&s.push(c),c=[n[m]]):c.push(n[m]))}if(c&&s.push(c),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(Rg(s[m],e,1,s[m].length-1,kg),s[m]=s[m].slice(0,e));return s}function kg(n,e){return e.area-n.area}function Nf(n,e,r){const s=r.patternDependencies;let c=!1;for(const f of e){const m=f.paint.get(`${n}-pattern`);m.isConstant()||(c=!0);const y=m.constantOr(null);y&&(c=!0,s[y.to]=!0,s[y.from]=!0)}return c}function Gn(n,e,r,s,c){const f=c.patternDependencies;for(const m of e){const y=m.paint.get(`${n}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:s-1},r,{},c.availableImages),w=y.evaluate({zoom:s},r,{},c.availableImages),S=y.evaluate({zoom:s+1},r,{},c.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,f[b]=!0,f[w]=!0,f[S]=!0,r.patterns[m.id]={min:b,mid:w,max:S}}}return r}Lu.deviation=function(n,e,r,s){var c=e&&e.length,f=Math.abs(zf(n,0,c?e[0]*r:n.length,r));if(c)for(var m=0,y=e.length;m<y;m++)f-=Math.abs(zf(n,e[m]*r,m<y-1?e[m+1]*r:n.length,r));var b=0;for(m=0;m<s.length;m+=3){var w=s[m]*r,S=s[m+1]*r,R=s[m+2]*r;b+=Math.abs((n[w]-n[R])*(n[S+1]-n[w+1])-(n[w]-n[S])*(n[R+1]-n[w+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},Lu.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<n.length;c++){for(var f=0;f<n[c].length;f++)for(var m=0;m<e;m++)r.vertices.push(n[c][f][m]);c>0&&r.holes.push(s+=n[c-1].length)}return r},yh.default=dm;class Th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cn,this.indexArray=new sr,this.indexArray2=new oi,this.programConfigurations=new Ll(e.layers,e.zoom),this.segments=new di,this.segments2=new di,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,s,c){this.hasPattern=Nf("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:S}of e){const R=this.layers[0]._featureFilter.needGeometry,k=yc(y,R);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),k,s))continue;const N=f?f.evaluate(k,{},s,r.availableImages):void 0,G={id:b,properties:y.properties,type:y.type,sourceLayerIndex:S,index:w,geometry:R?k.geometry:Ol(y,s,c),patterns:{},sortKey:N};m.push(G)}f&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:w,sourceLayerIndex:S}=y;if(this.hasPattern){const R=Gn("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(y,b,w,s,{},r.availableImages);r.featureIndex.insert(e[w].feature,b,w,S,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,f,m=[]){for(const y of Bf(r,500)){let b=0;for(const G of y)b+=G.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=w.vertexLength,R=[],k=[];for(const G of y){if(0===G.length)continue;G!==y[0]&&k.push(R.length/2);const q=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ie=q.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ie+G.length-1,ie),R.push(G[0].x),R.push(G[0].y);for(let ue=1;ue<G.length;ue++)this.layoutVertexArray.emplaceBack(G[ue].x,G[ue].y),this.indexArray2.emplaceBack(ie+ue-1,ie+ue),R.push(G[ue].x),R.push(G[ue].y);q.vertexLength+=G.length,q.primitiveLength+=G.length}const N=yh(R,k);for(let G=0;G<N.length;G+=3)this.indexArray.emplaceBack(S+N[G],S+N[G+1],S+N[G+2]);w.vertexLength+=b,w.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,c)}}Ut(Th,"FillBucket",{omit:["layers","patternFeatures"]});const vm=new et({"fill-sort-key":new be(ke.layout_fill["fill-sort-key"])});var xm={paint:new et({"fill-antialias":new je(ke.paint_fill["fill-antialias"]),"fill-opacity":new be(ke.paint_fill["fill-opacity"]),"fill-color":new be(ke.paint_fill["fill-color"]),"fill-outline-color":new be(ke.paint_fill["fill-outline-color"]),"fill-translate":new je(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new je(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new ht(ke.paint_fill["fill-pattern"])}),layout:vm};const Lg=St([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fg=St([{name:"a_centroid_pos",components:2,type:"Uint16"}]),bm=St([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Og}=Lg;var Uf=Fu;function Fu(n,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=c,n.readFields(zg,this,e)}function zg(n,e,r){1==n?e.id=r.readVarint():2==n?function(s,c){for(var f=s.readVarint()+s.pos;s.pos<f;){var m=c._keys[s.readVarint()],y=c._values[s.readVarint()];c.properties[m]=y}}(r,e):3==n?e.type=r.readVarint():4==n&&(e._geometry=r.pos)}function Ty(n){for(var e,r,s=0,c=0,f=n.length,m=f-1;c<f;m=c++)s+=((r=n[m]).x-(e=n[c]).x)*(e.y+r.y);return s}Fu.types=["Unknown","Point","LineString","Polygon"],Fu.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,s=1,c=0,f=0,m=0,y=[];n.pos<r;){if(c<=0){var b=n.readVarint();s=7&b,c=b>>3}if(c--,1===s||2===s)f+=n.readSVarint(),m+=n.readSVarint(),1===s&&(e&&y.push(e),e=[]),e.push(new nt(f,m));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Fu.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,s=0,c=0,f=0,m=1/0,y=-1/0,b=1/0,w=-1/0;n.pos<e;){if(s<=0){var S=n.readVarint();r=7&S,s=S>>3}if(s--,1===r||2===r)(c+=n.readSVarint())<m&&(m=c),c>y&&(y=c),(f+=n.readSVarint())<b&&(b=f),f>w&&(w=f);else if(7!==r)throw new Error("unknown command "+r)}return[m,b,y,w]},Fu.prototype.toGeoJSON=function(n,e,r){var s,c,f=this.extent*Math.pow(2,r),m=this.extent*n,y=this.extent*e,b=this.loadGeometry(),w=Fu.types[this.type];function S(N){for(var G=0;G<N.length;G++){var q=N[G];N[G]=[360*(q.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(s=0;s<b.length;s++)R[s]=b[s][0];S(b=R);break;case 2:for(s=0;s<b.length;s++)S(b[s]);break;case 3:for(b=function(N){var G=N.length;if(G<=1)return[N];for(var q,ie,ue=[],Ee=0;Ee<G;Ee++){var we=Ty(N[Ee]);0!==we&&(void 0===ie&&(ie=we<0),ie===we<0?(q&&ue.push(q),q=[N[Ee]]):q.push(N[Ee]))}return q&&ue.push(q),ue}(b),s=0;s<b.length;s++)for(c=0;c<b[s].length;c++)S(b[s][c])}1===b.length?b=b[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var gd=Vf;function Vf(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Bg,this,e),this.length=this._features.length}function Bg(n,e,r){15===n?e.version=r.readVarint():1===n?e.name=r.readString():5===n?e.extent=r.readVarint():2===n?e._features.push(r.pos):3===n?e._keys.push(r.readString()):4===n&&e._values.push(function(s){for(var c=null,f=s.readVarint()+s.pos;s.pos<f;){var m=s.readVarint()>>3;c=1===m?s.readString():2===m?s.readFloat():3===m?s.readDouble():4===m?s.readVarint64():5===m?s.readVarint():6===m?s.readSVarint():7===m?s.readBoolean():null}return c}(r))}function wm(n,e,r){if(3===n){var s=new gd(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Vf.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Uf(this._pbf,e,this.extent,this._keys,this._values)};var Ec={VectorTile:function(n,e){this.layers=n.readFields(wm,{},e)},VectorTileFeature:Uf,VectorTileLayer:gd};function Ou(n,e,r,s){const c=[],f=0===s?(m,y,b,w,S,R)=>{m.push(new nt(R,b+(R-y)/(w-y)*(S-b)))}:(m,y,b,w,S,R)=>{m.push(new nt(y+(R-b)/(S-b)*(w-y),R))};for(const m of n){const y=[];for(const b of m){if(b.length<=2)continue;const w=[];for(let k=0;k<b.length-1;k++){const N=b[k].x,G=b[k].y,q=b[k+1].x,ie=b[k+1].y,ue=0===s?N:G,Ee=0===s?q:ie;ue<e?Ee>e&&f(w,N,G,q,ie,e):ue>r?Ee<r&&f(w,N,G,q,ie,r):w.push(b[k]),Ee<e&&ue>=e&&f(w,N,G,q,ie,e),Ee>r&&ue<=r&&f(w,N,G,q,ie,r)}let S=b[b.length-1];const R=0===s?S.x:S.y;R>=e&&R<=r&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),y.push(w))}y.length&&c.push(y)}return c}const Dy=Ec.VectorTileFeature.types,Ng=Math.pow(2,13);function Kc(n,e,r,s,c,f,m,y){n.emplaceBack((e<<1)+m,(r<<1)+f,(Math.floor(s*Ng)<<1)+c,Math.round(y))}function zu(n,e,r){n.emplaceBack(e.x,e.y,e.z,16384*r[0],16384*r[1],16384*r[2])}class jf{constructor(){this.acc=new nt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new nt(e.x,e.y),this.max=new nt(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,c=this.max;e.x<s.x?s.x=e.x:e.x>c.x&&(c.x=e.x),e.y<s.y?s.y=e.y:e.y>c.y&&(c.y=e.y),((0===e.x||e.x===pn)&&e.x===r.x)!=((0===e.y||e.y===pn)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Je(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>pn!=e.x>pn&&this.addBorderIntersection(1,Je(r.y,e.y,(pn-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Je(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>pn!=e.y>pn&&this.addBorderIntersection(3,Je(r.x,e.x,(pn-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((r,s)=>r+s.edges,0);return 0!==e?this.acc.div(e)._round():new nt(0,0)}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Ea{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new tn,this.centroidVertexArray=new kl,this.indexArray=new sr,this.programConfigurations=new Ll(e.layers,e.zoom),this.segments=new di,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,s,c){this.features=[],this.hasPattern=Nf("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/pn/(1<<f.z)}(s);for(const{feature:f,id:m,index:y,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,S=yc(f,w);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),S,s))continue;const R={id:m,sourceLayerIndex:b,index:y,geometry:w?S.geometry:Ol(f,s,c),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Gn("fill-extrusion",this.layers,R,this.zoom,r)):this.addFeature(R,R.geometry,y,s,{},r.availableImages,c),r.featureIndex.insert(f,R.geometry,y,b,this.index,k)}this.sortBorders()}addFeatures(e,r,s,c,f){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,r,s,c,f)}this.sortBorders()}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Og),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,bm.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Fg.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c,f,m,y){const b=[new nt(0,0),new nt(pn,pn)],w=y.projection,S="globe"===w.name,R=this.enableTerrain&&!S?new jf:null;S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bg);const k=Bf(r,500);for(let q=k.length-1;q>=0;q--){const ie=k[q];(0===ie.length||(N=ie[0]).every(ue=>ue.x<=0)||N.every(ue=>ue.x>=pn)||N.every(ue=>ue.y<=0)||N.every(ue=>ue.y>=pn))&&k.splice(q,1)}var N;let G;if(S)G=$f(k,b,c);else{G=[];for(const q of k)G.push({polygon:q,bounds:b})}for(const q of G){const ie=q.polygon;let ue=0,Ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Ze=0;Ze<ie.length;Ze++){const Xe=ie[Ze];if(0===Xe.length)continue;ue+=Xe.length;let ct=0;R&&R.startRing(Xe[0]);for(let yt=0;yt<Xe.length;yt++){const Ve=Xe[yt];if(yt>=1){const it=Xe[yt-1];if(!Ug(Ve,it,q.bounds)){R&&R.append(Ve,it),Ee.vertexLength+4>di.MAX_VERTEX_ARRAY_LENGTH&&(Ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const xt=Ve.sub(it)._perp(),bt=xt.x/(Math.abs(xt.x)+Math.abs(xt.y)),Gt=xt.y>0?1:0,mt=it.dist(Ve);ct+mt>32768&&(ct=0),Kc(this.layoutVertexArray,Ve.x,Ve.y,bt,Gt,0,0,ct),Kc(this.layoutVertexArray,Ve.x,Ve.y,bt,Gt,0,1,ct),ct+=mt,Kc(this.layoutVertexArray,it.x,it.y,bt,Gt,0,0,ct),Kc(this.layoutVertexArray,it.x,it.y,bt,Gt,0,1,ct);const Vt=Ee.vertexLength;if(this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),Ee.vertexLength+=4,Ee.primitiveLength+=2,S){const On=this.layoutVertexExtArray,jn=w.projectTilePoint(Ve.x,Ve.y,c),ln=w.projectTilePoint(it.x,it.y,c),qt=w.upVector(c,Ve.x,Ve.y),Wn=w.upVector(c,it.x,it.y);zu(On,jn,qt),zu(On,jn,qt),zu(On,ln,Wn),zu(On,ln,Wn)}}}}}if(Ee.vertexLength+ue>di.MAX_VERTEX_ARRAY_LENGTH&&(Ee=this.segments.prepareSegment(ue,this.layoutVertexArray,this.indexArray)),"Polygon"!==Dy[e.type])continue;const we=[],Ce=[],Pe=Ee.vertexLength;for(let Ze=0;Ze<ie.length;Ze++){const Xe=ie[Ze];if(0!==Xe.length){Xe!==ie[0]&&Ce.push(we.length/2);for(let ct=0;ct<Xe.length;ct++){const yt=Xe[ct];Kc(this.layoutVertexArray,yt.x,yt.y,0,0,1,1,0),we.push(yt.x),we.push(yt.y),R&&R.currentPolyCount.top++,S&&zu(this.layoutVertexExtArray,w.projectTilePoint(yt.x,yt.y,c),w.upVector(c,yt.x,yt.y))}}}const Fe=yh(we,Ce);for(let Ze=0;Ze<Fe.length;Ze+=3)this.indexArray.emplaceBack(Pe+Fe[Ze],Pe+Fe[Ze+2],Pe+Fe[Ze+1]);Ee.primitiveLength+=Fe.length/3,Ee.vertexLength+=ue}if(R&&R.polyCount.length>0){if(R.borders){R.vertexArrayOffset=this.centroidVertexArray.length;const q=R.borders,ie=this.featuresOnBorder.push(R)-1;for(let ue=0;ue<4;ue++)q[ue][0]!==Number.MAX_VALUE&&this.borders[ue].push(ie)}this.encodeCentroid(R.borders?void 0:R.centroid(),R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,r,s=!0){let c,f;if(e)if(0!==e.y){const y=r.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else c=Math.ceil(7*(e.x+450)),f=0;else c=0,f=+s;let m=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,c,f);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(m++,c,f)}}}function Ug(n,e,r){return n.x===e.x&&(n.x<r[0].x||n.x>r[1].x)||n.y===e.y&&(n.y<r[0].y||n.y>r[1].y)}function _d(){const n=Math.PI/32,e=Math.tan(n),r=Mi;return r*Math.sqrt(1+2*e*e)-r}function $f(n,e,r){const s=1<<r.z,c=ko(r.x/s),f=ko((r.x+1)/s),m=Ai(r.y/s),y=Ai((r.y+1)/s);return function(b,w,S,R,k=0,N){const G=[];if(!b.length||!S||!R)return G;const q=(Fe,Ze)=>{for(const Xe of Fe)G.push({polygon:Xe,bounds:Ze})},ie=Math.ceil(Math.log2(S)),ue=Math.ceil(Math.log2(R)),Ee=ie-ue,we=[];for(let Fe=0;Fe<Math.abs(Ee);Fe++)we.push(Ee>0?0:1);for(let Fe=0;Fe<Math.min(ie,ue);Fe++)we.push(0),we.push(1);let Ce=b;if(Ce=Ou(Ce,w[0].y-k,w[1].y+k,1),Ce=Ou(Ce,w[0].x-k,w[1].x+k,0),!Ce.length)return G;const Pe=[];for(we.length?Pe.push({polygons:Ce,bounds:w,depth:0}):q(Ce,w);Pe.length;){const Fe=Pe.pop(),Ze=Fe.depth,Xe=we[Ze],ct=Fe.bounds[0],yt=Fe.bounds[1],Ve=0===Xe?ct.x:ct.y,it=0===Xe?yt.x:yt.y,xt=N?N(Xe,Ve,it):.5*(Ve+it),bt=Ou(Fe.polygons,Ve-k,xt+k,Xe),Gt=Ou(Fe.polygons,xt-k,it+k,Xe);if(bt.length){const mt=[ct,new nt(0===Xe?xt:yt.x,1===Xe?xt:yt.y)];we.length>Ze+1?Pe.push({polygons:bt,bounds:mt,depth:Ze+1}):q(bt,mt)}if(Gt.length){const mt=[new nt(0===Xe?xt:ct.x,1===Xe?xt:ct.y),yt];we.length>Ze+1?Pe.push({polygons:Gt,bounds:mt,depth:Ze+1}):q(Gt,mt)}}return G}(n,e,Math.ceil((f-c)/11.25),Math.ceil((m-y)/11.25),1,(b,w,S)=>{if(0===b)return.5*(w+S);{const R=Ai((r.y+w/pn)/s);return(Hc(.5*(Ai((r.y+S/pn)/s)+R))*s-r.y)*pn}})}Ut(Ea,"FillExtrusionBucket",{omit:["layers","features"]}),Ut(jf,"PartMetadata");var Gf={paint:new et({"fill-extrusion-opacity":new je(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new be(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new je(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new je(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ht(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new be(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new be(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new je(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Dh(n,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class yd{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=rl(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=(m=this.y,y=this.z,b=Dh(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),w=Dh(256*(f+1),256*(m+1),y),b[0]+","+b[1]+","+w[0]+","+w[1]),c=function(f,m,y){let b,w="";for(let S=f;S>0;S--)b=1<<S-1,w+=(m&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);var f,m,y,b,w;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vd{constructor(e,r){this.wrap=e,this.canonical=r,this.key=rl(e,r.z,r.z,r.x,r.y)}}class lo{constructor(e,r,s,c,f){this.overscaledZ=e,this.wrap=r,this.canonical=new yd(s,+c,+f),this.key=0===r&&e===s?this.canonical.key:rl(r,e,s,c,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new lo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lo(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return rl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return rl(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new lo(r,this.wrap,r,s,c),new lo(r,this.wrap,r,s+1,c),new lo(r,this.wrap,r,s,c+1),new lo(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new lo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rl(n,e,r,s,c){const f=1<<Math.min(r,22);let m=f*(c%f)+s%f;return n&&r<22&&(m+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}function Bu(n,e){return n.x*e.x+n.y*e.y}function xd(n,e){if(1===n.length){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const f=e[r],m=n[0],y=c.sub(s),b=f.sub(s),w=m.sub(s),S=Bu(y,y),R=Bu(y,b),k=Bu(b,b),N=Bu(w,y),G=Bu(w,b),q=S*k-R*R,ie=(k*N-R*G)/q,ue=(S*G-R*N)/q,Ee=s.z*(1-ie-ue)+c.z*ie+f.z*ue;if(isFinite(Ee))return Ee}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function bd(n){const e=new nt(n[0],n[1]);return e.z=n[2],e}function Em(n,e,r,s,c,f,m,y){const b=m*c.getElevationAt(n,e,!0,!0),w=0!==f[0],S=w?0===f[1]?m*(f[0]/7-450):m*function(R,k,N){const G=Math.floor(k[0]/8),q=Math.floor(k[1]/8),ie=10*(k[0]-8*G),ue=10*(k[1]-8*q),Ee=R.getElevationAt(G,q,!0,!0),we=R.getMeterToDEM(N),Ce=Math.floor(.5*(ie*we-1)),Pe=Math.floor(.5*(ue*we-1)),Fe=R.tileCoordToPixel(G,q),Ze=2*Ce+1,Xe=2*Pe+1,ct=(On=Ze,jn=Xe,[(Gt=R).getElevationAtPixel(mt=Fe.x-Ce,Vt=Fe.y-Pe,!0),Gt.getElevationAtPixel(mt+jn,Vt,!0),Gt.getElevationAtPixel(mt,Vt+jn,!0),Gt.getElevationAtPixel(mt+On,Vt+jn,!0)]),yt=Math.abs(ct[0]-ct[1]),Ve=Math.abs(ct[2]-ct[3]),it=Math.abs(ct[0]-ct[2])+Math.abs(ct[1]-ct[3]),xt=Math.min(.25,.5*we*(yt+Ve)/Ze),bt=Math.min(.25,.5*we*it/Xe);var Gt,mt,Vt,On,jn;return Ee+Math.max(xt*ie,bt*ue)}(c,f,y):b;return{base:b+(0===r)?-1:r,top:w?Math.max(S+s,b+r+2):b+s}}Ut(yd,"CanonicalTileID"),Ut(lo,"OverscaledTileID",{omit:["projMatrix"]});const Tm=St([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Nu}=Tm,Vg=St([{name:"a_packed",components:4,type:"Float32"}]),{members:jg}=Vg,$g=Ec.VectorTileFeature.types,Gg=Math.cos(Math.PI/180*37.5);class Uu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Cn,this.layoutVertexArray2=new cr,this.indexArray=new sr,this.programConfigurations=new Ll(e.layers,e.zoom),this.segments=new di,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){this.hasPattern=Nf("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:S,id:R,index:k,sourceLayerIndex:N}of e){const G=this.layers[0]._featureFilter.needGeometry,q=yc(S,G);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),q,s))continue;const ie=f?f.evaluate(q,{},s):void 0,ue={id:R,properties:S.properties,type:S.type,sourceLayerIndex:N,index:k,geometry:G?q.geometry:Ol(S,s,c),patterns:{},sortKey:ie};m.push(ue)}f&&m.sort((S,R)=>S.sortKey-R.sortKey);const{lineAtlas:y,featureIndex:b}=r,w=this.addConstantDashes(y);for(const S of m){const{geometry:R,index:k,sourceLayerIndex:N}=S;if(w&&this.addFeatureDashes(S,y),this.hasPattern){const G=Gn("line",this.layers,S,this.zoom,r);this.patternFeatures.push(G)}else this.addFeature(S,R,k,s,y.positions,r.availableImages);b.insert(e[k].feature,R,k,N,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==c.kind||"constant"!==f.kind)r=!0;else{const m=f.value,y=c.value;if(!y)continue;e.addDash(y.from,m),e.addDash(y.to,m),y.other&&e.addDash(y.other,m)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===m.kind)continue;let y,b,w,S,R,k;if("constant"===f.kind){const ie=f.value;if(!ie)continue;y=ie.other||ie.to,b=ie.to,w=ie.from}else y=f.evaluate({zoom:s-1},e),b=f.evaluate({zoom:s},e),w=f.evaluate({zoom:s+1},e);"constant"===m.kind?S=R=k=m.value:(S=m.evaluate({zoom:s-1},e),R=m.evaluate({zoom:s},e),k=m.evaluate({zoom:s+1},e)),r.addDash(y,S),r.addDash(b,R),r.addDash(w,k);const N=r.getKey(y,S),G=r.getKey(b,R),q=r.getKey(w,k);e.patterns[c.id]={min:N,mid:G,max:q}}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,jg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,f,m){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),S=y.get("line-miter-limit"),R=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of r)this.addLine(k,e,b,w,S,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,c)}addLine(e,r,s,c,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<e.length-1;ue++)this.totalDistance+=e[ue].dist(e[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===$g[r.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;"bevel"===s&&(f=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,R=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,N,G,q,ie;this.e1=this.e2=-1,y&&(k=e[b-2],ie=e[w].sub(k)._unit()._perp());for(let ue=w;ue<b;ue++){if(G=ue===b-1?y?e[w+1]:void 0:e[ue+1],G&&e[ue].equals(G))continue;ie&&(q=ie),k&&(N=k),k=e[ue],ie=G?G.sub(k)._unit()._perp():q,q=q||ie;let Ee=q.add(ie);0===Ee.x&&0===Ee.y||Ee._unit();const we=q.x*ie.x+q.y*ie.y,Ce=Ee.x*ie.x+Ee.y*ie.y,Pe=0!==Ce?1/Ce:1/0,Fe=2*Math.sqrt(2-2*Ce),Ze=Ce<Gg&&N&&G,Xe=q.x*ie.y-q.y*ie.x>0;if(Ze&&ue>w){const Ve=k.dist(N);if(Ve>2*S){const it=k.sub(k.sub(N)._mult(S/Ve)._round());this.updateDistance(N,it),this.addCurrentVertex(it,q,0,0,R),N=it}}const ct=N&&G;let yt=ct?s:y?"butt":c;if(ct&&"round"===yt&&(Pe<m?yt="miter":Pe<=2&&(yt="fakeround")),"miter"===yt&&Pe>f&&(yt="bevel"),"bevel"===yt&&(Pe>2&&(yt="flipbevel"),Pe<f&&(yt="miter")),N&&this.updateDistance(N,k),"miter"===yt)Ee._mult(Pe),this.addCurrentVertex(k,Ee,0,0,R);else if("flipbevel"===yt){if(Pe>100)Ee=ie.mult(-1);else{const Ve=Pe*q.add(ie).mag()/q.sub(ie).mag();Ee._perp()._mult(Ve*(Xe?-1:1))}this.addCurrentVertex(k,Ee,0,0,R),this.addCurrentVertex(k,Ee.mult(-1),0,0,R)}else if("bevel"===yt||"fakeround"===yt){const Ve=-Math.sqrt(Pe*Pe-1),it=Xe?Ve:0,xt=Xe?0:Ve;if(N&&this.addCurrentVertex(k,q,it,xt,R),"fakeround"===yt){const bt=Math.round(180*Fe/Math.PI/20);for(let Gt=1;Gt<bt;Gt++){let mt=Gt/bt;if(.5!==mt){const On=mt-.5;mt+=mt*On*(mt-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*On*On+(.848013+we*(.215638*we-1.06021)))}const Vt=ie.sub(q)._mult(mt)._add(q)._unit()._mult(Xe?-1:1);this.addHalfVertex(k,Vt.x,Vt.y,!1,Xe,0,R)}}G&&this.addCurrentVertex(k,ie,-it,-xt,R)}else if("butt"===yt)this.addCurrentVertex(k,Ee,0,0,R);else if("square"===yt){const Ve=N?1:-1;N||this.addCurrentVertex(k,Ee,Ve,Ve,R),this.addCurrentVertex(k,Ee,0,0,R),N&&this.addCurrentVertex(k,Ee,Ve,Ve,R)}else"round"===yt&&(N&&(this.addCurrentVertex(k,q,0,0,R),this.addCurrentVertex(k,q,1,1,R,!0)),G&&(this.addCurrentVertex(k,ie,-1,-1,R,!0),this.addCurrentVertex(k,ie,0,0,R)));if(Ze&&ue<b-1){const Ve=k.dist(G);if(Ve>2*S){const it=k.add(G.sub(k)._mult(S/Ve)._round());this.updateDistance(k,it),this.addCurrentVertex(it,ie,0,0,R),k=it}}}}addCurrentVertex(e,r,s,c,f,m=!1){const y=r.y*c-r.x,b=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,m,!1,s,f),this.addHalfVertex(e,y,b,m,!0,-c,f)}addHalfVertex({x:e,y:r},s,c,f,m,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ut(Uu,"LineBucket",{omit:["layers","patternFeatures"]});const Dm=new et({"line-cap":new be(ke.layout_line["line-cap"]),"line-join":new be(ke.layout_line["line-join"]),"line-miter-limit":new je(ke.layout_line["line-miter-limit"]),"line-round-limit":new je(ke.layout_line["line-round-limit"]),"line-sort-key":new be(ke.layout_line["line-sort-key"])});var Hf={paint:new et({"line-opacity":new be(ke.paint_line["line-opacity"]),"line-color":new be(ke.paint_line["line-color"]),"line-translate":new je(ke.paint_line["line-translate"]),"line-translate-anchor":new je(ke.paint_line["line-translate-anchor"]),"line-width":new be(ke.paint_line["line-width"]),"line-gap-width":new be(ke.paint_line["line-gap-width"]),"line-offset":new be(ke.paint_line["line-offset"]),"line-blur":new be(ke.paint_line["line-blur"]),"line-dasharray":new ht(ke.paint_line["line-dasharray"]),"line-pattern":new ht(ke.paint_line["line-pattern"]),"line-gradient":new kt(ke.paint_line["line-gradient"]),"line-trim-offset":new je(ke.paint_line["line-trim-offset"])}),layout:Dm};const Ta=new class extends be{possiblyEvaluate(n,e){return e=new ae(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,r,s){return e=gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,r,s)}}(Hf.paint.properties["line-width"].specification);function Cm(n,e){return e>0?e+2*n:n}Ta.useIntegerZoom=!0;const Zf=St([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qf=St([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Hg=St([{name:"a_projected_pos",components:4,type:"Float32"}],4);St([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cy=St([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Iy=St([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);St([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Zg=St([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),qg=St([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);St([{name:"triangle",components:3,type:"Uint16"}]),St([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),St([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),St([{type:"Float32",name:"offsetX"}]),St([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ul=128;function Wf(n,e){const{expression:r}=e;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new ae(n+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let m=f;for(;m<s.length&&s[m]<n+1;)m++;m=Math.min(s.length-1,m);const y=s[f],b=s[m];return"composite"===r.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new ae(y)),maxSize:r.evaluate(new ae(b)),interpolationType:c}}}function Vl(n,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return"source"===n.kind?s/Ul:"composite"===n.kind?Je(s/Ul,c/Ul,r):e}function Vu(n,e){let r=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:c,minZoom:f,maxZoom:m}=n,y=c?Xt(yr.interpolationFactor(c,e,f,m),0,1):0;"camera"===n.kind?s=Je(n.minSize,n.maxSize,y):r=y}return{uSizeT:r,uSize:s}}var Im=Object.freeze({__proto__:null,getSizeData:Wf,evaluateSizeForFeature:Vl,evaluateSizeForZoom:Vu,SIZE_PACK_FACTOR:Ul});function wd(n,e,r){return n.sections.forEach(s=>{s.text=function(c,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return"uppercase"===y?c=c.toLocaleUpperCase():"lowercase"===y&&(c=c.toLocaleLowerCase()),ee.applyArabicShaping&&(c=ee.applyArabicShaping(c)),c}(s.text,e,r)}),n}const Ch={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Sm(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Wg(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Mm=function(n,e,r,s,c){var f,m,y=8*c-s-1,b=(1<<y)-1,w=b>>1,S=-7,R=r?c-1:0,k=r?-1:1,N=n[e+R];for(R+=k,f=N&(1<<-S)-1,N>>=-S,S+=y;S>0;f=256*f+n[e+R],R+=k,S-=8);for(m=f&(1<<-S)-1,f>>=-S,S+=s;S>0;m=256*m+n[e+R],R+=k,S-=8);if(0===f)f=1-w;else{if(f===b)return m?NaN:1/0*(N?-1:1);m+=Math.pow(2,s),f-=w}return(N?-1:1)*m*Math.pow(2,f-s)},Am=function(n,e,r,s,c,f){var m,y,b,w=8*f-c-1,S=(1<<w)-1,R=S>>1,k=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,N=s?0:f-1,G=s?1:-1,q=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=S):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+R>=1?k/b:k*Math.pow(2,1-R))*b>=2&&(m++,b/=2),m+R>=S?(y=0,m=S):m+R>=1?(y=(e*b-1)*Math.pow(2,c),m+=R):(y=e*Math.pow(2,R-1)*Math.pow(2,c),m=0));c>=8;n[r+N]=255&y,N+=G,y/=256,c-=8);for(m=m<<c|y,w+=c;w>0;n[r+N]=255&m,N+=G,m/=256,w-=8);n[r+N-G]|=128*q},Ih=Nr;function Nr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Nr.Varint=0,Nr.Fixed64=1,Nr.Bytes=2,Nr.Fixed32=5;var Ed=4294967296,Pm=1/Ed,Xf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function il(n){return n.type===Nr.Bytes?n.readVarint()+n.pos:n.pos+1}function Xg(n,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=n;c--)r.buf[c+s]=r.buf[c]}function Yf(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function Yg(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function Sy(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function ju(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function Rm(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function Kg(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function Qg(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function Kf(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function My(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function Qf(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Dc(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function Jg(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function Ay(n,e,r){e.glyphs=[],1===n&&r.readMessage(Py,e)}function Py(n,e,r){if(3===n){const{id:s,bitmap:c,width:f,height:m,left:y,top:b,advance:w}=r.readMessage(Ry,{});e.glyphs.push({id:s,bitmap:new nl({width:f+6,height:m+6},c),metrics:{width:f,height:m,left:y,top:b,advance:w}})}else 4===n?e.ascender=r.readSVarint():5===n&&(e.descender=r.readSVarint())}function Ry(n,e,r){1===n?e.id=r.readVarint():2===n?e.bitmap=r.readBytes():3===n?e.width=r.readVarint():4===n?e.height=r.readVarint():5===n?e.left=r.readSVarint():6===n?e.top=r.readSVarint():7===n&&(e.advance=r.readVarint())}function km(n){let e=0,r=0;for(const m of n)e+=m.w*m.h,r=Math.max(r,m.w);n.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,f=0;for(const m of n)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,f=Math.max(f,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===b.w&&m.h===b.h){const w=s.pop();y<s.length&&(s[y]=w)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(s.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}Nr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,f=this.pos;this.type=7&s,n(c,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Qf(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Jg(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Qf(this.buf,this.pos)+Qf(this.buf,this.pos+4)*Ed;return this.pos+=8,n},readSFixed64:function(){var n=Qf(this.buf,this.pos)+Jg(this.buf,this.pos+4)*Ed;return this.pos+=8,n},readFloat:function(){var n=Mm(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Mm(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,f,m){var y,b,w=m.buf;if(y=(112&(b=w[m.pos++]))>>4,b<128||(y|=(127&(b=w[m.pos++]))<<3,b<128)||(y|=(127&(b=w[m.pos++]))<<10,b<128)||(y|=(127&(b=w[m.pos++]))<<17,b<128)||(y|=(127&(b=w[m.pos++]))<<24,b<128)||(y|=(1&(b=w[m.pos++]))<<31,b<128))return function Tc(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(c,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Xf?Xf.decode(this.buf.subarray(e,n)):function(r,s,c){for(var f="",m=s;m<c;){var y,b,w,S=r[m],R=null,k=S>239?4:S>223?3:S>191?2:1;if(m+k>c)break;1===k?S<128&&(R=S):2===k?128==(192&(y=r[m+1]))&&(R=(31&S)<<6|63&y)<=127&&(R=null):3===k?(b=r[m+2],128==(192&(y=r[m+1]))&&128==(192&b)&&((R=(15&S)<<12|(63&y)<<6|63&b)<=2047||R>=55296&&R<=57343)&&(R=null)):4===k&&(b=r[m+2],w=r[m+3],128==(192&(y=r[m+1]))&&128==(192&b)&&128==(192&w)&&((R=(15&S)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||R>=1114112)&&(R=null)),null===R?(R=65533,k=1):R>65535&&(R-=65536,f+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),f+=String.fromCharCode(R),m+=k}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Nr.Bytes)return n.push(this.readVarint(e));var r=il(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Nr.Bytes)return n.push(this.readSVarint());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Nr.Bytes)return n.push(this.readBoolean());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Nr.Bytes)return n.push(this.readFloat());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Nr.Bytes)return n.push(this.readDouble());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Nr.Bytes)return n.push(this.readFixed32());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Nr.Bytes)return n.push(this.readSFixed32());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Nr.Bytes)return n.push(this.readFixed64());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Nr.Bytes)return n.push(this.readSFixed64());var e=il(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Nr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Nr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Nr.Fixed32)this.pos+=4;else{if(e!==Nr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Dc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Dc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Dc(this.buf,-1&n,this.pos),Dc(this.buf,Math.floor(n*Pm),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Dc(this.buf,-1&n,this.pos),Dc(this.buf,Math.floor(n*Pm),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var s,c,f,y;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),f=s,(y=r).buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(c,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,c,f){for(var m,y,b=0;b<c.length;b++){if((m=c.charCodeAt(b))>55295&&m<57344){if(!y){m>56319||b+1===c.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=m;continue}if(m<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);m<128?s[f++]=m:(m<2048?s[f++]=m>>6|192:(m<65536?s[f++]=m>>12|224:(s[f++]=m>>18|240,s[f++]=m>>12&63|128),s[f++]=m>>6&63|128),s[f++]=63&m|128)}return f}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&Xg(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Am(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Am(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var s=this.pos-r;s>=128&&Xg(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,r){this.writeTag(n,Nr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Yf,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Yg,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Rm,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Sy,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,ju,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Kg,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Qg,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Kf,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,My,e)},writeBytesField:function(n,e){this.writeTag(n,Nr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Nr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Nr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Nr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Nr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Nr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Nr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Nr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Nr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Nr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class Td{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=f,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Dd{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(r,c,f);const{w:m,h:y}=km(f),b=new Jo({width:m||1,height:y||1});for(const w in e){const S=e[w],R=s[w].paddedRect;Jo.copy(S.data,b,{x:0,y:0},{x:R.x+1,y:R.y+1},S.data)}for(const w in r){const S=r[w],R=c[w].paddedRect,k=R.x+1,N=R.y+1,G=S.data.width,q=S.data.height;Jo.copy(S.data,b,{x:0,y:0},{x:k,y:N},S.data),Jo.copy(S.data,b,{x:0,y:q-1},{x:k,y:N-1},{width:G,height:1}),Jo.copy(S.data,b,{x:0,y:0},{x:k,y:N+q},{width:G,height:1}),Jo.copy(S.data,b,{x:G-1,y:0},{x:k-1,y:N},{width:1,height:q}),Jo.copy(S.data,b,{x:0,y:0},{x:k+G,y:N},{width:1,height:q})}this.image=b,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const f=e[c],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(m),r[c]=new Td(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,f]=e.tl;s.update(r.data,void 0,{x:c,y:f})}}Ut(Td,"ImagePosition"),Ut(Dd,"ImageAtlas");const ls={horizontal:1,vertical:2,horizontalOnly:3};class Sh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Sh;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Sh;return r.imageName=e,r}}class Qc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Qc;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?s.addImageSection(f):s.addTextSection(f,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,s){let c="";for(let f=0;f<r.length;f++){const m=r.charCodeAt(f+1)||null,y=r.charCodeAt(f-1)||null;c+=!s&&(m&&l(m)&&!Ch[r[f+1]]||y&&l(y)&&!Ch[r[f-1]])||!Ch[r[f]]?r[f]:Ch[r[f]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Jc[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Jc[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Qc;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Sh.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(0===r.length)return void fn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Sh.forImage(r)),this.sectionIndex.push(this.sections.length-1)):fn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cd(n,e,r,s,c,f,m,y,b,w,S,R,k,N,G,q){const ie=Qc.fromFeature(n,c);let ue;R===ls.vertical&&ie.verticalizePunctuation(k);const{processBidirectionalText:Ee,processStyledBidirectionalText:we}=ee;if(Ee&&1===ie.sections.length){ue=[];const Fe=Ee(ie.toString(),Sd(ie,w,f,e,s,N,G));for(const Ze of Fe){const Xe=new Qc;Xe.text=Ze,Xe.sections=ie.sections;for(let ct=0;ct<Ze.length;ct++)Xe.sectionIndex.push(0);ue.push(Xe)}}else if(we){ue=[];const Fe=we(ie.text,ie.sectionIndex,Sd(ie,w,f,e,s,N,G));for(const Ze of Fe){const Xe=new Qc;Xe.text=Ze[0],Xe.sectionIndex=Ze[1],Xe.sections=ie.sections,ue.push(Xe)}}else ue=function(Fe,Ze){const Xe=[],ct=Fe.text;let yt=0;for(const Ve of Ze)Xe.push(Fe.substring(yt,Ve)),yt=Ve;return yt<ct.length&&Xe.push(Fe.substring(yt,ct.length)),Xe}(ie,Sd(ie,w,f,e,s,N,G));const Ce=[],Pe={positionedLines:Ce,text:ie.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Fe,Ze,Xe,ct,yt,Ve,it,xt,bt,Gt,mt,Vt){let On=0,jn=0,ln=0;const qt="right"===xt?1:"left"===xt?0:.5;let Wn=!1;for(const Xn of yt){const tr=Xn.getSections();for(const Ur of tr){if(Ur.imageName)continue;const Lr=Ze[Ur.fontStack];if(Lr&&(Wn=void 0!==Lr.ascender&&void 0!==Lr.descender,!Wn))break}if(!Wn)break}let Nn=0;for(const Xn of yt){Xn.trim();const tr=Xn.getMaxScale(),Ur=24*(tr-1),Lr={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Nn]=Lr;const Cr=Lr.positionedGlyphs;let Vr=0;if(!Xn.length()){jn+=Ve,++Nn;continue}let Jr=0,hr=0;for(let er=0;er<Xn.length();er++){const li=Xn.getSection(er),uo=Xn.getSectionIndex(er),gr=Xn.getCharCode(er);let Xr=li.scale,wo=null,Ir=null,pi=null,ro=24,ji=0;const ho=!(bt===ls.horizontal||!mt&&!t(gr)||mt&&(Jc[gr]||(on=gr,Er(on)||Cu(on)||hc(on)||en(on)||Wa(on))));if(li.imageName){const Eo=ct[li.imageName];if(!Eo)continue;pi=li.imageName,Fe.iconsInText=Fe.iconsInText||!0,Ir=Eo.paddedRect;const fo=Eo.displaySize;Xr=24*Xr/Vt,wo={width:fo[0],height:fo[1],left:1,top:-3,advance:ho?fo[1]:fo[0],localGlyph:!1},ji=Wn?-wo.height*Xr:24*tr-17-fo[1]*Xr,ro=wo.advance;const dl=(ho?fo[0]:fo[1])*Xr-24*tr;dl>0&&dl>Vr&&(Vr=dl)}else{const Eo=Xe[li.fontStack];if(!Eo)continue;Eo[gr]&&(Ir=Eo[gr]);const fo=Ze[li.fontStack];if(!fo)continue;const dl=fo.glyphs[gr];if(!dl)continue;if(wo=dl.metrics,ro=8203!==gr?24:0,Wn){const fu=void 0!==fo.ascender?Math.abs(fo.ascender):0,us=void 0!==fo.descender?Math.abs(fo.descender):0,$h=(fu+us)*Xr;Jr<$h&&(Jr=$h,hr=(fu-us)/2*Xr),ji=-fu*Xr}else ji=24*(tr-Xr)-17}ho?(Fe.verticalizable=!0,Cr.push({glyph:gr,imageName:pi,x:On,y:jn+ji,vertical:ho,scale:Xr,localGlyph:wo.localGlyph,fontStack:li.fontStack,sectionIndex:uo,metrics:wo,rect:Ir}),On+=ro*Xr+Gt):(Cr.push({glyph:gr,imageName:pi,x:On,y:jn+ji,vertical:ho,scale:Xr,localGlyph:wo.localGlyph,fontStack:li.fontStack,sectionIndex:uo,metrics:wo,rect:Ir}),On+=wo.advance*Xr+Gt)}0!==Cr.length&&(ln=Math.max(On-Gt,ln),Wn?e_(Cr,qt,Vr,hr,Ve*tr/2):e_(Cr,qt,Vr,0,Ve/2)),On=0;const zo=Ve*tr+Vr;Lr.lineOffset=Math.max(Vr,Ur),jn+=zo,++Nn}var on;const Ti=jn,{horizontalAlign:ai,verticalAlign:ri}=Mh(it);(function(Xn,tr,Ur,Lr,Cr,Vr){const Jr=(tr-Ur)*Cr,hr=-Vr*Lr;for(const zo of Xn)for(const er of zo.positionedGlyphs)er.x+=Jr,er.y+=hr})(Fe.positionedLines,qt,ai,ri,ln,Ti),Fe.top+=-ri*Ti,Fe.bottom=Fe.top+Ti,Fe.left+=-ai*ln,Fe.right=Fe.left+ln,Fe.hasBaseline=Wn}(Pe,e,r,s,ue,m,y,b,R,w,k,q),!function(Fe){for(const Ze of Fe)if(0!==Ze.positionedGlyphs.length)return!1;return!0}(Ce)&&Pe}const Jc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Da={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jf(n,e,r,s,c,f){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*24/f+c:0}{const m=r[e.fontStack],y=m&&m.glyphs[n];return y?y.metrics.advance*e.scale+c:0}}function Lm(n,e,r,s){const c=Math.pow(n-e,2);return s?n<e?c/2:2*c:c+Math.abs(r)*r}function ep(n,e,r){let s=0;return 10===n&&(s-=1e4),r&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function ol(n,e,r,s,c,f){let m=null,y=Lm(e,r,c,f);for(const b of s){const w=Lm(e-b.x,r,c,f)+b.badness;w<=y&&(m=b,y=w)}return{index:n,x:e,priorBreak:m,badness:y}}function Id(n){return n?Id(n.priorBreak).concat(n.index):[]}function Sd(n,e,r,s,c,f,m){if("point"!==f)return[];if(!n)return[];const y=[],b=function(k,N,G,q,ie,ue){let Ee=0;for(let we=0;we<k.length();we++){const Ce=k.getSection(we);Ee+=Jf(k.getCharCode(we),Ce,q,ie,N,ue)}return Ee/Math.max(1,Math.ceil(Ee/G))}(n,e,r,s,c,m),w=n.text.indexOf("\u200b")>=0;let S=0;for(let k=0;k<n.length();k++){const N=n.getSection(k),G=n.getCharCode(k);if(Jc[G]||(S+=Jf(G,N,s,c,e,m)),k<n.length()-1){const q=!((R=G)<11904||!(M(R)||lh(R)||Wr(R)||Rn(R)||U(R)||Iu(R)||C(R)||jc(R)||X(R)||pe(R)||L(R)||Xa(R)||$c(R)||qa(R)||ah(R)||D(R)||Ys(R)||zr(R)||Ye(R)||De(R)));(Da[G]||q||N.imageName)&&y.push(ol(k+1,S,b,y,ep(G,n.getCharCode(k+1),q&&w),!1))}}var R;return Id(ol(n.length(),S,b,y,0,!0))}function Mh(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function e_(n,e,r,s,c){if(!(e||r||s||c))return;const f=n.length-1,m=n[f],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=f;b++)n[b].x-=y,n[b].y+=r+s+c}function Fm(n,e,r){const{horizontalAlign:s,verticalAlign:c}=Mh(r),f=e[0]-n.displaySize[0]*s,m=e[1]-n.displaySize[1]*c;return{image:n,top:m,bottom:m+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function t_(n,e,r,s,c,f){const m=n.image;let y;if(m.content){const ie=m.content,ue=m.pixelRatio||1;y=[ie[0]/ue,ie[1]/ue,m.displaySize[0]-ie[2]/ue,m.displaySize[1]-ie[3]/ue]}const b=e.left*f,w=e.right*f;let S,R,k,N;"width"===r||"both"===r?(N=c[0]+b-s[3],R=c[0]+w+s[1]):(N=c[0]+(b+w-m.displaySize[0])/2,R=N+m.displaySize[0]);const G=e.top*f,q=e.bottom*f;return"height"===r||"both"===r?(S=c[1]+G-s[0],k=c[1]+q+s[2]):(S=c[1]+(G+q-m.displaySize[1])/2,k=S+m.displaySize[1]),{image:m,top:S,right:R,bottom:k,left:N,collisionPadding:y}}class ea extends nt{constructor(e,r,s,c,f){super(e,r),this.angle=c,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new ea(this.x,this.y,this.z,this.angle,this.segment)}}function Ah(n,e,r,s,c){if(void 0===e.segment)return!0;let f=e,m=e.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=n[m].dist(f),f=n[m]}y+=n[m].dist(n[m+1]),m++;const b=[];let w=0;for(;y<r/2;){const S=n[m],R=n[m+1];if(!R)return!1;let k=n[m-1].angleTo(S)-S.angleTo(R);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:k}),w+=k;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>c)return!1;m++,y+=S.dist(R)}return!0}function Md(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Ad(n,e,r){return n?.6*e*r:0}function Pd(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function ky(n,e,r,s,c,f){const m=Ad(r,c,f),y=Pd(r,s)*f;let b=0;const w=Md(n)/2;for(let S=0;S<n.length-1;S++){const R=n[S],k=n[S+1],N=R.dist(k);if(b+N>w){const G=(w-b)/N,q=Je(R.x,k.x,G),ie=Je(R.y,k.y,G),ue=new ea(q,ie,0,k.angleTo(R),S);return!m||Ah(n,ue,y,m,e)?ue:void 0}b+=N}}function n_(n,e,r,s,c,f,m,y,b){const w=Ad(s,f,m),S=Pd(s,c),R=S*m,k=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return e-R<e/4&&(e=R+e/4),Om(n,k?e/2*y%e:(S/2+2*f)*m*y%e,e,w,r,R,k,!1,b)}function Om(n,e,r,s,c,f,m,y,b){const w=f/2,S=Md(n);let R=0,k=e-r,N=[];for(let G=0;G<n.length-1;G++){const q=n[G],ie=n[G+1],ue=q.dist(ie),Ee=ie.angleTo(q);for(;k+r<R+ue;){k+=r;const we=(k-R)/ue,Ce=Je(q.x,ie.x,we),Pe=Je(q.y,ie.y,we);if(Ce>=0&&Ce<b&&Pe>=0&&Pe<b&&k-w>=0&&k+w<=S){const Fe=new ea(Ce,Pe,0,Ee,G);Fe._round(),s&&!Ah(n,Fe,f,s,c)||N.push(Fe)}}R+=ue}return y||N.length||m||(N=Om(n,R/2,r,s,c,f,m,!0,b)),N}function zm(n,e,r,s,c){const f=[];for(let m=0;m<n.length;m++){const y=n[m];let b;for(let w=0;w<y.length-1;w++){let S=y[w],R=y[w+1];S.x<e&&R.x<e||(S.x<e?S=new nt(e,S.y+(e-S.x)/(R.x-S.x)*(R.y-S.y))._round():R.x<e&&(R=new nt(e,S.y+(e-S.x)/(R.x-S.x)*(R.y-S.y))._round()),S.y<r&&R.y<r||(S.y<r?S=new nt(S.x+(r-S.y)/(R.y-S.y)*(R.x-S.x),r)._round():R.y<r&&(R=new nt(S.x+(r-S.y)/(R.y-S.y)*(R.x-S.x),r)._round()),S.x>=s&&R.x>=s||(S.x>=s?S=new nt(s,S.y+(s-S.x)/(R.x-S.x)*(R.y-S.y))._round():R.x>=s&&(R=new nt(s,S.y+(s-S.x)/(R.x-S.x)*(R.y-S.y))._round()),S.y>=c&&R.y>=c||(S.y>=c?S=new nt(S.x+(c-S.y)/(R.y-S.y)*(R.x-S.x),c)._round():R.y>=c&&(R=new nt(S.x+(c-S.y)/(R.y-S.y)*(R.x-S.x),c)._round()),b&&S.equals(b[b.length-1])||(b=[S],f.push(b)),b.push(R)))))}}return f}Ut(ea,"Anchor");const Ph=1e20;function tp(n,e,r,s,c,f,m,y,b){for(let w=e;w<e+s;w++)r_(n,r*f+w,f,c,m,y,b);for(let w=r;w<r+c;w++)r_(n,w*f+e,1,s,m,y,b)}function r_(n,e,r,s,c,f,m){f[0]=0,m[0]=-Ph,m[1]=Ph,c[0]=n[e];for(let y=1,b=0,w=0;y<s;y++){c[y]=n[e+y*r];const S=y*y;do{const R=f[b];w=(c[y]-c[R]+S-R*R)/(y-R)/2}while(w<=m[b]&&--b>-1);b++,f[b]=y,m[b]=w,m[b+1]=Ph}for(let y=0,b=0;y<s;y++){for(;m[b+1]<y;)b++;const w=f[b],S=y-w;n[e+y*r]=c[w]+S*S}}const np={none:0,ideographs:1,all:2};class Rh{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const c in e)for(const f of e[c])s.push({stack:c,id:f});Bt(s,({stack:c,id:f},m)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[f];if(void 0!==b)return void m(null,{stack:c,id:f,glyph:b});if(b=this._tinySDF(y,c,f),b)return y.glyphs[f]=b,void m(null,{stack:c,id:f,glyph:b});const w=Math.floor(f/256);if(256*w>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void m(null,{stack:c,id:f,glyph:b});let S=y.requests[w];S||(S=y.requests[w]=[],Rh.loadGlyphRange(c,w,this.url,this.requestManager,(R,k)=>{if(k){y.ascender=k.ascender,y.descender=k.descender;for(const N in k.glyphs)this._doesCharSupportLocalGlyph(+N)||(y.glyphs[+N]=k.glyphs[+N]);y.ranges[w]=!0}for(const N of S)N(R,k);delete y.requests[w]})),S.push((R,k)=>{R?m(R):k&&m(null,{stack:c,id:f,glyph:k.glyphs[f]||null})})},(c,f)=>{if(c)r(c);else if(f){const m={};for(const{stack:y,id:b,glyph:w}of f)void 0===m[y]&&(m[y]={}),void 0===m[y].glyphs&&(m[y].glyphs={}),m[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;r(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==np.none&&(this.localGlyphMode===np.all?!!this.localFontFamily:!!this.localFontFamily&&(pe(e)||It(e)||$c(e)||Ys(e)||jc(e)))}_tinySDF(e,r,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let q="400";/bold/i.test(r)?q="900":/medium/i.test(r)?q="500":/light/i.test(r)&&(q="200"),f=e.tinySDF=new Rh.TinySDF({fontFamily:c,fontWeight:q,fontSize:48,buffer:6,radius:16}),f.fontWeight=q}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const m=String.fromCharCode(s),{data:y,width:b,height:w,glyphWidth:S,glyphHeight:R,glyphLeft:k,glyphTop:N,glyphAdvance:G}=f.draw(m);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new nl({width:b,height:w},y),metrics:{width:S/2,height:R/2,left:k/2,top:N/2-27,advance:G/2,localGlyph:!0}}}}function rp(n,e,r,s){const c=[],f=n.image,m=f.pixelRatio,y=f.paddedRect.w-2,b=f.paddedRect.h-2,w=n.right-n.left,S=n.bottom-n.top,R=f.stretchX||[[0,y]],k=f.stretchY||[[0,b]],N=(Ve,it)=>Ve+it[1]-it[0],G=R.reduce(N,0),q=k.reduce(N,0),ie=y-G,ue=b-q;let Ee=0,we=G,Ce=0,Pe=q,Fe=0,Ze=ie,Xe=0,ct=ue;if(f.content&&s){const Ve=f.content;Ee=kh(R,0,Ve[0]),Ce=kh(k,0,Ve[1]),we=kh(R,Ve[0],Ve[2]),Pe=kh(k,Ve[1],Ve[3]),Fe=Ve[0]-Ee,Xe=Ve[1]-Ce,Ze=Ve[2]-Ve[0]-we,ct=Ve[3]-Ve[1]-Pe}const yt=(Ve,it,xt,bt)=>{const Gt=$u(Ve.stretch-Ee,we,w,n.left),mt=ip(Ve.fixed-Fe,Ze,Ve.stretch,G),Vt=$u(it.stretch-Ce,Pe,S,n.top),On=ip(it.fixed-Xe,ct,it.stretch,q),jn=$u(xt.stretch-Ee,we,w,n.left),ln=ip(xt.fixed-Fe,Ze,xt.stretch,G),qt=$u(bt.stretch-Ce,Pe,S,n.top),Wn=ip(bt.fixed-Xe,ct,bt.stretch,q),Nn=new nt(Gt,Vt),on=new nt(jn,Vt),Ti=new nt(jn,qt),ai=new nt(Gt,qt),ri=new nt(mt/m,On/m),Xn=new nt(ln/m,Wn/m),tr=e*Math.PI/180;if(tr){const Cr=Math.sin(tr),Vr=Math.cos(tr),Jr=[Vr,-Cr,Cr,Vr];Nn._matMult(Jr),on._matMult(Jr),ai._matMult(Jr),Ti._matMult(Jr)}const Ur=Ve.stretch+Ve.fixed,Lr=it.stretch+it.fixed;return{tl:Nn,tr:on,bl:ai,br:Ti,tex:{x:f.paddedRect.x+1+Ur,y:f.paddedRect.y+1+Lr,w:xt.stretch+xt.fixed-Ur,h:bt.stretch+bt.fixed-Lr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ri,pixelOffsetBR:Xn,minFontScaleX:Ze/m/w,minFontScaleY:ct/m/S,isSDF:r}};if(s&&(f.stretchX||f.stretchY)){const Ve=Bm(R,ie,G),it=Bm(k,ue,q);for(let xt=0;xt<Ve.length-1;xt++){const bt=Ve[xt],Gt=Ve[xt+1];for(let mt=0;mt<it.length-1;mt++)c.push(yt(bt,it[mt],Gt,it[mt+1]))}}else c.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return c}function kh(n,e,r){let s=0;for(const c of n)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function Bm(n,e,r){const s=[{fixed:-1,stretch:0}];for(const[c,f]of n){const m=s[s.length-1];s.push({fixed:c-m.stretch,stretch:m.stretch}),s.push({fixed:c-m.stretch,stretch:m.stretch+(f-c)})}return s.push({fixed:e+1,stretch:r}),s}function $u(n,e,r,s){return n/e*r+s}function ip(n,e,r,s){return n-e*r/s}function Ly(n,e,r,s){const c=e+n.positionedLines[s].lineOffset;return 0===s?r+c/2:r+(c+(e+n.positionedLines[s-1].lineOffset))/2}Rh.loadGlyphRange=function(n,e,r,s,c){const f=256*e,m=f+255,y=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${f}-${m}`),ye.Glyphs);Ie(y,(b,w)=>{if(b)c(b);else if(w){const S={},R=new Ih(w).readFields(Ay,{});for(const k of R.glyphs)S[k.id]=k;c(null,{glyphs:S,ascender:R.ascender,descender:R.descender})}})},Rh.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const y=this.size=n+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${f} ${n}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(n),m=Math.ceil(r),y=Math.min(this.size-this.buffer,Math.ceil(f-c)),b=Math.min(this.size-this.buffer,m+Math.ceil(s)),w=y+2*this.buffer,S=b+2*this.buffer,R=Math.max(w*S,0),k=new Uint8ClampedArray(R),N={data:k,width:w,height:S,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(0===y||0===b)return N;const{ctx:G,buffer:q,gridInner:ie,gridOuter:ue}=this;G.clearRect(q,q,y,b),G.fillText(n,q,q+m);const Ee=G.getImageData(q,q,y,b);ue.fill(Ph,0,R),ie.fill(0,0,R);for(let we=0;we<b;we++)for(let Ce=0;Ce<y;Ce++){const Pe=Ee.data[4*(we*y+Ce)+3]/255;if(0===Pe)continue;const Fe=(we+q)*w+Ce+q;if(1===Pe)ue[Fe]=0,ie[Fe]=Ph;else{const Ze=.5-Pe;ue[Fe]=Ze>0?Ze*Ze:0,ie[Fe]=Ze<0?Ze*Ze:0}}tp(ue,0,0,w,S,w,this.f,this.v,this.z),tp(ie,q,q,y,b,w,this.f,this.v,this.z);for(let we=0;we<R;we++){const Ce=Math.sqrt(ue[we])-Math.sqrt(ie[we]);k[we]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return N}};class Fy{constructor(e=[],r=Oy){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const f=e-1>>1,m=r[f];if(s(c,m)>=0)break;r[e]=m,e=f}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,f=r[e];for(;e<c;){let m=1+(e<<1),y=r[m];const b=m+1;if(b<this.length&&s(r[b],y)<0&&(m=b,y=r[b]),s(y,f)>=0)break;r[e]=y,e=m}r[e]=f}}function Oy(n,e){return n<e?-1:n>e?1:0}function zy(n,e=1,r=!1){let s=1/0,c=1/0,f=-1/0,m=-1/0;const y=n[0];for(let N=0;N<y.length;N++){const G=y[N];(!N||G.x<s)&&(s=G.x),(!N||G.y<c)&&(c=G.y),(!N||G.x>f)&&(f=G.x),(!N||G.y>m)&&(m=G.y)}const b=Math.min(f-s,m-c);let w=b/2;const S=new Fy([],By);if(0===b)return new nt(s,c);for(let N=s;N<f;N+=b)for(let G=c;G<m;G+=b)S.push(new Lh(N+w,G+w,w,n));let R=function(N){let G=0,q=0,ie=0;const ue=N[0];for(let Ee=0,we=ue.length,Ce=we-1;Ee<we;Ce=Ee++){const Pe=ue[Ee],Fe=ue[Ce],Ze=Pe.x*Fe.y-Fe.x*Pe.y;q+=(Pe.x+Fe.x)*Ze,ie+=(Pe.y+Fe.y)*Ze,G+=3*Ze}return new Lh(q/G,ie/G,0,N)}(n),k=S.length;for(;S.length;){const N=S.pop();(N.d>R.d||!R.d)&&(R=N,r&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,k)),N.max-R.d<=e||(w=N.h/2,S.push(new Lh(N.p.x-w,N.p.y-w,w,n)),S.push(new Lh(N.p.x+w,N.p.y-w,w,n)),S.push(new Lh(N.p.x-w,N.p.y+w,w,n)),S.push(new Lh(N.p.x+w,N.p.y+w,w,n)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${R.d}`)),R.p}function By(n,e){return e.max-n.max}function Lh(n,e,r,s){this.p=new nt(n,e),this.h=r,this.d=function(c,f){let m=!1,y=1/0;for(let b=0;b<f.length;b++){const w=f[b];for(let S=0,R=w.length,k=R-1;S<R;k=S++){const N=w[S],G=w[k];N.y>c.y!=G.y>c.y&&c.x<(G.x-N.x)*(c.y-N.y)/(G.y-N.y)+N.x&&(m=!m),y=Math.min(y,Jp(c,N,G))}}return(m?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Nm=Number.POSITIVE_INFINITY,Ny=Math.sqrt(2);function i_(n,e){return e[1]!==Nm?function(r,s,c){let f=0,m=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":m=c-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-c}switch(r){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,m]}(n,e[0],e[1]):function(r,s){let c=0,f=0;s<0&&(s=0);const m=s/Ny;switch(r){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(r){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=s;break;case"right":c=-s}return[c,f]}(n,e[0])}function Cc(n,e,r,s,c,f,m,y,b,w){n.createArrays(),n.tilePixelRatio=pn/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const S=n.layers[0].layout,R=n.layers[0]._unevaluatedLayout._values,k={};if("composite"===n.textSizeData.kind){const{minZoom:q,maxZoom:ie}=n.textSizeData;k.compositeTextSizes=[R["text-size"].possiblyEvaluate(new ae(q),y),R["text-size"].possiblyEvaluate(new ae(ie),y)]}if("composite"===n.iconSizeData.kind){const{minZoom:q,maxZoom:ie}=n.iconSizeData;k.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new ae(q),y),R["icon-size"].possiblyEvaluate(new ae(ie),y)]}k.layoutTextSize=R["text-size"].possiblyEvaluate(new ae(b+1),y),k.layoutIconSize=R["icon-size"].possiblyEvaluate(new ae(b+1),y),k.textMaxSize=R["text-size"].possiblyEvaluate(new ae(18),y);const N="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),G=S.get("text-size");for(const q of n.features){const ie=S.get("text-font").evaluate(q,{},y).join(","),ue=G.evaluate(q,{},y),Ee=k.layoutTextSize.evaluate(q,{},y),we=(k.layoutIconSize.evaluate(q,{},y),{horizontal:{},vertical:void 0}),Ce=q.text;let Pe,Fe=[0,0];if(Ce){const ct=Ce.toString(),yt=24*S.get("text-letter-spacing").evaluate(q,{},y),Ve=24*S.get("text-line-height").evaluate(q,{},y),it=ss(ct)?yt:0,xt=S.get("text-anchor").evaluate(q,{},y),bt=S.get("text-variable-anchor");if(!bt){const ln=S.get("text-radial-offset").evaluate(q,{},y);Fe=ln?i_(xt,[24*ln,Nm]):S.get("text-offset").evaluate(q,{},y).map(qt=>24*qt)}let Gt=N?"center":S.get("text-justify").evaluate(q,{},y);const mt=S.get("symbol-placement"),Vt="point"===mt,On="point"===mt?24*S.get("text-max-width").evaluate(q,{},y):0,jn=ln=>{n.allowVerticalPlacement&&Ui(ct)&&(we.vertical=Cd(Ce,e,r,c,ie,On,Ve,xt,ln,it,Fe,ls.vertical,!0,mt,Ee,ue))};if(!N&&bt){const ln="auto"===Gt?bt.map(Wn=>Fh(Wn)):[Gt];let qt=!1;for(let Wn=0;Wn<ln.length;Wn++){const Nn=ln[Wn];if(!we.horizontal[Nn])if(qt)we.horizontal[Nn]=we.horizontal[0];else{const on=Cd(Ce,e,r,c,ie,On,Ve,"center",Nn,it,Fe,ls.horizontal,!1,mt,Ee,ue);on&&(we.horizontal[Nn]=on,qt=1===on.positionedLines.length)}}jn("left")}else{if("auto"===Gt&&(Gt=Fh(xt)),Vt||S.get("text-writing-mode").indexOf("horizontal")>=0||!Ui(ct)){const ln=Cd(Ce,e,r,c,ie,On,Ve,xt,Gt,it,Fe,ls.horizontal,!1,mt,Ee,ue);ln&&(we.horizontal[Gt]=ln)}jn("point"===mt?"left":Gt)}}let Ze=!1;if(q.icon&&q.icon.name){const ct=s[q.icon.name];ct&&(Pe=Fm(c[q.icon.name],S.get("icon-offset").evaluate(q,{},y),S.get("icon-anchor").evaluate(q,{},y)),Ze=ct.sdf,void 0===n.sdfIcons?n.sdfIcons=ct.sdf:n.sdfIcons!==ct.sdf&&fn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ct.pixelRatio!==n.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Xe=op(we.horizontal)||we.vertical;n.iconsInText||(n.iconsInText=!!Xe&&Xe.iconsInText),(Xe||Pe)&&o_(n,q,we,Pe,s,k,Ee,0,Fe,Ze,m,y,w)}f&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function Fh(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o_(n,e,r,s,c,f,m,y,b,w,S,R,k){let N=f.textMaxSize.evaluate(e,{},R);void 0===N&&(N=m);const G=n.layers[0].layout,q=G.get("icon-offset").evaluate(e,{},R),ie=op(r.horizontal)||r.vertical,ue="globe"===k.name,Ee=m/24,we=n.tilePixelRatio*N/24,Ce=(it=n.overscaling,n.zoom>18&&it>2&&(it>>=1),Math.max(pn/(512*it),1)*G.get("symbol-spacing")),Pe=G.get("text-padding")*n.tilePixelRatio,Fe=G.get("icon-padding")*n.tilePixelRatio,Ze=Tt(G.get("text-max-angle")),Xe="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),ct="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),yt=G.get("symbol-placement"),Ve=Ce/2;var it;const xt=G.get("icon-text-fit");let bt;s&&"none"!==xt&&(n.allowVerticalPlacement&&r.vertical&&(bt=t_(s,r.vertical,xt,G.get("icon-text-fit-padding"),q,Ee)),ie&&(s=t_(s,ie,xt,G.get("icon-text-fit-padding"),q,Ee)));const Gt=(mt,Vt,On)=>{if(Vt.x<0||Vt.x>=pn||Vt.y<0||Vt.y>=pn)return;let jn=null;if(ue){const{x:ln,y:qt,z:Wn}=k.projectTilePoint(Vt.x,Vt.y,On);jn={anchor:new ea(ln,qt,Wn,0,void 0),up:k.upVector(On,Vt.x,Vt.y)}}!function(ln,qt,Wn,Nn,on,Ti,ai,ri,Xn,tr,Ur,Lr,Cr,Vr,Jr,hr,zo,er,li,uo,gr,Xr,wo,Ir,pi){const ro=ln.addToLineVertexArray(qt,Nn);let ji,ho,Eo,fo,dl,fu,us,$h=0,rg=0,Ia=0,ia=0,ks=-1,Xd=-1;const Sa={};let ig=Xh("");const pu=Wn?Wn.anchor:qt;let wp=0,Ep=0;if(void 0===Xn._unevaluatedLayout.getValue("text-radial-offset")?[wp,Ep]=Xn.layout.get("text-offset").evaluate(gr,{},pi).map(es=>24*es):(wp=24*Xn.layout.get("text-radial-offset").evaluate(gr,{},pi),Ep=Nm),ln.allowVerticalPlacement&&on.vertical){const es=on.vertical;if(Jr)fu=sp(es),ri&&(us=sp(ri));else{const hs=Xn.layout.get("text-rotate").evaluate(gr,{},pi)+90;Eo=Gu(tr,pu,qt,Ur,Lr,Cr,es,Vr,hs,hr),ri&&(fo=Gu(tr,pu,qt,Ur,Lr,Cr,ri,er,hs))}}if(Ti){const es=Xn.layout.get("icon-rotate").evaluate(gr,{},pi),hs="none"!==Xn.layout.get("icon-text-fit"),th=rp(Ti,es,wo,hs),Yd=ri?rp(ri,es,wo,hs):void 0;ho=Gu(tr,pu,qt,Ur,Lr,Cr,Ti,er,es),$h=4*th.length;const Gh=ln.iconSizeData;let gu=null;"source"===Gh.kind?(gu=[Ul*Xn.layout.get("icon-size").evaluate(gr,{},pi)],gu[0]>jl&&fn(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Gh.kind&&(gu=[Ul*Xr.compositeIconSizes[0].evaluate(gr,{},pi),Ul*Xr.compositeIconSizes[1].evaluate(gr,{},pi)],(gu[0]>jl||gu[1]>jl)&&fn(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ln.addSymbols(ln.icon,th,gu,uo,li,gr,!1,Wn,qt,ro.lineStartIndex,ro.lineLength,-1,Ir,pi),ks=ln.icon.placedSymbolArray.length-1,Yd&&(rg=4*Yd.length,ln.addSymbols(ln.icon,Yd,gu,uo,li,gr,ls.vertical,Wn,qt,ro.lineStartIndex,ro.lineLength,-1,Ir,pi),Xd=ln.icon.placedSymbolArray.length-1)}for(const es in on.horizontal){const hs=on.horizontal[es];ji||(ig=Xh(hs.text),Jr?dl=sp(hs):ji=Gu(tr,pu,qt,Ur,Lr,Cr,hs,Vr,Xn.layout.get("text-rotate").evaluate(gr,{},pi),hr));const th=1===hs.positionedLines.length;if(Ia+=Rd(ln,Wn,qt,hs,ai,Xn,Jr,gr,hr,ro,on.vertical?ls.horizontal:ls.horizontalOnly,th?Object.keys(on.horizontal):[es],Sa,ks,Xr,Ir,pi),th)break}on.vertical&&(ia+=Rd(ln,Wn,qt,on.vertical,ai,Xn,Jr,gr,hr,ro,ls.vertical,["vertical"],Sa,Xd,Xr,Ir,pi));let fl=-1;const mu=(es,hs)=>es?Math.max(es,hs):hs;fl=mu(dl,fl),fl=mu(fu,fl),fl=mu(us,fl);const w_=fl>-1?1:0;ln.glyphOffsetArray.length>=al.MAX_GLYPHS&&fn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==gr.sortKey&&ln.addToSortKeyRanges(ln.symbolInstances.length,gr.sortKey),ln.symbolInstances.emplaceBack(pu.x,pu.y,pu.z,qt.x,qt.y,Sa.right>=0?Sa.right:-1,Sa.center>=0?Sa.center:-1,Sa.left>=0?Sa.left:-1,Sa.vertical>=0?Sa.vertical:-1,ks,Xd,ig,void 0!==ji?ji:ln.collisionBoxArray.length,void 0!==ji?ji+1:ln.collisionBoxArray.length,void 0!==Eo?Eo:ln.collisionBoxArray.length,void 0!==Eo?Eo+1:ln.collisionBoxArray.length,void 0!==ho?ho:ln.collisionBoxArray.length,void 0!==ho?ho+1:ln.collisionBoxArray.length,fo||ln.collisionBoxArray.length,fo?fo+1:ln.collisionBoxArray.length,Ur,Ia,ia,$h,rg,w_,0,wp,Ep,fl)}(n,Vt,jn,mt,r,s,c,bt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Pe,Xe,b,0,Fe,ct,q,e,f,w,S,R)};if("line"===yt)for(const mt of zm(e.geometry,0,0,pn,pn)){const Vt=n_(mt,Ce,Ze,r.vertical||ie,s,24,we,n.overscaling,pn);for(const On of Vt){const jn=ie;jn&&Ic(n,jn.text,Ve,On)||Gt(mt,On,R)}}else if("line-center"===yt){for(const mt of e.geometry)if(mt.length>1){const Vt=ky(mt,Ze,r.vertical||ie,s,24,we);Vt&&Gt(mt,Vt,R)}}else if("Polygon"===e.type)for(const mt of Bf(e.geometry,0)){const Vt=zy(mt,16);Gt(mt[0],new ea(Vt.x,Vt.y,0,0,void 0),R)}else if("LineString"===e.type)for(const mt of e.geometry)Gt(mt,new ea(mt[0].x,mt[0].y,0,0,void 0),R);else if("Point"===e.type)for(const mt of e.geometry)for(const Vt of mt)Gt([Vt],new ea(Vt.x,Vt.y,0,0,void 0),R)}const jl=32640;function Rd(n,e,r,s,c,f,m,y,b,w,S,R,k,N,G,q,ie){const ue=function(Ce,Pe,Fe,Ze,Xe,ct,yt,Ve){const it=[];if(0===Pe.positionedLines.length)return it;const xt=Ze.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,bt=function(jn){const ln=jn[0],qt=jn[1],Wn=ln*qt;return Wn>0?[ln,-qt]:Wn<0?[-ln,qt]:0===ln?[qt,ln]:[qt,-ln]}(Fe);let Gt=Math.abs(Pe.top-Pe.bottom);for(const jn of Pe.positionedLines)Gt-=jn.lineOffset;const mt=Pe.positionedLines.length,Vt=Gt/mt;let On=Pe.top-Fe[1];for(let jn=0;jn<mt;++jn){const ln=Pe.positionedLines[jn];On=Ly(Pe,Vt,On,jn);for(const qt of ln.positionedGlyphs){if(!qt.rect)continue;const Wn=qt.rect||{};let Nn=4,on=!0,Ti=1,ai=0;if(qt.imageName){const Ir=yt[qt.imageName];if(!Ir)continue;if(Ir.sdf){fn("SDF images are not supported in formatted text and will be ignored.");continue}on=!1,Ti=Ir.pixelRatio,Nn=1/Ti}const ri=(Xe||Ve)&&qt.vertical,Xn=qt.metrics.advance*qt.scale/2,tr=qt.metrics,Ur=qt.rect;if(null===Ur)continue;Ve&&Pe.verticalizable&&(ai=qt.imageName?Xn-qt.metrics.width*qt.scale/2:0);const Lr=Xe?[qt.x+Xn,qt.y]:[0,0];let Cr=[0,0],Vr=[0,0],Jr=!1;Xe||(ri?(Vr=[qt.x+Xn+bt[0],qt.y+bt[1]-ai],Jr=!0):Cr=[qt.x+Xn+Fe[0],qt.y+Fe[1]-ai]);const hr=Ur.w*qt.scale/(Ti*(qt.localGlyph?2:1)),zo=Ur.h*qt.scale/(Ti*(qt.localGlyph?2:1));let er,li,uo,gr;if(ri){const Ir=qt.y-On,pi=new nt(-Xn,Xn-Ir),ro=-Math.PI/2,ji=new nt(...Vr);er=new nt(-Xn+Cr[0],Cr[1]),er._rotateAround(ro,pi)._add(ji),er.x+=-Ir+Xn,er.y-=(tr.left-Nn)*qt.scale;const ho=qt.imageName?tr.advance*qt.scale:24*qt.scale,Eo=String.fromCharCode(qt.glyph);Sm(Eo)?er.x+=(1-Nn)*qt.scale:Wg(Eo)?er.x+=ho-tr.height*qt.scale+(-Nn-1)*qt.scale:er.x+=qt.imageName||tr.width+2*Nn===Ur.w&&tr.height+2*Nn===Ur.h?(ho-zo)/2:(ho-(tr.height+2*Nn)*qt.scale)/2,li=new nt(er.x,er.y-hr),uo=new nt(er.x+zo,er.y),gr=new nt(er.x+zo,er.y-hr)}else{const Ir=(tr.left-Nn)*qt.scale-Xn+Cr[0],pi=(-tr.top-Nn)*qt.scale+Cr[1],ro=Ir+hr,ji=pi+zo;er=new nt(Ir,pi),li=new nt(ro,pi),uo=new nt(Ir,ji),gr=new nt(ro,ji)}if(xt){let Ir;Ir=Xe?new nt(0,0):Jr?new nt(bt[0],bt[1]):new nt(Fe[0],Fe[1]),er._rotateAround(xt,Ir),li._rotateAround(xt,Ir),uo._rotateAround(xt,Ir),gr._rotateAround(xt,Ir)}const Xr=new nt(0,0),wo=new nt(0,0);it.push({tl:er,tr:li,bl:uo,br:gr,tex:Wn,writingMode:Pe.writingMode,glyphOffset:Lr,sectionIndex:qt.sectionIndex,isSDF:on,pixelOffsetTL:Xr,pixelOffsetBR:wo,minFontScaleX:0,minFontScaleY:0})}}return it}(0,s,b,f,m,y,c,n.allowVerticalPlacement),Ee=n.textSizeData;let we=null;"source"===Ee.kind?(we=[Ul*f.layout.get("text-size").evaluate(y,{},ie)],we[0]>jl&&fn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Ee.kind&&(we=[Ul*G.compositeTextSizes[0].evaluate(y,{},ie),Ul*G.compositeTextSizes[1].evaluate(y,{},ie)],(we[0]>jl||we[1]>jl)&&fn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,ue,we,b,m,y,S,e,r,w.lineStartIndex,w.lineLength,N,q,ie);for(const Ce of R)k[Ce]=n.text.placedSymbolArray.length-1;return 4*ue.length}function op(n){for(const e in n)return n[e];return null}function Gu(n,e,r,s,c,f,m,y,b,w){let S=m.top,R=m.bottom,k=m.left,N=m.right;const G=m.collisionPadding;if(G&&(k-=G[0],S-=G[1],N+=G[2],R+=G[3]),b){const q=new nt(k,S),ie=new nt(N,S),ue=new nt(k,R),Ee=new nt(N,R),we=Tt(b);let Ce=new nt(0,0);w&&(Ce=new nt(w[0],w[1])),q._rotateAround(we,Ce),ie._rotateAround(we,Ce),ue._rotateAround(we,Ce),Ee._rotateAround(we,Ce),k=Math.min(q.x,ie.x,ue.x,Ee.x),N=Math.max(q.x,ie.x,ue.x,Ee.x),S=Math.min(q.y,ie.y,ue.y,Ee.y),R=Math.max(q.y,ie.y,ue.y,Ee.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,k,S,N,R,y,s,c,f),n.length-1}function sp(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function Ic(n,e,r,s){const c=n.compareText;if(e in c){const f=c[e];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<r)return!0}else c[e]=[];return c[e].push(s),!1}const Um=St([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:Vm}=Um,kd=St([{name:"a_pos_3",components:3,type:"Int16"}]);var Oh=St([{name:"a_pos",type:"Int16",components:2}]);const Sc=pn/Math.PI/2,ap=2*Qs(1,0)*Sc*Math.PI,Hu=[64,32,16],bo=-Sc,no=Sc,lp=[new Rs([bo,bo,bo],[no,no,no]),new Rs([bo,bo,bo],[0,0,no]),new Rs([0,bo,bo],[no,0,no]),new Rs([bo,0,bo],[0,no,no]),new Rs([0,0,bo],[no,no,no])];function eu(n,e,r,s=!0){const c=tl([],n._camera.position,n.worldSize),f=[e,r,1,1];bc(f,f,n.pixelMatrixInverse),hd(f,f,1/f[3]);const m=Fo([],Ps([],f,c)),y=n.globeMatrix,b=[y[12],y[13],y[14]],w=Ps([],b,c),S=cd(w),R=Fo([],w),k=n.worldSize/(2*Math.PI),N=Oo(R,m),G=Math.asin(k/S);if(G<Math.acos(N)){if(!s)return null;const yt=[],Ve=[];tl(yt,m,S/N),Fo(Ve,Ps(Ve,yt,w)),Fo(m,Bl(m,w,tl(m,Ve,Math.tan(G)*S)))}const q=[];new bf(c,m).closestPointOnSphere(b,k,q);const ie=Fo([],ki(y,0)),ue=Fo([],ki(y,1)),Ee=Fo([],ki(y,2)),we=Oo(ie,q),Ce=Oo(ue,q),Pe=Oo(Ee,q),Fe=wn(Math.asin(-Ce/k));let Ze=wn(Math.atan2(we,Pe));Ze=n.center.lng+function(yt,Ve){const it=(Ve-yt+180)%360-180;return it<-180?it+360:it}(n.center.lng,Ze);const Xe=_c(Ze),ct=Xt(Hc(Fe),0,1);return new mh(Xe,ct)}class Ld{constructor(e,r,s){this.a=Ps([],e,s),this.b=Ps([],r,s),this.center=s;const c=Fo([],this.a),f=Fo([],this.b);this.angle=Math.acos(Oo(c,f))}}function tu(n,e){if(0===n.angle)return null;let r;return r=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(s,c,f,m){const y=Math.sin(f);return s*(Math.sin((1-m)*f)/y)+c*(Math.sin(m*f)/y)}(n.a[e],n.b[e],n.angle,Xt(r,0,1))+n.center[e]}function sl(n){if(n.z<=1)return lp[n.z+2*n.y+n.x];const[e,r]=Fd(n),s=[co(e[0],e[1]),co(e[0],r[1]),co(r[0],e[1]),co(r[0],r[1])],c=[no,no,no],f=[bo,bo,bo];for(const m of s)c[0]=Math.min(c[0],m[0]),c[1]=Math.min(c[1],m[1]),c[2]=Math.min(c[2],m[2]),f[0]=Math.max(f[0],m[0]),f[1]=Math.max(f[1],m[1]),f[2]=Math.max(f[2],m[2]);return new Rs(c,f)}function Fd(n){const e=1<<n.z,r=n.x/e,s=(n.x+1)/e,c=(n.y+1)/e;return[[Ai(n.y/e),ko(r)],[Ai(c),ko(s)]]}function Od(n,e,r,s=Sc){return r=Tt(r),[n*Math.sin(r)*s,-e*s,n*Math.cos(r)*s]}function co(n,e,r){return Od(Math.cos(Tt(n)),Math.sin(Tt(n)),e,r)}function cp(n,e,r){const s=Math.pow(2,r.z),c=(n/pn+r.x)/s;return co(Ai((e/pn+r.y)/s),ko(c))}function Zu(n){return 16383/Math.max(...Ps([],n.max,n.min))}function zh(n){const e=Qo(new Float64Array(16)),r=Zu(n);var s,c;return el(e,e,[r,r,r]),Wc(e,e,((s=[])[0]=-(c=n.min)[0],s[1]=-c[1],s[2]=-c[2],s)),e}function s_(n){const e=Qo(new Float64Array(16)),r=1/Zu(n);return Wc(e,e,n.min),el(e,e,[r,r,r]),e}function $m(n,e,r,s,c){const f=function(b){const w=pn/(2*Math.PI);return b/(2*Math.PI)/w}(r),m=[n,e,-r/(2*Math.PI)],y=Qo(new Float64Array(16));return Wc(y,y,m),el(y,y,[f,f,f]),ad(y,y,Tt(-c)),ld(y,y,Tt(-s)),y}function zd(n){return Hn(5,6,n)}function Gm(n,e){const r=co(e.lat,e.lng);return f=(s=om([],function(N){const G=co(N._center.lat,N._center.lng);let q=xf([],gh(0,1,0),G);const ie=rm([],-N.angle,G);q=eo(q,q,ie),rm(ie,-N._pitch,q);const ue=Fo([],G);return tl(ue,ue,N.cameraToCenterDistance/N.pixelsPerMeter*ap),eo(ue,ue,ie),Bl([],G,ue)}(n),r))[0],m=s[1],y=s[2],b=(c=r)[0],w=c[1],S=c[2],k=(R=Math.sqrt(f*f+m*m+y*y)*Math.sqrt(b*b+w*w+S*S))&&Oo(s,c)/R,Math.acos(Math.min(Math.max(k,-1),1));var s,c,f,m,y,b,w,S,R,k}const up=Tt(85),a_=Math.cos(up),l_=Math.sin(up);function cs(n,e){const r=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),f=Math.sin(r)*c/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),m=Math.sin(n._pitch)*f+c;return Math.min(1.01*m,c*(1/n._horizonShift))}function nu(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),s=n.x*r,c=(n.x+1)*r,f=n.y*r,m=(n.y+1)*r,y=ko(s),b=ko(c),w=Ai(f),S=Ai(m),R=e.project(y,w),k=e.project(b,w),N=e.project(b,S),G=e.project(y,S);let q=Math.min(R.x,k.x,N.x,G.x),ie=Math.min(R.y,k.y,N.y,G.y),ue=Math.max(R.x,k.x,N.x,G.x),Ee=Math.max(R.y,k.y,N.y,G.y);const we=r/16;function Ce(Fe,Ze,Xe,ct,yt,Ve){const it=(Xe+yt)/2,xt=(ct+Ve)/2,bt=e.project(ko(it),Ai(xt)),Gt=Math.max(0,q-bt.x,ie-bt.y,bt.x-ue,bt.y-Ee);q=Math.min(q,bt.x),ue=Math.max(ue,bt.x),ie=Math.min(ie,bt.y),Ee=Math.max(Ee,bt.y),Gt>we&&(Ce(Fe,bt,Xe,ct,it,xt),Ce(bt,Ze,it,xt,yt,Ve))}Ce(R,k,s,f,c,f),Ce(k,N,c,f,c,m),Ce(N,G,c,m,s,m),Ce(G,R,s,m,s,f),q-=we,ie-=we,ue+=we,Ee+=we;const Pe=1/Math.max(ue-q,Ee-ie);return{scale:Pe,x:q*Pe,y:ie*Pe,x2:ue*Pe,y2:Ee*Pe,projection:e}}const c_=Qo(new Float32Array(16));class ru{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Dr(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return Qs(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return cs(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,c){const f=e.horizonLineFromTop(!1),m=new nt(r,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,c))}pointCoordinate3D(e,r,s){const c=new nt(r,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const f=this.pointCoordinate(e,c.x,c.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return c_}createTileMatrix(e,r,s){let c,f,m;const y=s.canonical,b=Qo(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=nu(y,this);c=1,f=w.x+s.wrap*w.scale,m=w.y,el(b,b,[c/w.scale,c/w.scale,e.pixelsPerMeter/r])}else c=r/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*c,m=y.y*c;return Wc(b,b,[f,m,0]),el(b,b,[c/pn,c/pn,1]),b}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class u_ extends ru{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Tt(r));this.n=(c+Math.sin(Tt(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c,r0:f}=this,m=Tt(e-this.center[0]),y=Tt(r),b=Math.sqrt(c-2*s*Math.sin(y))/s;return{x:b*Math.sin(m*s),y:b*Math.cos(m*s)-f,z:0}}unproject(e,r){const{n:s,c,r0:f}=this,m=f+r;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const b=Tt(this.center[0])*s;y=Zt(y,-Math.PI-b,Math.PI-b);const w=wn(y/s)+this.center[0],S=Math.asin(Xt((c-(e*e+m*m)*s*s)/(2*s),-1,1)),R=Xt(wn(S),-85.051129,Fl);return new Dr(w,R)}}const iu=1.340264,qu=-.081106,Bh=893e-6,Nh=.003796,Bd=Math.sqrt(3)/2;class Hm extends ru{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Bd*Math.sin(r)),c=s*s,f=c*c*c;return{x:.5*(e*Math.cos(s)/(Bd*(iu+3*qu*c+f*(7*Bh+9*Nh*c)))/Math.PI+.5),y:1-.5*(s*(iu+qu*c+f*(Bh+Nh*c))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,c=s*s,f=c*c*c;for(let S,R,k,N=0;N<12&&(R=s*(iu+qu*c+f*(Bh+Nh*c))-r,k=iu+3*qu*c+f*(7*Bh+9*Nh*c),S=R/k,s=Xt(s-S,-Math.PI/3,Math.PI/3),c=s*s,f=c*c*c,!(Math.abs(S)<1e-12));++N);const m=Bd*e*(iu+3*qu*c+f*(7*Bh+9*Nh*c))/Math.cos(s),y=Math.asin(Math.sin(s)/Bd),b=Xt(180*m/Math.PI,-180,180),w=Xt(180*y/Math.PI,-85.051129,Fl);return new Dr(b,w)}}class h_ extends ru{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),c=Xt(360*(.5-r),-85.051129,Fl);return new Dr(s,c)}}const ou=Math.PI/2;function Nd(n){return Math.tan((ou+n)/2)}class d_ extends ru{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30],c=Tt(r),f=Tt(s),m=Math.cos(c);this.n=c===f?Math.sin(c):Math.log(m/Math.cos(f))/Math.log(Nd(f)/Nd(c)),this.f=m*Math.pow(Nd(c),this.n)/this.n}project(e,r){r=Tt(r),e=Tt(e-this.center[0]);const s=1e-6,{n:c,f}=this;f>0?r<-ou+s&&(r=-ou+s):r>ou-s&&(r=ou-s);const m=f/Math.pow(Nd(r),c),y=m*Math.sin(c*e),b=f-m*Math.cos(c*e);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:s,f:c}=this,f=c-r,m=Math.sign(f),y=Math.sign(s)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*m;f*s<0&&(b-=Math.PI*Math.sign(e)*m);const w=Xt(wn(b/s)+this.center[0],-180,180),S=Xt(wn(2*Math.atan(Math.pow(c/y,1/s))-ou),-85.051129,Fl);return new Dr(w,S)}}class hp extends ru{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:_c(e),y:Hc(r),z:0}}unproject(e,r){const s=ko(e),c=Ai(r);return new Dr(s,c)}}const dp=Tt(Fl);class f_ extends ru{project(e,r){const s=(r=Tt(r))*r,c=s*s;return{x:.5*((e=Tt(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,c=25,f=0,m=s*s;do{m=s*s;const w=m*m;f=(s*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-r)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),s=Xt(s-f,-dp,dp)}while(Math.abs(f)>1e-6&&--c>0);m=s*s;const y=Xt(wn(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=wn(s);return new Dr(y,b)}}const Ca=Tt(Fl);class fp extends ru{project(e,r){r=Tt(r),e=Tt(e);const s=Math.cos(r),c=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),m=Math.sin(f)/f,y=.5*(e*c+2*s*Math.sin(e/2)/m)||0,b=.5*(r+Math.sin(r)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,c=r=(2*(1-r)-1)*Math.PI,f=25;const m=1e-6;let y=0,b=0;do{const w=Math.cos(c),S=Math.sin(c),R=2*S*w,k=S*S,N=w*w,G=Math.cos(s/2),q=Math.sin(s/2),ie=2*G*q,ue=q*q,Ee=1-N*G*G,we=Ee?1/Ee:0,Ce=Ee?Math.acos(w*G)*Math.sqrt(1/Ee):0,Pe=.5*(2*Ce*w*q+2*s/Math.PI)-e,Fe=.5*(Ce*S+c)-r,Ze=.5*we*(N*ue+Ce*w*G*k)+1/Math.PI,Xe=we*(ie*R/4-Ce*S*q),ct=.125*we*(R*q-Ce*S*N*ie),yt=.5*we*(k*G+Ce*ue*w)+.5,Ve=Xe*ct-yt*Ze;y=(Fe*Xe-Pe*yt)/Ve,b=(Pe*ct-Fe*Ze)/Ve,s=Xt(s-y,-Math.PI,Math.PI),c=Xt(c-b,-Ca,Ca)}while((Math.abs(y)>m||Math.abs(b)>m)&&--f>0);return new Dr(wn(s),wn(c))}}class Zm extends ru{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Tt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:c}=this;return{x:Tt(e)*c*s+.5,y:-Math.sin(Tt(r))/c*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:c}=this,f=-(r-.5)/s,m=Xt(wn((e-.5)/s)/c,-180,180),y=Math.asin(Xt(f*c,-1,1)),b=Xt(wn(y),-85.051129,Fl);return new Dr(m,b)}}class p_ extends hp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,r,s){const c=Math.pow(2,s.z),f=(e/pn+s.x)/c,m=co(Ai((r/pn+s.y)/c),ko(f));return eo(m,m,zh(sl(s))),{x:m[0],y:m[1],z:m[2]}}locationPoint(e,r){const s=co(r.lat,r.lng),c=Fo([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;_h(s,s,c,Qs(1,0)*pn*f);const m=Qo(new Float64Array(16));return xc(m,e.pixelMatrix,e.globeMatrix),eo(s,s,m),new nt(s[0],s[1])}pixelsPerMeter(e,r){return Qs(1,0)*r}pixelSpaceConversion(e,r,s){const c=Je(Qs(1,45)*r,Qs(1,e)*r,s);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,s){const c=s_(sl(s.canonical));return xc(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,r){const{center:s}=e,c=Qo(new Float64Array(16));return xc(c,c,zh(sl(r))),ld(c,c,Tt(s.lng)),ad(c,c,Tt(s.lat)),el(c,c,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(c)}pointCoordinate(e,r,s,c){return eu(e,r,s,!0)||new mh(0,0)}pointCoordinate3D(e,r,s){const c=this.pointCoordinate(e,r,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,r){return!eu(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(c,f){const m=c.cameraToCenterDistance,y=c._centerAltitude*f,b=c._camera,w=c._camera.forward(),S=Bl([],tl([],w,-m),[0,0,y]),R=c.worldSize/(2*Math.PI),k=[0,0,-R],N=c.width/c.height,G=Math.tan(c.fovAboveCenter),q=tl([],b.up(),G),ie=tl([],b.right(),G*N),ue=Fo([],Bl([],Bl([],w,q),ie)),Ee=[];let we;if(new bf(S,ue).closestPointOnSphere(k,R,Ee)){const Ce=Bl([],Ee,k),Pe=Ps([],Ce,S);we=Math.cos(c.fovAboveCenter)*cd(Pe)}else{const Ce=Ps([],S,k),Pe=Ps([],k,S);Fo(Pe,Pe);const Fe=cd(Ce)-R;we=Math.sqrt(Fe*(Fe+2*R));const Ze=Math.acos(we/(R+Fe))-Math.acos(Oo(w,Pe));we*=Math.cos(Ze)}return 1.01*we}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=zd(e.zoom);if(s>0){const c=cs(e,Qs(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Je(r,c+f*(1-Math.cos(m)),Math.pow(s,10))}return r}upVector(e,r,s){const c=1<<e.z,f=(r/pn+e.x)/c;return co(Ai((s/pn+e.y)/c),ko(f),1)}upVectorScale(e){return{metersToTile:ap*Zu(sl(e))}}}function m_(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new hp(n);case"equirectangular":return new h_(n);case"naturalEarth":return new f_(n);case"equalEarth":return new Hm(n);case"winkelTripel":return new fp(n);case"albers":return r?new Zm(n):new u_(n);case"lambertConformalConic":return r?new Zm(n):new d_(n);case"globe":return new p_(n)}throw new Error(`Invalid projection name: ${n.name}`)}const qm=Ec.VectorTileFeature.types,g_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ud(n,e,r,s,c,f,m,y,b,w,S,R,k){const N=y?Math.min(jl,Math.round(y[0])):0,G=y?Math.min(jl,Math.round(y[1])):0;n.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),f,m,(N<<1)+(b?1:0),G,16*w,16*S,256*R,256*k)}function Vd(n,e,r,s,c,f,m){n.emplaceBack(e,r,s,c,f,m)}function Wu(n,e,r,s,c){n.emplaceBack(e,r,s,c),n.emplaceBack(e,r,s,c),n.emplaceBack(e,r,s,c),n.emplaceBack(e,r,s,c)}function __(n){for(const e of n.sections)if(v(e.text))return!0;return!1}class pp{constructor(e){this.layoutVertexArray=new as,this.indexArray=new sr,this.programConfigurations=e,this.segments=new di,this.dynamicLayoutVertexArray=new cr,this.opacityVertexArray=new _a,this.placedSymbolArray=new af,this.globeExtVertexArray=new Ks}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Hg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,g_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qf.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ut(pp,"SymbolBuffers");class Xu{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new di,this.collisionVertexArray=new Ei,this.collisionVertexArrayExt=new qi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Cy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Iy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ut(Xu,"CollisionBuffers");class al{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qo([]),this.placementViewportMatrix=Qo([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wf(this.zoom,r["text-size"]),this.iconSizeData=Wf(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==c.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>ls[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new pp(new Ll(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new pp(new Ll(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Fp,this.lineVertexArray=new Op,this.symbolInstances=new cf}calculateGlyphDependencies(e,r,s,c,f){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,c&&f){const y=Ch[e.charAt(m)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,s,c){const f=this.layers[0],m=f.layout,y="globe"===this.projection.name,b=m.get("text-font"),w=m.get("text-field"),S=m.get("icon-image"),R=("constant"!==w.value.kind||w.value.value instanceof Kr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),k="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,N=m.get("symbol-sort-key");if(this.features=[],!R&&!k)return;const G=r.iconDependencies,q=r.glyphDependencies,ie=r.availableImages,ue=new ae(this.zoom);for(const{feature:Ee,id:we,index:Ce,sourceLayerIndex:Pe}of e){const Fe=f._featureFilter.needGeometry,Ze=yc(Ee,Fe);if(!f._featureFilter.filter(ue,Ze,s))continue;if(Fe||(Ze.geometry=Ol(Ee,s,c)),y&&1!==Ee.type&&s.z<=5){const Ve=Ze.geometry,it=1<<s.z,xt=s.x,bt=s.y,Gt=.98078528056;for(let mt=0;mt<Ve.length;mt++)Ve[mt]=ff(Ve[mt],Vt=>Vt,(Vt,On)=>Oo(co(Ai((Vt.y/pn+bt)/it),ko((Vt.x/pn+xt)/it),1),co(Ai((On.y/pn+bt)/it),ko((On.x/pn+xt)/it),1))<Gt)}let Xe,ct;if(R){const Ve=f.getValueAndResolveTokens("text-field",Ze,s,ie),it=Kr.factory(Ve);__(it)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Q()||this.hasRTLText&&ee.isParsed())&&(Xe=wd(it,f,Ze))}if(k){const Ve=f.getValueAndResolveTokens("icon-image",Ze,s,ie);ct=Ve instanceof vi?Ve:vi.fromString(Ve)}if(!Xe&&!ct)continue;const yt=this.sortFeaturesByKey?N.evaluate(Ze,{},s):void 0;if(this.features.push({id:we,text:Xe,icon:ct,index:Ce,sourceLayerIndex:Pe,geometry:Ze.geometry,properties:Ee.properties,type:qm[Ee.type],sortKey:yt}),ct&&(G[ct.name]=!0),Xe){const Ve=b.evaluate(Ze,{},s).join(","),it="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ls.vertical)>=0;for(const xt of Xe.sections)if(xt.image)G[xt.image.name]=!0;else{const bt=Ui(Xe.toString()),Gt=xt.fontStack||Ve,mt=q[Gt]=q[Gt]||{};this.calculateGlyphDependencies(xt.text,mt,it,this.allowVerticalPlacement,bt)}}}"line"===m.get("symbol-placement")&&(this.features=function(Ee){const we={},Ce={},Pe=[];let Fe=0;function Ze(Ve){Pe.push(Ee[Ve]),Fe++}function Xe(Ve,it,xt){const bt=Ce[Ve];return delete Ce[Ve],Ce[it]=bt,Pe[bt].geometry[0].pop(),Pe[bt].geometry[0]=Pe[bt].geometry[0].concat(xt[0]),bt}function ct(Ve,it,xt){const bt=we[it];return delete we[it],we[Ve]=bt,Pe[bt].geometry[0].shift(),Pe[bt].geometry[0]=xt[0].concat(Pe[bt].geometry[0]),bt}function yt(Ve,it,xt){const bt=xt?it[0][it[0].length-1]:it[0][0];return`${Ve}:${bt.x}:${bt.y}`}for(let Ve=0;Ve<Ee.length;Ve++){const it=Ee[Ve],xt=it.geometry,bt=it.text?it.text.toString():null;if(!bt){Ze(Ve);continue}const Gt=yt(bt,xt),mt=yt(bt,xt,!0);if(Gt in Ce&&mt in we&&Ce[Gt]!==we[mt]){const Vt=ct(Gt,mt,xt),On=Xe(Gt,mt,Pe[Vt].geometry);delete we[Gt],delete Ce[mt],Ce[yt(bt,Pe[On].geometry,!0)]=On,Pe[Vt].geometry=null}else Gt in Ce?Xe(Gt,mt,xt):mt in we?ct(Gt,mt,xt):(Ze(Ve),we[Gt]=Fe-1,Ce[mt]=Fe-1)}return Pe.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ee,we)=>Ee.sortKey-we.sortKey)}update(e,r,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,c))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=m_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length,c=e.segment;if(void 0!==c){let f=e.dist(r[c+1]),m=e.dist(r[c]);const y={};for(let b=c+1;b<r.length;b++)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:f},b<r.length-1&&(f+=r[b+1].dist(r[b]));for(let b=c||0;b>=0;b--)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){const w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,f,m,y,b,w,S,R,k,N,G){const q=e.indexArray,ie=e.layoutVertexArray,ue=e.globeExtVertexArray,Ee=e.segments.prepareSegment(4*r.length,ie,q,this.canOverlap?m.sortKey:void 0),we=this.glyphOffsetArray.length,Ce=Ee.vertexLength,Pe=this.allowVerticalPlacement&&y===ls.vertical?Math.PI/2:0,Fe=m.text&&m.text.sections;for(let Xe=0;Xe<r.length;Xe++){const{tl:ct,tr:yt,bl:Ve,br:it,tex:xt,pixelOffsetTL:bt,pixelOffsetBR:Gt,minFontScaleX:mt,minFontScaleY:Vt,glyphOffset:On,isSDF:jn,sectionIndex:ln}=r[Xe],qt=Ee.vertexLength,Wn=On[1];if(Ud(ie,w.x,w.y,ct.x,Wn+ct.y,xt.x,xt.y,s,jn,bt.x,bt.y,mt,Vt),Ud(ie,w.x,w.y,yt.x,Wn+yt.y,xt.x+xt.w,xt.y,s,jn,Gt.x,bt.y,mt,Vt),Ud(ie,w.x,w.y,Ve.x,Wn+Ve.y,xt.x,xt.y+xt.h,s,jn,bt.x,Gt.y,mt,Vt),Ud(ie,w.x,w.y,it.x,Wn+it.y,xt.x+xt.w,xt.y+xt.h,s,jn,Gt.x,Gt.y,mt,Vt),b){const Nn=b.anchor,on=b.up;Vd(ue,Nn.x,Nn.y,Nn.z,on[0],on[1],on[2]),Vd(ue,Nn.x,Nn.y,Nn.z,on[0],on[1],on[2]),Vd(ue,Nn.x,Nn.y,Nn.z,on[0],on[1],on[2]),Vd(ue,Nn.x,Nn.y,Nn.z,on[0],on[1],on[2]),Wu(e.dynamicLayoutVertexArray,Nn.x,Nn.y,Nn.z,Pe)}else Wu(e.dynamicLayoutVertexArray,w.x,w.y,w.z,Pe);q.emplaceBack(qt,qt+1,qt+2),q.emplaceBack(qt+1,qt+2,qt+3),Ee.vertexLength+=4,Ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(On[0]),Xe!==r.length-1&&ln===r[Xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,m,m.index,{},N,G,Fe&&Fe[ln])}const Ze=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,w.x,w.y,we,this.glyphOffsetArray.length-we,Ce,S,R,w.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],y,0,!1,0,k,0)}_commitLayoutVertex(e,r,s,c,f,m,y){e.emplaceBack(r,s,c,f,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,s,c,f,m,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,S=y.tileAnchorX,R=y.tileAnchorY;for(let N=0;N<4;N++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,f,m,S,R,new nt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,f,m,S,R,new nt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,f,m,S,R,new nt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,f,m,S,R,new nt(e.x1,e.y2)),b.vertexLength+=4;const k=s.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,c,f,m){for(let y=c;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,m,r,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,s,c,f,m){for(let y=c;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(e,r,y);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xu(Br,Zg.members,oi),this.iconCollisionBox=new Xu(Br,Zg.members,oi);const s=Vu(this.iconSizeData,e),c=Vu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(c,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,s,c){const f=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:c),m=Vl(this.textSizeData,e,f)/24;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,s){const c=this.icon.placedSymbolArray.get(s),f=Vl(this.iconSizeData,e,c);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,c,f,m){for(let y=c;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,m,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,r,s,c,f){for(let m=c;m<f;m++){const y=s.get(m),b=this.getSymbolInstanceIconSize(e,r,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Vu(this.iconSizeData,e),c=Vu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(c,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(c,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,c,f,m,y,b,w){const S={};for(let R=r;R<s;R++){const k=e.get(R);S.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.textFeatureIndex=k.featureIndex;break}for(let R=c;R<f;R++){const k=e.get(R);S.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalTextFeatureIndex=k.featureIndex;break}for(let R=m;R<y;R++){const k=e.get(R);S.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.iconFeatureIndex=k.featureIndex;break}for(let R=b;R<w;R++){const k=e.get(R);S.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalIconFeatureIndex=k.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);c.push(0|Math.round(r*b.tileAnchorX+s*b.tileAnchorY)),f.push(b.featureIndex)}return m.sort((y,b)=>c[y]-c[b]||f[b]-f[y]),m}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,f,m)=>{c>=0&&m.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ut(al,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),al.MAX_GLYPHS=65535,al.addDynamicAttributes=Wu;const y_=new et({"symbol-placement":new je(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new je(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new je(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new be(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new je(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new je(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new je(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new je(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new je(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new be(ke.layout_symbol["icon-size"]),"icon-text-fit":new je(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new je(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new be(ke.layout_symbol["icon-image"]),"icon-rotate":new be(ke.layout_symbol["icon-rotate"]),"icon-padding":new je(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new je(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new be(ke.layout_symbol["icon-offset"]),"icon-anchor":new be(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new je(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new je(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new je(ke.layout_symbol["text-rotation-alignment"]),"text-field":new be(ke.layout_symbol["text-field"]),"text-font":new be(ke.layout_symbol["text-font"]),"text-size":new be(ke.layout_symbol["text-size"]),"text-max-width":new be(ke.layout_symbol["text-max-width"]),"text-line-height":new be(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new be(ke.layout_symbol["text-letter-spacing"]),"text-justify":new be(ke.layout_symbol["text-justify"]),"text-radial-offset":new be(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new je(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new be(ke.layout_symbol["text-anchor"]),"text-max-angle":new je(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new je(ke.layout_symbol["text-writing-mode"]),"text-rotate":new be(ke.layout_symbol["text-rotate"]),"text-padding":new je(ke.layout_symbol["text-padding"]),"text-keep-upright":new je(ke.layout_symbol["text-keep-upright"]),"text-transform":new be(ke.layout_symbol["text-transform"]),"text-offset":new be(ke.layout_symbol["text-offset"]),"text-allow-overlap":new je(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new je(ke.layout_symbol["text-ignore-placement"]),"text-optional":new je(ke.layout_symbol["text-optional"])});var jd={paint:new et({"icon-opacity":new be(ke.paint_symbol["icon-opacity"]),"icon-color":new be(ke.paint_symbol["icon-color"]),"icon-halo-color":new be(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new be(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new be(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new je(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new je(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new be(ke.paint_symbol["text-opacity"]),"text-color":new be(ke.paint_symbol["text-color"],{runtimeType:fr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new be(ke.paint_symbol["text-halo-color"]),"text-halo-width":new be(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new be(ke.paint_symbol["text-halo-blur"]),"text-translate":new je(ke.paint_symbol["text-translate"]),"text-translate-anchor":new je(ke.paint_symbol["text-translate-anchor"])}),layout:y_};class $d{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Do,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut($d,"FormatSectionOverride",{omit:["defaultValue"]});class Uh extends va{constructor(e){super(e,jd)}recalculate(e,r){super.recalculate(e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const f of s)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const f=this.layout.get(e).evaluate(r,{},s,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||bs(m.value)||!f?f:(y=r.properties,f.replace(/{([^{}]+)}/g,(w,S)=>S in y?String(y[S]):""));var y}createBucket(e){return new al(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of jd.paint.overridableProperties){if(!Uh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new $d(r),c=new Po(s,r.property.specification);let f=null;f="constant"===r.value.kind||"source"===r.value.kind?new Ml("source",c):new ws("composite",c,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new We(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Uh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=jd.paint.properties[r];let f=!1;const m=y=>{for(const b of y)if(c.overrides&&c.overrides.hasOverride(b))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Kr)m(s.value.value.sections);else if("source"===s.value.kind){const y=w=>{f||(w instanceof Io&&Fr(w.value)===Yi?m(w.value.sections):w instanceof $o?m(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramConfiguration(e){return new Ja(this,e)}}var Uy={paint:new et({"background-color":new je(ke.paint_background["background-color"]),"background-pattern":new lt(ke.paint_background["background-pattern"]),"background-opacity":new je(ke.paint_background["background-opacity"])})},Vy={paint:new et({"raster-opacity":new je(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new je(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new je(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new je(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new je(ke.paint_raster["raster-saturation"]),"raster-contrast":new je(ke.paint_raster["raster-contrast"]),"raster-resampling":new je(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new je(ke.paint_raster["raster-fade-duration"])})};class mp extends va{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var jy={paint:new et({"sky-type":new je(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new je(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new je(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new je(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new je(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new kt(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new je(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new je(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new je(ke.paint_sky["sky-opacity"])})};function gp(n,e,r){const s=[0,0,1],c=dd([]);return lm(c,c,r?-Tt(n)+Math.PI:Tt(n)),am(c,c,-Tt(e)),ud(s,s,c),Fo(s,s)}const Wm={circle:class extends va{constructor(n){super(n,tm)}createBucket(n){return new pf(n)}queryRadius(n){const e=n;return Vi("circle-radius",this,e)+Vi("circle-stroke-width",this,e)+vc(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,s,c,f,m,y){const b=em(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Tf(n,s,f,m,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Ja(this,n)}},heatmap:class extends va{createBucket(n){return new cm(n)}constructor(n){super(n,Sg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=um({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Vi("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,s,c,f,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return Tf(n,s,f,m,y,!0,!0,new nt(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Ja(this,n)}},hillshade:class extends va{constructor(n){super(n,fd)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends va{constructor(n){super(n,xm)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new Ja(this,n)}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Th(n)}queryRadius(){return vc(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,s,c,f){return!n.queryGeometry.isAboveHorizon&&Kp(od(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends va{constructor(n){super(n,Gf)}createBucket(n){return new Ea(n)}queryRadius(){return vc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Ja(this,n)}queryIntersectsFeature(n,e,r,s,c,f,m,y,b){const w=em(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,r),R=this.paint.get("fill-extrusion-base").evaluate(e,r),k=[0,0],N=y&&f.elevation,G=f.elevation?f.elevation.exaggeration():1,q=n.tile.getBucket(this);if(N&&q instanceof Ea){const Ee=q.centroidVertexArray,we=b+1;if(we<Ee.length){const Ce=Ee.get(we);k[0]=Ce.a_centroid_pos0,k[1]=Ce.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;"globe"===f.projection.name&&(s=$f([s],[new nt(0,0),new nt(pn,pn)],n.tileID.canonical).map(Ee=>Ee.polygon).flat());const ie=(we=s,Ce=R,Pe=S,Fe=w,Ze=m,Xe=N?y:null,ct=k,yt=G,Ve=f.center.lat,"globe"===(Ee=f).projection.name?function(xt,bt,Gt,mt,Vt,On,jn,ln,qt,Wn,Nn){const on=[],Ti=[],ai=xt.projection.upVectorScale(Nn,xt.center.lat,xt.worldSize).metersToTile,ri=[0,0,0,1],Xn=[0,0,0,1],tr=(Lr,Cr,Vr,Jr)=>{Lr[0]=Cr,Lr[1]=Vr,Lr[2]=Jr,Lr[3]=1},Ur=_d();Gt>0&&(Gt+=Ur),mt+=Ur;for(const Lr of bt){const Cr=[],Vr=[];for(const Jr of Lr){const hr=Jr.x+Vt.x,zo=Jr.y+Vt.y,er=xt.projection.projectTilePoint(hr,zo,Nn),li=xt.projection.upVector(Nn,Jr.x,Jr.y);let uo=Gt,gr=mt;if(jn){const Xr=Em(hr,zo,Gt,mt,jn,ln,qt,Wn);uo+=Xr.base,gr+=Xr.top}0!==Gt?tr(ri,er.x+li[0]*ai*uo,er.y+li[1]*ai*uo,er.z+li[2]*ai*uo):tr(ri,er.x,er.y,er.z),tr(Xn,er.x+li[0]*ai*gr,er.y+li[1]*ai*gr,er.z+li[2]*ai*gr),eo(ri,ri,On),eo(Xn,Xn,On),Cr.push(bd(ri)),Vr.push(bd(Xn))}on.push(Cr),Ti.push(Vr)}return[on,Ti]}(Ee,we,Ce,Pe,Fe,Ze,Xe,ct,yt,Ve,n.tileID.canonical):Xe?function(xt,bt,Gt,mt,Vt,On,jn,ln,qt){const Wn=[],Nn=[],on=[0,0,0,1];for(const Ti of xt){const ai=[],ri=[];for(const Xn of Ti){const tr=Xn.x+mt.x,Ur=Xn.y+mt.y,Lr=Em(tr,Ur,bt,Gt,On,jn,ln,qt);on[0]=tr,on[1]=Ur,on[2]=Lr.base,on[3]=1,bc(on,on,Vt),on[3]=Math.max(on[3],1e-5);const Cr=bd([on[0]/on[3],on[1]/on[3],on[2]/on[3]]);on[0]=tr,on[1]=Ur,on[2]=Lr.top,on[3]=1,bc(on,on,Vt),on[3]=Math.max(on[3],1e-5);const Vr=bd([on[0]/on[3],on[1]/on[3],on[2]/on[3]]);ai.push(Cr),ri.push(Vr)}Wn.push(ai),Nn.push(ri)}return[Wn,Nn]}(we,Ce,Pe,Fe,Ze,Xe,ct,yt,Ve):function(xt,bt,Gt,mt,Vt){const On=[],jn=[],ln=Vt[8]*bt,qt=Vt[9]*bt,Wn=Vt[10]*bt,Nn=Vt[11]*bt,on=Vt[8]*Gt,Ti=Vt[9]*Gt,ai=Vt[10]*Gt,ri=Vt[11]*Gt;for(const Xn of xt){const tr=[],Ur=[];for(const Lr of Xn){const Cr=Lr.x+mt.x,Vr=Lr.y+mt.y,Jr=Vt[0]*Cr+Vt[4]*Vr+Vt[12],hr=Vt[1]*Cr+Vt[5]*Vr+Vt[13],zo=Vt[2]*Cr+Vt[6]*Vr+Vt[14],er=Vt[3]*Cr+Vt[7]*Vr+Vt[15],li=Jr+ln,uo=hr+qt,gr=zo+Wn,Xr=Math.max(er+Nn,1e-5),wo=Jr+on,Ir=hr+Ti,pi=zo+ai,ro=Math.max(er+ri,1e-5),ji=new nt(li/Xr,uo/Xr);ji.z=gr/Xr,tr.push(ji);const ho=new nt(wo/ro,Ir/ro);ho.z=pi/ro,Ur.push(ho)}On.push(tr),jn.push(Ur)}return[On,jn]}(we,Ce,Pe,Fe,Ze)),ue=n.queryGeometry;var Ee,we,Ce,Pe,Fe,Ze,Xe,ct,yt,Ve;return function(Ee,we,Ce){let Pe=1/0;Kp(Ce,we)&&(Pe=xd(Ce,we[0]));for(let Fe=0;Fe<we.length;Fe++){const Ze=we[Fe],Xe=Ee[Fe];for(let ct=0;ct<Ze.length-1;ct++){const yt=Ze[ct],Ve=[yt,Ze[ct+1],Xe[ct+1],Xe[ct],yt];Yp(Ce,Ve)&&(Pe=Math.min(Pe,xd(Ce,Ve)))}}return Pe!==1/0&&Pe}(ie[0],ie[1],ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends va{constructor(n){super(n,Hf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof st,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Ta.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Uu(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Ja(this,n)}queryRadius(n){const e=n,r=Cm(Vi("line-width",this,e),Vi("line-gap-width",this,e)),s=Vi("line-offset",this,e);return r/2+Math.abs(s)+vc(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,s,c,f){if(n.queryGeometry.isAboveHorizon)return!1;const m=od(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*Cm(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(s=function(w,S){const R=[],k=new nt(0,0);for(let N=0;N<w.length;N++){const G=w[N],q=[];for(let ie=0;ie<G.length;ie++){const ue=G[ie-1],Ee=G[ie],we=G[ie+1],Ce=0===ie?k:Ee.sub(ue)._unit()._perp(),Pe=ie===G.length-1?k:we.sub(Ee)._unit()._perp(),Fe=Ce._add(Pe)._unit();Fe._mult(1/(Fe.x*Pe.x+Fe.y*Pe.y)),q.push(Fe._mult(S)._add(Ee))}R.push(q)}return R}(s,b*n.pixelToTileUnitsFactor)),function(w,S,R){for(let k=0;k<S.length;k++){const N=S[k];if(w.length>=3)for(let G=0;G<N.length;G++)if(zl(w,N[G]))return!0;if(Dg(w,N,R))return!0}return!1}(m,s,y)}isTileClipped(){return!0}},symbol:Uh,background:class extends va{constructor(n){super(n,Uy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends va{constructor(n){super(n,Vy)}getProgramIds(){return["raster"]}},sky:class extends va{constructor(n){super(n,jy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=um({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),c=!s,f=n.style.light,m=f.properties.get("position");return c&&"viewport"===f.properties.get("anchor")&&fn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?gp(m.azimuthal,90-m.polar,e):gp(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return gp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class Yu{constructor(e,r,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,s){const{width:c,height:f}=e,{context:m}=this,{gl:y}=m,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:S,ImageData:R,ImageBitmap:k}=Ae;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||!1!==r.premultiply)),s||this.size&&this.size[0]===c&&this.size[1]===f){const{x:N,y:G}=s||{x:0,y:0};e instanceof b||e instanceof w||e instanceof S||e instanceof R||k&&e instanceof k?y.texSubImage2D(y.TEXTURE_2D,0,N,G,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,N,G,c,f,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[c,f],e instanceof b||e instanceof w||e instanceof S||e instanceof R||k&&e instanceof k?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,c,f,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gd{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new nl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=Mn(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const c=[];let f=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,y=!0;c.push({left:f,right:m,isDash:y,zeroLength:0===e[0]});let b=e[0];for(let w=1;w<e.length;w++){y=!y;const S=e[w];f=b*s,b+=S,m=b*s,c.push({left:f,right:m,isDash:y,zeroLength:0===S})}return c}addRoundDash(e,r,s){const c=r/2;for(let f=-s;f<=s;f++){const m=this.width*(this.nextRow+s+f);let y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);const S=Math.abs(w-b.left),R=Math.abs(w-b.right),k=Math.min(S,R);let N;const G=f/s*(c+1);if(b.isDash){const q=c-Math.abs(G);N=Math.sqrt(k*k+q*q)}else N=c-Math.sqrt(k*k+G*G);this.image.data[m+w]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const w=e[b],S=e[b+1];w.zeroLength?e.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(b,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const f=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const w=Math.abs(b-y.left),S=Math.abs(b-y.right),R=Math.min(w,S);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?R:-R)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const c="round"===r,f=c?7:0,m=2*f+1;if(this.nextRow+m>this.height)return fn("LineAtlas out of space"),null;0===e.length&&e.push(1);let y=0;for(let S=0;S<e.length;S++)e[S]<0&&(fn("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),y+=e[S];if(0!==y){const S=this.width/y,R=this.getDashRanges(e,this.width,S);c?this.addRoundDash(R,S,f):this.addRegularDash(R,"square"===r?.5*S:0)}const b=this.nextRow+f;this.nextRow+=m;const w={tl:[b,f],br:[y,0]};return this.positions[s]=w,w}}Ut(Gd,"LineAtlas");class Xm{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ym{constructor(){this.tasks={},this.taskQueue=[],Ke(["process"],this),this.invoker=new Xm(this.process),this.nextId=0}add(e,r){const s=this.nextId++,c=function({type:f,isSymbolTile:m,zoom:y}){return y=y||0,"message"===f?0:"maybePrepare"!==f||m?"parseTile"!==f||m?"parseTile"===f&&m?300-y:"maybePrepare"===f&&m?400-y:500:200-y:100-y}(r);if(0===c){_r();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){_r();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let c=0;c<this.taskQueue.length;c++){const f=this.tasks[this.taskQueue[c]];f.priority<r&&(r=f.priority,e=c)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class ll{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Hd=["tile","layer","source","sourceLayer","state"];class v_{constructor(e,r,s,c,f){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=c,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const r of Hd)void 0!==this[r]&&(e[r]=this[r]);return e}}const Mc=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,r=0,s=0,c=0,f=0,m=0,y=0;for(1&e?c=f=m=32:r=s=y=32;(e>>=1)>1;){const w=r+c>>1,S=s+f>>1;1&e?(c=r,f=s,r=m,s=y):(r=c,s=f,c=m,f=y),m=w,y=S}const b=4*n;Mc[b+0]=r,Mc[b+1]=s,Mc[b+2]=c,Mc[b+3]=f}const ul=new Uint16Array(2178),su=new Uint8Array(1089),Vh=new Uint16Array(1089);function _p(n){return 0===n?-.03125:32===n?.03125:0}var Km=St([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Zd={type:2,extent:pn,loadGeometry:()=>[[new nt(0,0),new nt(8193,0),new nt(8193,8193),new nt(0,8193),new nt(0,0)]]};class yp{constructor(e,r,s,c,f){this.tileID=e,this.uid=wt(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<ci.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=nu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const m={};if(!f)return m;for(const y of c){const b=y.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(S=>S.id===w)[0]));for(const w of b)m[w.id]=y}}return m}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof al){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof al&&f.hasRTLText){this.hasRTLText=!0,ee.isLoading()||ee.isLoaded()||"deferred"!==Q()||_e();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new uh}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yu(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yu(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Yu(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,c,f,m,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:y,transform:m,params:f,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),f=r?r.sourceLayer:"",m=c._geojsonTileLayer||c[f];if(!m)return;const y=Ds(r&&r.filter),{z:b,x:w,y:S}=this.tileID.canonical,R={z:b,x:w,y:S};for(let k=0;k<m.length;k++){const N=m.feature(k);if(y.needGeometry){const ie=yc(N,!0);if(!y.filter(new ae(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!y.filter(new ae(this.tileID.overscaledZ),N))continue;const G=s.getId(N,f),q=new v_(N,b,w,S,G);q.tile=R,e.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=jr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const f=this.expirationTime-r;f?this.expirationTime=s+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),c=r.style.listImages();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const m=this.buckets[f],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],w=e[y];if(!b||!w||0===Object.keys(w).length)continue;if(m.update(w,b,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof Uu||m instanceof Th){const R=r.style._getSourceCache(m.layers[0].source);r._terrain&&r._terrain.enabled&&R&&m.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(R.id,this.tileID)}const S=r&&r.style&&r.style.getLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ci.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ci.now()+e}setTexture(e,r){const s=r.context,c=s.gl;this.texture=r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Yu(s,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,r){const s={};for(const c of r)s[c]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const c=this.dependencies[s];if(c)for(const f of r)if(c[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const s=Ol(Zd,this.tileID.canonical,this.tileTransform)[0],c=new cn,f=new xo;for(let m=0;m<s.length;m++){const{x:y,y:b}=s[m];c.emplaceBack(y,b),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(c,Oh.members),this._tileDebugSegments=di.simpleSegment(0,0,c.length,f.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const s=Ol(Zd,this.tileID.canonical,this.tileTransform)[0];let c,f;if(this.isRaster){const m=function(y,b){const w=nu(y,b),S=Math.pow(2,y.z);for(let ie=0;ie<33;ie++)for(let ue=0;ue<33;ue++){const Ee=ko((y.x+(ue+_p(ue))/32)/S),we=Ai((y.y+(ie+_p(ie))/32)/S),Ce=b.project(Ee,we),Pe=33*ie+ue;ul[2*Pe+0]=Math.round((Ce.x*w.scale-w.x)*pn),ul[2*Pe+1]=Math.round((Ce.y*w.scale-w.y)*pn)}su.fill(0),Vh.fill(0);for(let ie=2045;ie>=0;ie--){const ue=4*ie,Ee=Mc[ue+0],we=Mc[ue+1],Ce=Mc[ue+2],Pe=Mc[ue+3],Fe=Ee+Ce>>1,Ze=we+Pe>>1,Xe=Fe+Ze-we,ct=Ze+Ee-Fe,yt=33*we+Ee,Ve=33*Pe+Ce,it=33*Ze+Fe,xt=Math.hypot((ul[2*yt+0]+ul[2*Ve+0])/2-ul[2*it+0],(ul[2*yt+1]+ul[2*Ve+1])/2-ul[2*it+1])>=16;if(su[it]=su[it]||(xt?1:0),ie<1022){const bt=33*(we+ct>>1)+(Ee+Xe>>1),Gt=33*(Pe+ct>>1)+(Ce+Xe>>1);su[it]=su[it]||su[bt]||su[Gt]}}const R=new tn,k=new sr;let N=0;function G(ie,ue){const Ee=33*ue+ie;return 0===Vh[Ee]&&(R.emplaceBack(ul[2*Ee+0],ul[2*Ee+1],ie*pn/32,ue*pn/32),Vh[Ee]=++N),Vh[Ee]-1}function q(ie,ue,Ee,we,Ce,Pe){const Fe=ie+Ee>>1,Ze=ue+we>>1;if(Math.abs(ie-Ce)+Math.abs(ue-Pe)>1&&su[33*Ze+Fe])q(Ce,Pe,ie,ue,Fe,Ze),q(Ee,we,Ce,Pe,Fe,Ze);else{const Xe=G(ie,ue),ct=G(Ee,we),yt=G(Ce,Pe);k.emplaceBack(Xe,ct,yt)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:R,indices:k}}(this.tileID.canonical,r);c=m.vertices,f=m.indices}else{c=new tn,f=new sr;for(const{x:y,y:b}of s)c.emplaceBack(y,b,0,0);const m=yh(c.int16,void 0,4);for(let y=0;y<m.length;y+=3)f.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Km.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=di.simpleSegment(0,0,c.length,f.length)}_makeGlobeTileDebugBuffers(e,r){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!r||"globe"!==r.name)return;const s=this.tileID.canonical,c=zh(sl(s));this._makeGlobeTileDebugBorderBuffer(e,s,c),this._makeGlobeTileDebugTextBuffer(e,s,c)}_makeGlobeTileDebugBorderBuffer(e,r,s){const c=new cn,f=new xo,m=new Un,y=(w,S,R,k,N)=>{const G=(R-w)/(N-1),q=(k-S)/(N-1),ie=c.length;for(let ue=0;ue<N;ue++){const Ee=w+ue*G,we=S+ue*q;c.emplaceBack(Ee,we);const Ce=cp(Ee,we,r),Pe=eo(Ce,Ce,s);m.emplaceBack(Pe[0],Pe[1],Pe[2]),f.emplaceBack(ie+ue)}},b=pn;y(0,0,b,0,16),y(b,0,b,b,16),y(b,b,0,b,16),y(0,b,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(c,Oh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(m,kd.members),this._tileDebugSegments=di.simpleSegment(0,0,c.length,f.length)}_makeGlobeTileDebugTextBuffer(e,r,s){const c=new cn,f=new sr,m=new Un,y=25;f.reserve(32),c.reserve(y),m.reserve(y);const b=(w,S)=>y*w+S;for(let w=0;w<y;w++){const S=2048*w;for(let R=0;R<y;R++){const k=2048*R;c.emplaceBack(k,S);const N=cp(k,S,r),G=eo(N,N,s);m.emplaceBack(G[0],G[1],G[2])}}for(let w=0;w<4;w++)for(let S=0;S<4;S++){const R=b(w,S),k=b(w,S+1),N=b(w+1,S),G=b(w+1,S+1);f.emplaceBack(R,k,N),f.emplaceBack(N,k,G)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(f),this._tileDebugTextBuffer=e.createVertexBuffer(c,Oh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(m,kd.members),this._tileDebugTextSegments=di.simpleSegment(0,0,y,32)}}class x_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},gt(this.stateChanges[e][c],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][c]){this.deletedStates[e][c]={};for(const f in this.state[e][c])s[f]||(this.deletedStates[e][c][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][c]&&null===this.deletedStates[e][c][f]&&delete this.deletedStates[e][c][f]}removeFeatureState(e,r,s){if(null===this.deletedStates[e])return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==r)null!==this.deletedStates[e][c]&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(void 0!==r)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),c=gt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][r];if(null===f)return{};for(const m in f)delete c[m]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),gt(this.state[c][m],this.stateChanges[c][m]),f[m]=this.state[c][m];s[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(null===this.deletedStates[c])for(const m in this.state[c])f[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(null===this.deletedStates[c][m])this.state[c][m]={};else for(const y of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][y];f[m]=this.state[c][m]}s[c]=s[c]||{},gt(s[c],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const c in e)e[c].setFeatureState(s,r)}}class Qm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Jm(n,e,r,s){let c=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(r[m]<n[m]||r[m]>e[m])return null}else{const y=1/s[m];let b=(n[m]-r[m])*y,w=(e[m]-r[m])*y;if(b>w){const S=b;b=w,w=S}if(b>c&&(c=b),w<f&&(f=w),c>f)return null}return c}function eg(n,e,r,s,c,f,m,y,b,w,S){const R=s-n,k=c-e,N=f-r,G=m-n,q=y-e,ie=b-r,ue=S[1]*ie-S[2]*q,Ee=S[2]*G-S[0]*ie,we=S[0]*q-S[1]*G,Ce=R*ue+k*Ee+N*we;if(Math.abs(Ce)<1e-15)return null;const Pe=1/Ce,Fe=w[0]-n,Ze=w[1]-e,Xe=w[2]-r,ct=(Fe*ue+Ze*Ee+Xe*we)*Pe;if(ct<0||ct>1)return null;const yt=Ze*N-Xe*k,Ve=Xe*R-Fe*N,it=Fe*k-Ze*R,xt=(S[0]*yt+S[1]*Ve+S[2]*it)*Pe;return xt<0||ct+xt>1?null:(G*yt+q*Ve+ie*it)*Pe}function tg(n,e,r){return(n-e)/(r-e)}function jh(n,e,r,s,c,f,m,y,b){const w=1<<r,S=f-s,R=m-c,k=(n+1)/w*S+s,N=(e+0)/w*R+c,G=(e+1)/w*R+c;y[0]=(n+0)/w*S+s,y[1]=N,b[0]=k,b[1]=G}class Ac{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(f){const m=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const w=1/b,S=(N,G,q,ie,ue)=>{const Ee=ie?1:0,we=(N+1)*q-Ee,Ce=G*q,Pe=(G+1)*q-Ee;ue[0]=N*q,ue[1]=Ce,ue[2]=we,ue[3]=Pe};let R=new Qm(b);const k=[];for(let N=0;N<b*b;N++){S(N%b,Math.floor(N/b),w,!1,k);const G=na(k[0],k[1],f),q=na(k[2],k[1],f),ie=na(k[2],k[3],f),ue=na(k[0],k[3],f);R.minimums.push(Math.min(G,q,ie,ue)),R.maximums.push(Math.max(G,q,ie,ue)),R.leaves.push(1)}for(y.push(R),b/=2;b>=1;b/=2){const N=y[y.length-1];R=new Qm(b);for(let G=0;G<b*b;G++){S(G%b,Math.floor(G/b),2,!0,k);const q=N.getElevation(k[0],k[1]),ie=N.getElevation(k[2],k[1]),ue=N.getElevation(k[2],k[3]),Ee=N.getElevation(k[0],k[3]),we=N.isLeaf(k[0],k[1]),Ce=N.isLeaf(k[2],k[1]),Pe=N.isLeaf(k[2],k[3]),Fe=N.isLeaf(k[0],k[3]),Ze=Math.min(q.min,ie.min,ue.min,Ee.min),Xe=Math.max(q.max,ie.max,ue.max,Ee.max),ct=we&&Ce&&Pe&&Fe;R.maximums.push(Xe),R.minimums.push(Ze),R.leaves.push(Xe-Ze<=5&&ct?1:0)}y.push(R)}return y}(this.dem),s=r.length-1,c=r[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,c,f,m,y=1){return Jm([e,r,-100],[s,c,this.maximums[0]*y],f,m)}raycast(e,r,s,c,f,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,s,c,f,m,y);if(null==b)return null;const w=[],S=[],R=[],k=[],N=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:G,t:q,nodex:ie,nodey:ue,depth:Ee}=N.pop();if(this.leaves[G]){jh(ie,ue,Ee,e,r,s,c,R,k);const Ce=1<<Ee,Pe=(ie+0)/Ce,Fe=(ie+1)/Ce,Ze=(ue+0)/Ce,Xe=(ue+1)/Ce,ct=na(Pe,Ze,this.dem)*y,yt=na(Fe,Ze,this.dem)*y,Ve=na(Fe,Xe,this.dem)*y,it=na(Pe,Xe,this.dem)*y,xt=eg(R[0],R[1],ct,k[0],R[1],yt,k[0],k[1],Ve,f,m),bt=eg(k[0],k[1],Ve,R[0],k[1],it,R[0],R[1],ct,f,m),Gt=Math.min(null!==xt?xt:Number.MAX_VALUE,null!==bt?bt:Number.MAX_VALUE);if(Gt!==Number.MAX_VALUE)return Gt;{const mt=_h([],f,m,q);if(b_(ct,yt,it,Ve,tg(mt[0],R[0],k[0]),tg(mt[1],R[1],k[1]))>=mt[2])return q}continue}let we=0;for(let Ce=0;Ce<this._siblingOffset.length;Ce++){jh((ie<<1)+this._siblingOffset[Ce][0],(ue<<1)+this._siblingOffset[Ce][1],Ee+1,e,r,s,c,R,k),R[2]=-100,k[2]=this.maximums[this.childOffsets[G]+Ce]*y;const Pe=Jm(R,k,f,m);if(null!=Pe){const Fe=Pe;w[Ce]=Fe;let Ze=!1;for(let Xe=0;Xe<we&&!Ze;Xe++)Fe>=w[S[Xe]]&&(S.splice(Xe,0,Ce),Ze=!0);Ze||(S[we]=Ce),we++}}for(let Ce=0;Ce<we;Ce++){const Pe=S[Ce];N.push({idx:this.childOffsets[G]+Pe,t:w[Pe],nodex:(ie<<1)+this._siblingOffset[Pe][0],nodey:(ue<<1)+this._siblingOffset[Pe][1],depth:Ee+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,c,f){if(1===e[c].isLeaf(r,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=c-1,y=e[m];let b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const R=2*r+this._siblingOffset[S][0],k=2*s+this._siblingOffset[S][1],N=y.getElevation(R,k),G=y.isLeaf(R,k),q=this._addNode(N.min,N.max,G);G&&(b|=1<<S),w||(w=q)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(e,2*r+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],m,w+S)}}function b_(n,e,r,s,c,f){return Je(Je(n,r,f),Je(e,s,f),c)}function na(n,e,r){const s=r.dim,c=Xt(n*s-.5,0,s-1),f=Xt(e*s-.5,0,s-1),m=Math.floor(c),y=Math.floor(f),b=Math.min(m+1,s-1),w=Math.min(y+1,s-1);return b_(r.get(m,y),r.get(b,y),r.get(m,w),r.get(b,w),c-m,f-y)}const ng={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class qd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,c=!1,f=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return fn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let b=0;b<m;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(m,b)]=y[this._idx(m-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,m)]=y[this._idx(b,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ac(this)}get(e,r,s=!1){s&&(e=Xt(e,-1,this.dim),r=Xt(r,-1,this.dim));const c=4*this._idx(e,r);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return ng[e]}get unpackVector(){return ng[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}static pack(e,r){const s=[0,0,0,0],c=qd.getUnpackVector(r);let f=Math.floor((e+c[3])/c[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Jo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,f=r*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:c=f-1;break;case 1:f=c+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const b=-r*this.dim,w=-s*this.dim;for(let S=m;S<y;S++)for(let R=c;R<f;R++){const k=4*this._idx(R,S),N=4*this._idx(R+b,S+w);this.pixels[k+0]=e.pixels[N+0],this.pixels[k+1]=e.pixels[N+1],this.pixels[k+2]=e.pixels[N+2],this.pixels[k+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ut(qd,"DEMData"),Ut(Ac,"DemMinMaxQuadTree",{omit:["dem"]});class vp{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const c=e.wrapped().key;void 0===this.data[c]&&(this.data[c]=[]);const f={value:r,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,c=void 0===r?0:this.data[s].indexOf(r),f=this.data[s][c];return this.data[s].splice(c,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||r.push(c);for(const s of r)this.remove(s.value.tileID,s)}}class Ku{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}Ku.ReadOnly=!1,Ku.ReadWrite=!0,Ku.disabled=new Ku(519,Ku.ReadOnly,[0,1]);class au{constructor(e,r,s,c,f,m){this.test=e,this.ref=r,this.mask=s,this.fail=c,this.depthFail=f,this.pass=m}}au.disabled=new au({func:519,mask:0},0,0,7680,7680,7680);class si{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}si.Replace=[1,0],si.disabled=new si(si.Replace,Zr.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,Zr.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],Zr.transparent,[!0,!0,!0,!0]);class Pi{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}Pi.disabled=new Pi(!1,1029,2305),Pi.backCCW=new Pi(!0,1029,2305),Pi.backCW=new Pi(!0,1029,2304),Pi.frontCW=new Pi(!0,1028,2304),Pi.frontCCW=new Pi(!0,1028,2305);class Gl extends nn{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",c=>{"source"===c.dataType&&"metadata"===c.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===c.dataType&&"content"===c.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new vp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new x_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if("loaded"!==r.state&&"errored"!==r.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const r in this._tiles){const s=this._tiles[r];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(e),s.prepare(this.map.style.imageManager)}else for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Nt(this._tiles).map(e=>e.tileID).sort(lu).map(e=>e.key)}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort((s,c)=>{const f=s.tileID,m=c.tileID,y=new nt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new nt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||b.y-y.y||b.x-y.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(lu).map(s=>s.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,c){if(c)if(e.state="errored",404!==c.status)this._source.fire(new $t(c,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ci.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new rt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const f=r[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const m=this.getTileByID(f);s(e,m),s(m,e)}}function s(c,f){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-c.tileID.canonical.x;const y=f.tileID.canonical.y-c.tileID.canonical.y,b=Math.pow(2,c.tileID.canonical.z),w=f.tileID.key;0===m&&0===y||Math.abs(y)>1||(Math.abs(m)>1&&(1===Math.abs(m+b)?m+=b:1===Math.abs(m-b)&&(m-=b)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,m,y),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,c){for(const f in this._tiles){let m=this._tiles[f];if(c[f]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>s)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){c[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const c=e.scaledTo(s),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,c=Math.ceil(e.height/r)+1,f=Math.floor(s*c*5),m="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+r),s[f.tileID.key]=f}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new lo(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(c=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(y=>this._source.hasTile(y)))):c=[];const f=this._updateRetainedTiles(c);if(cu(this._source.type)&&0!==c.length){const y={},b={},w=Object.keys(f);for(const R of w){const k=f[R],N=this._tiles[R];if(!N||N.fadeEndTime&&N.fadeEndTime<=ci.now())continue;const G=this.findLoadedParent(k,Math.max(k.overscaledZ-Gl.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),y[G.tileID.key]=G.tileID),b[R]=k}const S=c[c.length-1].overscaledZ;for(const R in this._tiles){const k=this._tiles[R];if(f[R]||!k.hasData())continue;let N=k.tileID;for(;N.overscaledZ>S;){N=N.scaledTo(N.overscaledZ-1);const G=this._tiles[N.key];if(G&&G.hasData()&&b[N.key]){f[R]=k.tileID;break}}}for(const R in y)f[R]||(this._coveredTiles[R]=!0,f[R]=y[R])}for(const y in f)this._tiles[y].clearFadeHold();const m=function(y,b){const w=[];for(const S in y)S in b||w.push(S);return w}(this._tiles,f);for(const y of m){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(0===e.length)return r;const s={},c=e.reduce((w,S)=>Math.min(w,S.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-Gl.maxOverzooming,this._source.minzoom),y=Math.max(f+Gl.maxUnderzooming,this._source.minzoom),b={};for(const w of e){const S=this._addTile(w);r[w.key]=w,S.hasData()||c<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,c,y,r);for(const w of e){let S=this._tiles[w.key];if(S.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const k=w.children(this._source.maxzoom)[0],N=this.getTile(k);if(N&&N.hasData()){r[k.key]=k;continue}}else{const k=w.children(this._source.maxzoom);if(r[k[0].key]&&r[k[1].key]&&r[k[2].key]&&r[k[3].key])continue}let R=S.wasRequested();for(let k=w.overscaledZ-1;k>=m;--k){const N=w.scaledTo(k);if(s[N.key]||(s[N.key]=!0,S=this.getTile(N),!S&&R&&(S=this._addTile(N)),S&&(r[N.key]=N,R=S.wasRequested(),S.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}r.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;c=f}for(const f of r)this._loadedParentTiles[f]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=Boolean(r);if(!s){const c=this.map?this.map.painter:null;r=new yp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new rt("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,s){const c=[],f=this.transform;if(!f)return c;const m="globe"===f.projection.name,y=_c(f.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let S;if(m){const R=w.tileID.canonical;if(0===R.z){const k=[Math.abs(Xt(y,...hl(R,-1))-y),Math.abs(Xt(y,...hl(R,1))-y)];S=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(Xt(y,...hl(R,-1))-y),Math.abs(Xt(y,...hl(R,0))-y),Math.abs(Xt(y,...hl(R,1))-y)];S=[k.indexOf(Math.min(...k))-1]}}else S=[0];for(const R of S){const k=e.containsTile(w,f,r,R);k&&c.push(k)}}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(cu(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=ci.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const c=this._tiles[e];c&&c.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}_preloadTiles(e,r){const s=new Map,c=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of c){const b=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)s.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}Bt(Array.from(s.values()),(y,b)=>{const w=new yp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,S=>{"raster-dem"===this._source.type&&w.dem&&this._backfillDEM(w),b(S,w)})},r)}}function lu(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function cu(n){return"raster"===n||"image"===n||"video"===n}function hl(n,e){const r=1<<n.z;return[n.x/r+e,(n.x+1)/r+e]}Gl.maxOverzooming=10,Gl.maxUnderzooming=3;class Hl{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const c=s||e.findDEMTileFor(r);if(!c||!c.dem)return;const f=c.dem,m=c.tileID,y=1<<r.canonical.z-m.canonical.z;return new Hl(c,c.tileSize/pn/y,[(r.canonical.x/y-m.canonical.x)*f.dim,(r.canonical.y/y-m.canonical.y)*f.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new nt(c,f)}getElevationAt(e,r,s,c){const f=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(m),w=this._dem;return c=!!c,s?Je(Je(w.get(y,b,c),w.get(y,b+1,c),m-b),Je(w.get(y+1,b,c),w.get(y+1,b+1,c),m-b),f-y):w.get(y,b,c)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Qs(1,e)*this._dem.stride}}class uu{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Xs(pn,16,0),this.featureIndexArray=new Bp,this.promoteId=r}insert(e,r,s,c,f,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,f,m);const b=this.grid;for(let w=0;w<r.length;w++){const S=r[w],R=[1/0,1/0,-1/0,-1/0];for(let k=0;k<S.length;k++){const N=S[k];R[0]=Math.min(R[0],N.x),R[1]=Math.min(R[1],N.y),R[2]=Math.max(R[2],N.x),R[3]=Math.max(R[3],N.y)}R[0]<pn&&R[1]<pn&&R[2]>=0&&R[3]>=0&&b.insert(y,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ec.VectorTile(new Ih(this.rawTileData)).layers,this.sourceLayerCoder=new ll(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,c){this.loadVTLayers();const f=e.params||{},m=Ds(f.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(G,q,ie,ue)=>yf(y.bufferedTilespaceGeometry,G,q,ie,ue));S.sort(Ju);let R=null;b.elevation&&S.length>0&&(R=Hl.create(b.elevation,this.tileID));const k={};let N;for(let G=0;G<S.length;G++){const q=S[G];if(q===N)continue;N=q;const ie=this.featureIndexArray.get(q);let ue=null;this.loadMatchingFeature(k,ie,m,f.layers,f.availableImages,r,s,c,(Ee,we,Ce,Pe=0)=>(ue||(ue=Ol(Ee,this.tileID.canonical,e.tileTransform)),we.queryIntersectsFeature(y,Ee,Ce,ue,this.z,e.transform,e.pixelPosMatrix,R,Pe)))}return k}loadMatchingFeature(e,r,s,c,f,m,y,b,w){const{featureIndex:S,bucketIndex:R,sourceLayerIndex:k,layoutVertexArrayOffset:N}=r,G=this.bucketLayerIDs[R];if(c&&!function(Ee,we){for(let Ce=0;Ce<Ee.length;Ce++)if(we.indexOf(Ee[Ce])>=0)return!0;return!1}(c,G))return;const q=this.sourceLayerCoder.decode(k),ie=this.vtLayers[q].feature(S);if(s.needGeometry){const Ee=yc(ie,!0);if(!s.filter(new ae(this.tileID.overscaledZ),Ee,this.tileID.canonical))return}else if(!s.filter(new ae(this.tileID.overscaledZ),ie))return;const ue=this.getId(ie,q);for(let Ee=0;Ee<G.length;Ee++){const we=G[Ee];if(c&&c.indexOf(we)<0)continue;const Ce=m[we];if(!Ce)continue;let Pe={};void 0!==ue&&b&&(Pe=b.getState(Ce.sourceLayer||"_geojsonTileLayer",ue));const Fe=gt({},y[we]);Fe.paint=hu(Fe.paint,Ce.paint,ie,Pe,f),Fe.layout=hu(Fe.layout,Ce.layout,ie,Pe,f);const Ze=!w||w(ie,Ce,Pe,N);if(!Ze)continue;const Xe=new v_(ie,this.z,this.x,this.y,ue);Xe.layer=Fe;let ct=e[we];void 0===ct&&(ct=e[we]=[]),ct.push({featureIndex:S,feature:Xe,intersectionZ:Ze})}}lookupSymbolFeatures(e,r,s,c,f,m,y,b){const w={};this.loadVTLayers();const S=Ds(f);for(const R of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:c,featureIndex:R,layoutVertexArrayOffset:0},S,m,y,b,r);return w}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),f=this.vtFeatures[c];if(f[r])return f[r];const m=this.vtLayers[c].feature(r);return f[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[r]],"boolean"==typeof s&&(s=Number(s))),s}}function hu(n,e,r,s,c){return ot(n,(f,m)=>{const y=e instanceof $e?e.get(m):null;return y&&y.evaluate?y.evaluate(r,s,c):y})}function Ju(n,e){return e-n}Ut(uu,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class du{constructor(e){const r={},s=[];for(const y in e){const b=e[y],w=r[y]={};for(const S in b.glyphs){const R=b.glyphs[+S];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const k=R.metrics.localGlyph?2:1,N={x:0,y:0,w:R.bitmap.width+2*k,h:R.bitmap.height+2*k};s.push(N),w[S]=N}}const{w:c,h:f}=km(s),m=new nl({width:c||1,height:f||1});for(const y in e){const b=e[y];for(const w in b.glyphs){const S=b.glyphs[+w];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const R=r[y][w],k=S.metrics.localGlyph?2:1;nl.copy(S.bitmap,m,{x:0,y:0},{x:R.x+k,y:R.y+k},S.bitmap)}}this.image=m,this.positions=r}}Ut(du,"GlyphAtlas");class eh{constructor(e){this.tileID=new lo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=nu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,s,c,f){this.status="parsing",this.data=e,this.collisionBoxArray=new uh;const m=new ll(Object.keys(e.layers).sort()),y=new uu(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new Gd(256,256),S={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},R=r.familiesBySource[this.source];for(const Pe in R){const Fe=e.layers[Pe];if(!Fe)continue;let Ze=!1,Xe=!1;for(const Ve of R[Pe])"symbol"===Ve[0].type?Ze=!0:Xe=!0;if(!0===this.isSymbolTile&&!Ze||!1===this.isSymbolTile&&!Xe)continue;1===Fe.version&&fn(`Vector tile source "${this.source}" layer "${Pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ct=m.encode(Pe),yt=[];for(let Ve=0;Ve<Fe.length;Ve++){const it=Fe.feature(Ve),xt=y.getId(it,Pe);yt.push({feature:it,id:xt,index:Ve,sourceLayerIndex:ct})}for(const Ve of R[Pe]){const it=Ve[0];void 0!==this.isSymbolTile&&"symbol"===it.type!==this.isSymbolTile||it.minzoom&&this.zoom<Math.floor(it.minzoom)||it.maxzoom&&this.zoom>=it.maxzoom||"none"!==it.visibility&&(Wd(Ve,this.zoom,s),(b[it.id]=it.createBucket({index:y.bucketLayerIDs.length,layers:Ve,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ct,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(yt,S,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Ve.map(xt=>xt.id)))}}let k,N,G,q;w.trim();const ie={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=ot(S.glyphDependencies,Pe=>Object.keys(Pe).map(Number));Object.keys(ue).length?c.send("getGlyphs",{uid:this.uid,stacks:ue},(Pe,Fe)=>{k||(k=Pe,N=Fe,Ce.call(this))},void 0,!1,ie):N={};const Ee=Object.keys(S.iconDependencies);Ee.length?c.send("getImages",{icons:Ee,source:this.source,tileID:this.tileID,type:"icons"},(Pe,Fe)=>{k||(k=Pe,G=Fe,Ce.call(this))},void 0,!1,ie):G={};const we=Object.keys(S.patternDependencies);function Ce(){if(k)return f(k);if(N&&G&&q){const Pe=new du(N),Fe=new Dd(G,q);for(const Ze in b){const Xe=b[Ze];Xe instanceof al?(Wd(Xe.layers,this.zoom,s),Cc(Xe,N,Pe.positions,G,Fe.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Xe.hasPattern&&(Xe instanceof Uu||Xe instanceof Th||Xe instanceof Ea)&&(Wd(Xe.layers,this.zoom,s),Xe.addFeatures(S,this.tileID.canonical,Fe.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:Nt(b).filter(Ze=>!Ze.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pe.image,lineAtlas:w,imageAtlas:Fe,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?Pe.positions:null})}}we.length?c.send("getImages",{icons:we,source:this.source,tileID:this.tileID,type:"patterns"},(Pe,Fe)=>{k||(k=Pe,q=Fe,Ce.call(this))},void 0,!1,ie):q={},Ce.call(this)}}function Wd(n,e,r){const s=new ae(e);for(const c of n)c.recalculate(s,r)}class xp{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,c){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[m,y]=f.result;return this.scheduler?this.scheduler.add(()=>{c(m,y)},r):c(m,y),()=>{}}return f.callbacks.push(c),f.cancel||(f.cancel=s((m,y)=>{f.result=[m,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,y)},r):b(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==c),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function bp(n,e,r){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const f=Ie(n.request,(m,y,b,w)=>{m?c(m):y&&c(null,{vectorTile:r?void 0:new Ec.VectorTile(new Ih(y)),rawData:y,cacheControl:b,expires:w})});return()=>{f.cancel(),c()}},e)}u.ARRAY_TYPE=Ko,u.AUTH_ERR_MSG=Jt,u.Aabb=Rs,u.Actor=class{constructor(n,e,r){this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Ke(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=_r()?n:Ae,this.scheduler=new Ym}send(n,e,r,s,c=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=f,this.callbacks[m]=r);const y=Yr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:n,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:os(e,y)},y),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||_r()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(n,e){if("<response>"===e.type){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(uc(e.error)):r(null,uc(e.data)))}else{const r=Yr(this.globalScope)?void 0:[],s=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?os(f):null,data:os(m,r)},r)}:f=>{},c=uc(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],c.source)[f[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=yd,u.Color=Zr,u.ColorMode=si,u.CullFaceMode=Pi,u.DEMData=qd,u.DataConstantProperty=je,u.DedupedRequest=xp,u.DepthMode=Ku,u.EXTENT=pn,u.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,c=Math.floor(n.x),f=Math.floor((n.x-c)*s),m=Math.floor(n.y*s),y=this.findDEMTileFor(new lo(r,c,r,f,m));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const c=s.getSource().maxzoom,f=1<<c,m=Math.floor(n.x),y=n.x-m,b=new lo(c,m,c,Math.floor(y*f),Math.floor(n.y*f)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const S=w.dem,R=1<<w.tileID.canonical.z,k=(y*R-w.tileID.canonical.x)*S.dim,N=(n.y*R-w.tileID.canonical.y)*S.dim,G=Math.floor(k),q=Math.floor(N);return(r?this.exaggeration():1)*Je(Je(S.get(G,q),S.get(G,q+1),N-q),Je(S.get(G+1,q),S.get(G+1,q+1),N-q),k-G)}getAtTileOffset(n,e,r){const s=1<<n.canonical.z;return this.getAtPointOrZero(new mh(n.wrap+(n.canonical.x+e/pn)/s,(n.canonical.y+r/pn)/s))}getAtTileOffsetFunc(n,e,r,s){return c=>{const f=this.getAtTileOffset(n,c.x,c.y),m=s.upVector(n.canonical,c.x,c.y);return tl(m,m,f*s.upVectorScale(n.canonical,e,r).metersToTile),m}}getForTilePoints(n,e,r,s){const c=Hl.create(this,n,s);return!!c&&(e.forEach(f=>{f[2]=this.exaggeration()*c.getElevationAt(f[0],f[1],r)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,c=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/c-s.canonical.x,m=n.canonical.y/c-s.canonical.y,y=0;for(let b=0;b<n.canonical.z-s.canonical.z&&!r.leaves[y];b++){f*=2,m*=2;const w=2*Math.floor(m)+Math.floor(f);y=r.childOffsets[y]+w,f%=1,m%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=$t,u.EvaluationParameters=ae,u.Event=rt,u.Evented=nn,u.FillExtrusionBucket=Ea,u.Frustum=Ef,u.FrustumCorners=wf,u.GLOBE_METERS_TO_ECEF=ap,u.GLOBE_RADIUS=Sc,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GLOBE_ZOOM_THRESHOLD_MIN=5,u.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const e=new cn,r=new sr,s=65;for(let c=0;c<s;c++)for(let f=0;f<s;f++)e.emplaceBack(f,c);this._gridSegments=[];for(let c=0,f=0;c<Hu.length;c++){const m=Hu[c];for(let b=0;b<m;b++)for(let w=0;w<64;w++){const S=b*s+w;r.emplaceBack(S+1,S,S+s),r.emplaceBack(S+s,S+s+1,S+1)}const y=64*m*2;this._gridSegments.push(di.simpleSegment(0,f,(m+1)*s,y)),f+=y}this._gridBuffer=n.createVertexBuffer(e,Oh.members),this._gridIndexBuffer=n.createIndexBuffer(r,!0)}_createPoles(n){const e=new sr;for(let c=0;c<=64;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new fc,s=new fc;this._poleSegments=[];for(let c=0,f=0;c<5;c++){const m=1<<c,y=512*m/Math.PI/2,b=360/m;r.emplaceBack(0,-y,0,0,0,.5,0),s.emplaceBack(0,-y,0,0,0,.5,1);for(let w=0;w<=64;w++){const S=w/64,R=Je(0,b,S),[k,N,G]=Od(a_,l_,R,y);r.emplaceBack(k,N,G,0,0,S,0),s.emplaceBack(k,N,G,0,0,S,1)}this._poleSegments.push(di.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,Vm,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Vm,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const r=new oi,s=64,c=s+1;this._wireframeSegments=[];for(let f=0,m=0;f<Hu.length;f++){const y=Hu[f];for(let w=0;w<y;w++)for(let S=0;S<s;S++){const R=w*c+S;r.emplaceBack(R,R+1),r.emplaceBack(R,R+c),r.emplaceBack(R,R+c+1)}const b=y*s*3;this._wireframeSegments.push(di.simpleSegment(0,m,(y+1)*c,b)),m+=b}this._wireframeIndexBuffer=n.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},u.GlyphManager=Rh,u.ImagePosition=Td,u.LineAtlas=Gd,u.LngLat=Dr,u.LngLatBounds=gc,u.LocalGlyphMode=np,u.MAX_MERCATOR_LATITUDE=Fl,u.MercatorCoordinate=mh,u.ONE_EM=24,u.OverscaledTileID=lo,u.Properties=et,u.RGBAImage=Jo,u.Ray=bf,u.RequestManager=class{constructor(n,e,r){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ts,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!ui(n))return n;const r=gn(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!ui(n))return n;const r=gn(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(n,e,r,s){if(!ui(n))return n;const c=gn(n);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),r&&c.params.push(`language=${r}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(n,e,r,s){const c=gn(n);return ui(n)?(c.path=`/styles/v1${c.path}/sprite${e}${r}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${r}`,No(c))}normalizeTileURL(n,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!ui(n))return n;const s=gn(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&"raster"!==s.authority&&512===r?"@2x":""}${Ci.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Vn.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Vn.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(f){for(const m of f){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||Vn.ACCESS_TOKEN;return Vn.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(n,e){const r=gn(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${Vn.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${Vn.TILE_URL_VERSION}/`,"")}`;let c=r.params;return e&&(c=c.filter(f=>!f.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(n,e){const r=!!e&&ui(e),s=[];for(const c of n.tiles||[])vr(c)?s.push(this.canonicalizeTileURL(c,r)):s.push(c);return s}_makeAPIURL(n,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=gn(Vn.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const c=n.params.indexOf("secure");c>=0&&n.params.splice(c,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!Vn.REQUIRE_ACCESS_TOKEN)return No(n);if(e=e||Vn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(c=>-1===c.indexOf("access_token")),n.params.push(`access_token=${e||""}`),No(n)}},u.ResourceType=ye,u.SegmentVector=di,u.SourceCache=Gl,u.StencilMode=au,u.StructArrayLayout1ui2=xo,u.StructArrayLayout2f1f2i16=ur,u.StructArrayLayout2i4=cn,u.StructArrayLayout2ui4=oi,u.StructArrayLayout3f12=qi,u.StructArrayLayout3ui6=sr,u.StructArrayLayout4i8=tn,u.StructArrayLayout5f20=Rl,u.Texture=Yu,u.Tile=yp,u.Transitionable=de,u.Uniform1f=Qh,u.Uniform1i=class extends pc{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},u.Uniform2f=class extends pc{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},u.Uniform3f=class extends pc{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},u.Uniform4f=hh,u.UniformColor=hf,u.UniformMatrix2f=class extends pc{constructor(n,e){super(n,e),this.current=$p}set(n){for(let e=0;e<4;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},u.UniformMatrix3f=class extends pc{constructor(n,e){super(n,e),this.current=dh}set(n){for(let e=0;e<9;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},u.UniformMatrix4f=class extends pc{constructor(n,e){super(n,e),this.current=Ya}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},u.UnwrappedTileID=vd,u.ValidationError=Ht,u.VectorTileWorkerSource=class extends nn{constructor(n,e,r,s,c){super(),this.actor=n,this.layerIndex=e,this.availableImages=r,this.loadVectorData=c||bp,this.loading={},this.loaded={},this.deduped=new xp(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const r=n.uid,s=n&&n.request,c=s&&s.collectResourceTiming,f=this.loading[r]=new eh(n);f.abort=this.loadVectorData(n,(m,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||m||!y)return f.status="done",b||(this.loaded[r]=f),e(m);const w=y.rawData,S={};y.expires&&(S.expires=y.expires),y.cacheControl&&(S.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new Ec.VectorTile(new Ih(w));const R=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,N)=>{if(k||!N)return e(k);const G={};if(c){const q=An(s);q.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(q)))}e(null,gt({rawTileData:w.slice(0)},N,S,G))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[r]=f})}reloadTile(n,e){const r=this.loaded,s=n.uid,c=this;if(r&&r[s]){const f=r[s];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=nu(n.tileID.canonical,n.projection);const m=(y,b)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,c.layerIndex,this.availableImages,c.actor,w)),e(y,b)};"parsing"===f.status?f.reloadCallback=m:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(n,e){const r=n.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(n,e){const r=this.loaded,s=n.uid;r&&r[s]&&delete r[s],e()}},u.WritingMode=ls,u.ZoomHistory=Du,u.add=Bl,u.addDynamicAttributes=Wu,u.adjoint=function(n,e){var r=e[0],s=e[1],c=e[2],f=e[3],m=e[4],y=e[5],b=e[6],w=e[7],S=e[8];return n[0]=m*S-y*w,n[1]=c*w-s*S,n[2]=s*y-c*m,n[3]=y*b-f*S,n[4]=r*S-c*b,n[5]=c*f-r*y,n[6]=f*w-m*b,n[7]=s*b-r*w,n[8]=r*m-s*f,n},u.asyncAll=Bt,u.bezier=dt,u.bindAll=Ke,u.boundsAttributes=Km,u.bufferConvexPolygon=function(n,e){const r=[];for(let s=0;s<n.length;s++){const c=Zt(s-1,-1,n.length-1),f=Zt(s+1,-1,n.length-1),m=n[s],y=n[f],b=n[c].sub(m).unit(),w=y.sub(m).unit(),S=w.angleWithSep(b.x,b.y),R=b.add(w).unit().mult(-1*e/Math.sin(S/2));r.push(m.add(R))}return r},u.cacheEntryPossiblyAdded=function(n){ce++,ce>po&&(n.getActor().send("enforceCacheSizeLimit",In),ce=0)},u.calculateGlobeLabelMatrix=function(n,e){const{x:r,y:s}=n.point,c=$m(r,s,n.worldSize/n._projectionScaler,0,0);return xc(c,c,s_(sl(e)))},u.calculateGlobeMatrix=function(n){const{x:e,y:r}=n.point,{lng:s,lat:c}=n._center;return $m(e,r,n.worldSize,s,c)},u.calculateGlobeMercatorMatrix=function(n){const e=n.worldSize,r=n.point,s=Qs(1,n.center.lat)*e,c=n.pixelsPerMeter,f=e/(s/n.pixelsPerMeter),m=Qo(new Float64Array(16));return Wc(m,m,[r.x,r.y,0]),el(m,m,[f,f,c]),Float32Array.from(m)},u.circumferenceAtLatitude=ph,u.clamp=Xt,u.clearTileCache=function(n){const e=[];for(const r in Gr)e.push(Ae.caches.delete(r)),delete Gr[r];n&&Promise.all(e).catch(n).then(()=>n())},u.clipLine=zm,u.clone=function(n){var e=new Ko(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},u.clone$1=Rt,u.collisionCircleLayout=qg,u.config=Vn,u.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},u.create=function(){var n=new Ko(16);return Ko!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},u.create$1=nm,u.createExpression=js,u.createLayout=St,u.createStyleLayer=function(n){return"custom"===n.type?new mp(n):new Wm[n.type](n)},u.cross=xf,u.degToRad=Tt,u.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},u.div=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},u.dot=Oo,u.ease=dn,u.easeCubicInOut=bn,u.emitValidationErrors=Vc,u.endsWith=Qe,u.enforceCacheSizeLimit=function(n){for(const e in Gr)le(e),Gr[e].then(r=>{r.keys().then(s=>{for(let c=0;c<s.length-n;c++)r.delete(s[c])})})},u.evaluateSizeForFeature=Vl,u.evaluateSizeForZoom=Vu,u.evaluateVariableOffset=i_,u.evented=ne,u.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},u.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},u.exported=ci,u.exported$1=Ci,u.extend=gt,u.extend$1=Hr,u.fillExtrusionHeightLift=_d,u.filterObject=at,u.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},u.fromQuat=function(n,e){var r=e[0],s=e[1],c=e[2],f=e[3],m=r+r,y=s+s,b=c+c,w=r*m,S=s*m,R=s*y,k=c*m,N=c*y,G=c*b,q=f*m,ie=f*y,ue=f*b;return n[0]=1-R-G,n[1]=S+ue,n[2]=k-ie,n[3]=0,n[4]=S-ue,n[5]=1-w-G,n[6]=N+q,n[7]=0,n[8]=k+ie,n[9]=N-q,n[10]=1-w-R,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},u.fromRotation=function(n,e){var r=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},u.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},u.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return ut[e]},u.getAABBPointSquareDist=function(n,e,r){let s=0;for(let c=0;c<2;++c){const f=r?r[c]:0;n[c]>f&&(s+=(n[c]-f)*(n[c]-f)),e[c]<f&&(s+=(f-e[c])*(f-e[c]))}return s},u.getAnchorAlignment=Mh,u.getAnchorJustification=Fh,u.getBounds=function(n){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const f of n)e=Math.min(e,f.x),r=Math.min(r,f.y),s=Math.max(s,f.x),c=Math.max(c,f.y);return{min:new nt(e,r),max:new nt(s,c)}},u.getColumn=ki,u.getGridMatrix=function(n,e,r){const[s,c]=e,f=.015625;return[0,(c[1]-s[1])*f,1<<n.z,(c[0]-s[0])/Hu[r],0,n.y,s[0],s[1],f]},u.getImage=Me,u.getJSON=function(n,e){return Oe(gt(n,{type:"json"}),e)},u.getLatitudinalLod=function(n){const e=80.051129;n=Xt(n,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Tt(n))),3);return Math.round(r*(Hu.length-1))},u.getMapSessionAPI=xr,u.getPerformanceMeasurement=An,u.getProjection=m_,u.getRTLTextPluginStatus=Q,u.getReferrer=ze,u.getTilePoint=function(n,{x:e,y:r},s=0){return new nt(((e-s)*n.scale-n.x)*pn,(r*n.scale-n.y)*pn)},u.getTileVec3=function(n,e,r=0){return gh(((e.x-r)*n.scale-n.x)*pn,(e.y*n.scale-n.y)*pn,Wp(e.z,e.y))},u.getVideo=function(n,e){const r=Ae.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<n.length;s++){const c=Ae.document.createElement("source");At(n[s])||(r.crossOrigin="Anonymous"),c.src=n[s],r.appendChild(c)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(n){const e=[0,0,0],r=Qo(new Float64Array(16));return xc(r,n.pixelMatrix,n.globeMatrix),eo(e,e,r),new nt(e[0],e[1])},u.globeECEFOrigin=function(n,e){const r=[0,0,0];return eo(r,r,zh(sl(e.canonical))),eo(r,r,n),r},u.globeNormalizeECEF=zh,u.globePixelsToTileUnits=function(n,e){return pn/(512*Math.pow(2,n))*Zu(sl(e))},u.globePoleMatrixForTile=function(n,e,r){const s=Qo(new Float64Array(16)),c=1<<n,f=360*(e/c-.5),m=r.point,y=r.worldSize/(r.tileSize*c);return Wc(s,s,[m.x,m.y,-r.worldSize/Math.PI/2]),el(s,s,[y,y,y]),ad(s,s,Tt(-r._center.lat)),ld(s,s,Tt(-r._center.lng+f)),Float32Array.from(s)},u.globeTileBounds=sl,u.globeTileLatLngCorners=Fd,u.globeTiltAtLngLat=Gm,u.globeToMercatorTransition=zd,u.globeUseCustomAntiAliasing=function(n,e,r){const s=zd(r.zoom),c=n.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!c&&!m&&f},u.identity=Qo,u.identity$1=dd,u.invert=function(n,e){var r=e[0],s=e[1],c=e[2],f=e[3],m=e[4],y=e[5],b=e[6],w=e[7],S=e[8],R=e[9],k=e[10],N=e[11],G=e[12],q=e[13],ie=e[14],ue=e[15],Ee=r*y-s*m,we=r*b-c*m,Ce=r*w-f*m,Pe=s*b-c*y,Fe=s*w-f*y,Ze=c*w-f*b,Xe=S*q-R*G,ct=S*ie-k*G,yt=S*ue-N*G,Ve=R*ie-k*q,it=R*ue-N*q,xt=k*ue-N*ie,bt=Ee*xt-we*it+Ce*Ve+Pe*yt-Fe*ct+Ze*Xe;return bt?(n[0]=(y*xt-b*it+w*Ve)*(bt=1/bt),n[1]=(c*it-s*xt-f*Ve)*bt,n[2]=(q*Ze-ie*Fe+ue*Pe)*bt,n[3]=(k*Fe-R*Ze-N*Pe)*bt,n[4]=(b*yt-m*xt-w*ct)*bt,n[5]=(r*xt-c*yt+f*ct)*bt,n[6]=(ie*Ce-G*Ze-ue*we)*bt,n[7]=(S*Ze-k*Ce+N*we)*bt,n[8]=(m*it-y*yt+w*Xe)*bt,n[9]=(s*yt-r*it-f*Xe)*bt,n[10]=(G*Fe-q*Ce+ue*Ee)*bt,n[11]=(R*Ce-S*Fe-N*Ee)*bt,n[12]=(y*ct-m*Ve-b*Xe)*bt,n[13]=(r*Ve-s*ct+c*Xe)*bt,n[14]=(q*we-G*Pe-ie*Ee)*bt,n[15]=(S*Pe-R*we+k*Ee)*bt,n):null},u.isLngLatBehindGlobe=function(n,e){return Gm(n,e)>Math.PI/2*1.01},u.isMapAuthenticated=function(n){return Oi.has(n)},u.isMapboxURL=ui,u.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Yr(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=Ai,u.len=ku,u.length=cd,u.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},u.loadVectorTile=bp,u.makeRequest=Oe,u.mapValue=function(n,e,r,s,c){return Xt((n-e)/(r-e)*(c-s)+s,s,c)},u.mercatorXfromLng=_c,u.mercatorYfromLat=Hc,u.mercatorZfromAltitude=Qs,u.mul=Au,u.mul$1=Ey,u.multiply=xc,u.multiply$1=function(n,e,r){var s=e[0],c=e[1],f=e[2],m=e[3],y=e[4],b=e[5],w=e[6],S=e[7],R=e[8],k=r[0],N=r[1],G=r[2],q=r[3],ie=r[4],ue=r[5],Ee=r[6],we=r[7],Ce=r[8];return n[0]=k*s+N*m+G*w,n[1]=k*c+N*y+G*S,n[2]=k*f+N*b+G*R,n[3]=q*s+ie*m+ue*w,n[4]=q*c+ie*y+ue*S,n[5]=q*f+ie*b+ue*R,n[6]=Ee*s+we*m+Ce*w,n[7]=Ee*c+we*y+Ce*S,n[8]=Ee*f+we*b+Ce*R,n},u.multiply$2=ba,u.nextPowerOfTwo=Mn,u.normalize=Fo,u.normalize$1=function(n,e){var r=e[0],s=e[1],c=e[2],f=e[3],m=r*r+s*s+c*c+f*f;return m>0&&(m=1/Math.sqrt(m)),n[0]=r*m,n[1]=s*m,n[2]=c*m,n[3]=f*m,n},u.number=Je,u.ortho=function(n,e,r,s,c,f,m){var y=1/(e-r),b=1/(s-c),w=1/(f-m);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+r)*y,n[13]=(c+s)*b,n[14]=(m+f)*w,n[15]=1,n},u.pbf=Ih,u.perspective=function(n,e,r,s,c){var f,m=1/Math.tan(e/2);return n[0]=m/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=c&&c!==1/0?(n[10]=(c+s)*(f=1/(s-c)),n[14]=2*c*s*f):(n[10]=-1,n[14]=-2*s),n},u.pick=function(n,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in n&&(r[c]=n[c])}return r},u.plugin=ee,u.pointGeometry=nt,u.polygonContainsPoint=zl,u.polygonIntersectsBox=yf,u.polygonIntersectsPolygon=Yp,u.polygonizeBounds=function(n,e,r=0,s=!0){const c=new nt(r,r),f=n.sub(c),m=e.add(c),y=[f,new nt(m.x,f.y),m,new nt(f.x,m.y)];return s&&y.push(f.clone()),y},u.posAttributes=Oh,u.postMapLoadEvent=Pn,u.postTurnstileEvent=Si,u.potpack=km,u.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},u.radToDeg=wn,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(n){return n({pluginStatus:V,pluginURL:H}),ne.on("pluginStateChange",n),n},u.removeAuthState=function(n){Oi.delete(n)},u.renderColorRamp=um,u.resample=nd,u.rotateX=ad,u.rotateX$1=am,u.rotateY=ld,u.rotateY$1=lm,u.rotateZ=function(n,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[0],m=e[1],y=e[2],b=e[3],w=e[4],S=e[5],R=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*c+w*s,n[1]=m*c+S*s,n[2]=y*c+R*s,n[3]=b*c+k*s,n[4]=w*c-f*s,n[5]=S*c-m*s,n[6]=R*c-y*s,n[7]=k*c-b*s,n},u.rotateZ$1=function(n,e,r){r*=.5;var s=e[0],c=e[1],f=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return n[0]=s*b+c*y,n[1]=c*b-s*y,n[2]=f*b+m*y,n[3]=m*b-f*y,n},u.scale=el,u.scale$1=hd,u.scale$2=tl,u.scaleAndAdd=_h,u.setCacheLimits=function(n,e){In=n,po=e},u.setColumn=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},u.setRTLTextPlugin=function(n,e,r=!1){if(V===E||V===I||V===A)throw new Error("setRTLTextPlugin cannot be called multiple times.");H=ci.resolveURL(n),V=E,O=e,te(),r||_e()},u.smoothstep=Hn,u.spec=ke,u.storeAuthState=function(n,e){e?Oi.add(n):Oi.delete(n)},u.sub=Ps,u.subtract=om,u.symbolSize=Im,u.tileAABB=function(n,e,r,s,c,f,m,y,b){if("globe"===b.name)return function jm(n,e,r){const s=e/n.worldSize,c=Number.MAX_VALUE,f=[-c,-c,-c],m=[c,c,c],y=Qo(new Float64Array(16));if(el(y,y,[s,s,s]),xc(y,y,n.globeMatrix),r.z<=1){const Ve=sl(r).getCorners();for(let it=0;it<Ve.length;it++)eo(Ve[it],Ve[it],y),Pu(m,m,Ve[it]),Ru(f,f,Ve[it]);return new Rs(m,f)}const[b,w]=Fd(r),S=new gc;S.setSouthWest([b[1],w[0]]),S.setNorthEast([w[1],b[0]]);const R=[co(S.getSouth(),S.getWest()),co(S.getSouth(),S.getEast()),co(S.getNorth(),S.getEast()),co(S.getNorth(),S.getWest())];for(let Ve=0;Ve<R.length;Ve++)eo(R[Ve],R[Ve],y),Pu(m,m,R[Ve]),Ru(f,f,R[Ve]);if(S.contains(n.center)){f[2]=0;const Ve=n.point,it=[Ve.x*s,Ve.y*s,0];return Pu(m,m,it),Ru(f,f,it),new Rs(m,f)}const k=[y[12],y[13],y[14]],N=n.center.lng,G=Xt(n.center.lat,-85.051129,Fl),q=[_c(N),Hc(G)],ie=S.getCenter().lng,ue=Xt(S.getCenter().lat,-85.051129,Fl),Ee=[_c(ie),Hc(ue)];let we=new Array(3),Ce=0,Pe=q[0]-Ee[0];const Fe=q[1]-Ee[1];if(Pe>.5?Pe-=1:Pe<-.5&&(Pe+=1),Math.abs(Pe)>Math.abs(Fe))Ce=Pe>=0?1:3,we=k;else{Ce=Fe>=0?0:2;const Ve=[y[4],y[5],y[6]];let it;it=Fe>=0?-Math.sin(Tt(S.getSouth()))*Sc:-Math.sin(Tt(S.getNorth()))*Sc,we=_h(we,k,Ve,it)}const Ze=R[Ce],Xe=R[(Ce+1)%4],ct=new Ld(Ze,Xe,we),yt=[tu(ct,0)||Ze[0],tu(ct,1)||Ze[1],tu(ct,2)||Ze[2]];return m[2]=Math.min(Ze[2],Xe[2]),Pu(m,m,yt),Ru(f,f,yt),new Rs(m,f)}(n,e,new yd(r,s,c));const w=nu({z:r,x:s,y:c},b);return new Rs([(f+w.x/w.scale)*e,e*(w.y/w.scale),m],[(f+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},u.tileTransform=nu,u.transformMat3=function(n,e,r){var s=e[0],c=e[1],f=e[2];return n[0]=s*r[0]+c*r[3]+f*r[6],n[1]=s*r[1]+c*r[4]+f*r[7],n[2]=s*r[2]+c*r[5]+f*r[8],n},u.transformMat4=eo,u.transformMat4$1=bc,u.transformQuat=ud,u.translate=Wc,u.transpose=function(n,e){if(n===e){var r=e[1],s=e[2],c=e[5];n[1]=e[3],n[2]=e[6],n[3]=r,n[5]=e[7],n[6]=s,n[7]=c}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},u.triggerPluginCompletionEvent=W,u.uniqueId=wt,u.updateGlobeVertexNormal=function(n,e,r,s,c){const f=5*e+2;n.float32[f+0]=r,n.float32[f+1]=s,n.float32[f+2]=c},u.validateCustomStyleLayer=function(n){const e=[],r=n.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFilter=n=>Xo(Hs(n)),u.validateFog=n=>Xo(Tu(n)),u.validateLayer=n=>Xo(zc(n)),u.validateLight=n=>Xo(ga(n)),u.validateSource=n=>Xo(sh(n)),u.validateStyle=Bc,u.validateTerrain=n=>Xo(Ws(n)),u.values=Nt,u.vectorTile=Ec,u.version="2.9.2",u.warnOnce=fn,u.window=Ae,u.wrap=Zt}),re(0,function(u){function Ae(le){if("number"==typeof le||"boolean"==typeof le||"string"==typeof le||null==le)return JSON.stringify(le);if(Array.isArray(le)){let Z="[";for(const ce of le)Z+=`${Ae(ce)},`;return`${Z}]`}let $="{";for(const Z of Object.keys(le).sort())$+=`${Z}:${Ae(le[Z])},`;return`${$}}`}function hn(le){let $="";for(const Z of u.refProperties)$+=`/${Ae(le[Z])}`;return $}class jt{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,Z){for(const ye of $)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=u.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of Z)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ce=function(ye,Te){const ze={};for(let Ie=0;Ie<ye.length;Ie++){const Ne=Te&&Te[ye[Ie].id]||hn(ye[Ie]);Te&&(Te[ye[Ie].id]=Ne);let tt=ze[Ne];tt||(tt=ze[Ne]=[]),tt.push(ye[Ie])}const Oe=[];for(const Ie in ze)Oe.push(ze[Ie]);return Oe}(u.values(this._layerConfigs),this.keyCache);for(const ye of ce){const Te=ye.map(At=>this._layers[At.id]),ze=Te[0];if("none"===ze.visibility)continue;const Oe=ze.source||"";let Ie=this.familiesBySource[Oe];Ie||(Ie=this.familiesBySource[Oe]={});const Ne=ze.sourceLayer||"_geojsonTileLayer";let tt=Ie[Ne];tt||(tt=Ie[Ne]=[]),tt.push(Te)}}}class nt{loadTile($,Z){const{uid:ce,encoding:ye,rawImageData:Te,padding:ze,buildQuadTree:Oe}=$,Ie=u.window.ImageBitmap&&Te instanceof u.window.ImageBitmap?this.getImageData(Te,ze):Te;Z(null,new u.DEMData(ce,Ie,ye,ze<1,Oe))}getImageData($,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const ce=this.offscreenCanvasContext.getImageData(-Z,-Z,$.width+2*Z,$.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}var Mt=function le($,Z){var ce,ye=$&&$.type;if("FeatureCollection"===ye)for(ce=0;ce<$.features.length;ce++)le($.features[ce],Z);else if("GeometryCollection"===ye)for(ce=0;ce<$.geometries.length;ce++)le($.geometries[ce],Z);else if("Feature"===ye)le($.geometry,Z);else if("Polygon"===ye)Ct($.coordinates,Z);else if("MultiPolygon"===ye)for(ce=0;ce<$.coordinates.length;ce++)Ct($.coordinates[ce],Z);return $};function Ct(le,$){if(0!==le.length){ft(le[0],$);for(var Z=1;Z<le.length;Z++)ft(le[Z],!$)}}function ft(le,$){for(var Z=0,ce=0,ye=0,Te=le.length,ze=Te-1;ye<Te;ze=ye++){var Oe=(le[ye][0]-le[ze][0])*(le[ze][1]+le[ye][1]),Ie=Z+Oe;ce+=Math.abs(Z)>=Math.abs(Oe)?Z-Ie+Oe:Oe-Ie+Z,Z=Ie}Z+ce>=0!=!!$&&le.reverse()}const Tt=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;class wn{constructor($){this._feature=$,this.extent=u.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))}loadGeometry(){if(1===this._feature.type){const $=[];for(const Z of this._feature.geometry)$.push([new u.pointGeometry(Z[0],Z[1])]);return $}{const $=[];for(const Z of this._feature.geometry){const ce=[];for(const ye of Z)ce.push(new u.pointGeometry(ye[0],ye[1]));$.push(ce)}return $}}toGeoJSON($,Z,ce){return Tt.call(this,$,Z,ce)}}class ut{constructor($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=$.length,this._features=$}feature($){return new wn(this._features[$])}}var bn=u.vectorTile.VectorTileFeature,dt=dn;function dn(le,$){this.options=$||{},this.features=le,this.length=le.length}function Xt(le,$){this.id="number"==typeof le.id?le.id:void 0,this.type=le.type,this.rawGeometry=1===le.type?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=$||4096}dn.prototype.feature=function(le){return new Xt(this.features[le],this.options.extent)},Xt.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var $=0;$<le.length;$++){for(var Z=le[$],ce=[],ye=0;ye<Z.length;ye++)ce.push(new u.pointGeometry(Z[ye][0],Z[ye][1]));this.geometry.push(ce)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,$=1/0,Z=-1/0,ce=1/0,ye=-1/0,Te=0;Te<le.length;Te++)for(var ze=le[Te],Oe=0;Oe<ze.length;Oe++){var Ie=ze[Oe];$=Math.min($,Ie.x),Z=Math.max(Z,Ie.x),ce=Math.min(ce,Ie.y),ye=Math.max(ye,Ie.y)}return[$,ce,Z,ye]},Xt.prototype.toGeoJSON=bn.prototype.toGeoJSON;var Hn=Bt,Zt=dt;function Bt(le){var $=new u.pbf;return function(Z,ce){for(var ye in Z.layers)ce.writeMessage(3,Nt,Z.layers[ye])}(le,$),$.finish()}function Nt(le,$){var Z;$.writeVarintField(15,le.version||1),$.writeStringField(1,le.name||""),$.writeVarintField(5,le.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<le.length;Z++)ce.feature=le.feature(Z),$.writeMessage(2,gt,ce);var ye=ce.keys;for(Z=0;Z<ye.length;Z++)$.writeStringField(3,ye[Z]);var Te=ce.values;for(Z=0;Z<Te.length;Z++)$.writeMessage(4,qe,Te[Z])}function gt(le,$){var Z=le.feature;void 0!==Z.id&&$.writeVarintField(1,Z.id),$.writeMessage(2,rr,le),$.writeVarintField(3,Z.type),$.writeMessage(4,Mn,Z)}function rr(le,$){var Z=le.feature,ce=le.keys,ye=le.values,Te=le.keycache,ze=le.valuecache;for(var Oe in Z.properties){var Ie=Z.properties[Oe],Ne=Te[Oe];if(null!==Ie){void 0===Ne&&(ce.push(Oe),Te[Oe]=Ne=ce.length-1),$.writeVarint(Ne);var tt=typeof Ie;"string"!==tt&&"boolean"!==tt&&"number"!==tt&&(Ie=JSON.stringify(Ie));var At=tt+":"+Ie,ve=ze[At];void 0===ve&&(ye.push(Ie),ze[At]=ve=ye.length-1),$.writeVarint(ve)}}}function wt(le,$){return($<<3)+(7&le)}function Ft(le){return le<<1^le>>31}function Mn(le,$){for(var Z=le.loadGeometry(),ce=le.type,ye=0,Te=0,ze=Z.length,Oe=0;Oe<ze;Oe++){var Ie=Z[Oe],Ne=1;1===ce&&(Ne=Ie.length),$.writeVarint(wt(1,Ne));for(var tt=3===ce?Ie.length-1:Ie.length,At=0;At<tt;At++){1===At&&1!==ce&&$.writeVarint(wt(2,tt-1));var ve=Ie[At].x-ye,he=Ie[At].y-Te;$.writeVarint(Ft(ve)),$.writeVarint(Ft(he)),ye+=ve,Te+=he}3===ce&&$.writeVarint(wt(7,1))}}function qe(le,$){var Z=typeof le;"string"===Z?$.writeStringField(1,le):"boolean"===Z?$.writeBooleanField(7,le):"number"===Z&&(le%1!=0?$.writeDoubleField(3,le):le<0?$.writeSVarintField(6,le):$.writeVarintField(5,le))}function Ke(le,$,Z,ce,ye,Te){if(ye-ce<=Z)return;const ze=ce+ye>>1;Qe(le,$,ze,ce,ye,Te%2),Ke(le,$,Z,ce,ze-1,Te+1),Ke(le,$,Z,ze+1,ye,Te+1)}function Qe(le,$,Z,ce,ye,Te){for(;ye>ce;){if(ye-ce>600){const Ne=ye-ce+1,tt=Z-ce+1,At=Math.log(Ne),ve=.5*Math.exp(2*At/3),he=.5*Math.sqrt(At*ve*(Ne-ve)/Ne)*(tt-Ne/2<0?-1:1);Qe(le,$,Z,Math.max(ce,Math.floor(Z-tt*ve/Ne+he)),Math.min(ye,Math.floor(Z+(Ne-tt)*ve/Ne+he)),Te)}const ze=$[2*Z+Te];let Oe=ce,Ie=ye;for(ot(le,$,ce,Z),$[2*ye+Te]>ze&&ot(le,$,ce,ye);Oe<Ie;){for(ot(le,$,Oe,Ie),Oe++,Ie--;$[2*Oe+Te]<ze;)Oe++;for(;$[2*Ie+Te]>ze;)Ie--}$[2*ce+Te]===ze?ot(le,$,ce,Ie):(Ie++,ot(le,$,Ie,ye)),Ie<=Z&&(ce=Ie+1),Z<=Ie&&(ye=Ie-1)}}function ot(le,$,Z,ce){at(le,Z,ce),at($,2*Z,2*ce),at($,2*Z+1,2*ce+1)}function at(le,$,Z){const ce=le[$];le[$]=le[Z],le[Z]=ce}function Rt(le,$,Z,ce){const ye=le-Z,Te=$-ce;return ye*ye+Te*Te}Hn.fromVectorTileJs=Bt,Hn.fromGeojsonVt=function(le,$){$=$||{};var Z={};for(var ce in le)Z[ce]=new dt(le[ce].features,$),Z[ce].name=ce,Z[ce].version=$.version,Z[ce].extent=$.extent;return Bt({layers:Z})},Hn.GeoJSONWrapper=Zt;const Ln=le=>le[0],fn=le=>le[1];class Zn{constructor($,Z=Ln,ce=fn,ye=64,Te=Float64Array){this.nodeSize=ye,this.points=$;const ze=$.length<65536?Uint16Array:Uint32Array,Oe=this.ids=new ze($.length),Ie=this.coords=new Te(2*$.length);for(let Ne=0;Ne<$.length;Ne++)Oe[Ne]=Ne,Ie[2*Ne]=Z($[Ne]),Ie[2*Ne+1]=ce($[Ne]);Ke(Oe,Ie,ye,0,Oe.length-1,0)}range($,Z,ce,ye){return function(Te,ze,Oe,Ie,Ne,tt,At){const ve=[0,Te.length-1,0],he=[];let se,Me;for(;ve.length;){const Ue=ve.pop(),Et=ve.pop(),rt=ve.pop();if(Et-rt<=At){for(let ke=rt;ke<=Et;ke++)se=ze[2*ke],Me=ze[2*ke+1],se>=Oe&&se<=Ne&&Me>=Ie&&Me<=tt&&he.push(Te[ke]);continue}const $t=Math.floor((rt+Et)/2);se=ze[2*$t],Me=ze[2*$t+1],se>=Oe&&se<=Ne&&Me>=Ie&&Me<=tt&&he.push(Te[$t]);const nn=(Ue+1)%2;(0===Ue?Oe<=se:Ie<=Me)&&(ve.push(rt),ve.push($t-1),ve.push(nn)),(0===Ue?Ne>=se:tt>=Me)&&(ve.push($t+1),ve.push(Et),ve.push(nn))}return he}(this.ids,this.coords,$,Z,ce,ye,this.nodeSize)}within($,Z,ce){return function(ye,Te,ze,Oe,Ie,Ne){const tt=[0,ye.length-1,0],At=[],ve=Ie*Ie;for(;tt.length;){const he=tt.pop(),se=tt.pop(),Me=tt.pop();if(se-Me<=Ne){for(let nn=Me;nn<=se;nn++)Rt(Te[2*nn],Te[2*nn+1],ze,Oe)<=ve&&At.push(ye[nn]);continue}const Ue=Math.floor((Me+se)/2),Et=Te[2*Ue],rt=Te[2*Ue+1];Rt(Et,rt,ze,Oe)<=ve&&At.push(ye[Ue]);const $t=(he+1)%2;(0===he?ze-Ie<=Et:Oe-Ie<=rt)&&(tt.push(Me),tt.push(Ue-1),tt.push($t)),(0===he?ze+Ie>=Et:Oe+Ie>=rt)&&(tt.push(Ue+1),tt.push(se),tt.push($t))}return At}(this.ids,this.coords,$,Z,ce,this.nodeSize)}}const Dn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},_r=Math.fround||(jr=new Float32Array(1),le=>(jr[0]=+le,jr[0]));var jr;class ir{constructor($){this.options=io(Object.create(Dn),$),this.trees=new Array(this.options.maxZoom+1)}load($){const{log:Z,minZoom:ce,maxZoom:ye,nodeSize:Te}=this.options;Z&&console.time("total time");const ze=`prepare ${$.length} points`;Z&&console.time(ze),this.points=$;let Oe=[];for(let Ie=0;Ie<$.length;Ie++)$[Ie].geometry&&Oe.push(Ri($[Ie],Ie));this.trees[ye+1]=new Zn(Oe,Sr,oo,Te,Float32Array),Z&&console.timeEnd(ze);for(let Ie=ye;Ie>=ce;Ie--){const Ne=+Date.now();Oe=this._cluster(Oe,Ie),this.trees[Ie]=new Zn(Oe,Sr,oo,Te,Float32Array),Z&&console.log("z%d: %d clusters in %dms",Ie,Oe.length,+Date.now()-Ne)}return Z&&console.timeEnd("total time"),this}getClusters($,Z){let ce=(($[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,$[1]));let Te=180===$[2]?180:(($[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)ce=-180,Te=180;else if(ce>Te){const tt=this.getClusters([ce,ye,180,ze],Z),At=this.getClusters([-180,ye,Te,ze],Z);return tt.concat(At)}const Oe=this.trees[this._limitZoom(Z)],Ie=Oe.range(An(ce),Li(ze),An(Te),Li(ye)),Ne=[];for(const tt of Ie){const At=Oe.points[tt];Ne.push(At.numPoints?ki(At):this.points[At.index])}return Ne}getChildren($){const Z=this._getOriginId($),ce=this._getOriginZoom($),ye="No cluster with the specified id.",Te=this.trees[ce];if(!Te)throw new Error(ye);const ze=Te.points[Z];if(!ze)throw new Error(ye);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ie=Te.within(ze.x,ze.y,Oe),Ne=[];for(const tt of Ie){const At=Te.points[tt];At.parentId===$&&Ne.push(At.numPoints?ki(At):this.points[At.index])}if(0===Ne.length)throw new Error(ye);return Ne}getLeaves($,Z,ce){const ye=[];return this._appendLeaves(ye,$,Z=Z||10,ce=ce||0,0),ye}getTile($,Z,ce){const ye=this.trees[this._limitZoom($)],Te=Math.pow(2,$),{extent:ze,radius:Oe}=this.options,Ie=Oe/ze,Ne=(ce-Ie)/Te,tt=(ce+1+Ie)/Te,At={features:[]};return this._addTileFeatures(ye.range((Z-Ie)/Te,Ne,(Z+1+Ie)/Te,tt),ye.points,Z,ce,Te,At),0===Z&&this._addTileFeatures(ye.range(1-Ie/Te,Ne,1,tt),ye.points,Te,ce,Te,At),Z===Te-1&&this._addTileFeatures(ye.range(0,Ne,Ie/Te,tt),ye.points,-1,ce,Te,At),At.features.length?At:null}getClusterExpansionZoom($){let Z=this._getOriginZoom($)-1;for(;Z<=this.options.maxZoom;){const ce=this.getChildren($);if(Z++,1!==ce.length)break;$=ce[0].properties.cluster_id}return Z}_appendLeaves($,Z,ce,ye,Te){const ze=this.getChildren(Z);for(const Oe of ze){const Ie=Oe.properties;if(Ie&&Ie.cluster?Te+Ie.point_count<=ye?Te+=Ie.point_count:Te=this._appendLeaves($,Ie.cluster_id,ce,ye,Te):Te<ye?Te++:$.push(Oe),$.length===ce)break}return Te}_addTileFeatures($,Z,ce,ye,Te,ze){for(const Oe of $){const Ie=Z[Oe],Ne=Ie.numPoints;let tt,At,ve;if(Ne)tt=dr(Ie),At=Ie.x,ve=Ie.y;else{const Me=this.points[Ie.index];tt=Me.properties,At=An(Me.geometry.coordinates[0]),ve=Li(Me.geometry.coordinates[1])}const he={type:1,geometry:[[Math.round(this.options.extent*(At*Te-ce)),Math.round(this.options.extent*(ve*Te-ye))]],tags:tt};let se;Ne?se=Ie.id:this.options.generateId?se=Ie.index:this.points[Ie.index].id&&(se=this.points[Ie.index].id),void 0!==se&&(he.id=se),ze.features.push(he)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))}_cluster($,Z){const ce=[],{radius:ye,extent:Te,reduce:ze,minPoints:Oe}=this.options,Ie=ye/(Te*Math.pow(2,Z));for(let Ne=0;Ne<$.length;Ne++){const tt=$[Ne];if(tt.zoom<=Z)continue;tt.zoom=Z;const At=this.trees[Z+1],ve=At.within(tt.x,tt.y,Ie),he=tt.numPoints||1;let se=he;for(const Me of ve){const Ue=At.points[Me];Ue.zoom>Z&&(se+=Ue.numPoints||1)}if(se>he&&se>=Oe){let Me=tt.x*he,Ue=tt.y*he,Et=ze&&he>1?this._map(tt,!0):null;const rt=(Ne<<5)+(Z+1)+this.points.length;for(const $t of ve){const nn=At.points[$t];if(nn.zoom<=Z)continue;nn.zoom=Z;const ke=nn.numPoints||1;Me+=nn.x*ke,Ue+=nn.y*ke,nn.parentId=rt,ze&&(Et||(Et=this._map(tt,!0)),ze(Et,this._map(nn)))}tt.parentId=rt,ce.push(Yr(Me/se,Ue/se,rt,se,Et))}else if(ce.push(tt),se>1)for(const Me of ve){const Ue=At.points[Me];Ue.zoom<=Z||(Ue.zoom=Z,ce.push(Ue))}}return ce}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,Z){if($.numPoints)return Z?io({},$.properties):$.properties;const ce=this.points[$.index].properties,ye=this.options.map(ce);return Z&&ye===ce?io({},ye):ye}}function Yr(le,$,Z,ce,ye){return{x:_r(le),y:_r($),zoom:1/0,id:Z,parentId:-1,numPoints:ce,properties:ye}}function Ri(le,$){const[Z,ce]=le.geometry.coordinates;return{x:_r(An(Z)),y:_r(Li(ce)),zoom:1/0,index:$,parentId:-1}}function ki(le){return{type:"Feature",id:le.id,properties:dr(le),geometry:{type:"Point",coordinates:[($=le.x,360*($-.5)),En(le.y)]}};var $}function dr(le){const $=le.numPoints,Z=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$;return io(io({},le.properties),{cluster:!0,cluster_id:le.id,point_count:$,point_count_abbreviated:Z})}function An(le){return le/360+.5}function Li(le){const $=Math.sin(le*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function En(le){const $=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function io(le,$){for(const Z in $)le[Z]=$[Z];return le}function Sr(le){return le.x}function oo(le){return le.y}function ci(le,$,Z,ce){for(var ye,Te=ce,ze=Z-$>>1,Oe=Z-$,Ie=le[$],Ne=le[$+1],tt=le[Z],At=le[Z+1],ve=$+3;ve<Z;ve+=3){var he=Xi(le[ve],le[ve+1],Ie,Ne,tt,At);if(he>Te)ye=ve,Te=he;else if(he===Te){var se=Math.abs(ve-ze);se<Oe&&(ye=ve,Oe=se)}}Te>ce&&(ye-$>3&&ci(le,$,ye,ce),le[ye+2]=Te,Z-ye>3&&ci(le,ye,Z,ce))}function Xi(le,$,Z,ce,ye,Te){var ze=ye-Z,Oe=Te-ce;if(0!==ze||0!==Oe){var Ie=((le-Z)*ze+($-ce)*Oe)/(ze*ze+Oe*Oe);Ie>1?(Z=ye,ce=Te):Ie>0&&(Z+=ze*Ie,ce+=Oe*Ie)}return(ze=le-Z)*ze+(Oe=$-ce)*Oe}function Vn(le,$,Z,ce){var ye={id:void 0===le?null:le,type:$,geometry:Z,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var ze=Te.geometry,Oe=Te.type;if("Point"===Oe||"MultiPoint"===Oe||"LineString"===Oe)Ci(Te,ze);else if("Polygon"===Oe||"MultiLineString"===Oe)for(var Ie=0;Ie<ze.length;Ie++)Ci(Te,ze[Ie]);else if("MultiPolygon"===Oe)for(Ie=0;Ie<ze.length;Ie++)for(var Ne=0;Ne<ze[Ie].length;Ne++)Ci(Te,ze[Ie][Ne])}(ye),ye}function Ci(le,$){for(var Z=0;Z<$.length;Z+=3)le.minX=Math.min(le.minX,$[Z]),le.minY=Math.min(le.minY,$[Z+1]),le.maxX=Math.max(le.maxX,$[Z]),le.maxY=Math.max(le.maxY,$[Z+1])}function Yn(le,$,Z,ce){if($.geometry){var ye=$.geometry.coordinates,Te=$.geometry.type,ze=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Oe=[],Ie=$.id;if(Z.promoteId?Ie=$.properties[Z.promoteId]:Z.generateId&&(Ie=ce||0),"Point"===Te)Fi(ye,Oe);else if("MultiPoint"===Te)for(var Ne=0;Ne<ye.length;Ne++)Fi(ye[Ne],Oe);else if("LineString"===Te)$i(ye,Oe,ze,!1);else if("MultiLineString"===Te){if(Z.lineMetrics){for(Ne=0;Ne<ye.length;Ne++)$i(ye[Ne],Oe=[],ze,!1),le.push(Vn(Ie,"LineString",Oe,$.properties));return}Bo(ye,Oe,ze,!1)}else if("Polygon"===Te)Bo(ye,Oe,ze,!0);else{if("MultiPolygon"!==Te){if("GeometryCollection"===Te){for(Ne=0;Ne<$.geometry.geometries.length;Ne++)Yn(le,{id:Ie,geometry:$.geometry.geometries[Ne],properties:$.properties},Z,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ne=0;Ne<ye.length;Ne++){var tt=[];Bo(ye[Ne],tt,ze,!0),Oe.push(tt)}}le.push(Vn(Ie,Te,Oe,$.properties))}}function Fi(le,$){$.push(Ii(le[0])),$.push(ts(le[1])),$.push(0)}function $i(le,$,Z,ce){for(var ye,Te,ze=0,Oe=0;Oe<le.length;Oe++){var Ie=Ii(le[Oe][0]),Ne=ts(le[Oe][1]);$.push(Ie),$.push(Ne),$.push(0),Oe>0&&(ze+=ce?(ye*Ne-Ie*Te)/2:Math.sqrt(Math.pow(Ie-ye,2)+Math.pow(Ne-Te,2))),ye=Ie,Te=Ne}var tt=$.length-3;$[2]=1,ci($,0,tt,Z),$[tt+2]=1,$.size=Math.abs(ze),$.start=0,$.end=$.size}function Bo(le,$,Z,ce){for(var ye=0;ye<le.length;ye++){var Te=[];$i(le[ye],Te,Z,ce),$.push(Te)}}function Ii(le){return le/360+.5}function ts(le){var $=Math.sin(le*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Jt(le,$,Z,ce,ye,Te,ze,Oe){if(ce/=$,Te>=(Z/=$)&&ze<ce)return le;if(ze<Z||Te>=ce)return null;for(var Ie=[],Ne=0;Ne<le.length;Ne++){var tt=le[Ne],At=tt.geometry,ve=tt.type,he=0===ye?tt.minX:tt.minY,se=0===ye?tt.maxX:tt.maxY;if(he>=Z&&se<ce)Ie.push(tt);else if(!(se<Z||he>=ce)){var Me=[];if("Point"===ve||"MultiPoint"===ve)ui(At,Me,Z,ce,ye);else if("LineString"===ve)vr(At,Me,Z,ce,ye,!1,Oe.lineMetrics);else if("MultiLineString"===ve)gn(At,Me,Z,ce,ye,!1);else if("Polygon"===ve)gn(At,Me,Z,ce,ye,!0);else if("MultiPolygon"===ve)for(var Ue=0;Ue<At.length;Ue++){var Et=[];gn(At[Ue],Et,Z,ce,ye,!0),Et.length&&Me.push(Et)}if(Me.length){if(Oe.lineMetrics&&"LineString"===ve){for(Ue=0;Ue<Me.length;Ue++)Ie.push(Vn(tt.id,ve,Me[Ue],tt.tags));continue}"LineString"!==ve&&"MultiLineString"!==ve||(1===Me.length?(ve="LineString",Me=Me[0]):ve="MultiLineString"),"Point"!==ve&&"MultiPoint"!==ve||(ve=3===Me.length?"Point":"MultiPoint"),Ie.push(Vn(tt.id,ve,Me,tt.tags))}}}return Ie.length?Ie:null}function ui(le,$,Z,ce,ye){for(var Te=0;Te<le.length;Te+=3){var ze=le[Te+ye];ze>=Z&&ze<=ce&&($.push(le[Te]),$.push(le[Te+1]),$.push(le[Te+2]))}}function vr(le,$,Z,ce,ye,Te,ze){for(var Oe,Ie,Ne=an(le),tt=0===ye?mi:ar,At=le.start,ve=0;ve<le.length-3;ve+=3){var he=le[ve],se=le[ve+1],Me=le[ve+2],Ue=le[ve+3],Et=le[ve+4],rt=0===ye?he:se,$t=0===ye?Ue:Et,nn=!1;ze&&(Oe=Math.sqrt(Math.pow(he-Ue,2)+Math.pow(se-Et,2))),rt<Z?$t>Z&&(Ie=tt(Ne,he,se,Ue,Et,Z),ze&&(Ne.start=At+Oe*Ie)):rt>ce?$t<ce&&(Ie=tt(Ne,he,se,Ue,Et,ce),ze&&(Ne.start=At+Oe*Ie)):No(Ne,he,se,Me),$t<Z&&rt>=Z&&(Ie=tt(Ne,he,se,Ue,Et,Z),nn=!0),$t>ce&&rt<=ce&&(Ie=tt(Ne,he,se,Ue,Et,ce),nn=!0),!Te&&nn&&(ze&&(Ne.end=At+Oe*Ie),$.push(Ne),Ne=an(le)),ze&&(At+=Oe)}var ke=le.length-3;he=le[ke],se=le[ke+1],Me=le[ke+2],(rt=0===ye?he:se)>=Z&&rt<=ce&&No(Ne,he,se,Me),ke=Ne.length-3,Te&&ke>=3&&(Ne[ke]!==Ne[0]||Ne[ke+1]!==Ne[1])&&No(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&$.push(Ne)}function an(le){var $=[];return $.size=le.size,$.start=le.start,$.end=le.end,$}function gn(le,$,Z,ce,ye,Te){for(var ze=0;ze<le.length;ze++)vr(le[ze],$,Z,ce,ye,Te,!1)}function No(le,$,Z,ce){le.push($),le.push(Z),le.push(ce)}function mi(le,$,Z,ce,ye,Te){var ze=(Te-$)/(ce-$);return le.push(Te),le.push(Z+(ye-Z)*ze),le.push(1),ze}function ar(le,$,Z,ce,ye,Te){var ze=(Te-Z)/(ye-Z);return le.push($+(ce-$)*ze),le.push(Te),le.push(1),ze}function Uo(le,$){for(var Z=[],ce=0;ce<le.length;ce++){var ye,Te=le[ce],ze=Te.type;if("Point"===ze||"MultiPoint"===ze||"LineString"===ze)ye=Si(Te.geometry,$);else if("MultiLineString"===ze||"Polygon"===ze){ye=[];for(var Oe=0;Oe<Te.geometry.length;Oe++)ye.push(Si(Te.geometry[Oe],$))}else if("MultiPolygon"===ze)for(ye=[],Oe=0;Oe<Te.geometry.length;Oe++){for(var Ie=[],Ne=0;Ne<Te.geometry[Oe].length;Ne++)Ie.push(Si(Te.geometry[Oe][Ne],$));ye.push(Ie)}Z.push(Vn(Te.id,ze,ye,Te.tags))}return Z}function Si(le,$){var Z=[];Z.size=le.size,void 0!==le.start&&(Z.start=le.start,Z.end=le.end);for(var ce=0;ce<le.length;ce+=3)Z.push(le[ce]+$,le[ce+1],le[ce+2]);return Z}function gi(le,$){if(le.transformed)return le;var Z,ce,ye,Te=1<<le.z,ze=le.x,Oe=le.y;for(Z=0;Z<le.features.length;Z++){var Ie=le.features[Z],Ne=Ie.geometry,tt=Ie.type;if(Ie.geometry=[],1===tt)for(ce=0;ce<Ne.length;ce+=2)Ie.geometry.push(Pn(Ne[ce],Ne[ce+1],$,Te,ze,Oe));else for(ce=0;ce<Ne.length;ce++){var At=[];for(ye=0;ye<Ne[ce].length;ye+=2)At.push(Pn(Ne[ce][ye],Ne[ce][ye+1],$,Te,ze,Oe));Ie.geometry.push(At)}}return le.transformed=!0,le}function Pn(le,$,Z,ce,ye,Te){return[Math.round(Z*(le*ce-ye)),Math.round(Z*($*ce-Te))]}function Aa(le,$,Z,ce,ye){for(var Te=$===ye.maxZoom?0:ye.tolerance/((1<<$)*ye.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ce,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Oe=0;Oe<le.length;Oe++){ze.numFeatures++,xr(ze,le[Oe],Te,ye);var Ie=le[Oe].minX,Ne=le[Oe].minY,tt=le[Oe].maxX,At=le[Oe].maxY;Ie<ze.minX&&(ze.minX=Ie),Ne<ze.minY&&(ze.minY=Ne),tt>ze.maxX&&(ze.maxX=tt),At>ze.maxY&&(ze.maxY=At)}return ze}function xr(le,$,Z,ce){var ye=$.geometry,Te=$.type,ze=[];if("Point"===Te||"MultiPoint"===Te)for(var Oe=0;Oe<ye.length;Oe+=3)ze.push(ye[Oe]),ze.push(ye[Oe+1]),le.numPoints++,le.numSimplified++;else if("LineString"===Te)Oi(ze,ye,le,Z,!1,!1);else if("MultiLineString"===Te||"Polygon"===Te)for(Oe=0;Oe<ye.length;Oe++)Oi(ze,ye[Oe],le,Z,"Polygon"===Te,0===Oe);else if("MultiPolygon"===Te)for(var Ie=0;Ie<ye.length;Ie++){var Ne=ye[Ie];for(Oe=0;Oe<Ne.length;Oe++)Oi(ze,Ne[Oe],le,Z,!0,0===Oe)}if(ze.length){var tt=$.tags||null;if("LineString"===Te&&ce.lineMetrics){for(var At in tt={},$.tags)tt[At]=$.tags[At];tt.mapbox_clip_start=ye.start/ye.size,tt.mapbox_clip_end=ye.end/ye.size}var ve={geometry:ze,type:"Polygon"===Te||"MultiPolygon"===Te?3:"LineString"===Te||"MultiLineString"===Te?2:1,tags:tt};null!==$.id&&(ve.id=$.id),le.features.push(ve)}}function Oi(le,$,Z,ce,ye,Te){var ze=ce*ce;if(ce>0&&$.size<(ye?ze:ce))Z.numPoints+=$.length/3;else{for(var Oe=[],Ie=0;Ie<$.length;Ie+=3)(0===ce||$[Ie+2]>ze)&&(Z.numSimplified++,Oe.push($[Ie]),Oe.push($[Ie+1])),Z.numPoints++;ye&&function(Ne,tt){for(var At=0,ve=0,he=Ne.length,se=he-2;ve<he;se=ve,ve+=2)At+=(Ne[ve]-Ne[se])*(Ne[ve+1]+Ne[se+1]);if(At>0===tt)for(ve=0,he=Ne.length;ve<he/2;ve+=2){var Me=Ne[ve],Ue=Ne[ve+1];Ne[ve]=Ne[he-2-ve],Ne[ve+1]=Ne[he-1-ve],Ne[he-2-ve]=Me,Ne[he-1-ve]=Ue}}(Oe,Te),le.push(Oe)}}function Fn(le,$){var Z=($=this.options=function(ye,Te){for(var ze in Te)ye[ze]=Te[ze];return ye}(Object.create(this.options),$)).debug;if(Z&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye,Te,ze,Oe,Ie,Ne,ce=function(ye,Te){var ze=[];if("FeatureCollection"===ye.type)for(var Oe=0;Oe<ye.features.length;Oe++)Yn(ze,ye.features[Oe],Te,Oe);else Yn(ze,"Feature"===ye.type?ye:{geometry:ye},Te);return ze}(le,$);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=ce,Te=$,ze=Te.buffer/Te.extent,Oe=ye,Ie=Jt(ye,1,-1-ze,ze,0,-1,2,Te),Ne=Jt(ye,1,1-ze,2+ze,0,-1,2,Te),(Ie||Ne)&&(Oe=Jt(ye,1,-ze,1+ze,0,-1,2,Te)||[],Ie&&(Oe=Uo(Ie,1).concat(Oe)),Ne&&(Oe=Oe.concat(Uo(Ne,-1)))),ce=Oe).length&&this.splitTile(ce,0,0,0),Z&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function In(le,$,Z){return 32*((1<<le)*Z+$)+le}function po(le,$){const Z=le.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const ce=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ce)return $(null,null);const ye=new ut(ce.features);let Te=Hn(ye);0===Te.byteOffset&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),$(null,{vectorTile:ye,rawData:Te.buffer})}Fn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fn.prototype.splitTile=function(le,$,Z,ce,ye,Te,ze){for(var Oe=[le,$,Z,ce],Ie=this.options,Ne=Ie.debug;Oe.length;){ce=Oe.pop(),Z=Oe.pop(),$=Oe.pop(),le=Oe.pop();var tt=1<<$,At=In($,Z,ce),ve=this.tiles[At];if(!ve&&(Ne>1&&console.time("creation"),ve=this.tiles[At]=Aa(le,$,Z,ce,Ie),this.tileCoords.push({z:$,x:Z,y:ce}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,Z,ce,ve.numFeatures,ve.numPoints,ve.numSimplified),console.timeEnd("creation"));var he="z"+$;this.stats[he]=(this.stats[he]||0)+1,this.total++}if(ve.source=le,ye){if($===Ie.maxZoom||$===ye)continue;var se=1<<ye-$;if(Z!==Math.floor(Te/se)||ce!==Math.floor(ze/se))continue}else if($===Ie.indexMaxZoom||ve.numPoints<=Ie.indexMaxPoints)continue;if(ve.source=null,0!==le.length){Ne>1&&console.time("clipping");var Me,Ue,Et,rt,$t,nn,ke=.5*Ie.buffer/Ie.extent,Hr=.5-ke,Tn=.5+ke,xn=1+ke;Me=Ue=Et=rt=null,$t=Jt(le,tt,Z-ke,Z+Tn,0,ve.minX,ve.maxX,Ie),nn=Jt(le,tt,Z+Hr,Z+xn,0,ve.minX,ve.maxX,Ie),le=null,$t&&(Me=Jt($t,tt,ce-ke,ce+Tn,1,ve.minY,ve.maxY,Ie),Ue=Jt($t,tt,ce+Hr,ce+xn,1,ve.minY,ve.maxY,Ie),$t=null),nn&&(Et=Jt(nn,tt,ce-ke,ce+Tn,1,ve.minY,ve.maxY,Ie),rt=Jt(nn,tt,ce+Hr,ce+xn,1,ve.minY,ve.maxY,Ie),nn=null),Ne>1&&console.timeEnd("clipping"),Oe.push(Me||[],$+1,2*Z,2*ce),Oe.push(Ue||[],$+1,2*Z,2*ce+1),Oe.push(Et||[],$+1,2*Z+1,2*ce),Oe.push(rt||[],$+1,2*Z+1,2*ce+1)}}},Fn.prototype.getTile=function(le,$,Z){var ce=this.options,ye=ce.extent,Te=ce.debug;if(le<0||le>24)return null;var ze=1<<le,Oe=In(le,$=($%ze+ze)%ze,Z);if(this.tiles[Oe])return gi(this.tiles[Oe],ye);Te>1&&console.log("drilling down to z%d-%d-%d",le,$,Z);for(var Ie,Ne=le,tt=$,At=Z;!Ie&&Ne>0;)Ne--,tt=Math.floor(tt/2),At=Math.floor(At/2),Ie=this.tiles[In(Ne,tt,At)];return Ie&&Ie.source?(Te>1&&console.log("found parent tile z%d-%d-%d",Ne,tt,At),Te>1&&console.time("drilling down"),this.splitTile(Ie.source,Ne,tt,At,le,$,Z),Te>1&&console.timeEnd("drilling down"),this.tiles[Oe]?gi(this.tiles[Oe],ye):null):null};class Gr extends u.VectorTileWorkerSource{constructor($,Z,ce,ye,Te){super($,Z,ce,ye,po),Te&&(this.loadGeoJSON=Te)}loadData($,Z){const ce=$&&$.request,ye=ce&&ce.collectResourceTiming;this.loadGeoJSON($,(Te,ze)=>{if(Te||!ze)return Z(Te);if("object"!=typeof ze)return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{Mt(ze,!0);try{if($.filter){const Ie=u.createExpression($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ie.result)throw new Error(Ie.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));const Ne=ze.features.filter(tt=>Ie.value.evaluate({zoom:0},tt));ze={type:"FeatureCollection",features:Ne}}this._geoJSONIndex=$.cluster?new ir(function({superclusterOptions:Ie,clusterProperties:Ne}){if(!Ne||!Ie)return Ie;const tt={},At={},ve={accumulated:null,zoom:0},he={properties:null},se=Object.keys(Ne);for(const Me of se){const[Ue,Et]=Ne[Me],rt=u.createExpression(Et),$t=u.createExpression("string"==typeof Ue?[Ue,["accumulated"],["get",Me]]:Ue);tt[Me]=rt.value,At[Me]=$t.value}return Ie.map=Me=>{he.properties=Me;const Ue={};for(const Et of se)Ue[Et]=tt[Et].evaluate(ve,he);return Ue},Ie.reduce=(Me,Ue)=>{he.properties=Ue;for(const Et of se)ve.accumulated=Me[Et],Me[Et]=At[Et].evaluate(ve,he)},Ie}($)).load(ze.features):new Fn(Ie=ze,$.geojsonVtOptions)}catch(Ie){return Z(Ie)}this.loaded={};const Oe={};if(ye){const Ie=u.getPerformanceMeasurement(ce);Ie&&(Oe.resourceTiming={},Oe.resourceTiming[$.source]=JSON.parse(JSON.stringify(Ie)))}Z(null,Oe)}var Ie})}reloadTile($,Z){const ce=this.loaded;return ce&&ce[$.uid]?super.reloadTile($,Z):this.loadTile($,Z)}loadGeoJSON($,Z){if($.request)u.getJSON($.request,Z);else{if("string"!=typeof $.data)return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse($.data))}catch{return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(ce){Z(ce)}}getClusterChildren($,Z){try{Z(null,this._geoJSONIndex.getChildren($.clusterId))}catch(ce){Z(ce)}}getClusterLeaves($,Z){try{Z(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(ce){Z(ce)}}}class To{constructor($){this.self=$,this.actor=new u.Actor($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Gr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,ce)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=ce},this.self.registerRTLTextPlugin=Z=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=Z.applyArabicShaping,u.plugin.processBidirectionalText=Z.processBidirectionalText,u.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches($,Z,ce){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],ce()}checkIfReady($,Z,ce){ce()}setReferrer($,Z){this.referrer=Z}spriteLoaded($,Z){this.isSpriteLoaded[$]=Z;for(const ce in this.workerSources[$]){const ye=this.workerSources[$][ce];for(const Te in ye)ye[Te]instanceof u.VectorTileWorkerSource&&(ye[Te].isSpriteLoaded=Z,ye[Te].fire(new u.Event("isSpriteLoaded")))}}setImages($,Z,ce){this.availableImages[$]=Z;for(const ye in this.workerSources[$]){const Te=this.workerSources[$][ye];for(const ze in Te)Te[ze].availableImages=Z}ce()}enableTerrain($,Z,ce){this.terrain=Z,ce()}setProjection($,Z){this.projections[$]=u.getProjection(Z)}setLayers($,Z,ce){this.getLayerIndex($).replace(Z),ce()}updateLayers($,Z,ce){this.getLayerIndex($).update(Z.layers,Z.removedIds),ce()}loadTile($,Z,ce){const ye=this.enableTerrain?u.extend({enableTerrain:this.terrain},Z):Z;ye.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source).loadTile(ye,ce)}loadDEMTile($,Z,ce){const ye=this.enableTerrain?u.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource($,Z.source).loadTile(ye,ce)}reloadTile($,Z,ce){const ye=this.enableTerrain?u.extend({enableTerrain:this.terrain},Z):Z;ye.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source).reloadTile(ye,ce)}abortTile($,Z,ce){this.getWorkerSource($,Z.type,Z.source).abortTile(Z,ce)}removeTile($,Z,ce){this.getWorkerSource($,Z.type,Z.source).removeTile(Z,ce)}removeSource($,Z,ce){if(!this.workerSources[$]||!this.workerSources[$][Z.type]||!this.workerSources[$][Z.type][Z.source])return;const ye=this.workerSources[$][Z.type][Z.source];delete this.workerSources[$][Z.type][Z.source],void 0!==ye.removeSource?ye.removeSource(Z,ce):ce()}loadWorkerSource($,Z,ce){try{this.self.importScripts(Z.url),ce()}catch(ye){ce(ye.toString())}}syncRTLPluginState($,Z,ce){try{u.plugin.setState(Z);const ye=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=ye){this.self.importScripts(ye);const Te=u.plugin.isParsed();ce(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),Te)}}catch(ye){ce(ye.toString())}}getAvailableImages($){let Z=this.availableImages[$];return Z||(Z=[]),Z}getLayerIndex($){let Z=this.layerIndexes[$];return Z||(Z=this.layerIndexes[$]=new jt),Z}getWorkerSource($,Z,ce){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][Z]||(this.workerSources[$][Z]={}),this.workerSources[$][Z][ce]||(this.workerSources[$][Z][ce]=new this.workerSourceTypes[Z]({send:(ye,Te,ze,Oe,Ie,Ne)=>{this.actor.send(ye,Te,ze,$,Ie,Ne)},scheduler:this.actor.scheduler},this.getLayerIndex($),this.getAvailableImages($),this.isSpriteLoaded[$])),this.workerSources[$][Z][ce]}getDEMWorkerSource($,Z){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][Z]||(this.demWorkerSources[$][Z]=new nt),this.demWorkerSources[$][Z]}enforceCacheSizeLimit($,Z){u.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics($,Z,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new To(self)),To}),re(0,function(u){function Ae(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let l=0;l<h.length;l++)if(!Ae(h[l],t[l]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==t){if("object"!=typeof t||Object.keys(h).length!==Object.keys(t).length)return!1;for(const l in h)if(!Ae(h[l],t[l]))return!1;return!0}return h===t}var hn=jt;function jt(h){return t=h,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()||(void 0===nt[l=t&&t.failIfMajorPerformanceCaveat]&&(nt[l]=function(p){var _,E,I,A,v=(E=p,I=document.createElement("canvas"),(A=Object.create(jt.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,I.getContext("webgl",A)||I.getContext("experimental-webgl",A));if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),!0===v.getShaderParameter(_,v.COMPILE_STATUS))}(l)),!nt[l]||document.documentMode));var t,l}var nt={};function Mt(h,t,l){const p=u.window.document.createElement(h);return void 0!==t&&(p.className=t),l&&l.appendChild(p),p}function Ct(h,t,l){const p=u.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(t))p.setAttributeNS(null,_,t[_]);return l&&l.appendChild(p),p}jt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ft=u.window.document&&u.window.document.documentElement.style,Tt=ft&&void 0!==ft.userSelect?"userSelect":"WebkitUserSelect";let wn;function ut(){ft&&Tt&&(wn=ft[Tt],ft[Tt]="none")}function bn(){ft&&Tt&&(ft[Tt]=wn)}function dt(h){h.preventDefault(),h.stopPropagation(),u.window.removeEventListener("click",dt,!0)}function dn(){u.window.addEventListener("click",dt,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",dt,!0)},0)}function Xt(h,t){const l=h.getBoundingClientRect();return Bt(h,l,t)}function Hn(h,t){const l=h.getBoundingClientRect(),p=[];for(let _=0;_<t.length;_++)p.push(Bt(h,l,t[_]));return p}function Zt(h){return void 0!==u.window.InstallTrigger&&2===h.button&&h.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Bt(h,t,l){const p=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new u.pointGeometry((l.clientX-t.left)*p,(l.clientY-t.top)*p)}function Nt(h,t){var l=t[0],p=t[1],_=t[2],v=t[3],E=l*v-_*p;return E?(h[0]=v*(E=1/E),h[1]=-p*E,h[2]=-_*E,h[3]=l*E,h):null}function gt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class rr extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,l){this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,l){if(!t)return!0;let p=0;for(const _ of t){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(t,l){return!(t&&(4!==t.length||t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,l){l.version=this.images[t].version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,l){let p=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(t,l):this.requestors.push({ids:t,callback:l})}_notify(t,l){const p={};for(const _ of t){this.images[_]||this.fire(new u.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:u.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],p=this.getImage(t);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new u.ImagePosition(_,p);this.patterns[t]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:l,h:p}=u.potpack(t),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],I=E.x+1,A=E.y+1,O=this.images[v].data,V=O.width,H=O.height;u.RGBAImage.copy(O,_,{x:0,y:0},{x:I,y:A},{width:V,height:H}),u.RGBAImage.copy(O,_,{x:0,y:H-1},{x:I,y:A-1},{width:V,height:1}),u.RGBAImage.copy(O,_,{x:0,y:0},{x:I,y:A+H},{width:V,height:1}),u.RGBAImage.copy(O,_,{x:V-1,y:0},{x:I-1,y:A},{width:1,height:H}),u.RGBAImage.copy(O,_,{x:0,y:0},{x:I+V,y:A},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];gt(p)&&this.updateImage(l,p)}}}const wt=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(h,t){return function([l,p,_]){const v=u.degToRad(p+90),E=u.degToRad(_);return{x:l*Math.cos(v)*Math.sin(E),y:l*Math.sin(v)*Math.sin(E),z:l*Math.cos(E),azimuthal:p,polar:_}}(h.expression.evaluate(t))}interpolate(h,t,l){return{x:u.number(h.x,t.x,l),y:u.number(h.y,t.y,l),z:u.number(h.z,t.z,l),azimuthal:u.number(h.azimuthal,t.azimuthal,l),polar:u.number(h.polar,t.polar,l)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),Ft="-transition";class Mn extends u.Evented{constructor(t){super(),this._transitionable=new u.Transitionable(wt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(u.validateLight,t,l))for(const p in t){const _=t[p];u.endsWith(p,Ft)?this._transitionable.setTransition(p.slice(0,-Ft.length),_):this._transitionable.setValue(p,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||!1!==p.validate)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const qe=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),Ke="-transition";class Qe extends u.Evented{constructor(t,l){super(),this._transitionable=new u.Transitionable(qe),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(t){for(const l in t){const p=t[l];u.endsWith(l,Ke)?this._transitionable.setTransition(l.slice(0,-Ke.length),p):this._transitionable.setValue(l,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function ot(h,t,l,p){const _=u.smoothstep(45,65,l),[v,E]=at(h,p),I=u.length(t);let A=1-Math.min(1,Math.exp((I-v)/(E-v)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*_*h.alpha}function at(h,t){const l=.5/Math.tan(.5*t);return[h.range[0]+l,h.range[1]+l]}const Rt=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])}),Ln="-transition";class fn extends u.Evented{constructor(t,l){super(),this._transitionable=new u.Transitionable(Rt),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const t=this._transform,l="globe"===t.projection.name,p=u.globeToMercatorTransition(t.zoom),_=this.properties.get("range"),v=[.5,3];return{range:l?[u.number(v[0],_[0],p),u.number(v[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,l={}){if(!this._validate(u.validateFog,t,l)){for(const p of Object.keys(u.spec.fog))t&&void 0===t[p]&&(t[p]=u.spec.fog[p].default);for(const p in t){const _=t[p];u.endsWith(p,Ln)?this._transitionable.setTransition(p.slice(0,-Ln.length),_):this._transitionable.setValue(p,_)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,t))*l.a}getOpacityAtLatLng(t,l){return this._transform.projection.supportsFog?function(p,_,v){const E=u.MercatorCoordinate.fromLngLat(_),I=v.elevation?v.elevation.getAtPointOrZero(E):0,A=[E.x,E.y,I];return u.transformMat4(A,A,v.mercatorFogMatrix),ot(p,A,v.pitch,v._fov)}(this.state,t,l):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?at(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||!1!==p.validate)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class Zn{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new Zn.Actor(p[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,l,p){u.asyncAll(this.actors,(_,v)=>{_.send(t,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Dn(h,t,l){return t*(u.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Zn.Actor=u.Actor;class _r{constructor(t,l,p,_){this.screenBounds=t,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(t,l){let p,_;if(t instanceof u.pointGeometry||"number"==typeof t[0]){const v=u.pointGeometry.convert(t);p=[u.pointGeometry.convert(t)],_=l.isPointAboveHorizon(v)}else{const v=u.pointGeometry.convert(t[0]),E=u.pointGeometry.convert(t[1]);p=[v,E],_=u.polygonizeBounds(v,E).every(I=>l.isPointAboveHorizon(I))}return new _r(p,l.getCameraPoint(),_,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],_=u.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),u.bufferConvexPolygon(_,t)}bufferedCameraGeometryGlobe(t){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],_=u.polygonizeBounds(l,p,t),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(t,l,p,_=0){const v=t.queryPadding/l._projectionScaler+1,E=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let I=t.tileID.wrap+(E.unwrapped?_:0);const A=E.polygon.map(_e=>u.getTilePoint(t.tileTransform,_e,I));if(!u.polygonIntersectsBox(A,0,0,u.EXTENT,u.EXTENT))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const O=this.screenGeometryMercator.polygon.map(_e=>u.getTileVec3(t.tileTransform,_e,I)),V=O.map(_e=>new u.pointGeometry(_e[0],_e[1])),H=l.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),W=u.getTileVec3(t.tileTransform,H,I),te=O.map(_e=>{const ee=u.sub(_e,_e,W);return u.normalize(ee,ee),new u.Ray(W,ee)}),ne=Dn(t,1,l.zoom)*l._projectionScaler;return{queryGeometry:this,tilespaceGeometry:V,tilespaceRays:te,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(Q=u.getBounds(A),Q.min.x=u.clamp(Q.min.x,0,u.EXTENT),Q.min.y=u.clamp(Q.min.y,0,u.EXTENT),Q.max.x=u.clamp(Q.max.x,0,u.EXTENT),Q.max.y=u.clamp(Q.max.y,0,u.EXTENT),Q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ne};var Q}_bufferedScreenMercator(t,l){const p=Yr(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),l):{polygon:this.bufferedScreenGeometry(t).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(t,l){const p=Yr(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),l):{polygon:this.bufferedCameraGeometry(t).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(t,l){const p=function(v,E){const I=u.multiply([],E.pixelMatrix,E.globeMatrix),A=[0,-u.GLOBE_RADIUS,0,1],O=[0,u.GLOBE_RADIUS,0,1],V=[0,0,0,1];u.transformMat4$1(A,A,I),u.transformMat4$1(O,O,I),u.transformMat4$1(V,V,I);const H=new u.pointGeometry(A[0]/A[3],A[1]/A[3]),W=new u.pointGeometry(O[0]/O[3],O[1]/O[3]),te=u.polygonContainsPoint(v,H)&&A[3]<V[3],ne=u.polygonContainsPoint(v,W)&&O[3]<V[3];if(!te&&!ne)return null;const Q=function(Se,Ge,We){for(let $e=1;$e<Se.length;$e++){const je=ir(Ge.pointCoordinate3D(Se[$e-1]).x),be=ir(Ge.pointCoordinate3D(Se[$e]).x);if(We<0){if(je<be)return{idx:$e,t:-je/(be-1-je)}}else if(be<je)return{idx:$e,t:(1-je)/(be+1-je)}}return null}(v,E,te?-1:1);if(!Q)return null;const{idx:_e,t:ee}=Q;let ae=_e>1?jr(v.slice(0,_e),E):[],oe=_e<v.length?jr(v.slice(_e),E):[];ae=ae.map(Se=>new u.pointGeometry(ir(Se.x),Se.y)),oe=oe.map(Se=>new u.pointGeometry(ir(Se.x),Se.y));const xe=[...ae];0===xe.length&&xe.push(oe[oe.length-1]);const de=u.number(xe[xe.length-1].y,(0===oe.length?ae[0]:oe[0]).y,ee);let fe;return fe=te?[new u.pointGeometry(0,de),new u.pointGeometry(0,0),new u.pointGeometry(1,0),new u.pointGeometry(1,de)]:[new u.pointGeometry(1,de),new u.pointGeometry(1,1),new u.pointGeometry(0,1),new u.pointGeometry(0,de)],xe.push(...fe),0===oe.length?xe.push(ae[0]):xe.push(...oe),{polygon:xe.map(Se=>new u.MercatorCoordinate(Se.x,Se.y)),unwrapped:!1}}(t,l);if(p)return p;const _=function(v,E){let I=!1,A=-1/0,O=0;for(let H=0;H<v.length-1;H++)v[H].x>A&&(A=v[H].x,O=H);for(let H=0;H<v.length-1;H++){const W=(O+H)%(v.length-1),te=v[W],ne=v[W+1];Math.abs(te.x-ne.x)>.5&&(te.x<ne.x?(te.x+=1,0===W&&(v[v.length-1].x+=1)):(ne.x+=1,W+1===v.length-1&&(v[0].x+=1)),I=!0)}const V=u.mercatorXfromLng(E.center.lng);return I&&V<Math.abs(V-1)&&v.forEach(H=>{H.x-=1}),{polygon:v,unwrapped:I}}(jr(t,l).map(v=>new u.pointGeometry(ir(v.x),v.y)),l);return{polygon:_.polygon.map(v=>new u.MercatorCoordinate(v.x,v.y)),unwrapped:_.unwrapped}}}function jr(h,t){return u.resample(h,l=>{const p=t.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ir(h){return h<0?1+h%1:h%1}function Yr(h){return 100*h|0}function Ri(h,t,l,p,_){const v=function(E,I){if(E)return _(E);if(I){const A=u.pick(u.extend(I,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(A.vectorLayers=I.vector_layers,A.vectorLayerIds=A.vectorLayers.map(O=>O.id)),I.language_options&&(A.languageOptions=I.language_options),I.language&&I.language[I.id]&&(A.language=I.language[I.id]),I.worldview_options&&(A.worldviewOptions=I.worldview_options),I.worldview?A.worldview=I.worldview[I.id]:I.worldview_default&&(A.worldview=I.worldview_default),A.tiles=t.canonicalizeTileset(A,h.url),_(null,A)}};return h.url?u.getJSON(t.transformRequest(t.normalizeSourceURL(h.url,null,l,p),u.ResourceType.Source),v):u.exported.frame(()=>v(null,h))}class ki{constructor(t,l,p){this.bounds=u.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),p=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*l),E=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*l);return t.x>=p&&t.x<v&&t.y>=_&&t.y<E}}class dr{constructor(t,l,p){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const An={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Li{constructor(t,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];void 0!==_&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,l,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],E=l.attributes[v.name];void 0!==E&&t.vertexAttribPointer(E,v.components,t[An[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class En{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class io extends En{getDefault(){return u.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Sr extends En{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class oo extends En{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ci extends En{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Xi extends En{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Vn extends En{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ci extends En{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Yn extends En{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Fi extends En{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class $i extends En{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Bo extends En{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ii extends En{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ts extends En{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class Jt extends En{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ui extends En{getDefault(){return u.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vr extends En{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class an extends En{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class gn extends En{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class No extends En{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class mi extends En{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ar extends En{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Uo extends En{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Si extends En{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class gi extends En{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pn extends En{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Aa extends En{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xr extends En{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oi extends En{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Fn extends En{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class In extends En{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class po extends En{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Gr extends En{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class To extends Gr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class le extends Gr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $ extends le{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Z{constructor(t,l,p,_){this.context=t,this.width=l,this.height=p;const v=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new To(t,v),_&&(this.depthAttachment=new le(t,v))}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class ce{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new io(this),this.clearDepth=new Sr(this),this.clearStencil=new oo(this),this.colorMask=new ci(this),this.depthMask=new Xi(this),this.stencilMask=new Vn(this),this.stencilFunc=new Ci(this),this.stencilOp=new Yn(this),this.stencilTest=new Fi(this),this.depthRange=new $i(this),this.depthTest=new Bo(this),this.depthFunc=new Ii(this),this.blend=new ts(this),this.blendFunc=new Jt(this),this.blendColor=new ui(this),this.blendEquation=new vr(this),this.cullFace=new an(this),this.cullFaceSide=new gn(this),this.frontFace=new No(this),this.program=new mi(this),this.activeTexture=new ar(this),this.viewport=new Uo(this),this.bindFramebuffer=new Si(this),this.bindRenderbuffer=new gi(this),this.bindTexture=new Pn(this),this.bindVertexBuffer=new Aa(this),this.bindElementBuffer=new xr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Oi(this),this.pixelStoreUnpack=new Fn(this),this.pixelStoreUnpackPremultiplyAlpha=new In(this),this.pixelStoreUnpackFlipY=new po(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new dr(this,t,l)}createVertexBuffer(t,l,p){return new Li(this,t,l,p)}createRenderbuffer(t,l,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,t,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(t,l,p){return new Z(this,t,l,p)}clear({color:t,depth:l,stencil:p}){const _=this.gl;let v=0;t&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Ae(t.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ye extends u.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},l),u.extend(this,u.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ri(this._options,this.map._requestManager,null,null,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):l&&(u.extend(this,l),l.bounds&&(this.tileBounds=new ki(l.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(l.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const p=u.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=u.getImage(this.map._requestManager.transformRequest(_,u.ResourceType.Tile),(v,E,I,A)=>(delete t.request,t.aborted?(t.state="unloaded",l(null)):v?(t.state="errored",l(v)):E?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:A}),t.setTexture(E,this.map.painter),t.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(t,l,p){t.setTexture(l,p)}static unloadTileData(t,l){t.texture&&l.saveTileTexture(t.texture)}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l()}unloadTile(t,l){t.texture&&this.map.painter.saveTileTexture(t.texture),l()}hasTransition(){return!1}}let Te;function ze(h,t,l,p,_,v,E,I){const A=[h,l,_,t,p,v,1,1,1],O=[E,I,1],V=u.adjoint([],A),[H,W,te]=u.transformMat3(O,O,u.transpose(V,V));return u.multiply$1(A,[H,0,0,0,W,0,0,0,te],A)}class Oe extends u.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(t,l){this._loaded=l||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(p,_)=>{if(this._loaded=!0,p)this.fire(new u.ErrorEvent(p));else if(_){const{HTMLImageElement:v}=u.window;this.image=_ instanceof v?u.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const l=t.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,E=-1/0,I=-1/0;for(const H of p)_=Math.min(_,H.x),v=Math.min(v,H.y),E=Math.max(E,H.x),I=Math.max(I,H.y);const A=Math.max(E-_,I-v),O=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),V=Math.pow(2,O);return new u.CanonicalTileID(O,Math.floor((_+E)/2*V),Math.floor((v+I)/2*V))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const A in this.tiles){const O=this.tiles[A];"loaded"!==O.state&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const l=u.tileTransform(this.tileID,this.map.transform.projection),[p,_,v,E]=this.coordinates.map(A=>{const O=l.projection.project(A[0],A[1]);return u.getTilePoint(l,O)._round()});this.perspectiveTransform=function(A,O,V,H,W,te,ne,Q,_e,ee){const ae=ze(0,0,A,0,0,O,A,O),oe=ze(V,H,W,te,ne,Q,_e,ee);return u.multiply$1(oe,u.adjoint(ae,ae),oe),[oe[6]/oe[8]*A/u.EXTENT,oe[7]/oe[8]*O/u.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,E.x,E.y,v.x,v.y);const I=this._boundsArray=new u.StructArrayLayout4i8;I.emplaceBack(p.x,p.y,0,0),I.emplaceBack(_.x,_.y,u.EXTENT,0),I.emplaceBack(E.x,E.y,0,u.EXTENT),I.emplaceBack(v.x,v.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(I,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,l=t.gl;this.texture?this.texture.update(this.image):(this.texture=new u.Texture(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,l){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},l(null)):(t.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ie={vector:class extends u.Evented{constructor(h,t,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(t,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(h){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const t=this.language||this.map._language,l=this.worldview||this.map._worldview;this._tileJSONRequest=Ri(this._options,this.map._requestManager,t,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${t}`),l&&2!==l.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new u.ErrorEvent(p))):_&&(u.extend(this,_),_.bounds&&(this.tileBounds=new ki(_.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(p)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load(()=>{const t=this.map.style._getSourceCaches(this.id);for(const l of t)l.clearTiles()})}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}_setLanguage(h){return h===this.language||this.setSourceProperty(()=>{this.language=h}),this}_setWorldview(h){return h===this.worldview?this:this.worldviewOptions&&h&&!this.worldviewOptions[h]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${h}".`),this):(this.setSourceProperty(()=>{this.worldview=h}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(h,t){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,u.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&"expired"!==h.state)"loading"===h.state?h.reloadCallback=t:h.request=h.actor.send("reloadTile",p,_.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const v=u.loadVectorTile.call({deduped:this._deduped},p,(E,I)=>{E||!I?_.call(this,E):(p.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);h.request={cancel:v}}function _(v,E){return delete h.request,h.aborted?t(null):v&&404!==v.status?t(v):(E&&E.resourceTiming&&(h.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&h.setExpiryData(E),h.loadVectorData(E,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ye,"raster-dem":class extends ye{constructor(h,t,l,p){super(h,t,l,p),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(h.state="errored",t(_)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=u.getImage(this.map._requestManager.transformRequest(l,u.ResourceType.Tile),function(_,v,E,I){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(_)h.state="errored",t(_);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:E,expires:I});const A=u.window.ImageBitmap&&v instanceof u.window.ImageBitmap&&(null==Te&&(Te=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),Te),O=1-(v.width-u.prevPowerOfTwo(v.width))/2;O<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const V=A?v:u.exported.getImageData(v,O),H={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:V,encoding:this.encoding,padding:O};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",H,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const t=h.canonical,l=Math.pow(2,t.z),p=(t.x-1+l)%l,_=0===t.x?h.wrap-1:h.wrap,v=(t.x+1+l)%l,E=t.x+1===l?h.wrap+1:h.wrap,I={};return I[new u.OverscaledTileID(h.overscaledZ,_,t.z,p,t.y).key]={backfilled:!1},I[new u.OverscaledTileID(h.overscaledZ,E,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(I[new u.OverscaledTileID(h.overscaledZ,_,t.z,p,t.y-1).key]={backfilled:!1},I[new u.OverscaledTileID(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new u.OverscaledTileID(h.overscaledZ,E,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<l&&(I[new u.OverscaledTileID(h.overscaledZ,_,t.z,p,t.y+1).key]={backfilled:!1},I[new u.OverscaledTileID(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new u.OverscaledTileID(h.overscaledZ,E,t.z,v,t.y+1).key]={backfilled:!1}),I}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends u.Evented{constructor(h,t,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=t.data,this._options=u.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*_,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*_,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},t),this}getClusterLeaves(h,t,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:t,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=u.extend({},this.workerOptions),t=this._data;"string"==typeof t?(h.request=this.map._requestManager.transformRequest(u.exported.resolveURL(t),u.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new u.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new u.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,t){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?t(null):p?t(p):(h.loadVectorData(_,this.map.painter,"reloadTile"===l),t(null))),void 0,"loadTile"===l)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Oe{constructor(h,t,l,p){super(h,t,l,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,u.ResourceType.Source).url);u.getVideo(this.urls,(t,l)=>{this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(h,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Oe,canvas:class extends Oe{constructor(h,t,l,p){super(h,t,l,p),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(v=>"number"!=typeof v))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends u.Evented{constructor(h,t,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ki(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:t,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:l,y:p,z:_}=h.tileID.canonical,v=new u.window.AbortController,E=this._implementation.loadTile({x:l,y:p,z:_},{signal:v.signal});if(!E)return this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null);E.cancel=()=>v.abort(),h.request=E.then(function(I){return delete h.request,h.aborted?(h.state="unloaded",t(null)):I?(A=I)instanceof u.window.ImageData||A instanceof u.window.ImageBitmap||A instanceof u.window.HTMLCanvasElement?(this.loadTileData(h,I),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null));var A}.bind(this)).catch(I=>{20!==I.code&&(h.state="errored",t(I))})}loadTileData(h,t){ye.loadTileData(h,t,this._map.painter)}unloadTileData(h){ye.unloadTileData(h,this._map.painter)}prepareTile(h){if(!this._implementation.prepareTile)return null;const{x:t,y:l,z:p}=h.tileID.canonical,_=this._implementation.prepareTile({x:t,y:l,z:p});return _?(this.loadTileData(h,_),h.state="loaded",_):null}unloadTile(h,t){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ne=function(h,t,l,p){const _=new Ie[t.type](h,t,l,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],_),_};function tt(h,t){const l=u.identity([]);return u.scale(l,l,[.5*h.width,.5*-h.height,1]),u.translate(l,l,[1,-1,0]),u.multiply(l,l,h.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(l)}function At(h,t,l,p,_,v,E,I=!1){const A=h.tilesIn(p,E,I);A.sort(he);const O=[];for(const H of A)O.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(t,l,h._state,H,_,v,tt(h.transform,H.tile.tileID),I)});const V=function(H){const W={},te={};for(const ne of H){const Q=ne.queryResults,_e=ne.wrappedTileID,ee=te[_e]=te[_e]||{};for(const ae in Q){const oe=Q[ae],xe=ee[ae]=ee[ae]||{},de=W[ae]=W[ae]||[];for(const fe of oe)xe[fe.featureIndex]||(xe[fe.featureIndex]=!0,de.push(fe))}}return W}(O);for(const H in V)V[H].forEach(W=>{const te=W.feature,ne=te.layer;ne&&"background"!==ne.type&&"sky"!==ne.type&&(te.source=ne.source,ne["source-layer"]&&(te.sourceLayer=ne["source-layer"]),te.state=void 0!==te.id?h.getFeatureState(ne["source-layer"],te.id):{})});return V}function ve(h,t){const l=h.getRenderableIds().map(v=>h.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){const E=l[v],I=E.tileID.canonical.key;_[I]||(_[I]=!0,E.querySourceFeatures(p,t))}return p}function he(h,t){const l=h.tileID,p=t.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function se(){return null!=ss.workerClass?new ss.workerClass:new u.window.Worker(ss.workerUrl)}const Me="mapboxgl_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new se);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Me]}numActive(){return Object.keys(this.active).length}}let Et;function rt(){return Et||(Et=new Ue),Et}function $t(h,t){const l={};for(const p in h)"ref"!==p&&(l[p]=h[p]);return u.refProperties.forEach(p=>{p in t&&(l[p]=t[p])}),l}function nn(h){h=h.slice();const t=Object.create(null);for(let l=0;l<h.length;l++)t[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=$t(h[l],t[h[l].ref]));return h}Ue.workerCount=2;const ke={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Hr(h,t,l){l.push({command:ke.addSource,args:[h,t[h]]})}function Tn(h,t,l){t.push({command:ke.removeSource,args:[h]}),l[h]=!0}function xn(h,t,l,p){Tn(h,l,p),Hr(h,t,l)}function Mr(h,t,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&"data"!==p&&!Ae(h[l][p],t[l][p]))return!1;for(p in t[l])if(t[l].hasOwnProperty(p)&&"data"!==p&&!Ae(h[l][p],t[l][p]))return!1;return!0}function _i(h,t,l,p,_,v){let E;for(E in t=t||{},h=h||{})h.hasOwnProperty(E)&&(Ae(h[E],t[E])||l.push({command:v,args:[p,E,t[E],_]}));for(E in t)t.hasOwnProperty(E)&&!h.hasOwnProperty(E)&&(Ae(h[E],t[E])||l.push({command:v,args:[p,E,t[E],_]}))}function yi(h){return h.id}function Bn(h,t){return h[t.id]=t,h}class Do{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=u.clamp(t,0,1);let l=1,p=this._distances[l];const _=t*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const v=l-1,E=this._distances[v],I=p-E,A=I>0?(_-E)/I:0;return this.points[v].mult(1-A).add(this.points[l].mult(A))}}class Ot{constructor(t,l,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(l/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(t,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(t,l,p,_,v,E){this.boxCells[v].push(E)}_insertCircleCell(t,l,p,_,v,E){this.circleCells[v].push(E)}_query(t,l,p,_,v,E){if(p<0||t>this.width||_<0||l>this.height)return!v&&[];const I=[];if(t<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const O=this.circles[3*A],V=this.circles[3*A+1],H=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:O-H,y1:V-H,x2:O+H,y2:V+H})}return E?I.filter(E):I}return this._forEachCell(t,l,p,_,this._queryCell,I,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?I.length>0:I}_queryCircle(t,l,p,_,v){const E=t-p,I=t+p,A=l-p,O=l+p;if(I<0||E>this.width||O<0||A>this.height)return!_&&[];const V=[];return this._forEachCell(E,A,I,O,this._queryCellCircle,V,{hitTest:_,circle:{x:t,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?V.length>0:V}query(t,l,p,_,v){return this._query(t,l,p,_,!1,v)}hitTest(t,l,p,_,v){return this._query(t,l,p,_,!0,v)}hitTestCircle(t,l,p,_){return this._queryCircle(t,l,p,!0,_)}_queryCell(t,l,p,_,v,E,I,A){const O=I.seenUids,V=this.boxCells[v];if(null!==V){const W=this.bboxes;for(const te of V)if(!O.box[te]){O.box[te]=!0;const ne=4*te;if(t<=W[ne+2]&&l<=W[ne+3]&&p>=W[ne+0]&&_>=W[ne+1]&&(!A||A(this.boxKeys[te]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[te],x1:W[ne],y1:W[ne+1],x2:W[ne+2],y2:W[ne+3]})}}}const H=this.circleCells[v];if(null!==H){const W=this.circles;for(const te of H)if(!O.circle[te]){O.circle[te]=!0;const ne=3*te;if(this._circleAndRectCollide(W[ne],W[ne+1],W[ne+2],t,l,p,_)&&(!A||A(this.circleKeys[te]))){if(I.hitTest)return E.push(!0),!0;{const Q=W[ne],_e=W[ne+1],ee=W[ne+2];E.push({key:this.circleKeys[te],x1:Q-ee,y1:_e-ee,x2:Q+ee,y2:_e+ee})}}}}}_queryCellCircle(t,l,p,_,v,E,I,A){const O=I.circle,V=I.seenUids,H=this.boxCells[v];if(null!==H){const te=this.bboxes;for(const ne of H)if(!V.box[ne]){V.box[ne]=!0;const Q=4*ne;if(this._circleAndRectCollide(O.x,O.y,O.radius,te[Q+0],te[Q+1],te[Q+2],te[Q+3])&&(!A||A(this.boxKeys[ne])))return E.push(!0),!0}}const W=this.circleCells[v];if(null!==W){const te=this.circles;for(const ne of W)if(!V.circle[ne]){V.circle[ne]=!0;const Q=3*ne;if(this._circlesCollide(te[Q],te[Q+1],te[Q+2],O.x,O.y,O.radius)&&(!A||A(this.circleKeys[ne])))return E.push(!0),!0}}}_forEachCell(t,l,p,_,v,E,I,A){const O=this._convertToXCellCoord(t),V=this._convertToYCellCoord(l),H=this._convertToXCellCoord(p),W=this._convertToYCellCoord(_);for(let te=O;te<=H;te++)for(let ne=V;ne<=W;ne++)if(v.call(this,t,l,p,_,this.xCellCount*ne+te,E,I,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,p,_,v,E){const I=_-t,A=v-l,O=p+E;return O*O>I*I+A*A}_circleAndRectCollide(t,l,p,_,v,E,I){const A=(E-_)/2,O=Math.abs(t-(_+A));if(O>A+p)return!1;const V=(I-v)/2,H=Math.abs(l-(v+V));if(H>V+p)return!1;if(O<=A||H<=V)return!0;const W=O-A,te=H-V;return W*W+te*te<=p*p}}const $n=Math.tan(85*Math.PI/180);function _n(h,t,l,p,_,v,E){const I=u.create();if(l)if("globe"===v.name){const A=u.calculateGlobeLabelMatrix(_,t);u.multiply(I,I,A)}else{const A=Nt([],E);I[0]=A[0],I[1]=A[1],I[4]=A[2],I[5]=A[3],p||u.rotateZ(I,I,_.angle)}else u.multiply(I,_.labelPlaneMatrix,h);return I}function fr(h,t,l,p,_,v,E){const I=_n(h,t,l,p,_,v,E);return"globe"===v.name&&l||(I[2]=I[6]=I[10]=I[14]=0),I}function so(h,t,l,p,_,v,E){if(l){if("globe"===v.name){const I=_n(h,t,l,p,_,v,E);return u.invert(I,I),u.multiply(I,h,I),I}{const I=u.clone(h),A=u.identity([]);return A[0]=E[0],A[1]=E[1],A[4]=E[2],A[5]=E[3],u.multiply(I,I,A),p||u.rotateZ(I,I,-_.angle),I}}return _.glCoordMatrix}function mn(h,t,l=0){const p=[h.x,h.y,l,1];l?u.transformMat4$1(p,p,t):Zr(p,p,t);const _=p[3];return{point:[p[0]/_,p[1]/_,p[2]/_],signedDistanceFromCamera:_}}function ei(h,t){const l=[h[0],h[1],h[2],1];u.transformMat4$1(l,l,t);const p=l[3];return{point:[l[0]/p,l[1]/p,l[2]/p],signedDistanceFromCamera:p}}function Yi(h,t){return Math.min(.5+h/t*.5,1.5)}function Co(h,t){const l=h[0]/h[3],p=h[1]/h[3];return l>=-t[0]&&l<=t[0]&&p>=-t[1]&&p<=t[1]}function qn(h,t,l,p,_,v,E,I,A,O){const V=l.transform,H=p?h.textSizeData:h.iconSizeData,W=u.evaluateSizeForZoom(H,l.transform.zoom),te="globe"===V.projection.name,ne=[256/l.width*2+1,256/l.height*2+1],Q=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Q.clear();let _e=null;te&&(_e=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const ee=h.lineVertexArray,ae=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,oe=l.transform.width/l.transform.height;let xe=!1;for(let de=0;de<ae.length;de++){const fe=ae.get(de);if(fe.writingMode!==u.WritingMode.vertical||xe||0!==de&&ae.get(de-1).writingMode===u.WritingMode.horizontal||(xe=!0),(fe.hidden||fe.writingMode===u.WritingMode.vertical)&&!xe){Jn(fe.numGlyphs,Q);continue}xe=!1;const Se=new u.pointGeometry(fe.tileAnchorX,fe.tileAnchorY),Ge=A?A(Se):[0,0,0],We=V.projection.projectTilePoint(Se.x,Se.y,O.canonical),$e=[We.x+Ge[0],We.y+Ge[1],We.z+Ge[2]],je=[...$e,1];if(u.transformMat4$1(je,je,t),!Co(je,ne)){Jn(fe.numGlyphs,Q);continue}const be=Yi(l.transform.cameraToCenterDistance,je[3]),ht=u.evaluateSizeForFeature(H,W,fe),lt=E?ht/be:ht*be,kt=mn(new u.pointGeometry($e[0],$e[1]),_,$e[2]);if(kt.signedDistanceFromCamera<=0){Jn(fe.numGlyphs,Q);continue}let et={};const rn=E?null:A,zt=Vo(fe,lt,!1,I,t,_,v,h.glyphOffsetArray,ee,Q,_e,kt.point,Se,et,oe,rn,V.projection,O,E);xe=zt.useVertical,rn&&zt.needsFlipping&&(et={}),(zt.notEnoughRoom||xe||zt.needsFlipping&&Vo(fe,lt,!0,I,t,_,v,h.glyphOffsetArray,ee,Q,_e,kt.point,Se,et,oe,rn,V.projection,O,E).notEnoughRoom)&&Jn(fe.numGlyphs,Q)}p?(h.text.dynamicLayoutVertexBuffer.updateData(Q),_e&&h.text.globeExtVertexBuffer.updateData(_e)):(h.icon.dynamicLayoutVertexBuffer.updateData(Q),_e&&h.icon.globeExtVertexBuffer.updateData(_e))}function Ar(h,t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q){const _e=I.glyphStartIndex+I.numGlyphs,ee=I.lineStartIndex,ae=I.lineStartIndex+I.lineLength,oe=t.getoffsetX(I.glyphStartIndex),xe=t.getoffsetX(_e-1),de=mo(h*oe,l,p,_,v,E,I.segment,ee,ae,A,O,V,H,W,!0,te,ne,Q);if(!de)return null;const fe=mo(h*xe,l,p,_,v,E,I.segment,ee,ae,A,O,V,H,W,!0,te,ne,Q);return fe?{first:de,last:fe}:null}function ql(h,t,l,p){return h.writingMode===u.WritingMode.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*p?{useVertical:!0}:h.writingMode===u.WritingMode.vertical?t.y<l.y?{needsFlipping:!0}:null:0!==h.flipState&&function(_,v,E){const I=(v.x-_.x)*E;return 0===I||Math.abs((v.y-_.y)/I)>$n}(t,l,p)?1===h.flipState?{needsFlipping:!0}:null:t.x>l.x?{needsFlipping:!0}:null}function Vo(h,t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q,_e,ee,ae){const oe=t/24,xe=h.lineOffsetX*oe,de=h.lineOffsetY*oe;let fe;if(h.numGlyphs>1){const Se=h.glyphStartIndex+h.numGlyphs,Ge=h.lineStartIndex,We=h.lineStartIndex+h.lineLength,$e=Ar(oe,I,xe,de,l,H,W,h,A,v,te,Q,!1,_e,ee,ae);if(!$e)return{notEnoughRoom:!0};const je=ei($e.first.point,E).point,be=ei($e.last.point,E).point,ht=new u.pointGeometry(je[0],je[1]),lt=new u.pointGeometry(be[0],be[1]);if(p&&!l){const kt=ql(h,ht,lt,ne);if(h.flipState=kt&&kt.needsFlipping?1:2,kt)return kt}fe=[$e.first];for(let kt=h.glyphStartIndex+1;kt<Se-1;kt++)fe.push(mo(oe*I.getoffsetX(kt),xe,de,l,H,W,h.segment,Ge,We,A,v,te,Q,!1,!1,_e,ee,ae));fe.push($e.last)}else{if(p&&!l){const Ge=mn(W,_).point,We=h.lineStartIndex+h.segment+1,$e=new u.pointGeometry(A.getx(We),A.gety(We)),je=mn($e,_),be=je.signedDistanceFromCamera>0?je.point:zi(W,$e,Ge,1,_,void 0,_e,ee.canonical),ht=ql(h,new u.pointGeometry(Ge[0],Ge[1]),new u.pointGeometry(be[0],be[1]),ne);if(h.flipState=ht&&ht.needsFlipping?1:2,ht)return ht}const Se=mo(oe*I.getoffsetX(h.glyphStartIndex),xe,de,l,H,W,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,A,v,te,Q,!1,!1,_e,ee,ae);if(!Se)return{notEnoughRoom:!0};fe=[Se]}if(V)for(const Se of fe)u.updateGlobeVertexNormal(V,O.length+0,Se.up[0],Se.up[1],Se.up[2]),u.updateGlobeVertexNormal(V,O.length+1,Se.up[0],Se.up[1],Se.up[2]),u.updateGlobeVertexNormal(V,O.length+2,Se.up[0],Se.up[1],Se.up[2]),u.updateGlobeVertexNormal(V,O.length+3,Se.up[0],Se.up[1],Se.up[2]),u.addDynamicAttributes(O,Se.point[0],Se.point[1],Se.point[2],Se.angle);else for(const Se of fe)u.addDynamicAttributes(O,Se.point[0],Se.point[1],Se.point[2],Se.angle);return{}}function ds(h,t,l,p,_){const v=p.projectTilePoint(h.x,h.y,t);if(!_)return mn(v,l,v.z);const E=_(h);return mn(new u.pointGeometry(v.x+E[0],v.y+E[1]),l,v.z+E[2])}function zi(h,t,l,p,_,v,E,I){const A=ds(h.add(h.sub(t)._unit()),I,_,E,v).point,O=u.sub([],l,A);return u.scaleAndAdd([],l,O,p/u.length(O))}function mo(h,t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q,_e,ee){const ae=p?h-t:h+t;let oe=ae>0?1:-1,xe=0;p&&(oe*=-1,xe=Math.PI),oe<0&&(xe+=Math.PI);let de=oe>0?I+E:I+E+1,fe=_,Se=_,Ge=0,We=0;const $e=Math.abs(ae),je=[],be=[];let ht=v;const lt=()=>{const tn=de-oe;return 0===Ge?v:new u.pointGeometry(O.getx(tn),O.gety(tn))},kt=()=>zi(lt(),ht,Se,$e-Ge+1,V,W,Q,_e.canonical);for(;Ge+We<=$e;){if(de+=oe,de<I||de>=A)return null;if(Se=fe,je.push(fe),te&&be.push(ht||lt()),fe=H[de],void 0===fe){ht=new u.pointGeometry(O.getx(de),O.gety(de));const tn=ds(ht,_e.canonical,V,Q,W);fe=tn.signedDistanceFromCamera>0?H[de]=tn.point:kt()}else ht=null;Ge+=We,We=u.distance(Se,fe)}ht=ht||new u.pointGeometry(O.getx(de),O.gety(de));const et=lt();ne&&W&&(H[de]=fe=void 0===H[de]?fe:kt(),We=u.distance(Se,fe));const rn=($e-Ge)/We,zt=ht.sub(et).mult(rn)._add(et),Lt=u.sub([],fe,Se),vt=u.scaleAndAdd([],Se,Lt,rn);let St=[0,0,1],vn=Lt[0],cn=Lt[1];if(ee&&(St=Q.upVector(_e.canonical,zt.x,zt.y),0!==St[0]||0!==St[1]||1!==St[2])){const tn=[1,0,0],Cn=[0,1,0];tn[0]=St[2],tn[1]=0,tn[2]=-St[0],u.cross(Cn,St,tn),u.normalize(tn,tn),u.normalize(Cn,Cn),vn=u.dot(Lt,tn),cn=u.dot(Lt,Cn)}if(l){const tn=u.cross([],St,Lt);u.normalize(tn,tn),u.scaleAndAdd(vt,vt,tn,l*oe)}const Un=xe+Math.atan2(cn,vn);return je.push(vt),te&&be.push(zt),{point:vt,angle:Un,path:je,tilePath:be,up:St}}const ns=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Jn(h,t){for(let l=0;l<h;l++){const p=t.length;t.resize(p+4),t.float32.set(ns,4*p)}}function Zr(h,t,l){const p=t[0],_=t[1];return h[0]=l[0]*p+l[4]*_+l[12],h[1]=l[1]*p+l[5]*_+l[13],h[3]=l[3]*p+l[7]*_+l[15],h}const Pr=100;class Gi{constructor(t,l,p=new Ot(t.width+200,t.height+200,25),_=new Ot(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Pr,this.screenBottomBoundary=t.height+Pr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=l}placeCollisionBox(t,l,p,_,v,E,I,A){let O=p.projectedAnchorX,V=p.projectedAnchorY,H=p.projectedAnchorZ;const W=p.elevation,te=p.tileID;if(W&&te){const de=t.getProjection().upVector(te.canonical,p.tileAnchorX,p.tileAnchorY),fe=t.getProjection().upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=de[0]*W*fe,V+=de[1]*W*fe,H+=de[2]*W*fe}const ne=this.projectAndGetPerspectiveRatio(I,[O,V,H],p.tileID,"globe"===t.projection.name||!!W||this.transform.pitch>0,t.getProjection()),Q=E*ne.perspectiveRatio,_e=(p.x1*l+_.x-p.padding)*Q+ne.point.x,ee=(p.y1*l+_.y-p.padding)*Q+ne.point.y,ae=(p.x2*l+_.x+p.padding)*Q+ne.point.x,oe=(p.y2*l+_.y+p.padding)*Q+ne.point.y,xe=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(_e,ee,ae,oe)||!v&&this.grid.hitTest(_e,ee,ae,oe,A)||xe?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[_e,ee,ae,oe],offscreen:this.isOffscreen(_e,ee,ae,oe),occluded:!1}}placeCollisionCircles(t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q){const _e=[],ee=this.transform.elevation,ae=ee?ee.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,t.getProjection()):et=>[0,0,0],oe=new u.pointGeometry(p.tileAnchorX,p.tileAnchorY),xe=t.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,Q.canonical),de=ae(oe),fe=[xe.x+de[0],xe.y+de[1],xe.z+de[2]],Se="globe"===t.projection.name,Ge=this.projectAndGetPerspectiveRatio(I,[fe[0],fe[1],fe[2]],Q,Se||!!ee||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:We}=Ge,$e=(H?E/We:E*We)/u.ONE_EM,je=mn(new u.pointGeometry(fe[0],fe[1]),A,fe[2]).point,be=Ge.signedDistanceFromCamera>0?Ar($e,v,p.lineOffsetX*$e,p.lineOffsetY*$e,!1,je,oe,p,_,A,{},ee&&!H?ae:null,H&&!!ee,t.getProjection(),Q,H):null;let ht=!1,lt=!1,kt=!0;if(be&&!Ge.occluded){const et=.5*te*We+ne,rn=new u.pointGeometry(-100,-100),zt=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Lt=new Do,vt=be.first,St=be.last;let vn=[];for(let tn=vt.path.length-1;tn>=1;tn--)vn.push(vt.path[tn]);for(let tn=1;tn<St.path.length;tn++)vn.push(St.path[tn]);const cn=2.5*et;if(O){const tn=vn.map(ee&&!Se?(Cn,cr)=>{const Tr=ae(cr<vt.path.length-1?vt.tilePath[vt.path.length-1-cr]:St.tilePath[cr-vt.path.length+2]);return Cn[2]=Tr[2],ei(Cn,O)}:Cn=>ei(Cn,O));vn=tn.some(Cn=>Cn.signedDistanceFromCamera<=0)?[]:tn.map(Cn=>Cn.point)}let Un=[];if(vn.length>0){const tn=vn.map(kr=>new u.pointGeometry(kr[0],kr[1]));let Cn=1/0,cr=-1/0,Tr=1/0,ii=-1/0;for(let kr=0;kr<tn.length;kr++)Cn=Math.min(Cn,tn[kr].x),Tr=Math.min(Tr,tn[kr].y),cr=Math.max(cr,tn[kr].x),ii=Math.max(ii,tn[kr].y);Un=Cn>=rn.x&&cr<=zt.x&&Tr>=rn.y&&ii<=zt.y?[tn]:cr<rn.x||Cn>zt.x||ii<rn.y||Tr>zt.y?[]:u.clipLine([tn],rn.x,rn.y,zt.x,zt.y)}for(const tn of Un){Lt.reset(tn,.25*et);let Cn=0;Cn=Lt.length<=.5*et?1:Math.ceil(Lt.paddedLength/cn)+1;for(let cr=0;cr<Cn;cr++){const Tr=cr/Math.max(Cn-1,1),ii=Lt.lerp(Tr),kr=ii.x+Pr,as=ii.y+Pr;_e.push(kr,as,et,0);const Ks=kr-et,_a=as-et,$r=kr+et,Br=as+et;if(kt=kt&&this.isOffscreen(Ks,_a,$r,Br),lt=lt||this.isInsideGrid(Ks,_a,$r,Br),!l&&this.grid.hitTestCircle(kr,as,et,W)&&(ht=!0,!V))return{circles:[],offscreen:!1,collisionDetected:ht,occluded:!1}}}}return{circles:!V&&ht||!lt?[]:_e,offscreen:kt,collisionDetected:ht,occluded:Ge.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,_=1/0,v=-1/0,E=-1/0;for(const V of t){const H=new u.pointGeometry(V.x+Pr,V.y+Pr);p=Math.min(p,H.x),_=Math.min(_,H.y),v=Math.max(v,H.x),E=Math.max(E,H.y),l.push(H)}const I=this.grid.query(p,_,v,E).concat(this.ignoredGrid.query(p,_,v,E)),A={},O={};for(const V of I){const H=V.key;if(void 0===A[H.bucketInstanceId]&&(A[H.bucketInstanceId]={}),A[H.bucketInstanceId][H.featureIndex])continue;const W=[new u.pointGeometry(V.x1,V.y1),new u.pointGeometry(V.x2,V.y1),new u.pointGeometry(V.x2,V.y2),new u.pointGeometry(V.x1,V.y2)];u.polygonIntersectsPolygon(l,W)&&(A[H.bucketInstanceId][H.featureIndex]=!0,void 0===O[H.bucketInstanceId]&&(O[H.bucketInstanceId]=[]),O[H.bucketInstanceId].push(H.featureIndex))}return O}insertCollisionBox(t,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,p,_,v){const E=l?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let A=0;A<t.length;A+=4)E.insertCircle(I,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,l,p,_,v){const E=[l[0],l[1],l[2],1];let I=!1;if(l[2]||this.transform.pitch>0){u.transformMat4$1(E,E,t);const A="globe"===v.name;this.fogState&&p&&!A&&(I=function(O,V,H,W,te,ne){const Q=ne.calculateFogTileMatrix(te),_e=[V,H,W];return u.transformMat4(_e,_e,Q),ot(O,_e,ne.pitch,ne._fov)}(this.fogState,l[0],l[1],l[2],p.toUnwrapped(),this.transform)>.9)}else Zr(E,E,t);return{point:new u.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+Pr,(-E[1]/E[3]+1)/2*this.transform.height+Pr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/E[3]*.5,1.5),signedDistanceFromCamera:E[3],occluded:_&&E[2]>E[3]||I}}isOffscreen(t,l,p,_){return p<Pr||t>=this.screenRightBoundary||_<Pr||l>this.screenBottomBoundary}isInsideGrid(t,l,p,_){return p>=0&&t<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=u.identity([]);return u.translate(t,t,[-100,-100,0]),t}}function Kr(h,t,l){const p=t.createTileMatrix(h,h.worldSize,l.toUnwrapped());return u.multiply(new Float32Array(16),h.projMatrix,p)}function vi(h,t,l){if(t.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(t.projection),Kr(p,t.getProjection(),h)}function Hi(h,t,l){return t.name===l.projection.name?h.projMatrix:Kr(l,t,h)}class pr{constructor(t,l,p,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Fr{constructor(t,l,p,_,v,E=!1){this.text=new pr(t?t.text:null,l,p,v),this.icon=new pr(t?t.icon:null,l,_,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fs{constructor(t,l,p,_=!1){this.text=t,this.icon=l,this.skipFade=p,this.clipped=_}}class pl{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Io{constructor(t,l,p,_,v){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class xi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[t]}}function ml(h,t,l,p,_){const{horizontalAlign:v,verticalAlign:E}=u.getAnchorAlignment(h),I=-(v-.5)*t,A=-(E-.5)*l,O=u.evaluateVariableOffset(h,p);return new u.pointGeometry(I+O[0]*_,A+O[1]*_)}function ps(h,t,l,p,_){const v=new u.pointGeometry(h,t);return l&&v._rotate(p?_:-_),v}class jo{constructor(t,l,p,_,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Gi(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new xi(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,l,p,_){const v=p.getBucket(l),E=p.latestFeatureIndex;if(!v||!E||l.id!==v.layerIds[0])return;const I=v.layers[0].layout,A=p.collisionBoxArray,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/u.EXTENT,H=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);const W=(te=p.tileID,ne=v.getProjection(),Q=this.transform,ne.name===this.projection?Q.calculateProjMatrix(te.toUnwrapped()):Kr(Q,ne,te));var te,ne,Q;const _e="map"===I.get("text-pitch-alignment"),ee="map"===I.get("text-rotation-alignment");l.compileFilter();const ae=l.dynamicFilter(),oe=l.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(p),de=fr(W,p.tileID.canonical,_e,ee,this.transform,v.getProjection(),xe);let fe=null;if(_e){const We=so(W,p.tileID.canonical,_e,ee,this.transform,v.getProjection(),xe);fe=u.multiply([],this.transform.labelPlaneMatrix,We)}let Se=null;ae&&p.latestFeatureIndex&&(Se={unwrappedTileID:H,dynamicFilter:ae,dynamicFilterNeedsFeature:oe,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Io(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const Ge={bucket:v,layout:I,posMatrix:W,textLabelPlaneMatrix:de,labelToScreenMatrix:fe,clippingData:Se,scale:O,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const We of v.sortKeyRanges){const{sortKey:$e,symbolInstanceStart:je,symbolInstanceEnd:be}=We;t.push({sortKey:$e,symbolInstanceStart:je,symbolInstanceEnd:be,parameters:Ge})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ge})}attemptAnchorPlacement(t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q,_e,ee,ae){const oe=[W.textOffset0,W.textOffset1],xe=ml(t,p,_,oe,v),de=this.collisionIndex.placeCollisionBox(ne,v,l,ps(xe.x,xe.y,E,I,this.transform.angle),H,A,O,V.predicate);if((!_e||0!==this.collisionIndex.placeCollisionBox(ne,ne.getSymbolInstanceIconSize(ae,this.transform.zoom,te),_e,ps(xe.x,xe.y,E,I,this.transform.angle),H,A,O,V.predicate).box.length)&&de.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[W.crossTileID].anchor),this.variableOffsets[W.crossTileID]={textOffset:oe,width:p,height:_,anchor:t,textScale:v,prevAnchor:fe},this.markUsedJustification(ne,t,W,Q),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,Q,W),this.placedOrientations[W.crossTileID]=Q),{shift:xe,placedGlyphBoxes:de}}}placeLayerBucketPart(t,l,p,_){const{bucket:v,layout:E,posMatrix:I,textLabelPlaneMatrix:A,labelToScreenMatrix:O,clippingData:V,textPixelRatio:H,holdingForFade:W,collisionBoxArray:te,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:Q,collisionGroup:_e}=t.parameters,ee=E.get("text-optional"),ae=E.get("icon-optional"),oe=E.get("text-allow-overlap"),xe=E.get("icon-allow-overlap"),de="map"===E.get("text-rotation-alignment"),fe="map"===E.get("text-pitch-alignment"),Se="none"!==E.get("icon-text-fit"),Ge="viewport-y"===E.get("symbol-z-order");this.transform.setProjection(v.projection);let We=oe&&(xe||!v.hasIconData()||ae),$e=xe&&(oe||!v.hasTextData()||ee);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,te);const je=(be,ht,lt)=>{if(V){const $r={zoom:this.transform.zoom,pitch:this.transform.pitch};let Br=null;if(V.dynamicFilterNeedsFeature){const ur=this.retainedQueryData[v.bucketInstanceId];Br=V.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:ur.bucketIndex,sourceLayerIndex:ur.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,V.dynamicFilter)($r,Br,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new u.pointGeometry(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[be.crossTileID]=new fs(!1,!1,!1,!0),void(l[be.crossTileID]=!0)}if(l[be.crossTileID])return;if(W)return void(this.placements[be.crossTileID]=new fs(!1,!1,!1));let kt=!1,et=!1,rn=!0,zt=!1,Lt=!1,vt=null,St={box:null,offscreen:null,occluded:null},vn={box:null,offscreen:null,occluded:null},cn=null,Un=null,tn=null,Cn=0,cr=0,Tr=0;lt.textFeatureIndex?Cn=lt.textFeatureIndex:be.useRuntimeCollisionCircles&&(Cn=be.featureIndex),lt.verticalTextFeatureIndex&&(cr=lt.verticalTextFeatureIndex);const ii=$r=>{$r.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||$r.elevation)&&($r.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,$r.tileAnchorX,$r.tileAnchorY):0)},kr=lt.textBox;if(kr){ii(kr);const $r=ur=>{let Ei=u.WritingMode.horizontal;if(v.allowVerticalPlacement&&!ur&&this.prevPlacement){const qi=this.prevPlacement.placedOrientations[be.crossTileID];qi&&(this.placedOrientations[be.crossTileID]=qi,Ei=qi,this.markUsedOrientation(v,Ei,be))}return Ei},Br=(ur,Ei)=>{if(v.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const qi of v.writingModes)if(qi===u.WritingMode.vertical?(St=Ei(),vn=St):St=ur(),St&&St.box&&St.box.length)break}else St=ur()};if(E.get("text-variable-anchor")){let ur=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const sr=this.prevPlacement.variableOffsets[be.crossTileID];ur.indexOf(sr.anchor)>0&&(ur=ur.filter(vo=>vo!==sr.anchor),ur.unshift(sr.anchor))}const Ei=(sr,vo,dc)=>{const Yo=v.getSymbolInstanceTextSize(ne,be,this.transform.zoom,ht),fc=(sr.x2-sr.x1)*Yo+2*sr.padding,Rl=(sr.y2-sr.y1)*Yo+2*sr.padding,As=Se&&!xe?vo:null;As&&ii(As);let oi={box:[],offscreen:!1,occluded:!1};const xo=oe?2*ur.length:ur.length;for(let ya=0;ya<xo;++ya){const Gc=this.attemptAnchorPlacement(ur[ya%ur.length],sr,fc,Rl,Yo,de,fe,H,I,_e,ya>=ur.length,be,ht,v,dc,As,ne,Q);if(Gc&&(oi=Gc.placedGlyphBoxes,oi&&oi.box&&oi.box.length)){kt=!0,vt=Gc.shift;break}}return oi};Br(()=>Ei(kr,lt.iconBox,u.WritingMode.horizontal),()=>{const sr=lt.verticalTextBox;return sr&&ii(sr),v.allowVerticalPlacement&&!(St&&St.box&&St.box.length)&&be.numVerticalGlyphVertices>0&&sr?Ei(sr,lt.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),St&&(kt=St.box,rn=St.offscreen,zt=St.occluded);const qi=$r(St&&St.box);if(!kt&&this.prevPlacement){const sr=this.prevPlacement.variableOffsets[be.crossTileID];sr&&(this.variableOffsets[be.crossTileID]=sr,this.markUsedJustification(v,sr.anchor,be,qi))}}else{const ur=(Ei,qi)=>{const sr=v.getSymbolInstanceTextSize(ne,be,this.transform.zoom,ht),vo=this.collisionIndex.placeCollisionBox(v,sr,Ei,new u.pointGeometry(0,0),oe,H,I,_e.predicate);return vo&&vo.box&&vo.box.length&&(this.markUsedOrientation(v,qi,be),this.placedOrientations[be.crossTileID]=qi),vo};Br(()=>ur(kr,u.WritingMode.horizontal),()=>{const Ei=lt.verticalTextBox;return v.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Ei?(ii(Ei),ur(Ei,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),$r(St&&St.box&&St.box.length)}}if(cn=St,kt=cn&&cn.box&&cn.box.length>0,rn=cn&&cn.offscreen,zt=cn&&cn.occluded,be.useRuntimeCollisionCircles){const $r=v.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),Br=u.evaluateSizeForFeature(v.textSizeData,ne,$r),ur=E.get("text-padding");Un=this.collisionIndex.placeCollisionCircles(v,oe,$r,v.lineVertexArray,v.glyphOffsetArray,Br,I,A,O,p,fe,_e.predicate,be.collisionCircleDiameter*Br/u.ONE_EM,ur,this.retainedQueryData[v.bucketInstanceId].tileID),kt=oe||Un.circles.length>0&&!Un.collisionDetected,rn=rn&&Un.offscreen,zt=Un.occluded}if(lt.iconFeatureIndex&&(Tr=lt.iconFeatureIndex),lt.iconBox){const $r=Br=>{ii(Br);const ur=Se&&vt?ps(vt.x,vt.y,de,fe,this.transform.angle):new u.pointGeometry(0,0),Ei=v.getSymbolInstanceIconSize(Q,this.transform.zoom,ht);return this.collisionIndex.placeCollisionBox(v,Ei,Br,ur,xe,H,I,_e.predicate)};vn&&vn.box&&vn.box.length&&lt.verticalIconBox?(tn=$r(lt.verticalIconBox),et=tn.box.length>0):(tn=$r(lt.iconBox),et=tn.box.length>0),rn=rn&&tn.offscreen,Lt=tn.occluded}const as=ee||0===be.numHorizontalGlyphVertices&&0===be.numVerticalGlyphVertices,Ks=ae||0===be.numIconVertices;if(as||Ks?Ks?as||(et=et&&kt):kt=et&&kt:et=kt=et&&kt,kt&&cn&&cn.box&&this.collisionIndex.insertCollisionBox(cn.box,E.get("text-ignore-placement"),v.bucketInstanceId,vn&&vn.box&&cr?cr:Cn,_e.ID),et&&tn&&this.collisionIndex.insertCollisionBox(tn.box,E.get("icon-ignore-placement"),v.bucketInstanceId,Tr,_e.ID),Un&&(kt&&this.collisionIndex.insertCollisionCircles(Un.circles,E.get("text-ignore-placement"),v.bucketInstanceId,Cn,_e.ID),p)){const $r=v.bucketInstanceId;let Br=this.collisionCircleArrays[$r];void 0===Br&&(Br=this.collisionCircleArrays[$r]=new pl);for(let ur=0;ur<Un.circles.length;ur+=4)Br.circles.push(Un.circles[ur+0]),Br.circles.push(Un.circles[ur+1]),Br.circles.push(Un.circles[ur+2]),Br.circles.push(Un.collisionDetected?1:0)}const _a="globe"!==v.projection.name;We=We&&(_a||!zt),$e=$e&&(_a||!Lt),this.placements[be.crossTileID]=new fs(kt||We,et||$e,rn||v.justReloaded),l[be.crossTileID]=!0};if(Ge){const be=v.getSortedSymbolIndexes(this.transform.angle);for(let ht=be.length-1;ht>=0;--ht){const lt=be[ht];je(v.symbolInstances.get(lt),lt,v.collisionArrays[lt])}}else for(let be=t.symbolInstanceStart;be<t.symbolInstanceEnd;be++)je(v.symbolInstances.get(be),be,v.collisionArrays[be]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[v.bucketInstanceId];u.invert(be.invProjMatrix,I),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,l,p,_){let v;v=_===u.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(l)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=v>=0&&I!==v?0:p.crossTileID)}markUsedOrientation(t,l,p){const _=l===u.WritingMode.horizontal||l===u.WritingMode.horizontalOnly?l:0,v=l===u.WritingMode.vertical?l:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const I of E)t.text.placedSymbolArray.get(I).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(t):1,v=l?l.opacities:{},E=l?l.variableOffsets:{},I=l?l.placedOrientations:{};for(const A in this.placements){const O=this.placements[A],V=v[A];V?(this.opacities[A]=new Fr(V,_,O.text,O.icon,null,O.clipped),p=p||O.text!==V.text.placed||O.icon!==V.icon.placed):(this.opacities[A]=new Fr(null,_,O.text,O.icon,O.skipFade,O.clipped),p=p||O.text||O.icon)}for(const A in v){const O=v[A];if(!this.opacities[A]){const V=new Fr(O,_,!1,!1);V.isHidden()||(this.opacities[A]=V,p=p||O.text.placed||O.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in I)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=I[A]);p?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const p={};for(const _ of l){const v=_.getBucket(t);v&&_.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(t,l,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0].layout,v=!!t.layers[0].dynamicFilter(),E=new Fr(null,0,!1,!1,!0),I=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),O=_.get("text-variable-anchor"),V="map"===_.get("text-rotation-alignment"),H="map"===_.get("text-pitch-alignment"),W="none"!==_.get("icon-text-fit"),te=new Fr(null,0,I&&(A||!t.hasIconData()||_.get("icon-optional")),A&&(I||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ne=(_e,ee,ae)=>{for(let oe=0;oe<ee/4;oe++)_e.opacityVertexArray.emplaceBack(ae)};let Q=0;for(let _e=0;_e<t.symbolInstances.length;_e++){const ee=t.symbolInstances.get(_e),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:oe,crossTileID:xe}=ee;let de=this.opacities[xe];l[xe]?de=E:de||(de=te,this.opacities[xe]=de),l[xe]=!0;const fe=ae>0||oe>0,Se=ee.numIconVertices>0,Ge=this.placedOrientations[ee.crossTileID],We=Ge===u.WritingMode.vertical,$e=Ge===u.WritingMode.horizontal||Ge===u.WritingMode.horizontalOnly;if(!fe&&!Se||de.isHidden()||Q++,fe){const je=So(de.text);ne(t.text,ae,We?ms:je),ne(t.text,oe,$e?ms:je);const be=de.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(kt=>{kt>=0&&(t.text.placedSymbolArray.get(kt).hidden=be||We?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=be||$e?1:0);const ht=this.variableOffsets[ee.crossTileID];ht&&this.markUsedJustification(t,ht.anchor,ee,Ge);const lt=this.placedOrientations[ee.crossTileID];lt&&(this.markUsedJustification(t,"left",ee,lt),this.markUsedOrientation(t,lt,ee))}if(Se){const je=So(de.icon);ee.placedIconSymbolIndex>=0&&(ne(t.icon,ee.numIconVertices,We?ms:je),t.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=de.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(ne(t.icon,ee.numVerticalIconVertices,$e?ms:je),t.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const je=t.collisionArrays[_e];if(je){let be=new u.pointGeometry(0,0),ht=!0;if(je.textBox||je.verticalTextBox){if(O){const kt=this.variableOffsets[xe];kt?(be=ml(kt.anchor,kt.width,kt.height,kt.textOffset,kt.textScale),V&&be._rotate(H?this.transform.angle:-this.transform.angle)):ht=!1}v&&(ht=!de.clipped),je.textBox&&$o(t.textCollisionBox.collisionVertexArray,de.text.placed,!ht||We,be.x,be.y),je.verticalTextBox&&$o(t.textCollisionBox.collisionVertexArray,de.text.placed,!ht||$e,be.x,be.y)}const lt=ht&&Boolean(!$e&&je.verticalIconBox);je.iconBox&&$o(t.iconCollisionBox.collisionVertexArray,de.icon.placed,lt,W?be.x:0,W?be.y:0),je.verticalIconBox&&$o(t.iconCollisionBox.collisionVertexArray,de.icon.placed,!lt,W?be.x:0,W?be.y:0)}}}if(t.fullyClipped=0===Q,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=_e.invProjMatrix,t.placementViewportMatrix=_e.viewportMatrix,t.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function $o(h,t,l,p,_){h.emplaceBack(t?1:0,l?1:0,p||0,_||0),h.emplaceBack(t?1:0,l?1:0,p||0,_||0),h.emplaceBack(t?1:0,l?1:0,p||0,_||0),h.emplaceBack(t?1:0,l?1:0,p||0,_||0)}const Pa=Math.pow(2,25),Wl=Math.pow(2,24),Ra=Math.pow(2,17),oa=Math.pow(2,16),ka=Math.pow(2,9),Rc=Math.pow(2,8),sa=Math.pow(2,1);function So(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const t=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Pa+t*Wl+l*Ra+t*oa+l*ka+t*Rc+l*sa+t}const ms=0;class Ki{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,p,_,v){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(E,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,A)=>I.sortKey-A.sortKey));this._currentPartIndex<E.length;){const I=E[this._currentPartIndex];if(l.placeLayerBucketPart(I,this._seenCrossTileIDs,p,0===I.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class Go{constructor(t,l,p,_,v,E,I,A){this.placement=new jo(t,v,E,I,A),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,l,p){const _=u.exported.now(),v=()=>{const E=u.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=l[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Ki(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const aa=512/u.EXTENT/2;class gl{constructor(t,l,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const v=l.get(_),E=v.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,t)})}}getScaledCoordinates(t,l){const p=aa/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*u.EXTENT+t.tileAnchorX)*p),y:Math.floor((l.canonical.y*u.EXTENT+t.tileAnchorY)*p)}}findMatches(t,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<t.length;v++){const E=t.get(v);if(E.crossTileID)continue;const I=this.indexedSymbolInstances[E.key];if(!I)continue;const A=this.getScaledCoordinates(E,l);for(const O of I)if(Math.abs(O.coord.x-A.x)<=_&&Math.abs(O.coord.y-A.y)<=_&&!p[O.crossTileID]){p[O.crossTileID]=!0,E.crossTileID=O.crossTileID;break}}}}class _l{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ho{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(0!==l)for(const p in this.indexes){const _=this.indexes[p],v={};for(const E in _){const I=_[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+l),v[I.tileID.key]=I}this.indexes[p]=v}this.lng=t}addBucket(t,l,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>t.overscaledZ)for(const I in E){const A=E[I];A.tileID.isChildOf(t)&&A.findMatches(l.symbolInstances,t,_)}else{const I=E[t.scaledTo(Number(v)).key];I&&I.findMatches(l.symbolInstances,t,_)}}for(let v=0;v<l.symbolInstances.length;v++){const E=l.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new gl(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][_.crossTileID]}removeStaleBuckets(t){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)t[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class yl{constructor(){this.layerIndexes={},this.crossTileIDs=new _l,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,p,_){let v=this.layerIndexes[t.id];void 0===v&&(v=this.layerIndexes[t.id]=new Ho);let E=!1;const I={};"globe"!==_.name&&v.handleWrapJump(p);for(const A of l){const O=A.getBucket(t);O&&t.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(A.tileID,O,this.crossTileIDs)&&(E=!0),I[O.bucketInstanceId]=!0)}return v.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(t){const l={};t.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const gs=(h,t)=>u.emitValidationErrors(h,t&&t.filter(l=>"source.canvas"!==l.identifier)),vl=u.pick(ke,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Xl=u.pick(ke,["setCenter","setZoom","setBearing","setPitch"]),Yl={version:8,layers:[],sources:{}},_s={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class go extends u.Evented{constructor(t,l={}){super(),this.map=t,this.dispatcher=new Zn(rt(),this),this.imageManager=new rr,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(t._requestManager,l.localFontFamily?u.LocalGlyphMode.all:l.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new u.LineAtlas(256,512),this.crossTileSymbolIndex=new yl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const p=this;this._rtlTextPluginCallback=go.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,E)=>{if(u.triggerPluginCompletionEvent(v),E&&E.every(I=>I))for(const I in p._sourceCaches){const A=p._sourceCaches[I],O=A.getSource().type;"vector"!==O&&"geojson"!==O||A.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===v.id&&this._validateLayer(I)}})}loadURL(t,l={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!u.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,l.accessToken);const _=this.map._requestManager.transformRequest(t,u.ResourceType.Style);this._request=u.getJSON(_,(v,E)=>{this._request=null,v?this.fire(new u.ErrorEvent(v)):E&&this._load(E,p)})}loadJSON(t,l={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(t,!1!==l.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Yl,!1)}_updateLayerCount(t,l){const p=l?1:-1;t.is3D()&&(this._num3DLayers+=p),"circle"===t.type&&(this._numCircleLayers+=p),"symbol"===t.type&&(this._numSymbolLayers+=p)}_load(t,l){if(l&&gs(this,u.validateStyle(t)))return;this._loaded=!0,this.stylesheet=u.clone$1(t),this._updateMapProjection();for(const _ in t.sources)this.addSource(_,t.sources[_],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const p=nn(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=u.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Mn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(l,p,_){let v,E,I;const A=u.exported.devicePixelRatio>1?"@2x":"";let O=u.getJSON(p.transformRequest(p.normalizeSpriteURL(l,A,".json"),u.ResourceType.SpriteJSON),(W,te)=>{O=null,I||(I=W,v=te,H())}),V=u.getImage(p.transformRequest(p.normalizeSpriteURL(l,A,".png"),u.ResourceType.SpriteImage),(W,te)=>{V=null,I||(I=W,E=te,H())});function H(){if(I)_(I);else if(v&&E){const W=u.exported.getImageData(E),te={};for(const ne in v){const{width:Q,height:_e,x:ee,y:ae,sdf:oe,pixelRatio:xe,stretchX:de,stretchY:fe,content:Se}=v[ne],Ge=new u.RGBAImage({width:Q,height:_e});u.RGBAImage.copy(W,Ge,{x:ee,y:ae},{x:0,y:0},{width:Q,height:_e}),te[ne]={data:Ge,pixelRatio:xe,sdf:oe,stretchX:de,stretchY:fe,content:Se}}_(null,te)}}return{cancel(){O&&(O.cancel(),O=null),V&&(V.cancel(),V=null)}}}(t,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new u.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(t){const l=this.getSource(t.source);if(!l)return;const p=t.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const l=[];for(const p of t){const _=this._layers[p];"custom"!==_.type&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&_s[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const E in this._updatedSources){const I=this._updatedSources[E];"reload"===I?this._reloadSource(E):"clear"===I&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];if(v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)){const I=this._getLayerSourceCache(v);I&&(I.used=!0)}const E=this.map.painter;if(E){const I=v.getProgramIds();if(!I)continue;const A=v.getProgramConfiguration(t.zoom);for(const O of I)E.useProgram(O,A)}}for(const _ in p){const v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),gs(this,u.validateStyle(t)))return!1;(t=u.clone$1(t)).layers=nn(t.layers);const l=function(_,v){if(!_)return[{command:ke.setStyle,args:[v]}];let E=[];try{if(!Ae(_.version,v.version))return[{command:ke.setStyle,args:[v]}];Ae(_.center,v.center)||E.push({command:ke.setCenter,args:[v.center]}),Ae(_.zoom,v.zoom)||E.push({command:ke.setZoom,args:[v.zoom]}),Ae(_.bearing,v.bearing)||E.push({command:ke.setBearing,args:[v.bearing]}),Ae(_.pitch,v.pitch)||E.push({command:ke.setPitch,args:[v.pitch]}),Ae(_.sprite,v.sprite)||E.push({command:ke.setSprite,args:[v.sprite]}),Ae(_.glyphs,v.glyphs)||E.push({command:ke.setGlyphs,args:[v.glyphs]}),Ae(_.transition,v.transition)||E.push({command:ke.setTransition,args:[v.transition]}),Ae(_.light,v.light)||E.push({command:ke.setLight,args:[v.light]}),Ae(_.fog,v.fog)||E.push({command:ke.setFog,args:[v.fog]}),Ae(_.projection,v.projection)||E.push({command:ke.setProjection,args:[v.projection]});const I={},A=[];!function(H,W,te,ne){let Q;for(Q in W=W||{},H=H||{})H.hasOwnProperty(Q)&&(W.hasOwnProperty(Q)||Tn(Q,te,ne));for(Q in W)W.hasOwnProperty(Q)&&(H.hasOwnProperty(Q)?Ae(H[Q],W[Q])||("geojson"===H[Q].type&&"geojson"===W[Q].type&&Mr(H,W,Q)?te.push({command:ke.setGeoJSONSourceData,args:[Q,W[Q].data]}):xn(Q,W,te,ne)):Hr(Q,W,te))}(_.sources,v.sources,A,I);const O=[];_.layers&&_.layers.forEach(H=>{H.source&&I[H.source]?E.push({command:ke.removeLayer,args:[H.id]}):O.push(H)});let V=_.terrain;V&&I[V.source]&&(E.push({command:ke.setTerrain,args:[void 0]}),V=void 0),E=E.concat(A),Ae(V,v.terrain)||E.push({command:ke.setTerrain,args:[v.terrain]}),function(H,W,te){W=W||[];const ne=(H=H||[]).map(yi),Q=W.map(yi),_e=H.reduce(Bn,{}),ee=W.reduce(Bn,{}),ae=ne.slice(),oe=Object.create(null);let xe,de,fe,Se,Ge,We,$e;for(xe=0,de=0;xe<ne.length;xe++)fe=ne[xe],ee.hasOwnProperty(fe)?de++:(te.push({command:ke.removeLayer,args:[fe]}),ae.splice(ae.indexOf(fe,de),1));for(xe=0,de=0;xe<Q.length;xe++)fe=Q[Q.length-1-xe],ae[ae.length-1-xe]!==fe&&(_e.hasOwnProperty(fe)?(te.push({command:ke.removeLayer,args:[fe]}),ae.splice(ae.lastIndexOf(fe,ae.length-de),1)):de++,We=ae[ae.length-xe],te.push({command:ke.addLayer,args:[ee[fe],We]}),ae.splice(ae.length-xe,0,fe),oe[fe]=!0);for(xe=0;xe<Q.length;xe++)if(fe=Q[xe],Se=_e[fe],Ge=ee[fe],!oe[fe]&&!Ae(Se,Ge))if(Ae(Se.source,Ge.source)&&Ae(Se["source-layer"],Ge["source-layer"])&&Ae(Se.type,Ge.type)){for($e in _i(Se.layout,Ge.layout,te,fe,null,ke.setLayoutProperty),_i(Se.paint,Ge.paint,te,fe,null,ke.setPaintProperty),Ae(Se.filter,Ge.filter)||te.push({command:ke.setFilter,args:[fe,Ge.filter]}),Ae(Se.minzoom,Ge.minzoom)&&Ae(Se.maxzoom,Ge.maxzoom)||te.push({command:ke.setLayerZoomRange,args:[fe,Ge.minzoom,Ge.maxzoom]}),Se)Se.hasOwnProperty($e)&&"layout"!==$e&&"paint"!==$e&&"filter"!==$e&&"metadata"!==$e&&"minzoom"!==$e&&"maxzoom"!==$e&&(0===$e.indexOf("paint.")?_i(Se[$e],Ge[$e],te,fe,$e.slice(6),ke.setPaintProperty):Ae(Se[$e],Ge[$e])||te.push({command:ke.setLayerProperty,args:[fe,$e,Ge[$e]]}));for($e in Ge)Ge.hasOwnProperty($e)&&!Se.hasOwnProperty($e)&&"layout"!==$e&&"paint"!==$e&&"filter"!==$e&&"metadata"!==$e&&"minzoom"!==$e&&"maxzoom"!==$e&&(0===$e.indexOf("paint.")?_i(Se[$e],Ge[$e],te,fe,$e.slice(6),ke.setPaintProperty):Ae(Se[$e],Ge[$e])||te.push({command:ke.setLayerProperty,args:[fe,$e,Ge[$e]]}))}else te.push({command:ke.removeLayer,args:[fe]}),We=ae[ae.lastIndexOf(fe)+1],te.push({command:ke.addLayer,args:[Ge,We]})}(O,v.layers,E)}catch(I){console.warn("Unable to compute style diff:",I),E=[{command:ke.setStyle,args:[v]}]}return E}(this.serialize(),t).filter(_=>!(_.command in Xl));if(0===l.length)return!1;const p=l.filter(_=>!(_.command in vl));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{"setTransition"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,l){return this.getImage(t)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,l),this._afterImageUpdated(t),this)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(u.validateSource,`sources.${t}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Ne(t,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:_.serialize(),sourceId:t}));const v=E=>{const I=(E?"symbol:":"other:")+t,A=this._sourceCaches[I]=new u.SourceCache(I,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[t]=A,A.style=this,A.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const l=this.getSource(t);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(t);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,l){this._checkLoaded(),this.getSource(t).setData(l),this._changed=!0}getSource(t){const l=this._getSourceCache(t);return l&&l.getSource()}addLayer(t,l,p={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if("custom"===t.type){if(gs(this,u.validateCustomStyleLayer(t)))return;v=u.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(_,t.source),t=u.clone$1(t),t=u.extend(t,{source:_})),this._validate(u.validateLayer,`layers.${_}`,t,{arrayIndex:-1},p))return;v=u.createStyleLayer(t),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const E=l?this._order.indexOf(l):this._order.length;if(l&&-1===E)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const I=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&I&&"custom"!==v.type){const A=this._removedLayers[_];delete this._removedLayers[_],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",I.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const p=this._order.indexOf(t);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&-1===_?this.fire(new u.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const l in this._layers)if(this._layers[l].type===t)return!0;return!1}setLayerZoomRange(t,l,p){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===l&&_.maxzoom===p||(null!=l&&(_.minzoom=l),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,l,p={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!Ae(_.filter,l))return null==l?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(u.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=u.clone$1(l),this._updateLayer(_)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const l=this.getLayer(t);return l&&u.clone$1(l.filter)}setLayoutProperty(t,l,p,_={}){this._checkLoaded();const v=this.getLayer(t);v?Ae(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,_),this._updateLayer(v)):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,l){const p=this.getLayer(t);if(p)return p.getLayoutProperty(l);this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,l,p,_={}){this._checkLoaded();const v=this.getLayer(t);v?Ae(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,l){const p=this.getLayer(t);return p&&p.getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const p=t.source,_=t.sourceLayer,v=this.getSource(p);if(!v)return void this.fire(new u.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.type;if("geojson"===E&&_)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!_)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(p);for(const A of I)A.setFeatureState(_,t.id,l)}removeFeatureState(t,l){this._checkLoaded();const p=t.source,_=this.getSource(p);if(!_)return void this.fire(new u.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.type,E="vector"===v?t.sourceLayer:void 0;if("vector"===v&&!E)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(p);for(const A of I)A.removeFeatureState(E,t.id,l)}getFeatureState(t){this._checkLoaded();const l=t.source,p=t.sourceLayer,_=this.getSource(l);if(_){if("vector"!==_.type||p)return void 0===t.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,t.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();t[p.id]||(t[p.id]=p.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(t){this._updatedLayers[t.id]=!0;const l=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[t.source]="reload",l.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const l=E=>"fill-extrusion"===this._layers[E].type,p={},_=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(l(I)){p[I]=E;for(const A of t){const O=A[I];if(O)for(const V of O)_.push(V)}}}_.sort((E,I)=>I.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(l(I))for(let A=_.length-1;A>=0;A--){const O=_[A].feature;if(p[O.layer.id]<E)break;v.push(O),_.pop()}else for(const A of t){const O=A[I];if(O)for(const V of O)v.push(V.feature)}}return v}queryRenderedFeatures(t,l,p){l&&l.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of l.layers){const O=this._layers[A];if(!O)return this.fire(new u.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];_[O.source]=!0}}const v=[];l.availableImages=this._availableImages;const E=l&&l.layers?l.layers.some(A=>{const O=this.getLayer(A);return O&&O.is3D()}):this.has3DLayers(),I=_r.createFromScreenPoints(t,p);for(const A in this._sourceCaches){const O=this._sourceCaches[A].getSource().id;l.layers&&!_[O]||v.push(At(this._sourceCaches[A],this._layers,this._serializedLayers,I,l,p,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(A,O,V,H,W,te,ne){const Q={},_e=te.queryRenderedSymbols(H),ee=[];for(const ae of Object.keys(_e).map(Number))ee.push(ne[ae]);ee.sort(he);for(const ae of ee){const oe=ae.featureIndex.lookupSymbolFeatures(_e[ae.bucketInstanceId],O,ae.bucketIndex,ae.sourceLayerIndex,W.filter,W.layers,W.availableImages,A);for(const xe in oe){const de=Q[xe]=Q[xe]||[],fe=oe[xe];fe.sort((Se,Ge)=>{const We=ae.featureSortOrder;if(We){const $e=We.indexOf(Se.featureIndex);return We.indexOf(Ge.featureIndex)-$e}return Ge.featureIndex-Se.featureIndex});for(const Se of fe)de.push(Se)}}for(const ae in Q)Q[ae].forEach(oe=>{const xe=oe.feature,de=V(A[ae]).getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=de});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,l){l&&l.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(t);let _=[];for(const v of p)_=_.concat(ve(v,l));return _}addSourceType(t,l,p){return go.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(go.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in t)if(!Ae(t[E],p[E])){_=!0;break}if(!_)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,l=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof t.source){const p="terrain-dem-src";this.addSource(p,t.source),t=u.clone$1(t),t=u.extend(t,{source:p})}if(this._validate(u.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(t,l);else{const p=this.terrain,_=p.get();for(const v of Object.keys(u.spec.terrain))!t.hasOwnProperty(v)&&u.spec.terrain[v].default&&(t[v]=u.spec.terrain[v].default);for(const v in t)if(!Ae(t[v],_[v])){p.set(t),this.stylesheet.terrain=t;const E=this._setTransitionParameters({duration:0});p.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const l=this.fog=new fn(t,this.map.transform);this.stylesheet.fog=t;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();0===Object.keys(t).length&&l.set(t);for(const _ in t)if(!Ae(t[_],p[_])){l.set(t),this.stylesheet.fog=t;const v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:u.exported.now(),transition:u.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...l)}_createTerrain(t,l){const p=this.terrain=new Qe(t,l);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const l=this._layers[t];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const l=this._layers[t];"symbol"===l.type&&this._updateLayer(l)}}_validate(t,l,p,_,v={}){return(!v||!1!==v.validate)&&gs(this,t.call(u.validateStyle,u.extend({key:l,style:this.serialize(),value:p,styleSpec:u.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const l=this._getSourceCaches(t);for(const p of l)p.clearTiles()}_reloadSource(t){const l=this._getSourceCaches(t);for(const p of l)p.resume(),p.reload()}_updateSources(t){for(const l in this._sourceCaches)this._sourceCaches[l].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const l=this._sourceCaches[t];l.resume(),l.reload()}}_updatePlacement(t,l,p,_,v=!1){let E=!1,I=!1;const A={};for(const O of this._order){const V=this._layers[O];if("symbol"!==V.type)continue;if(!A[V.source]){const W=this._getLayerSourceCache(V);if(!W)continue;A[V.source]=W.getRenderableIds(!0).map(te=>W.getTileByID(te)).sort((te,ne)=>ne.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ne.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(V,A[V.source],t.center.lng,t.projection);E=E||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),t.zoom))&&(this.pauseablePlacement=new Go(t,this._order,v,l,p,_,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const O of this._order){const V=this._layers[O];"symbol"===V.type&&this.placement.updateLayerOpacities(V,A[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(t,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(t,l,p){return u.makeRequest(l,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const l=[];return this._otherSourceCaches[t]&&l.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&l.push(this._symbolSourceCaches[t]),l}_isSourceCacheLoaded(t){const l=this._getSourceCaches(t);return 0===l.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}go.getSourceType=function(h){return Ie[h]},go.setSourceType=function(h,t){Ie[h]=t},go.registerForPluginStateChange=u.registerForPluginStateChange;var La="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Fa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let la={},ti={};la=or("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ti=or("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Fs=or("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Mo=La,ao="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Os={background:or("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:or("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:or("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:or("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:or("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:or("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:or("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:or("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:or("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:or("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:or("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:or("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:or("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:or("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:or("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:or("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:or("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:or("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:or("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:or("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:or("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:or("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:or("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:or("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:or("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:or("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Fa),skyboxGradient:or("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Fa),skyboxCapture:or("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:or("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:or("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function or(h,t,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=h.match(_),I=t.match(_),A=La.match(_);let O=I?I.concat(E):E;l||(la.staticUniforms&&(O=la.staticUniforms.concat(O)),ti.staticUniforms&&(O=ti.staticUniforms.concat(O))),O&&(O=O.concat(A));const V={};return{fragmentSource:h=h.replace(p,(H,W,te,ne,Q)=>(V[Q]=!0,"define"===W?`\n#ifndef HAS_UNIFORM_u_${Q}\nvarying ${te} ${ne} ${Q};\n#else\nuniform ${te} ${ne} u_${Q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${te} ${ne} ${Q} = u_${Q};\n#endif\n`)),vertexSource:t=t.replace(p,(H,W,te,ne,Q)=>{const _e="float"===ne?"vec2":"vec4",ee=Q.match(/color/)?"color":_e;return V[Q]?"define"===W?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${te} ${_e} a_${Q};\nvarying ${te} ${ne} ${Q};\n#else\nuniform ${te} ${ne} u_${Q};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${te} ${ne} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${ee}(a_${Q}, u_${Q}_t);\n#else\n    ${te} ${ne} ${Q} = u_${Q};\n#endif\n`:"define"===W?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${te} ${_e} a_${Q};\n#else\nuniform ${te} ${ne} u_${Q};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${te} ${ne} ${Q} = a_${Q};\n#else\n    ${te} ${ne} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${te} ${ne} ${Q} = unpack_mix_${ee}(a_${Q}, u_${Q}_t);\n#else\n    ${te} ${ne} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:v,staticUniforms:O}}class Qr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,p,_,v,E,I,A,O){this.context=t;let V=this.boundPaintVertexBuffers.length!==_.length;for(let H=0;!V&&H<_.length;H++)this.boundPaintVertexBuffers[H]!==_[H]&&(V=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!V&&this.boundIndexBuffer===v&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===A&&this.boundDynamicVertexBuffer3===O?(t.bindVertexArrayOES.set(this.vao),I&&I.bind(),v&&v.dynamicDraw&&v.bind(),A&&A.bind(),O&&O.bind()):this.freshBind(l,p,_,v,E,I,A,O)}freshBind(t,l,p,_,v,E,I,A){let O;const V=t.numAttributes,H=this.context,W=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=A;else{O=H.currentNumAttributes||0;for(let te=V;te<O;te++)W.disableVertexAttribArray(te)}l.enableAttributes(W,t);for(const te of p)te.enableAttributes(W,t);E&&E.enableAttributes(W,t),I&&I.enableAttributes(W,t),A&&A.enableAttributes(W,t),l.bind(),l.setVertexAttribPointers(W,t,v);for(const te of p)te.bind(),te.setVertexAttribPointers(W,t,v);E&&(E.bind(),E.setVertexAttribPointers(W,t,v)),_&&_.bind(),I&&(I.bind(),I.setVertexAttribPointers(W,t,v)),A&&(A.bind(),A.setVertexAttribPointers(W,t,v)),H.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function z(h,t){const l=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new u.MercatorCoordinate(0,p/l).toLngLat().lat,new u.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function K(h,t,l,p,_,v,E){const I=h.context,A=I.gl,O=l.fbo;if(!O)return;h.prepareDrawTile();const V=h.useProgram("hillshade");I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.colorAttachment.get());const H=((Q,_e,ee,ae)=>{const oe=ee.paint.get("hillshade-shadow-color"),xe=ee.paint.get("hillshade-highlight-color"),de=ee.paint.get("hillshade-accent-color");let fe=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ee.paint.get("hillshade-illumination-anchor")&&(fe-=Q.transform.angle);const Se=!Q.options.moving;return{u_matrix:ae||Q.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),Se),u_image:0,u_latrange:z(0,_e.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),fe],u_shadow:oe,u_highlight:xe,u_accent:de}})(h,l,p,h.terrain?t.projMatrix:null);h.prepareDrawProgram(I,V,t.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:te,tileBoundsSegments:ne}=h.getTileBoundsBuffers(l);V.draw(I,A.TRIANGLES,_,v,E,u.CullFaceMode.disabled,H,p.id,W,te,ne)}function B(h,t,l){if(!t.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(l.stride);const v=l.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new u.Texture(p,v,_.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function J(h,t,l,p,_,v){const E=h.context,I=E.gl;if(!t.dem)return;const A=t.dem;if(E.activeTexture.set(I.TEXTURE1),B(h,t,A),!t.demTexture)return;t.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const O=A.dim;E.activeTexture.set(I.TEXTURE0);let V=t.fbo;if(!V){const ne=new u.Texture(E,{width:O,height:O,data:null},I.RGBA);ne.bind(I.LINEAR,I.CLAMP_TO_EDGE),V=t.fbo=E.createFramebuffer(O,O,!0),V.colorAttachment.set(ne.texture)}E.bindFramebuffer.set(V.framebuffer),E.viewport.set([0,0,O,O]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:W,tileBoundsSegments:te}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(E,I.TRIANGLES,p,_,v,u.CullFaceMode.disabled,((ne,Q)=>{const _e=Q.stride,ee=u.create();return u.ortho(ee,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(ee,ee,[0,-u.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[_e,_e],u_zoom:ne.overscaledZ,u_unpack:Q.unpackVector}})(t.tileID,A),l.id,H,W,te),t.needsHillshadePrepare=!1}const Le=(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image0:new u.Uniform1i(h,t.u_image0),u_skirt_height:new u.Uniform1f(h,t.u_skirt_height)}),st=(h,t)=>({u_matrix:h,u_image0:0,u_skirt_height:t}),Je=(h,t,l,p,_,v,E,I,A,O,V,H,W,te)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:E,u_frustum_tr:I,u_frustum_br:A,u_frustum_bl:O,u_globe_pos:V,u_globe_radius:H,u_viewport:W,u_grid_matrix:te?Float32Array.from(te):new Float32Array(9)});function Yt(h,t){return null!=h&&null!=t&&!(!h.hasData()||!t.hasData())&&null!=h.demTexture&&null!=t.demTexture&&h.tileID.key!==t.tileID.key}const lr=new class{constructor(){this.operations={}}newMorphing(h,t,l,p,_){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:_,from:t,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const l=this.operations[t];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},mr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function wr(h,t){const l=1<<h.z;return!t&&(0===h.x||h.x===l-1)||0===h.y||h.y===l-1}const yn=h=>({u_matrix:h});function ni(h,t,l,p,_){if(_>0){const v=u.exported.now(),E=(v-h.timeAdded)/_,I=t?(v-t.timeAdded)/_:-1,A=l.getSource(),O=p.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(h.tileID.overscaledZ-O),H=V&&h.refreshedUponExpiration?1:u.clamp(V?E:1-I,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Rr extends u.SourceCache{constructor(t){const l={type:"raster-dem",maxzoom:t.transform.maxZoom},p=new Zn(rt(),null),_=Ne("mock-dem",l,p,t.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,l){t.state="loaded",l(null)}}class un extends u.SourceCache{constructor(t){const l=Ne("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Zn(rt(),null),t.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,l,p){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){const I=new u.Tile(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[E.key]=I}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const l=this.proxyCachedFBO[t];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zo extends u.OverscaledTileID{constructor(t,l,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class _o extends u.Elevation{constructor(t,l){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,v]=function(A){const O=new u.StructArrayLayout4i8,V=new u.StructArrayLayout3ui6,H=131;O.reserve(17161),V.reserve(33800);const W=u.EXTENT/128,te=u.EXTENT+W/2,ne=te+W;for(let _e=-W;_e<ne;_e+=W)for(let ee=-W;ee<ne;ee+=W){const ae=ee<0||ee>te||_e<0||_e>te?24575:0,oe=u.clamp(Math.round(ee),0,u.EXTENT),xe=u.clamp(Math.round(_e),0,u.EXTENT);O.emplaceBack(oe+ae,xe,oe,xe)}const Q=(_e,ee)=>{const ae=ee*H+_e;V.emplaceBack(ae+1,ae,ae+H),V.emplaceBack(ae+H,ae+H+1,ae+1)};for(let _e=1;_e<129;_e++)for(let ee=1;ee<129;ee++)Q(ee,_e);return[0,129].forEach(_e=>{for(let ee=0;ee<130;ee++)Q(ee,_e),Q(_e,ee)}),[O,V,32768]}(),E=t.context;this.gridBuffer=E.createVertexBuffer(p,u.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=u.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new un(l.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,0,u.EXTENT,0,u.EXTENT,0,1);const I=E.gl;this._overlapStencilMode=new u.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Rr(l.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,l,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const _=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const v=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(l,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(A=>{const O=l.getTileByID(A).tileID;return O.projMatrix=p.calculateProjMatrix(O.toUnwrapped()),O});(function(A,O){const V=O.transform.pointCoordinate(O.transform.getCameraPoint()),H=new u.pointGeometry(V.x,V.y);A.sort((W,te)=>{if(te.overscaledZ-W.overscaledZ)return te.overscaledZ-W.overscaledZ;const ne=new u.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),Q=new u.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),_e=H.mult(1<<W.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(ne)-_e.distSqr(Q)})})(_,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const A in E){const O=E[A];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[A],v),O.usedForTerrain))continue;const V=t[A];O.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[l.id]=_.map(A=>new Zo(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const I={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const O=this.terrainTileForTile[A.key];if(!O)continue;const V=O.tileID.key;V in I||(this._visibleDemTiles.push(O),I[V]=V)}}_assignTerrainTiles(t){this._initializing||t.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,l=t.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(l.TEXTURE1),B(this.painter,_,v))}}_prepareDemTileUniforms(t,l,p,_){if(!l||null==l.demTexture)return!1;const v=t.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-v.z),I=_||"";return p[`u_dem_tl${I}`]=[v.x*E%1,v.y*E%1],p[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,l=t.gl;if(!this._emptyDepthBufferTexture){const p=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(t,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const v=_.dem.tree.minimums[0];return v>0&&t++,p+v},0);return t?l/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,l=t.gl;t.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new u.Texture(t,_,l.RGBA,{premultiply:!1}),v}setupElevationDraw(t,l,p){const _=this.painter.context,v=_.gl,E=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var I;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const A=this.painter.transform,O=A.projection,V=t.tileID.canonical;E.u_tile_tl_up=O.upVector(V,0,0),E.u_tile_tr_up=O.upVector(V,u.EXTENT,0),E.u_tile_br_up=O.upVector(V,u.EXTENT,u.EXTENT),E.u_tile_bl_up=O.upVector(V,0,u.EXTENT),E.u_tile_up_scale=p&&p.useDenormalizedUpVectorScale?u.GLOBE_METERS_TO_ECEF:O.upVectorScale(V,A.center.lat,A.worldSize).metersToTile;let H=null,W=null,te=1;if(p&&p.morphing&&this._useVertexMorphing){const ne=p.morphing.srcDemTile,Q=p.morphing.dstDemTile;te=p.morphing.phase,ne&&Q&&(this._prepareDemTileUniforms(t,ne,E,"_prev")&&(W=ne),this._prepareDemTileUniforms(t,Q,E)&&(H=Q))}if(W&&H?(_.activeTexture.set(v.TEXTURE2),H.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),W.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=te):(H=this.terrainTileForTile[t.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(t,H,E)?H.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&H){const ne=(1<<H.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=ne}p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,E)}renderToBackBuffer(t){const l=this.painter,p=this.painter.context;0!==t.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,E,I,A){if("globe"===_.transform.projection.name)!function(O,V,H,W,te){const ne=O.context,Q=ne.gl;let _e,ee;const ae=O.options.showTerrainWireframe?2:0,oe=O.transform,xe=u.globeUseCustomAntiAliasing(O,ne,oe),de=(be,ht)=>{if(ee===be)return;const lt=[mr[be],"PROJECTION_GLOBE_VIEW"];xe&&lt.push("CUSTOM_ANTIALIASING"),ht&&lt.push(mr[ae]),_e=O.useProgram("globeRaster",null,lt),ee=be},fe=O.colorModeForRenderPass(),Se=new u.DepthMode(Q.LEQUAL,u.DepthMode.ReadWrite,O.depthRangeFor3D);lr.update(te);const Ge=u.calculateGlobeMercatorMatrix(oe),We=[u.mercatorXfromLng(oe.center.lng),u.mercatorYfromLat(oe.center.lat)],$e=O.globeSharedBuffers,je=[oe.width*u.exported.devicePixelRatio,oe.height*u.exported.devicePixelRatio];if((ae?[!1,!0]:[!1]).forEach(be=>{ee=-1;const ht=be?Q.LINES:Q.TRIANGLES;for(const lt of W){const kt=H.getTile(lt),et=u.StencilMode.disabled,rn=V.prevTerrainTileForTile[lt.key],zt=V.terrainTileForTile[lt.key];Yt(rn,zt)&&lr.newMorphing(lt.key,rn,zt,te,250),ne.activeTexture.set(Q.TEXTURE0),kt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Lt=lr.getMorphValuesForProxy(lt.key),vt=Lt?1:0,St={useDenormalizedUpVectorScale:!0};Lt&&u.extend$1(St,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:u.easeCubicInOut(Lt.phase)}});const vn=Float32Array.from(oe.globeMatrix),cn=u.globeTileLatLngCorners(lt.canonical),Un=u.getLatitudinalLod((cn[0][0]+cn[1][0])/2),tn=u.getGridMatrix(lt.canonical,cn,Un),Cn=u.globeNormalizeECEF(u.globeTileBounds(lt.canonical)),cr=Je(oe.projMatrix,vn,Ge,Cn,u.globeToMercatorTransition(oe.zoom),We,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,je,tn);if(de(vt,be),V.setupElevationDraw(kt,_e,St),O.prepareDrawProgram(ne,_e,lt.toUnwrapped()),$e){const[Tr,ii,kr]=be?$e.getWirefameBuffers(O.context,Un):$e.getGridBuffers(Un);_e.draw(ne,ht,Se,et,fe,u.CullFaceMode.backCCW,cr,"globe_raster",Tr,ii,kr)}}}),$e){const be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&be.push("CUSTOM_ANTIALIASING"),_e=O.useProgram("globeRaster",null,be);for(const ht of W){const{x:lt,y:kt,z:et}=ht.canonical,rn=0===kt,zt=kt===(1<<et)-1,[Lt,vt,St,vn]=$e.getPoleBuffers(et);if(vn&&(rn||zt)){const cn=H.getTile(ht);ne.activeTexture.set(Q.TEXTURE0),cn.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Un=u.globePoleMatrixForTile(et,lt,oe);const tn=u.globeNormalizeECEF(u.globeTileBounds(ht.canonical)),Cn=(cr,Tr)=>cr.draw(ne,Q.TRIANGLES,Se,u.StencilMode.disabled,fe,u.CullFaceMode.disabled,Je(oe.projMatrix,Un,Un,tn,0,We,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,je),"globe_pole_raster",Tr,St,vn);V.setupElevationDraw(cn,_e,{}),O.prepareDrawProgram(ne,_e,ht.toUnwrapped()),rn&&Cn(_e,Lt),zt&&(Un=u.scale(u.create(),Un,[1,-1,1]),Cn(_e,vt))}}}}(_,v,E,I,A);else{const O=_.context,V=O.gl;let H,W;const te=_.options.showTerrainWireframe?2:0,ne=(oe,xe)=>{if(W===oe)return;const de=[mr[oe]];xe&&de.push(mr[te]),H=_.useProgram("terrainRaster",null,de),W=oe},Q=_.colorModeForRenderPass(),_e=new u.DepthMode(V.LEQUAL,u.DepthMode.ReadWrite,_.depthRangeFor3D);lr.update(A);const ee=_.transform,ae=6*Math.pow(1.5,22-ee.zoom)*v.exaggeration();(te?[!1,!0]:[!1]).forEach(oe=>{W=-1;const xe=oe?V.LINES:V.TRIANGLES,[de,fe]=oe?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const Se of I){const Ge=E.getTile(Se),We=u.StencilMode.disabled,$e=v.prevTerrainTileForTile[Se.key],je=v.terrainTileForTile[Se.key];Yt($e,je)&&lr.newMorphing(Se.key,$e,je,A,250),O.activeTexture.set(V.TEXTURE0),Ge.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const be=lr.getMorphValuesForProxy(Se.key),ht=be?1:0;let lt;be&&(lt={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:u.easeCubicInOut(be.phase)}});const kt=st(Se.projMatrix,wr(Se.canonical,ee.renderWorldCopies)?ae/10:ae);ne(ht,oe),v.setupElevationDraw(Ge,H,lt),_.prepareDrawProgram(O,H,Se.toUnwrapped()),H.draw(O,xe,_e,We,Q,u.CullFaceMode.backCCW,kt,"terrain_raster",v.gridBuffer,de,fe)}})}}(l,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),I=[],A=l.style.order;let O=0;for(const V of v){const H=_.getTileByID(V.proxyTileKey),W=_.proxyCachedFBO[V.key]?_.proxyCachedFBO[V.key][t]:void 0,te=void 0!==W?_.renderCache[W]:this.pool[O++],ne=void 0!==W;if(H.texture=te.tex,ne&&!te.dirty){I.push(H.tileID);continue}let Q;p.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(p.clear({color:u.Color.transparent,stencil:0}),te.dirty=!1);for(let _e=E.start;_e<=E.end;++_e){const ee=l.style._layers[A[_e]];if(ee.isHidden(l.transform.zoom))continue;const ae=l.style._getLayerSourceCache(ee),oe=ae?this.proxyToSource[V.key][ae.id]:[V];if(!oe)continue;const xe=oe;p.viewport.set([0,0,te.fb.width,te.fb.height]),Q!==(ae?ae.id:null)&&(this._setupStencil(te,oe,ee,ae),Q=ae?ae.id:null),l.renderLayer(l,ae,ee,xe)}this.renderedToTile?(te.dirty=!0,I.push(H.tileID)):ne||--O,5===O&&(O=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}renderCacheEfficiency(t){const l=t.order.length;if(0===l)return{efficiency:100};let p,_=0,v=0,E=!1;for(let I=0;I<l;++I){const A=t._layers[t.order[I]];this._style.isLayerDraped(A)?(E&&++_,++v):E||(E=!0,p=A.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{t=Math.min(t,l.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const E=v.tileID,I=Math.pow(2,E.overscaledZ),{x:A,y:O}=E.canonical,V=A/I,H=(A+1)/I,W=O/I,te=(O+1)/I;return{minx:V,miny:W,maxx:H,maxy:te,t:v.dem.tree.raycastRoot(V,W,H,te,t,l,p),tile:v}});_.sort((v,E)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const v of _){if(null==v.t)return null;const E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,l,p);if(null!=E)return E}return null}_createFBO(){const t=this.painter.context,l=t.gl,p=this.drapeBufferSize;t.activeTexture.set(l.TEXTURE0);const _=new u.Texture(t,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=t.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new $(t,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const l=this._style._layers[t],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),v=!!_&&1!==_.t,E=l.hasTransition();return"custom"!==l.type&&!p&&(v||E)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof ye){t=!0;break}if(t)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if("raster"!==p.type||_||!v)continue;const E=p.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][v.id];if(A)for(const O of A){const V=ni(v.getTile(O),v.findLoadedParent(O,0),v,this.painter.transform,E);(1!==V.opacity||0!==V.mix)&&this._clearRenderCacheForTile(v.id,O)}}}}_setupDrapedRenderBatches(){const t=this._style.order,l=t.length;if(0===l)return;const p=[];let _,v=0,E=this._style._layers[t[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<l;)E=this._style._layers[t[v]];for(;v<l;++v){const I=this._style._layers[t[v]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===_&&(_=v):void 0!==_&&(p.push({start:_,end:v-1}),_=void 0))}void 0!==_&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(t){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let I=0;I<E.length;++I){const A=Object.values(E[I]);l.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const I=p[E];if(l.getTileByID(I.key),void 0!==l.proxyCachedFBO[I.key]){const A=t[I.key],O=this.proxyToSource[I.key];let V=0;for(const H in O){const W=O[H],te=A[H];if(!te||te.length!==W.length||W.some((ne,Q)=>ne!==te[Q]||_[H]&&_[H].hasOwnProperty(ne.key))){V=-1;break}++V}for(const H in l.proxyCachedFBO[I.key])l.renderCache[l.proxyCachedFBO[I.key][H]].dirty=V<0||V!==Object.values(A).length}}const v=[...this._drapedRenderBatches];v.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of v)for(const I of p){if(l.proxyCachedFBO[I.key])continue;let A=l.renderCachePool.pop();void 0===A&&l.renderCache.length<50&&(A=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==A&&(l.proxyCachedFBO[I.key]={},l.proxyCachedFBO[I.key][E.start]=A,l.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,E=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(t,l){const p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(u.ColorMode.disabled),_.setDepthMode(u.DepthMode.disabled);const E=p.useProgram("clippingMask");for(const I of t){const A=p._tileClippingMaskIDs[I.key]=--l;E.draw(_,v.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,yn(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const l=this.painter.transform;if(t.x<0||t.x>l.width||t.y<0||t.y>l.height)return null;const p=[t.x,t.y,1,1];u.transformMat4$1(p,p,l.pixelMatrixInverse),u.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,v=u.mercatorZfromAltitude(1,l.center.lat),E=[_[0],_[1],_[2]/v,0],I=u.subtract([],p.slice(0,3),E);u.normalize(I,I);const A=this.raycast(E,I,this._exaggeration);return null!==A&&A?(u.scaleAndAdd(E,E,I,A),E[3]=E[2],E[2]*=v,E):null}drawDepth(){const t=this.painter,l=t.context,p=this.proxySourceCache,_=Math.ceil(t.width),v=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=l.gl,I=l.createFramebuffer(_,v,!0);l.activeTexture.set(E.TEXTURE0);const A=new u.Texture(l,{width:_,height:v,data:null},E.RGBA);A.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.colorAttachment.set(A.texture);const O=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);I.depthAttachment.set(O),this._depthFBO=I,this._depthTexture=A}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(E,I,A,O){if("globe"===E.transform.projection.name)return;const V=E.context,H=V.gl;V.clear({depth:1});const W=E.useProgram("terrainDepth"),te=new u.DepthMode(H.LESS,u.DepthMode.ReadWrite,E.depthRangeFor3D);for(const ne of O){const Q=A.getTile(ne),_e=st(ne.projMatrix,0);I.setupElevationDraw(Q,W),W.draw(V,H.TRIANGLES,te,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,_e,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,l,p){if(t.getSource()instanceof Oe)return this._setupProxiedCoordsForImageSource(t,l,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let I=0;I<v.length;I++){const A=v[I],O=this._findTileCoveringTileID(A,t);if(O){const V=this._createProxiedId(A,O,p[A.key]&&p[A.key][t.id]);_.push(V),this.proxyToSource[A.key][t.id]=[V]}}let E=!1;for(let I=0;I<l.length;I++){const A=t.getTile(l[I]);if(!A||!A.hasData())continue;const O=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==A.tileID.canonical.z){const V=this.proxyToSource[O.tileID.key][t.id],H=this._createProxiedId(O.tileID,A,p[O.tileID.key]&&p[O.tileID.key][t.id]);V?V.splice(V.length-1,0,H):this.proxyToSource[O.tileID.key][t.id]=[H],_.push(H),E=!0}}this._sourceTilesOverlap[t.id]=E}_setupProxiedCoordsForImageSource(t,l,p){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords,E=t.getSource(),I=new u.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),A=E.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((V,H)=>(V.min.x=Math.min(V.min.x,H.x-I.x),V.min.y=Math.min(V.min.y,H.y-I.y),V.max.x=Math.max(V.max.x,H.x-I.x),V.max.y=Math.max(V.max.y,H.y-I.y),V),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(V,H)=>{const W=V.wrap+V.canonical.x/(1<<V.canonical.z),te=V.canonical.y/(1<<V.canonical.z),ne=u.EXTENT/(1<<V.canonical.z),Q=H.wrap+H.canonical.x/(1<<H.canonical.z),_e=H.canonical.y/(1<<H.canonical.z);return W+ne<Q+A.min.x||W>Q+A.max.x||te+ne<_e+A.min.y||te>_e+A.max.y};for(let V=0;V<v.length;V++){const H=v[V];for(let W=0;W<l.length;W++){const te=t.getTile(l[W]);if(!te||!te.hasData()||O(H,te.tileID))continue;const ne=this._createProxiedId(H,te,p[H.key]&&p[H.key][t.id]),Q=this.proxyToSource[H.key][t.id];Q?Q.push(ne):this.proxyToSource[H.key][t.id]=[ne],_.push(ne)}}}_createProxiedId(t,l,p){let _=this.orthoMatrix;if(p){const v=p.find(E=>E.key===l.tileID.key);if(v)return v}if(l.tileID.key!==t.key){const v=t.canonical.z-l.tileID.canonical.z;let E,I,A;_=u.create();const O=l.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(E=u.EXTENT>>v,I=E*((l.tileID.canonical.x<<v)-t.canonical.x+O),A=E*((l.tileID.canonical.y<<v)-t.canonical.y)):(E=u.EXTENT<<-v,I=u.EXTENT*(l.tileID.canonical.x-(t.canonical.x+O<<-v)),A=u.EXTENT*(l.tileID.canonical.y-(t.canonical.y<<-v))),u.ortho(_,0,E,0,E,0,1),u.translate(_,_,[I,A,0])}return new Zo(l.tileID,t.key,_)}_findTileCoveringTileID(t,l){let p=l.getTile(t);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],v=_[t.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||null===v)return p;let E=p?p.tileID:t,I=E.overscaledZ;const A=l.getSource().minzoom,O=[];if(!v){const H=l.getSource().maxzoom;if(t.canonical.z>=H){const W=t.canonical.z-H;l.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,l.transform.tileZoom),E=new u.OverscaledTileID(I,t.wrap,H,t.canonical.x>>W,t.canonical.y>>W)):0!==W&&(I=H,E=new u.OverscaledTileID(I,t.wrap,H,t.canonical.x>>W,t.canonical.y>>W))}E.key!==t.key&&(O.push(E.key),p=l.getTile(E))}const V=H=>{O.forEach(W=>{_[W]=H}),O.length=0};for(I-=1;I>=A&&(!p||!p.hasData());I--){p&&V(p.tileID.key);const H=E.calculateScaledKey(I);if(p=l.getTileByID(H),p&&p.hasData())break;const W=_[H];if(null===W)break;void 0===W?O.push(H):p=l.getTileByID(W)}return V(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,l){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(l){let p=0;const _=new u.StructArrayLayout2ui4,v=131;for(let E=1;E<129;E++){for(let I=1;I<129;I++)p=E*v+I,_.emplaceBack(p,p+1),_.emplaceBack(p,p+v),_.emplaceBack(p+1,p+v),128===E&&_.emplaceBack(p+v,p+v+1);_.emplaceBack(p+1,p+1+v)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ys(h){const t=[];for(let l=0;l<h.length;l++){if(null===h[l])continue;const p=h[l].split(" ");t.push(p.pop())}return t}class Bi{static cacheKey(t,l,p){let _=`${t}${p?p.cacheKey:""}`;for(const v of l)_+=`/${v}`;return _}constructor(t,l,p,_,v,E){const I=t.gl;this.program=I.createProgram();const A=ys(p.staticAttributes),O=_?_.getBinderAttributes():[],V=A.concat(O),H=p.staticUniforms?ys(p.staticUniforms):[],W=_?_.getBinderUniforms():[],te=H.concat(W),ne=[];for(const de of te)ne.indexOf(de)<0&&ne.push(de);let Q=_?_.defines():[];Q=Q.concat(E.map(de=>`#define ${de}`));const _e=Q.concat(t.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(ao):ao,ao,Mo,Fs.fragmentSource,ti.fragmentSource,p.fragmentSource).join("\n"),ee=Q.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Mo,Fs.vertexSource,ti.vertexSource,la.vertexSource,p.vertexSource).join("\n"),ae=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ae,_e),I.compileShader(ae),I.attachShader(this.program,ae);const oe=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(oe,ee),I.compileShader(oe),I.attachShader(this.program,oe),this.attributes={};const xe={};this.numAttributes=V.length;for(let de=0;de<this.numAttributes;de++)V[de]&&(I.bindAttribLocation(this.program,de,V[de]),this.attributes[V[de]]=de);I.linkProgram(this.program),I.deleteShader(oe),I.deleteShader(ae);for(let de=0;de<ne.length;de++){const fe=ne[de];if(fe&&!xe[fe]){const Se=I.getUniformLocation(this.program,fe);Se&&(xe[fe]=Se)}}var de,fe;this.fixedUniforms=v(t,xe),this.binderUniforms=_?_.getUniforms(t,xe):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(de=t,(fe=xe).u_dem),u_dem_prev:new u.Uniform1i(de,fe.u_dem_prev),u_dem_unpack:new u.Uniform4f(de,fe.u_dem_unpack),u_dem_tl:new u.Uniform2f(de,fe.u_dem_tl),u_dem_scale:new u.Uniform1f(de,fe.u_dem_scale),u_dem_tl_prev:new u.Uniform2f(de,fe.u_dem_tl_prev),u_dem_scale_prev:new u.Uniform1f(de,fe.u_dem_scale_prev),u_dem_size:new u.Uniform1f(de,fe.u_dem_size),u_dem_lerp:new u.Uniform1f(de,fe.u_dem_lerp),u_exaggeration:new u.Uniform1f(de,fe.u_exaggeration),u_depth:new u.Uniform1i(de,fe.u_depth),u_depth_size_inv:new u.Uniform2f(de,fe.u_depth_size_inv),u_meter_to_dem:new u.Uniform1f(de,fe.u_meter_to_dem),u_label_plane_matrix_inv:new u.UniformMatrix4f(de,fe.u_label_plane_matrix_inv),u_tile_tl_up:new u.Uniform3f(de,fe.u_tile_tl_up),u_tile_tr_up:new u.Uniform3f(de,fe.u_tile_tr_up),u_tile_br_up:new u.Uniform3f(de,fe.u_tile_br_up),u_tile_bl_up:new u.Uniform3f(de,fe.u_tile_bl_up),u_tile_up_scale:new u.Uniform1f(de,fe.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((de,fe)=>({u_fog_matrix:new u.UniformMatrix4f(de,fe.u_fog_matrix),u_fog_range:new u.Uniform2f(de,fe.u_fog_range),u_fog_color:new u.Uniform4f(de,fe.u_fog_color),u_fog_horizon_blend:new u.Uniform1f(de,fe.u_fog_horizon_blend),u_fog_temporal_offset:new u.Uniform1f(de,fe.u_fog_temporal_offset),u_frustum_tl:new u.Uniform3f(de,fe.u_frustum_tl),u_frustum_tr:new u.Uniform3f(de,fe.u_frustum_tr),u_frustum_br:new u.Uniform3f(de,fe.u_frustum_br),u_frustum_bl:new u.Uniform3f(de,fe.u_frustum_bl),u_globe_pos:new u.Uniform3f(de,fe.u_globe_pos),u_globe_radius:new u.Uniform1f(de,fe.u_globe_radius),u_globe_transition:new u.Uniform1f(de,fe.u_globe_transition),u_is_globe:new u.Uniform1i(de,fe.u_is_globe),u_viewport:new u.Uniform2f(de,fe.u_viewport)}))(t,xe))}setTerrainUniformValues(t,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].set(l[_])}}setFogUniformValues(t,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].location&&p[_].set(l[_])}}draw(t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q,_e,ee){const ae=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(_),t.setColorMode(v),t.setCullFace(E);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(I[xe]);ne&&ne.setUniforms(t,this.binderUniforms,W,{zoom:te});const oe={[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[l];for(const xe of H.get()){const de=xe.vaos||(xe.vaos={});(de[A]||(de[A]=new Qr)).bind(t,this,O,ne?ne.getPaintVertexBuffers():[],V,xe.vertexOffset,Q,_e,ee),ae.drawElements(l,xe.primitiveLength*oe,ae.UNSIGNED_SHORT,xe.primitiveOffset*oe*2)}}}function Oa(h,t,l){const p=1/Dn(l,1,t.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,t.transform.tileZoom)/_,E=v*(l.tileID.canonical.x+l.tileID.wrap*_),I=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const ca=u.create(),xl=(h,t,l,p,_,v,E,I,A)=>{const O=t.style.light,V=O.properties.get("position"),H=[V.x,V.y,V.z],W=u.create$1();"viewport"===O.properties.get("anchor")&&(u.fromRotation(W,-t.transform.angle),u.transformMat3(H,H,W));const te=O.properties.get("color"),ne=t.transform,Q={u_matrix:h,u_lightpos:H,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===ne.projection.name&&(Q.u_tile_id=[_.canonical.x,_.canonical.y,1<<_.canonical.z],Q.u_zoom_transition=E,Q.u_inv_rot_matrix=A,Q.u_merc_center=I,Q.u_up_dir=ne.projection.upVector(new u.CanonicalTileID(0,0,0),I[0]*u.EXTENT,I[1]*u.EXTENT),Q.u_height_lift=v),Q},bl=(h,t,l,p,_,v,E,I,A,O,V)=>{const H=xl(h,t,l,p,_,I,A,O,V),W={u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8};return u.extend(H,Oa(v,t,E),W)},_t=h=>({u_matrix:h}),Kn=(h,t,l,p)=>u.extend(_t(h),Oa(l,t,p)),za=(h,t)=>({u_matrix:h,u_world:t}),ua=(h,t,l,p,_)=>u.extend(Kn(h,t,l,p),{u_world:_}),yr=u.create(),Kl=(h,t,l,p,_,v)=>{const E=h.transform,I="globe"===E.projection.name;let A;if("map"===v.paint.get("circle-pitch-alignment"))if(I){const V=u.globePixelsToTileUnits(E.zoom,t.canonical)*E._projectionScaler;A=Float32Array.from([V,0,0,V])}else A=E.calculatePixelsToTileUnitsMatrix(l);else A=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:h.translatePosMatrix(t.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:yr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){O.u_inv_rot_matrix=p,O.u_merc_center=_,O.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],O.u_zoom_transition=u.globeToMercatorTransition(E.zoom);const V=_[0]*u.EXTENT,H=_[1]*u.EXTENT;O.u_up_dir=E.projection.upVector(new u.CanonicalTileID(0,0,0),V,H)}return O},Ba=h=>{const t=[];return"map"===h.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Ao=(h,t,l,p)=>{const _=u.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(p),u_extrude_scale:[t.pixelsToGLUnits[0]/_,t.pixelsToGLUnits[1]/_]}},wl=(h,t,l=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:l}),zs=u.create(),rh=(h,t,l,p,_,v,E)=>{const I=h.transform,A="globe"===I.projection.name,O=A?u.globePixelsToTileUnits(I.zoom,t.canonical)*I._projectionScaler:Dn(l,1,v),V={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:E,u_inv_rot_matrix:zs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){V.u_inv_rot_matrix=p,V.u_merc_center=_,V.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],V.u_zoom_transition=u.globeToMercatorTransition(I.zoom);const H=_[0]*u.EXTENT,W=_[1]*u.EXTENT;V.u_up_dir=I.projection.upVector(new u.CanonicalTileID(0,0,0),H,W)}return V},Ql=(h,t,l,p,_,v,E,I)=>{const A=h.transform,O=A.calculatePixelsToTileUnitsMatrix(t),V={u_matrix:Ni(h,t,l,_),u_pixels_to_tile_units:O,u_device_pixel_ratio:E,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:I};if(Zi(l)){const H=qo(t,h.transform);V.u_texsize=t.lineAtlasTexture.size,V.u_scale=[H,p.fromScale,p.toScale],V.u_mix=p.t}return V},kc=(h,t,l,p,_,v)=>{const E=h.transform,I=qo(t,E);return{u_matrix:Ni(h,t,l,_),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:v,u_image:0,u_scale:[I,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qo(h,t){return 1/Dn(h,1,t.tileZoom)}function Ni(h,t,l,p){return h.translatePosMatrix(p||t.tileID.projMatrix,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Zi(h){const t=h.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Lc=(h,t,l,p,_,v)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(I=_.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(E=_.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Bs(_.paint.get("raster-hue-rotate")),u_perspective_transform:v};var E,I};function Bs(h){h*=Math.PI/180;const t=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const rs=u.create(),El=(h,t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q)=>{const _e=_.transform,ee={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:_e.width/_e.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+A,u_pitch_with_map:+p,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rs,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:rs,u_up_vector:[0,-1,0]};return"globe"===Q.name&&(ee.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],ee.u_zoom_transition=H,ee.u_inv_rot_matrix=te,ee.u_merc_center=W,ee.u_camera_forward=_e._camera.forward(),ee.u_ecef_origin=u.globeECEFOrigin(_e.globeMatrix,V.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(_e.globeMatrix),ee.u_up_vector=ne),ee},Fc=(h,t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q,_e)=>u.extend(El(h,t,l,p,_,v,E,I,A,O,H,W,te,ne,Q,_e),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+V}),yu=(h,t,l,p,_,v,E,I,A,O,V,H,W,te,ne,Q)=>u.extend(Fc(h,t,l,p,_,v,E,I,!0,A,!0,V,H,W,te,ne,Q),{u_texsize_icon:O,u_texture_icon:1}),Jl=(h,t,l)=>({u_matrix:h,u_opacity:t,u_color:l}),Ns=(h,t,l,p,_,v)=>u.extend(function(E,I,A,O){const V=A.imageManager.getPattern(E.from.toString()),H=A.imageManager.getPattern(E.to.toString()),{width:W,height:te}=A.imageManager.getPixelSize(),ne=Math.pow(2,O.tileID.overscaledZ),Q=O.tileSize*Math.pow(2,A.transform.tileZoom)/ne,_e=Q*(O.tileID.canonical.x+O.tileID.wrap*ne),ee=Q*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[W,te],u_mix:I.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Dn(O,1,A.transform.tileZoom),u_pixel_coord_upper:[_e>>16,ee>>16],u_pixel_coord_lower:[65535&_e,65535&ee]}}(p,v,l,_),{u_matrix:h,u_opacity:t}),ec={fillExtrusion:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_lightpos:new u.Uniform3f(h,t.u_lightpos),u_lightintensity:new u.Uniform1f(h,t.u_lightintensity),u_lightcolor:new u.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(h,t.u_vertical_gradient),u_opacity:new u.Uniform1f(h,t.u_opacity),u_tile_id:new u.Uniform3f(h,t.u_tile_id),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_up_dir:new u.Uniform3f(h,t.u_up_dir),u_height_lift:new u.Uniform1f(h,t.u_height_lift)}),fillExtrusionPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_lightpos:new u.Uniform3f(h,t.u_lightpos),u_lightintensity:new u.Uniform1f(h,t.u_lightintensity),u_lightcolor:new u.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new u.Uniform1f(h,t.u_height_factor),u_tile_id:new u.Uniform3f(h,t.u_tile_id),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_up_dir:new u.Uniform3f(h,t.u_up_dir),u_height_lift:new u.Uniform1f(h,t.u_height_lift),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade),u_opacity:new u.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_extrude_scale:new u.UniformMatrix2f(h,t.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_inv_rot_matrix:new u.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_tile_id:new u.Uniform3f(h,t.u_tile_id),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_up_dir:new u.Uniform3f(h,t.u_up_dir)}),collisionBox:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_extrude_scale:new u.Uniform2f(h,t.u_extrude_scale)}),collisionCircle:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new u.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new u.UniformColor(h,t.u_color),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_overlay:new u.Uniform1i(h,t.u_overlay),u_overlay_scale:new u.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new u.Uniform1f(h,t.u_extrude_scale),u_intensity:new u.Uniform1f(h,t.u_intensity),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_inv_rot_matrix:new u.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_tile_id:new u.Uniform3f(h,t.u_tile_id),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_up_dir:new u.Uniform3f(h,t.u_up_dir)}),heatmapTexture:(h,t)=>({u_image:new u.Uniform1i(h,t.u_image),u_color_ramp:new u.Uniform1i(h,t.u_color_ramp),u_opacity:new u.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_latrange:new u.Uniform2f(h,t.u_latrange),u_light:new u.Uniform2f(h,t.u_light),u_shadow:new u.UniformColor(h,t.u_shadow),u_highlight:new u.UniformColor(h,t.u_highlight),u_accent:new u.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_dimension:new u.Uniform2f(h,t.u_dimension),u_zoom:new u.Uniform1f(h,t.u_zoom),u_unpack:new u.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_pixels_to_tile_units:new u.UniformMatrix2f(h,t.u_pixels_to_tile_units),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_dash_image:new u.Uniform1i(h,t.u_dash_image),u_gradient_image:new u.Uniform1i(h,t.u_gradient_image),u_image_height:new u.Uniform1f(h,t.u_image_height),u_texsize:new u.Uniform2f(h,t.u_texsize),u_scale:new u.Uniform3f(h,t.u_scale),u_mix:new u.Uniform1f(h,t.u_mix),u_alpha_discard_threshold:new u.Uniform1f(h,t.u_alpha_discard_threshold),u_trim_offset:new u.Uniform2f(h,t.u_trim_offset)}),linePattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixels_to_tile_units:new u.UniformMatrix2f(h,t.u_pixels_to_tile_units),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_image:new u.Uniform1i(h,t.u_image),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade),u_alpha_discard_threshold:new u.Uniform1f(h,t.u_alpha_discard_threshold)}),raster:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new u.Uniform2f(h,t.u_tl_parent),u_scale_parent:new u.Uniform1f(h,t.u_scale_parent),u_fade_t:new u.Uniform1f(h,t.u_fade_t),u_opacity:new u.Uniform1f(h,t.u_opacity),u_image0:new u.Uniform1i(h,t.u_image0),u_image1:new u.Uniform1i(h,t.u_image1),u_brightness_low:new u.Uniform1f(h,t.u_brightness_low),u_brightness_high:new u.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new u.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new u.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new u.Uniform3f(h,t.u_spin_weights),u_perspective_transform:new u.Uniform2f(h,t.u_perspective_transform)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_tile_id:new u.Uniform3f(h,t.u_tile_id),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_camera_forward:new u.Uniform3f(h,t.u_camera_forward),u_tile_matrix:new u.UniformMatrix4f(h,t.u_tile_matrix),u_up_vector:new u.Uniform3f(h,t.u_up_vector),u_ecef_origin:new u.Uniform3f(h,t.u_ecef_origin),u_texture:new u.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texture:new u.Uniform1i(h,t.u_texture),u_gamma_scale:new u.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_tile_id:new u.Uniform3f(h,t.u_tile_id),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_camera_forward:new u.Uniform3f(h,t.u_camera_forward),u_tile_matrix:new u.UniformMatrix4f(h,t.u_tile_matrix),u_up_vector:new u.Uniform3f(h,t.u_up_vector),u_ecef_origin:new u.Uniform3f(h,t.u_ecef_origin),u_is_halo:new u.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texsize_icon:new u.Uniform2f(h,t.u_texsize_icon),u_texture:new u.Uniform1i(h,t.u_texture),u_texture_icon:new u.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new u.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_opacity:new u.Uniform1f(h,t.u_opacity),u_color:new u.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_opacity:new u.Uniform1f(h,t.u_opacity),u_image:new u.Uniform1i(h,t.u_image),u_pattern_tl_a:new u.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(h,t.u_pattern_br_b),u_texsize:new u.Uniform2f(h,t.u_texsize),u_mix:new u.Uniform1f(h,t.u_mix),u_pattern_size_a:new u.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new u.Uniform1f(h,t.u_scale_a),u_scale_b:new u.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(h,t.u_tile_units_to_pixels)}),terrainRaster:Le,terrainDepth:Le,skybox:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_sun_direction:new u.Uniform3f(h,t.u_sun_direction),u_cubemap:new u.Uniform1i(h,t.u_cubemap),u_opacity:new u.Uniform1f(h,t.u_opacity),u_temporal_offset:new u.Uniform1f(h,t.u_temporal_offset)}),skyboxGradient:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_color_ramp:new u.Uniform1i(h,t.u_color_ramp),u_center_direction:new u.Uniform3f(h,t.u_center_direction),u_radius:new u.Uniform1f(h,t.u_radius),u_opacity:new u.Uniform1f(h,t.u_opacity),u_temporal_offset:new u.Uniform1f(h,t.u_temporal_offset)}),skyboxCapture:(h,t)=>({u_matrix_3f:new u.UniformMatrix3f(h,t.u_matrix_3f),u_sun_direction:new u.Uniform3f(h,t.u_sun_direction),u_sun_intensity:new u.Uniform1f(h,t.u_sun_intensity),u_color_tint_r:new u.Uniform4f(h,t.u_color_tint_r),u_color_tint_m:new u.Uniform4f(h,t.u_color_tint_m),u_luminance:new u.Uniform1f(h,t.u_luminance)}),globeRaster:(h,t)=>({u_proj_matrix:new u.UniformMatrix4f(h,t.u_proj_matrix),u_globe_matrix:new u.UniformMatrix4f(h,t.u_globe_matrix),u_normalize_matrix:new u.UniformMatrix4f(h,t.u_normalize_matrix),u_merc_matrix:new u.UniformMatrix4f(h,t.u_merc_matrix),u_zoom_transition:new u.Uniform1f(h,t.u_zoom_transition),u_merc_center:new u.Uniform2f(h,t.u_merc_center),u_image0:new u.Uniform1i(h,t.u_image0),u_grid_matrix:new u.UniformMatrix3f(h,t.u_grid_matrix),u_frustum_tl:new u.Uniform3f(h,t.u_frustum_tl),u_frustum_tr:new u.Uniform3f(h,t.u_frustum_tr),u_frustum_br:new u.Uniform3f(h,t.u_frustum_br),u_frustum_bl:new u.Uniform3f(h,t.u_frustum_bl),u_globe_pos:new u.Uniform3f(h,t.u_globe_pos),u_globe_radius:new u.Uniform1f(h,t.u_globe_radius),u_viewport:new u.Uniform2f(h,t.u_viewport)}),globeAtmosphere:(h,t)=>({u_frustum_tl:new u.Uniform3f(h,t.u_frustum_tl),u_frustum_tr:new u.Uniform3f(h,t.u_frustum_tr),u_frustum_br:new u.Uniform3f(h,t.u_frustum_br),u_frustum_bl:new u.Uniform3f(h,t.u_frustum_bl),u_horizon:new u.Uniform1f(h,t.u_horizon),u_transition:new u.Uniform1f(h,t.u_transition),u_fadeout_range:new u.Uniform1f(h,t.u_fadeout_range),u_color:new u.Uniform4f(h,t.u_color),u_high_color:new u.Uniform4f(h,t.u_high_color),u_space_color:new u.Uniform4f(h,t.u_space_color),u_star_intensity:new u.Uniform1f(h,t.u_star_intensity),u_star_density:new u.Uniform1f(h,t.u_star_density),u_star_size:new u.Uniform1f(h,t.u_star_size),u_temporal_offset:new u.Uniform1f(h,t.u_temporal_offset),u_horizon_angle:new u.Uniform1f(h,t.u_horizon_angle),u_rotation_matrix:new u.UniformMatrix4f(h,t.u_rotation_matrix)})};let Us;function tc(h,t,l,p,_,v,E){const I=h.context,A=I.gl,O=h.transform,V=h.useProgram("collisionBox"),H=[];let W=0,te=0;for(let xe=0;xe<p.length;xe++){const de=p[xe],fe=t.getTile(de),Se=fe.getBucket(l);if(!Se)continue;const Ge=vi(de,Se,O);let We=Ge;0===_[0]&&0===_[1]||(We=h.translatePosMatrix(Ge,fe,_,v));const $e=E?Se.textCollisionBox:Se.iconCollisionBox,je=Se.collisionCircleArray;if(je.length>0){const be=u.create(),ht=We;u.mul(be,Se.placementInvProjMatrix,O.glCoordMatrix),u.mul(be,be,Se.placementViewportMatrix),H.push({circleArray:je,circleOffset:te,transform:ht,invTransform:be,projection:Se.getProjection()}),W+=je.length/4,te=W}$e&&(h.terrain&&h.terrain.setupElevationDraw(fe,V),V.draw(I,A.LINES,u.DepthMode.disabled,u.StencilMode.disabled,h.colorModeForRenderPass(),u.CullFaceMode.disabled,Ao(We,O,fe,Se.getProjection()),l.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,O.zoom,null,$e.collisionVertexBuffer,$e.collisionVertexBufferExt))}if(!E||!H.length)return;const ne=h.useProgram("collisionCircle"),Q=new u.StructArrayLayout2f1f2i16;Q.resize(4*W),Q._trim();let _e=0;for(const xe of H)for(let de=0;de<xe.circleArray.length/4;de++){const fe=4*de,Se=xe.circleArray[fe+0],Ge=xe.circleArray[fe+1],We=xe.circleArray[fe+2],$e=xe.circleArray[fe+3];Q.emplace(_e++,Se,Ge,We,$e,0),Q.emplace(_e++,Se,Ge,We,$e,1),Q.emplace(_e++,Se,Ge,We,$e,2),Q.emplace(_e++,Se,Ge,We,$e,3)}(!Us||Us.length<2*W)&&(Us=function(xe){const de=2*xe,fe=new u.StructArrayLayout3ui6;fe.resize(de),fe._trim();for(let Se=0;Se<de;Se++){const Ge=6*Se;fe.uint16[Ge+0]=4*Se+0,fe.uint16[Ge+1]=4*Se+1,fe.uint16[Ge+2]=4*Se+2,fe.uint16[Ge+3]=4*Se+2,fe.uint16[Ge+4]=4*Se+3,fe.uint16[Ge+5]=4*Se+0}return fe}(W));const ee=I.createIndexBuffer(Us,!0),ae=I.createVertexBuffer(Q,u.collisionCircleLayout.members,!0);for(const xe of H){const de={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(oe=O).getCameraToCenterDistance(xe.projection),u_viewport_size:[oe.width,oe.height]};ne.draw(I,A.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,h.colorModeForRenderPass(),u.CullFaceMode.disabled,de,l.id,ae,ee,u.SegmentVector.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,O.zoom)}var oe;ae.destroy(),ee.destroy()}const vu=u.create();function Tl(h,t,l,p,_,v){const{horizontalAlign:E,verticalAlign:I}=u.getAnchorAlignment(h),A=-(E-.5)*t,O=-(I-.5)*l,V=u.evaluateVariableOffset(h,p);return new u.pointGeometry((A/_+V[0])*v,(O/_+V[1])*v)}function ha(h,t,l,p,_,v,E,I,A,O,V){const H=h.text.placedSymbolArray,W=h.text.dynamicLayoutVertexArray,te=h.icon.dynamicLayoutVertexArray,ne={},Q=Hi(I,h.getProjection(),v),_e=v.elevation,ee=h.getProjection().upVectorScale(I.canonical,v.center.lat,v.worldSize);W.clear();for(let ae=0;ae<H.length;ae++){const oe=H.get(ae),xe=h.allowVerticalPlacement&&!oe.placedOrientation,de=oe.hidden||!oe.crossTileID||xe?null:p[oe.crossTileID];if(de){const fe=new u.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),Se=h.getProjection().upVector(I.canonical,fe.x,fe.y),Ge=_e?_e.getAtTileOffset(I,fe.x,fe.y):0,We=ei([oe.projectedAnchorX+Ge*Se[0]*ee.metersToTile,oe.projectedAnchorY+Ge*Se[1]*ee.metersToTile,oe.projectedAnchorZ+Ge*Se[2]*ee.metersToTile],l?Q:E),$e=Yi(v.getCameraToCenterDistance(h.getProjection()),We.signedDistanceFromCamera);let je=_.evaluateSizeForFeature(h.textSizeData,O,oe)*$e/u.ONE_EM;l&&(je*=h.tilePixelRatio/A);const{width:be,height:ht,anchor:lt,textOffset:kt,textScale:et}=de,rn=Tl(lt,be,ht,kt,et,je);let zt;if(l){const vt=fe.add(rn),{x:St,y:vn,z:cn}=h.getProjection().projectTilePoint(vt.x,vt.y,I.canonical);zt=ei([St+Ge*Se[0]*ee.metersToTile,vn+Ge*Se[1]*ee.metersToTile,cn+Ge*Se[2]*ee.metersToTile],E).point}else{const vt=t?rn.rotate(-v.angle):rn;zt=[We.point[0]+vt.x,We.point[1]+vt.y,0]}const Lt=h.allowVerticalPlacement&&oe.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let vt=0;vt<oe.numGlyphs;vt++)u.addDynamicAttributes(W,zt[0],zt[1],zt[2],Lt);V&&oe.associatedIconIndex>=0&&(ne[oe.associatedIconIndex]={shiftedAnchor:zt,angle:Lt})}else Jn(oe.numGlyphs,W)}if(V){te.clear();const ae=h.icon.placedSymbolArray;for(let oe=0;oe<ae.length;oe++){const xe=ae.get(oe);if(xe.hidden)Jn(xe.numGlyphs,te);else{const de=ne[oe];if(de)for(let fe=0;fe<xe.numGlyphs;fe++)u.addDynamicAttributes(te,de.shiftedAnchor[0],de.shiftedAnchor[1],de.shiftedAnchor[2],de.angle);else Jn(xe.numGlyphs,te)}}h.icon.dynamicLayoutVertexBuffer.updateData(te)}h.text.dynamicLayoutVertexBuffer.updateData(W)}function nc(h,t,l){return l.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Dl(h,t,l,p,_,v,E,I,A,O,V,H){const W=h.context,te=W.gl,ne=h.transform,Q="map"===I,_e="map"===A,ee=Q&&"point"!==l.layout.get("symbol-placement"),ae=Q&&!_e&&!ee,oe=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let xe=!1;const de=h.depthModeForSublayer(0,u.DepthMode.ReadOnly),fe=[u.mercatorXfromLng(ne.center.lng),u.mercatorYfromLat(ne.center.lat)],Se=l.layout.get("text-variable-anchor"),Ge="globe"===ne.projection.name,We=[],$e=[0,-1,0];let je=$e;!Ge&&!ne.mercatorFromTransition||Q||(je=function(be){const ht=be._camera.getWorldToCamera(be.worldSize,1),lt=u.multiply([],ht,be.globeMatrix);u.invert(lt,lt);const kt=[0,0,0],et=[0,1,0,0];return u.transformMat4$1(et,et,lt),kt[0]=et[0],kt[1]=et[1],kt[2]=et[2],u.normalize(kt,kt),kt}(ne));for(const be of p){const ht=t.getTile(be),lt=ht.getBucket(l);if(!lt||"mercator"===lt.projection.name&&Ge)continue;const kt=_?lt.text:lt.icon;if(!kt||lt.fullyClipped||!kt.segments.get().length)continue;const et=kt.programConfigurations.get(l.id),rn=_||lt.sdfIcons,zt=_?lt.textSizeData:lt.iconSizeData,Lt=_e||0!==ne.pitch,vt=u.evaluateSizeForZoom(zt,ne.zoom);let St,vn,cn,Un,tn=[0,0],Cn=null;if(_){if(vn=ht.glyphAtlasTexture,cn=te.LINEAR,St=ht.glyphAtlasTexture.size,lt.iconsInText){tn=ht.imageAtlasTexture.size,Cn=ht.imageAtlasTexture;const oi="composite"===zt.kind||"camera"===zt.kind;Un=Lt||h.options.rotating||h.options.zooming||oi?te.LINEAR:te.NEAREST}}else{const oi=1!==l.layout.get("icon-size").constantOr(0)||lt.iconsNeedLinear;vn=ht.imageAtlasTexture,cn=rn||h.options.rotating||h.options.zooming||oi||Lt?te.LINEAR:te.NEAREST,St=ht.imageAtlasTexture.size}const cr="globe"===lt.projection.name,Tr=cr?je:$e,ii=cr?u.globeToMercatorTransition(ne.zoom):0,kr=Hi(be,lt.getProjection(),ne),as=ne.calculatePixelsToTileUnitsMatrix(ht),Ks=_n(kr,ht.tileID.canonical,_e,Q,ne,lt.getProjection(),as),_a=h.terrain&&_e&&ee?u.invert(u.create(),Ks):vu,$r=so(kr,ht.tileID.canonical,_e,Q,ne,lt.getProjection(),as),Br=Se&&lt.hasTextData(),ur="none"!==l.layout.get("icon-text-fit")&&Br&&lt.hasIconData();if(ee){const oi=ne.elevation,xo=oi?oi.getAtTileOffsetFunc(be,ne.center.lat,ne.worldSize,lt.getProjection()):Gc=>[0,0,0],ya=fr(kr,ht.tileID.canonical,_e,Q,ne,lt.getProjection(),as);qn(lt,kr,h,_,ya,$r,_e,O,xo,be)}const Ei=ee||_&&Se||ur,qi=h.translatePosMatrix(kr,ht,v,E),sr=Ei?vu:Ks,vo=h.translatePosMatrix($r,ht,v,E,!0),dc=lt.getProjection().createInversionMatrix(ne,be.canonical),Yo=[];h.terrain&&_e&&Yo.push("PITCH_WITH_MAP_TERRAIN"),cr&&Yo.push("PROJECTION_GLOBE_VIEW"),Ei&&Yo.push("PROJECTED_POS_ON_VIEWPORT");const fc=rn&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let Rl;Rl=rn?lt.iconsInText?yu(zt.kind,vt,ae,_e,h,qi,sr,vo,St,tn,be,ii,fe,dc,Tr,lt.getProjection()):Fc(zt.kind,vt,ae,_e,h,qi,sr,vo,_,St,!0,be,ii,fe,dc,Tr,lt.getProjection()):El(zt.kind,vt,ae,_e,h,qi,sr,vo,_,St,be,ii,fe,dc,Tr,lt.getProjection());const As={program:h.useProgram(nc(rn,_,lt),et,Yo),buffers:kt,uniformValues:Rl,atlasTexture:vn,atlasTextureIcon:Cn,atlasInterpolation:cn,atlasInterpolationIcon:Un,isSDF:rn,hasHalo:fc,tile:ht,labelPlaneMatrixInv:_a};if(oe&&lt.canOverlap){xe=!0;const oi=kt.segments.get();for(const xo of oi)We.push({segments:new u.SegmentVector([xo]),sortKey:xo.sortKey,state:As})}else We.push({segments:kt.segments,sortKey:0,state:As})}xe&&We.sort((be,ht)=>be.sortKey-ht.sortKey);for(const be of We){const ht=be.state;if(h.terrain&&h.terrain.setupElevationDraw(ht.tile,ht.program,{useDepthForOcclusion:!Ge,labelPlaneMatrixInv:ht.labelPlaneMatrixInv}),W.activeTexture.set(te.TEXTURE0),ht.atlasTexture.bind(ht.atlasInterpolation,te.CLAMP_TO_EDGE),ht.atlasTextureIcon&&(W.activeTexture.set(te.TEXTURE1),ht.atlasTextureIcon&&ht.atlasTextureIcon.bind(ht.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),ht.isSDF){const lt=ht.uniformValues;ht.hasHalo&&(lt.u_is_halo=1,Vs(ht.buffers,be.segments,l,h,ht.program,de,V,H,lt)),lt.u_is_halo=0}Vs(ht.buffers,be.segments,l,h,ht.program,de,V,H,ht.uniformValues)}}function Vs(h,t,l,p,_,v,E,I,A){const O=p.context;_.draw(O,O.gl.TRIANGLES,v,E,I,u.CullFaceMode.disabled,A,l.id,h.layoutVertexBuffer,h.indexBuffer,t,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer)}function rc(h,t,l,p,_,v,E){const I=h.context.gl,A=l.paint.get("fill-pattern"),O=A&&A.constantOr(1),V=l.getCrossfadeParameters();let H,W,te,ne,Q;E?(W=O&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=I.LINES):(W=O?"fillPattern":"fill",H=I.TRIANGLES);for(const _e of p){const ee=t.getTile(_e);if(O&&!ee.patternsLoaded())continue;const ae=ee.getBucket(l);if(!ae)continue;h.prepareDrawTile();const oe=ae.programConfigurations.get(l.id),xe=h.useProgram(W,oe);O&&(h.context.activeTexture.set(I.TEXTURE0),ee.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),oe.updatePaintBuffers(V));const de=A.constantOr(null);if(de&&ee.imageAtlas){const Se=ee.imageAtlas,Ge=Se.patternPositions[de.to.toString()],We=Se.patternPositions[de.from.toString()];Ge&&We&&oe.setConstantPatternPositions(Ge,We)}const fe=h.translatePosMatrix(_e.projMatrix,ee,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){ne=ae.indexBuffer2,Q=ae.segments2;const Se=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];te="fillOutlinePattern"===W&&O?ua(fe,h,V,ee,Se):za(fe,Se)}else ne=ae.indexBuffer,Q=ae.segments,te=O?Kn(fe,h,V,ee):_t(fe);h.prepareDrawProgram(h.context,xe,_e.toUnwrapped()),xe.draw(h.context,H,_,h.stencilModeForClipping(_e),v,u.CullFaceMode.disabled,te,l.id,ae.layoutVertexBuffer,ne,Q,l.paint,h.transform.zoom,oe)}}function Na(h,t,l,p,_,v,E){const I=h.context,A=I.gl,O=h.transform,V=l.paint.get("fill-extrusion-pattern"),H=V.constantOr(1),W=l.getCrossfadeParameters(),te=l.paint.get("fill-extrusion-opacity"),ne="globe"===O.projection.name?u.fillExtrusionHeightLift():0,Q="globe"===O.projection.name,_e=Q?u.globeToMercatorTransition(O.zoom):0,ee=[u.mercatorXfromLng(O.center.lng),u.mercatorYfromLat(O.center.lat)],ae=[];Q&&ae.push("PROJECTION_GLOBE_VIEW");for(const oe of p){const xe=t.getTile(oe),de=xe.getBucket(l);if(!de||de.projection.name!==O.projection.name)continue;const fe=de.programConfigurations.get(l.id),Se=h.useProgram(H?"fillExtrusionPattern":"fillExtrusion",fe,ae);if(h.terrain){const ht=h.terrain;if(h.style.terrainSetForDrapingOnly())ht.setupElevationDraw(xe,Se,{useMeterToDem:!0});else{if(!de.enableTerrain)continue;if(ht.setupElevationDraw(xe,Se,{useMeterToDem:!0}),Oc(I,t,oe,de,l,ht),!de.centroidVertexBuffer){const lt=Se.attributes.a_centroid_pos;void 0!==lt&&A.vertexAttrib2f(lt,0,0)}}}H&&(h.context.activeTexture.set(A.TEXTURE0),xe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),fe.updatePaintBuffers(W));const Ge=V.constantOr(null);if(Ge&&xe.imageAtlas){const ht=xe.imageAtlas,lt=ht.patternPositions[Ge.to.toString()],kt=ht.patternPositions[Ge.from.toString()];lt&&kt&&fe.setConstantPatternPositions(lt,kt)}const We=h.translatePosMatrix(oe.projMatrix,xe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),$e=O.projection.createInversionMatrix(O,oe.canonical),je=l.paint.get("fill-extrusion-vertical-gradient"),be=H?bl(We,h,je,te,oe,W,xe,ne,_e,ee,$e):xl(We,h,je,te,oe,ne,_e,ee,$e);h.prepareDrawProgram(I,Se,oe.toUnwrapped()),Se.draw(I,I.gl.TRIANGLES,_,v,E,u.CullFaceMode.backCCW,be,l.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,l.paint,h.transform.zoom,fe,h.terrain?de.centroidVertexBuffer:null,Q?de.layoutVertexExtBuffer:null)}}function Oc(h,t,l,p,_,v){const E=[ee=>{let ae=ee.canonical.x-1,oe=ee.wrap;return ae<0&&(ae=(1<<ee.canonical.z)-1,oe--),new u.OverscaledTileID(ee.overscaledZ,oe,ee.canonical.z,ae,ee.canonical.y)},ee=>{let ae=ee.canonical.x+1,oe=ee.wrap;return ae===1<<ee.canonical.z&&(ae=0,oe++),new u.OverscaledTileID(ee.overscaledZ,oe,ee.canonical.z,ae,ee.canonical.y)},ee=>new u.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,(0===ee.canonical.y?1<<ee.canonical.z:ee.canonical.y)-1),ee=>new u.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y===(1<<ee.canonical.z)-1?0:ee.canonical.y+1)],I=ee=>{const ae=t.getSource().minzoom,oe=de=>{const fe=t.getTileByID(de);if(fe&&fe.hasData())return fe.getBucket(_)},xe=[0,-1,1];for(const de of xe){if(ee.overscaledZ+de<ae)continue;const fe=oe(ee.calculateScaledKey(ee.overscaledZ+de));if(fe)return fe}},A=[0,0,0],O=(ee,ae)=>(A[0]=Math.min(ee.min.y,ae.min.y),A[1]=Math.max(ee.max.y,ae.max.y),A[2]=u.EXTENT-ae.min.x>ee.max.x?ae.min.x-u.EXTENT:ee.max.x,A),V=(ee,ae)=>(A[0]=Math.min(ee.min.x,ae.min.x),A[1]=Math.max(ee.max.x,ae.max.x),A[2]=u.EXTENT-ae.min.y>ee.max.y?ae.min.y-u.EXTENT:ee.max.y,A),H=[(ee,ae)=>O(ee,ae),(ee,ae)=>O(ae,ee),(ee,ae)=>V(ee,ae),(ee,ae)=>V(ae,ee)],W=new u.pointGeometry(0,0);let te,ne,Q;const _e=(ee,ae,oe,xe,de)=>{const fe=[[xe?oe:ee,xe?ee:oe,0],[xe?oe:ae,xe?ae:oe,0]],Se=de<0?u.EXTENT+de:de,Ge=[xe?Se:(ee+ae)/2,xe?(ee+ae)/2:Se,0];return 0===oe&&de<0||0!==oe&&de>0?v.getForTilePoints(Q,[Ge],!0,ne):fe.push(Ge),v.getForTilePoints(l,fe,!0,te),Math.max(fe[0][2],fe[1][2],Ge[2])/v.exaggeration()};for(let ee=0;ee<4;ee++){const ae=(ee<2?1:5)-ee,oe=p.borders[ee];if(0===oe.length)continue;const xe=Q=E[ee](l),de=I(xe);if(!(de&&de instanceof u.FillExtrusionBucket&&de.enableTerrain)||p.borderDoneWithNeighborZ[ee]===de.canonical.z&&de.borderDoneWithNeighborZ[ae]===p.canonical.z||(ne=v.findDEMTileFor(xe),!ne||!ne.dem))continue;if(!te){const We=v.findDEMTileFor(l);if(!We||!We.dem)return;te=We}const fe=de.borders[ae];let Se=0;const Ge=de.borderDoneWithNeighborZ[ae]!==p.canonical.z;if(p.canonical.z===de.canonical.z){for(let We=0;We<oe.length;We++){const $e=p.featuresOnBorder[oe[We]],je=$e.borders[ee];let be;for(;Se<fe.length&&(be=de.featuresOnBorder[fe[Se]],!(be.borders[ae][1]>je[0]+3));)Ge&&de.encodeCentroid(void 0,be,!1),Se++;if(be&&Se<fe.length){const ht=Se;let lt=0;for(;!(be.borders[ae][0]>je[1]-3)&&(lt++,++Se!==fe.length);)be=de.featuresOnBorder[fe[Se]];if(be=de.featuresOnBorder[fe[ht]],$e.intersectsCount()>1||be.intersectsCount()>1||1!==lt){1!==lt&&(Se=ht),p.encodeCentroid(void 0,$e,!1),Ge&&de.encodeCentroid(void 0,be,!1);continue}const kt=H[ee]($e,be),et=ee%2?u.EXTENT-1:0;W.x=_e(kt[0],Math.min(u.EXTENT-1,kt[1]),et,ee<2,kt[2]),W.y=0,p.encodeCentroid(W,$e,!1),Ge&&de.encodeCentroid(W,be,!1)}else p.encodeCentroid(void 0,$e,!1)}p.borderDoneWithNeighborZ[ee]=de.canonical.z,p.needsCentroidUpdate=!0,Ge&&(de.borderDoneWithNeighborZ[ae]=p.canonical.z,de.needsCentroidUpdate=!0)}else{for(const We of oe)p.encodeCentroid(void 0,p.featuresOnBorder[We],!1);if(Ge){for(const We of fe)de.encodeCentroid(void 0,de.featuresOnBorder[We],!1);de.borderDoneWithNeighborZ[ae]=p.canonical.z,de.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[ee]=de.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(h)}const da=new u.Color(1,0,0,1),bi=new u.Color(0,1,0,1),vs=new u.Color(0,0,1,1),Or=new u.Color(1,0,1,1),Ua=new u.Color(0,1,1,1);function Cl(h,t,l,p){Qn(h,0,t+l/2,h.transform.width,l,p)}function ic(h,t,l,p){Qn(h,t-l/2,0,l,h.transform.height,p)}function Qn(h,t,l,p,_,v){const E=h.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*u.exported.devicePixelRatio,l*u.exported.devicePixelRatio,p*u.exported.devicePixelRatio,_*u.exported.devicePixelRatio),E.clear({color:v}),I.disable(I.SCISSOR_TEST)}function oc(h,t,l){const p=h.context,_=p.gl,v="globe"===h.transform.projection.name,E=l.projMatrix,I=h.useProgram("debug",null,v?["PROJECTION_GLOBE_VIEW"]:null),A=t.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(A,I);const O=u.DepthMode.disabled,V=u.StencilMode.disabled,H=h.colorModeForRenderPass(),W="$debug";p.activeTexture.set(_.TEXTURE0),h.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),v?A._makeGlobeTileDebugBuffers(h.context,h.transform.projection):A._makeDebugTileBoundsBuffers(h.context,h.transform.projection);const te=A._tileDebugBuffer||h.debugBuffer,ne=A._tileDebugIndexBuffer||h.debugIndexBuffer,Q=A._tileDebugSegments||h.debugSegments;I.draw(p,_.LINE_STRIP,O,V,H,u.CullFaceMode.disabled,wl(E,u.Color.red),W,te,ne,Q,null,null,null,A._globeTileDebugBorderBuffer);const _e=A.latestRawTileData,ee=Math.floor((_e&&_e.byteLength||0)/1024),ae=t.getTile(l).tileSize,oe=512/Math.min(ae,512)*(l.overscaledZ/h.transform.zoom)*.5;let xe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(xe+=` => ${l.overscaledZ}`),function(Ge,We){Ge.initDebugOverlayCanvas();const $e=Ge.debugOverlayCanvas,je=Ge.context.gl,be=Ge.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,$e.width,$e.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(We,5,5),be.strokeText(We,5,5),Ge.debugOverlayTexture.update($e),Ge.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(h,`${xe} ${ee}kb`);const de=A._tileDebugTextBuffer||h.debugBuffer,fe=A._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Se=A._tileDebugTextSegments||h.debugSegments;I.draw(p,_.TRIANGLES,O,V,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,wl(E,u.Color.transparent,oe),W,de,fe,Se,null,null,null,A._globeTileDebugTextBuffer)}const ih=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Il}=ih;function Qi(h,t,l,p){h.emplaceBack(t,l,p)}class Sl{constructor(t){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,Qi(this.vertexArray,-1,-1,1),Qi(this.vertexArray,1,-1,1),Qi(this.vertexArray,-1,1,1),Qi(this.vertexArray,1,1,1),Qi(this.vertexArray,-1,-1,-1),Qi(this.vertexArray,1,-1,-1),Qi(this.vertexArray,-1,1,-1),Qi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Il),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function xs(h,t,l,p,_,v){const E=h.gl,I=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),V={u_matrix_3f:u.fromMat4(u.create$1(),p),u_sun_direction:_,u_sun_intensity:O,u_color_tint_r:[(ne=I).r,ne.g,ne.b,ne.a],u_color_tint_m:[(Q=A).r,Q.g,Q.b,Q.a],u_luminance:5e-5};var ne,Q;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),l.draw(h,E.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,V,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const xu=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bu{constructor(t){const l=new u.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new u.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(l,xu.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Po={symbol:function(h,t,l,p,_){if("translucent"!==h.renderPass)return;const v=u.StencilMode.disabled,E=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(I,A,O,V,H,W,te){const ne=A.transform,Q="map"===H,_e="map"===W;for(const ee of I){const ae=V.getTile(ee),oe=ae.getBucket(O);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const xe=u.evaluateSizeForZoom(oe.textSizeData,ne.zoom),de=Hi(ee,oe.getProjection(),ne),fe=ne.calculatePixelsToTileUnitsMatrix(ae),Se=_n(de,ae.tileID.canonical,_e,Q,ne,oe.getProjection(),fe),Ge="none"!==O.layout.get("icon-text-fit")&&oe.hasIconData();if(xe){const We=Math.pow(2,ne.zoom-ae.tileID.overscaledZ);ha(oe,Q,_e,te,u.symbolSize,ne,Se,ee,We,xe,Ge)}}}(p,h,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&Dl(h,t,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,E),0!==l.paint.get("text-opacity").constantOr(1)&&Dl(h,t,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,E),t.map.showCollisionBoxes&&(tc(h,t,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),tc(h,t,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,l,p){if("translucent"!==h.renderPass)return;const _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),I=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===v.constantOr(1)||0===E.constantOr(1)))return;const A=h.context,O=A.gl,V=h.transform,H=h.depthModeForSublayer(0,u.DepthMode.ReadOnly),W=u.StencilMode.disabled,te=h.colorModeForRenderPass(),ne="globe"===V.projection.name,Q=[u.mercatorXfromLng(V.center.lng),u.mercatorYfromLat(V.center.lat)],_e=[];for(let ae=0;ae<p.length;ae++){const oe=p[ae],xe=t.getTile(oe),de=xe.getBucket(l);if(!de||de.projection.name!==V.projection.name)continue;const fe=de.programConfigurations.get(l.id),Se=Ba(l);ne&&Se.push("PROJECTION_GLOBE_VIEW");const Ge=h.useProgram("circle",fe,Se),We=de.layoutVertexBuffer,$e=de.globeExtVertexBuffer,je=de.indexBuffer,be=V.projection.createInversionMatrix(V,oe.canonical),ht={programConfiguration:fe,program:Ge,layoutVertexBuffer:We,globeExtVertexBuffer:$e,indexBuffer:je,uniformValues:Kl(h,oe,xe,be,Q,l),tile:xe};if(I){const lt=de.segments.get();for(const kt of lt)_e.push({segments:new u.SegmentVector([kt]),sortKey:kt.sortKey,state:ht})}else _e.push({segments:de.segments,sortKey:0,state:ht})}I&&_e.sort((ae,oe)=>ae.sortKey-oe.sortKey);const ee={useDepthForOcclusion:!ne};for(const ae of _e){const{programConfiguration:oe,program:xe,layoutVertexBuffer:de,globeExtVertexBuffer:fe,indexBuffer:Se,uniformValues:Ge,tile:We}=ae.state,$e=ae.segments;h.terrain&&h.terrain.setupElevationDraw(We,xe,ee),h.prepareDrawProgram(A,xe,We.tileID.toUnwrapped()),xe.draw(A,O.TRIANGLES,H,W,te,u.CullFaceMode.disabled,Ge,l.id,de,Se,$e,l.paint,V.zoom,oe,ne?fe:null)}},heatmap:function(h,t,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const _=h.context,v=_.gl,E=u.StencilMode.disabled,I=new u.ColorMode([v.ONE,v.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(te,ne,Q,_e){const ee=te.gl,ae=ne.width*_e,oe=ne.height*_e;te.activeTexture.set(ee.TEXTURE1),te.viewport.set([0,0,ae,oe]);let xe=Q.heatmapFbo;if(!xe||xe&&(xe.width!==ae||xe.height!==oe)){xe&&xe.destroy();const de=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,de),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),xe=Q.heatmapFbo=te.createFramebuffer(ae,oe,!1),function(fe,Se,Ge,We,$e,je){const be=fe.gl;be.texImage2D(be.TEXTURE_2D,0,be.RGBA,$e,je,0,be.RGBA,fe.extRenderToTextureHalfFloat?fe.extTextureHalfFloat.HALF_FLOAT_OES:be.UNSIGNED_BYTE,null),We.colorAttachment.set(Ge)}(te,0,de,xe,ae,oe)}else ee.bindTexture(ee.TEXTURE_2D,xe.colorAttachment.get()),te.bindFramebuffer.set(xe.framebuffer)})(_,h,l,"globe"===h.transform.projection.name?.5:.25),_.clear({color:u.Color.transparent});const A=h.transform,O="globe"===A.projection.name,V=O?["PROJECTION_GLOBE_VIEW"]:null,H=O?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,W=[u.mercatorXfromLng(A.center.lng),u.mercatorYfromLat(A.center.lat)];for(let te=0;te<p.length;te++){const ne=p[te];if(t.hasRenderableParent(ne))continue;const Q=t.getTile(ne),_e=Q.getBucket(l);if(!_e||_e.projection.name!==A.projection.name)continue;const ee=_e.programConfigurations.get(l.id),ae=h.useProgram("heatmap",ee,V),{zoom:oe}=h.transform;h.terrain&&h.terrain.setupElevationDraw(Q,ae),h.prepareDrawProgram(_,ae,ne.toUnwrapped());const xe=A.projection.createInversionMatrix(A,ne.canonical);ae.draw(_,v.TRIANGLES,u.DepthMode.disabled,E,I,H,rh(h,ne,Q,xe,W,oe,l.paint.get("heatmap-intensity")),l.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,l.paint,h.transform.zoom,ee,O?_e.globeExtVertexBuffer:null)}_.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,v){const E=_.context,I=E.gl,A=v.heatmapFbo;if(!A)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),E.activeTexture.set(I.TEXTURE1);let O=v.colorRampTexture;O||(O=v.colorRampTexture=new u.Texture(E,v.colorRamp,I.RGBA)),O.bind(I.LINEAR,I.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,I.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,_.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(h,l))},line:function(h,t,l,p){if("translucent"!==h.renderPass)return;const _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===_.constantOr(1)||0===v.constantOr(1))return;const E=h.depthModeForSublayer(0,u.DepthMode.ReadOnly),I=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture?1:u.exported.devicePixelRatio,O=l.paint.get("line-dasharray"),V=O.constantOr(1),H=l.layout.get("line-cap"),W=l.paint.get("line-pattern"),te=W.constantOr(1),ne=l.paint.get("line-gradient"),Q=l.getCrossfadeParameters(),_e=te?"linePattern":"line",ee=h.context,ae=ee.gl,oe=(de=>{const fe=[];Zi(de)&&fe.push("RENDER_LINE_DASH"),de.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const Se=de.paint.get("line-trim-offset");0===Se[0]&&0===Se[1]||fe.push("RENDER_LINE_TRIM_OFFSET");const Ge=de.paint.get("line-pattern").constantOr(1),We=1!==de.paint.get("line-opacity").constantOr(1);return!Ge&&We&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(l);let xe=oe.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(xe=!1);for(const de of p){const fe=t.getTile(de);if(te&&!fe.patternsLoaded())continue;const Se=fe.getBucket(l);if(!Se)continue;h.prepareDrawTile();const Ge=Se.programConfigurations.get(l.id),We=h.useProgram(_e,Ge,oe),$e=W.constantOr(null);if($e&&fe.imageAtlas){const zt=fe.imageAtlas,Lt=zt.patternPositions[$e.to.toString()],vt=zt.patternPositions[$e.from.toString()];Lt&&vt&&Ge.setConstantPatternPositions(Lt,vt)}const je=O.constantOr(null),be=H.constantOr(null);if(!te&&je&&be&&fe.lineAtlas){const zt=fe.lineAtlas,Lt=zt.getDash(je.to,be),vt=zt.getDash(je.from,be);Lt&&vt&&Ge.setConstantPatternPositions(Lt,vt)}let[ht,lt]=l.paint.get("line-trim-offset");("round"===be||"square"===be)&&ht!==lt&&(0===ht&&(ht-=1),1===lt&&(lt+=1));const kt=h.terrain?de.projMatrix:null,et=te?kc(h,fe,l,Q,kt,A):Ql(h,fe,l,Q,kt,Se.lineClipsArray.length,A,[ht,lt]);if(ne){const zt=Se.gradients[l.id];let Lt=zt.texture;if(l.gradientVersion!==zt.version){let vt=256;if(l.stepInterpolant){const St=t.getSource().maxzoom,vn=de.canonical.z===St?Math.ceil(1<<h.transform.maxZoom-de.canonical.z):1;vt=u.clamp(u.nextPowerOfTwo(Se.maxLineLength/u.EXTENT*1024*vn),256,ee.maxTextureSize)}zt.gradient=u.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:vt,image:zt.gradient||void 0,clips:Se.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new u.Texture(ee,zt.gradient,ae.RGBA),zt.version=l.gradientVersion,Lt=zt.texture}ee.activeTexture.set(ae.TEXTURE1),Lt.bind(l.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}V&&(ee.activeTexture.set(ae.TEXTURE0),fe.lineAtlasTexture.bind(ae.LINEAR,ae.REPEAT),Ge.updatePaintBuffers(Q)),te&&(ee.activeTexture.set(ae.TEXTURE0),fe.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ge.updatePaintBuffers(Q)),h.prepareDrawProgram(ee,We,de.toUnwrapped());const rn=zt=>{We.draw(ee,ae.TRIANGLES,E,zt,I,u.CullFaceMode.disabled,et,l.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,l.paint,h.transform.zoom,Ge,Se.layoutVertexBuffer2)};if(xe){const zt=h.stencilModeForClipping(de).ref;0===zt&&h.terrain&&ee.clear({stencil:0});const Lt={func:ae.EQUAL,mask:255};et.u_alpha_discard_threshold=.8,rn(new u.StencilMode(Lt,zt,255,ae.KEEP,ae.KEEP,ae.INVERT)),et.u_alpha_discard_threshold=0,rn(new u.StencilMode(Lt,zt,255,ae.KEEP,ae.KEEP,ae.KEEP))}else rn(h.stencilModeForClipping(de))}xe&&(h.resetStencilClippingMasks(),h.terrain&&ee.clear({stencil:0}))},fill:function(h,t,l,p){const _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const E=h.colorModeForRenderPass(),I=l.paint.get("fill-pattern"),A=h.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===_.constantOr(u.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(h.renderPass===A){const O=h.depthModeForSublayer(1,"opaque"===h.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);rc(h,t,l,p,O,E,!1)}if("translucent"===h.renderPass&&l.paint.get("fill-antialias")){const O=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);rc(h,t,l,p,O,E,!0)}},"fill-extrusion":function(h,t,l,p){const _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===h.renderPass){const v=new u.DepthMode(h.context.gl.LEQUAL,u.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))Na(h,t,l,p,v,u.StencilMode.disabled,u.ColorMode.disabled),Na(h,t,l,p,v,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const E=h.colorModeForRenderPass();Na(h,t,l,p,v,u.StencilMode.disabled,E)}}},hillshade:function(h,t,l,p){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const _=h.context,v=h.depthModeForSublayer(0,u.DepthMode.ReadOnly),E=h.colorModeForRenderPass(),I=h.terrain&&h.terrain.renderingToTexture,[A,O]="translucent"!==h.renderPass||I?[{},p]:h.stencilConfigForOverlap(p);for(const V of O){const H=t.getTile(V);if(H.needsHillshadePrepare&&"offscreen"===h.renderPass)J(h,H,l,v,u.StencilMode.disabled,E);else if("translucent"===h.renderPass){const W=I&&h.terrain?h.terrain.stencilModeForRTTOverlap(V):A[V.overscaledZ];K(h,V,H,l,v,W,E)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,l,p,_,v){if("translucent"!==h.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const E=h.context,I=E.gl,A=t.getSource(),O=h.useProgram("raster"),V=h.colorModeForRenderPass(),H=h.terrain&&h.terrain.renderingToTexture,[W,te]=A instanceof Oe||H?[{},p]:h.stencilConfigForOverlap(p),ne=te[te.length-1].overscaledZ,Q=!h.options.moving;for(const _e of te){const ee=H?u.DepthMode.disabled:h.depthModeForSublayer(_e.overscaledZ-ne,1===l.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,I.LESS),ae=_e.toUnwrapped(),oe=t.getTile(_e);if(H&&(!oe||!oe.hasData()))continue;const xe=H?_e.projMatrix:h.transform.calculateProjMatrix(ae,Q),de=h.terrain&&H?h.terrain.stencilModeForRTTOverlap(_e):W[_e.overscaledZ],fe=v?0:l.paint.get("raster-fade-duration");oe.registerFadeDuration(fe);const Se=t.findLoadedParent(_e,0),Ge=ni(oe,Se,t,h.transform,fe);let We,$e;h.terrain&&h.terrain.prepareDrawTile();const je="nearest"===l.paint.get("raster-resampling")?I.NEAREST:I.LINEAR;E.activeTexture.set(I.TEXTURE0),oe.texture.bind(je,I.CLAMP_TO_EDGE),E.activeTexture.set(I.TEXTURE1),Se?(Se.texture.bind(je,I.CLAMP_TO_EDGE),We=Math.pow(2,Se.tileID.overscaledZ-oe.tileID.overscaledZ),$e=[oe.tileID.canonical.x*We%1,oe.tileID.canonical.y*We%1]):oe.texture.bind(je,I.CLAMP_TO_EDGE);const be=Lc(xe,$e||[0,0],We||1,Ge,l,A instanceof Oe?A.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(E,O,ae),A instanceof Oe)A.boundsBuffer&&A.boundsSegments&&O.draw(E,I.TRIANGLES,ee,u.StencilMode.disabled,V,u.CullFaceMode.disabled,be,l.id,A.boundsBuffer,h.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:lt,tileBoundsSegments:kt}=h.getTileBoundsBuffers(oe);O.draw(E,I.TRIANGLES,ee,de,V,u.CullFaceMode.disabled,be,l.id,ht,lt,kt)}}h.resetStencilClippingMasks()},background:function(h,t,l,p){const _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(0===v)return;const E=h.context,I=E.gl,A=h.transform,O=A.tileSize,V=l.paint.get("background-pattern");if(h.isPatternMissing(V))return;const H=!V&&1===_.a&&1===v&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==H)return;const W=u.StencilMode.disabled,te=h.depthModeForSublayer(0,"opaque"===H?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),ne=h.colorModeForRenderPass(),Q=h.useProgram(V?"backgroundPattern":"background");let _e,ee=p;ee||(_e=h.getBackgroundTiles(),ee=Object.values(_e).map(oe=>oe.tileID)),V&&(E.activeTexture.set(I.TEXTURE0),h.imageManager.bind(h.context));const ae=l.getCrossfadeParameters();for(const oe of ee){const xe=oe.toUnwrapped(),de=p?oe.projMatrix:h.transform.calculateProjMatrix(xe);h.prepareDrawTile();const fe=t?t.getTile(oe):_e?_e[oe.key]:new u.Tile(oe,O,A.zoom,h),Se=V?Ns(de,v,h,V,{tileID:oe,tileSize:O},ae):Jl(de,v,_);h.prepareDrawProgram(E,Q,xe);const{tileBoundsBuffer:Ge,tileBoundsIndexBuffer:We,tileBoundsSegments:$e}=h.getTileBoundsBuffers(fe);Q.draw(E,I.TRIANGLES,te,W,ne,u.CullFaceMode.disabled,Se,l.id,Ge,We,$e)}},sky:function(h,t,l){const p=h.transform,_="mercator"===p.projection.name||"globe"===p.projection.name?1:u.smoothstep(7,8,p.zoom),v=l.paint.get("sky-opacity")*_;if(0===v)return;const E=h.context,I=l.paint.get("sky-type"),A=new u.DepthMode(E.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),O=h.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===h.renderPass?l.needsSkyboxCapture(h)&&(function(V,H,W,te){const ne=V.context,Q=ne.gl;let _e=H.skyboxFbo;if(!_e){_e=H.skyboxFbo=ne.createFramebuffer(32,32,!1),H.skyboxGeometry=new Sl(ne),H.skyboxTexture=ne.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,H.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let xe=0;xe<6;++xe)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}ne.bindFramebuffer.set(_e.framebuffer),ne.viewport.set([0,0,32,32]);const ee=H.getCenter(V,!0),ae=V.useProgram("skyboxCapture"),oe=new Float64Array(16);u.identity(oe),u.rotateY(oe,oe,.5*-Math.PI),xs(ne,H,ae,oe,ee,0),u.identity(oe),u.rotateY(oe,oe,.5*Math.PI),xs(ne,H,ae,oe,ee,1),u.identity(oe),u.rotateX(oe,oe,.5*-Math.PI),xs(ne,H,ae,oe,ee,2),u.identity(oe),u.rotateX(oe,oe,.5*Math.PI),xs(ne,H,ae,oe,ee,3),u.identity(oe),xs(ne,H,ae,oe,ee,4),u.identity(oe),u.rotateY(oe,oe,Math.PI),xs(ne,H,ae,oe,ee,5),ne.viewport.set([0,0,V.width,V.height])}(h,l),l.markSkyboxValid(h)):"sky"===h.renderPass&&function(V,H,W,te,ne){const Q=V.context,_e=Q.gl,ee=V.transform,ae=V.useProgram("skybox");Q.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,H.skyboxTexture);const oe={u_matrix:ee.skyboxMatrix,u_sun_direction:H.getCenter(V,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:ne};V.prepareDrawProgram(Q,ae),ae.draw(Q,_e.TRIANGLES,W,u.StencilMode.disabled,V.colorModeForRenderPass(),u.CullFaceMode.backCW,oe,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(h,l,A,v,O):"gradient"===I&&"sky"===h.renderPass&&function(V,H,W,te,ne){const Q=V.context,_e=Q.gl,ee=V.transform,ae=V.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Sl(Q)),Q.activeTexture.set(_e.TEXTURE0);let oe=H.colorRampTexture;oe||(oe=H.colorRampTexture=new u.Texture(Q,H.colorRamp,_e.RGBA)),oe.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const xe=(de=ee.skyboxMatrix,fe=H.getCenter(V,!1),Se=H.paint.get("sky-gradient-radius"),Ge=te,We=ne,{u_matrix:de,u_color_ramp:0,u_center_direction:fe,u_radius:u.degToRad(Se),u_opacity:Ge,u_temporal_offset:We});var de,fe,Se,Ge,We;V.prepareDrawProgram(Q,ae),ae.draw(Q,_e.TRIANGLES,W,u.StencilMode.disabled,V.colorModeForRenderPass(),u.CullFaceMode.backCW,xe,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(h,l,A,v,O)},debug:function(h,t,l){for(let p=0;p<l.length;p++)oc(h,t,l[p])},custom:function(h,t,l){const p=h.context,_=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))u.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===h.renderPass){const v=_.prerender;v&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),v.call(_,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if("translucent"===h.renderPass){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(u.StencilMode.disabled);const v="3d"===_.renderingMode?new u.DepthMode(h.context.gl.LEQUAL,u.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,u.DepthMode.ReadOnly);p.setDepthMode(v),_.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class bs{constructor(t,l){this.context=new ce(t),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,l){const p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _o(this,t));const _=this._terrain;this.transform.elevation=p?_:null,_.update(t,this.transform,l)}_updateFog(t){const l=t.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,l){if(this.width=t*u.exported.devicePixelRatio,this.height=l*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const t=this.context,l=new u.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(u.EXTENT,0),l.emplaceBack(0,u.EXTENT),l.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(l,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const p=new u.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(u.EXTENT,0),p.emplaceBack(0,u.EXTENT),p.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=t.createVertexBuffer(p,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const _=new u.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const v=new u.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(u.EXTENT,0,u.EXTENT,0),v.emplaceBack(0,u.EXTENT,0,u.EXTENT),v.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(v,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const E=new u.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const I=new u.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])I.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new u.Texture(t,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=u.create();const A=this.context.gl;this.stencilClearMode=new u.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new bu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,l.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,yn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,l,p){if(!l||this.currentStencilSource===l.id||!t.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const A of p)if(void 0===this._tileClippingMaskIDs[A.key]){I=!0;break}if(!I)return}this.currentStencilSource=l.id;const _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(u.ColorMode.disabled),_.setDepthMode(u.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const A=l.getTile(I),O=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:H,tileBoundsSegments:W}=this.getTileBoundsBuffers(A);E.draw(_,v.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:v.ALWAYS,mask:0},O,255,v.KEEP,v.KEEP,v.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,yn(I.projMatrix),"$clipping",V,H,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new u.StencilMode({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const l=this.context.gl;return new u.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,p=t.sort((E,I)=>I.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let I=0;I<v;I++)E[I+_]=new u.StencilMode({func:l.GEQUAL,mask:255},I+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[_]:u.StencilMode.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([t.CONSTANT_COLOR,t.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(t,l,p){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new u.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const A in _){const O=_[A];O.used&&O.prepare(this.context)}const v={},E={},I={};for(const A in _){const O=_[A];v[A]=O.getVisibleCoordinates(),E[A]=v[A].slice().reverse(),I[A]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),u.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const A of p){const O=this.style._layers[A],V=t._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const H=V?E[V.id]:void 0;("custom"===O.type||O.isSky()||H&&H.length)&&this.renderLayer(this,V,O,H)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],O=t._getLayerSourceCache(A);if(A.isSky())continue;const V=O?E[O.id]:void 0;this._renderTileClippingMasks(A,O,V),this.renderLayer(this,O,A,V)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,O){const V=A.context,H=V.gl,W=A.transform,te=new u.DepthMode(H.LEQUAL,u.DepthMode.ReadOnly,[0,1]),ne=A.useProgram("globeAtmosphere",null,"globe"===W.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=u.globeToMercatorTransition(W.zoom),_e=O.properties.get("color").toArray01(),ee=O.properties.get("high-color").toArray01(),ae=O.properties.get("space-color").toArray01PremultipliedAlpha(),oe=u.identity$1([]);u.rotateY$1(oe,oe,-u.degToRad(W._center.lng)),u.rotateX$1(oe,oe,u.degToRad(W._center.lat)),u.rotateZ$1(oe,oe,W.angle),u.rotateX$1(oe,oe,-W._pitch);const xe=u.fromQuat(new Float32Array(16),oe),de=u.mapValue(O.properties.get("star-intensity"),0,1,0,.25),Se=u.mapValue(O.properties.get("horizon-blend"),0,1,5e-4,.25),Ge=u.globeUseCustomAntiAliasing(A,V,W)&&5e-4===Se?W.worldSize/(2*Math.PI*1.025)-1:W.globeRadius,We=A.frameCounter/1e3%1,$e=u.length(W.globeCenterInViewSpace),je=Math.sqrt(Math.pow($e,2)-Math.pow(Ge,2)),be=Math.acos(je/$e),ht={u_frustum_tl:W.frustumCorners.TL,u_frustum_tr:W.frustumCorners.TR,u_frustum_br:W.frustumCorners.BR,u_frustum_bl:W.frustumCorners.BL,u_horizon:W.frustumCorners.horizon,u_transition:Q,u_fadeout_range:Se,u_color:_e,u_high_color:ee,u_space_color:ae,u_star_intensity:de,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:We,u_horizon_angle:be,u_rotation_matrix:xe};A.prepareDrawProgram(V,ne);const lt=A.atmosphereBuffer;lt&&ne.draw(V,H.TRIANGLES,te,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,ht,"skybox",lt.vertexBuffer,lt.indexBuffer,lt.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],O=t._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,O,A,O?E[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const A=this.style._layers[p[this.currentLayer]],O=t._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const V=O?("symbol"===A.type?I:E)[O.id]:void 0;this._renderTileClippingMasks(A,O,O?v[O.id]:void 0),this.renderLayer(this,O,A,V),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;u.values(this.style._layers).forEach(O=>{const V=t._getLayerSourceCache(O);V&&!O.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<V.getSource().maxzoom)&&(A=V)}),A&&this.options.showTileBoundaries&&Po.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const O=A.transform.padding;Cl(A,A.transform.height-(O.top||0),3,da),Cl(A,O.bottom||0,3,bi),ic(A,O.left||0,3,vs),ic(A,A.transform.width-(O.right||0),3,Or);const V=A.transform.centerPoint;var H,W,te,ne;Qn(H=A,(W=V.x)-1,(te=A.transform.height-V.y)-10,2,20,ne=Ua),Qn(H,W-10,te-1,20,2,ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,l,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)||Po[p.type](t,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,l=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),t.beginQueryEXT(t.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const l={};for(const p in t){const _=t[p],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[p]=E}return l}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of t)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(t,l,p,_,v){if(!p[0]&&!p[1])return t;const E=v?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(E){const O=Math.sin(E),V=Math.cos(E);p=[p[0]*V-p[1]*O,p[0]*O+p[1]*V]}const I=[v?p[0]:Dn(l,p[0],this.transform.zoom),v?p[1]:Dn(l,p[1],this.transform.zoom),0],A=new Float32Array(16);return u.translate(A,t,I),A}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!l||!p}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!t&&0!==l.getOpacity(this.transform.pitch)&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,l,p){this.cache=this.cache||{};const _=p||[],v=this.currentGlobalDefines().concat(_),E=Bi.cacheKey(t,v,l);return this.cache[E]||(this.cache[E]=new Bi(this.context,t,Os[t],l,ec[t],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch),E=((I,A,O,V,H,W,te,ne,Q,_e,ee)=>{const ae=I.transform,oe=A.properties.get("color").toArray01();oe[3]=V;const xe=I.frameCounter/1e3%1;return{u_fog_matrix:O?ae.calculateFogTileMatrix(O):I.identityMat,u_fog_range:A.getFovAdjustedRange(ae._fov),u_fog_color:oe,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:xe,u_frustum_tl:H,u_frustum_tr:W,u_frustum_br:te,u_frustum_bl:ne,u_globe_pos:Q,u_globe_radius:_e,u_viewport:ee,u_globe_transition:u.globeToMercatorTransition(ae.zoom),u_is_globe:+("globe"===ae.projection.name)}})(this,_,p,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);l.setFogUniformValues(t,E)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,l=t.createTexture();return t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=t[_.key]||new u.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class js{constructor(t=0,l=0,p=0,_=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=p,this.right=_}interpolate(t,l,p){return null!=l.top&&null!=t.top&&(this.top=u.number(t.top,l.top,p)),null!=l.bottom&&null!=t.bottom&&(this.bottom=u.number(t.bottom,l.bottom,p)),null!=l.left&&null!=t.left&&(this.left=u.number(t.left,l.left,p)),null!=l.right&&null!=t.right&&(this.right=u.number(t.right,l.right,p)),this}getCenter(t,l){const p=u.clamp((this.left+t-this.right)/2,0,t),_=u.clamp((this.top+l-this.bottom)/2,0,l);return new u.pointGeometry(p,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new js(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ml(h,t){const l=u.getColumn(h,3);u.fromQuat(h,t),u.setColumn(h,3,l)}function ws(h,t){const l=u.identity$1([]);return u.rotateZ$1(l,l,-t),u.rotateX$1(l,l,-h),l}function $s(h,t){const l=[h[0],h[1],0],p=[t[0],t[1],0];if(u.length(l)>=1e-15){const E=u.normalize([],l);u.scale$2(p,E,u.dot(p,E)),t[0]=p[0],t[1]=p[1]}const _=u.cross([],t,h);if(u.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return ws(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class Al{constructor(t,l){this.position=t,this.orientation=l}get position(){return this._position}set position(t){if(t){const l=t instanceof u.MercatorCoordinate?t:new u.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(l.x=u.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(t,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(t)):0,_=this.position,v=u.MercatorCoordinate.fromLngLat(t,p),E=[v.x-_.x,v.y-_.y,v.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=$s(E,l)}setPitchBearing(t,l){this.orientation=ws(u.degToRad(t),u.degToRad(-l))}}class Va{constructor(t,l){this._transform=u.identity([]),this.orientation=l,this.position=t}get mercatorPosition(){const t=this.position;return new u.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=u.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var l;t&&u.setColumn(this._transform,3,[(l=t)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||u.identity$1([]),t&&Ml(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,l){this._orientation=ws(t,l),Ml(this._transform,this._orientation)}forward(){const t=u.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=u.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=u.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,l){const p=new Float64Array(16);return u.invert(p,this.getWorldToCamera(t,l)),p}getWorldToCameraPosition(t,l,p){const _=this.position;u.scale$2(_,_,-t);const v=new Float64Array(16);return u.fromScaling(v,[p,p,p]),u.translate(v,v,_),v[10]*=l,v}getWorldToCamera(t,l){const p=new Float64Array(16),_=new Float64Array(4),v=this.position;return u.conjugate(_,this._orientation),u.scale$2(v,v,-t),u.fromQuat(p,_),u.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(t,l,p,_){const v=new Float64Array(16);return u.perspective(v,t,l,p,_),v}getDistanceToElevation(t){const l=0===t?0:u.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new Va([...this.position],[...this.orientation])}}function Ht(h,t){const l=Gs(h.projection,h.zoom,h.width,h.height),p=function(v,E,I,A,O){const V=new u.LngLat(I.lng-180*Es,I.lat),H=new u.LngLat(I.lng+180*Es,I.lat),W=v.project(V.lng,V.lat),te=v.project(H.lng,H.lat),ne=-Math.atan2(te.y-W.y,te.x-W.x),Q=u.MercatorCoordinate.fromLngLat(I);Q.y=u.clamp(Q.y,-.999975,.999975);const _e=Q.toLngLat(),ee=v.project(_e.lng,_e.lat),ae=u.MercatorCoordinate.fromLngLat(_e);ae.x+=Es;const oe=ae.toLngLat(),xe=v.project(oe.lng,oe.lat),de=is(xe.x-ee.x,xe.y-ee.y,ne),fe=u.MercatorCoordinate.fromLngLat(_e);fe.y+=Es;const Se=fe.toLngLat(),Ge=v.project(Se.lng,Se.lat),We=is(Ge.x-ee.x,Ge.y-ee.y,ne),$e=Math.abs(de.x)/Math.abs(We.y),je=u.identity([]);u.rotateZ(je,je,-ne*(1-(O?0:A)));const be=u.identity([]);return u.scale(be,be,[1,1-(1-$e)*A,1]),be[4]=-We.x/We.y*A,u.rotateZ(be,be,ne),u.multiply(be,je,be),be}(h.projection,0,h.center,l,t),_=Wo(h);return u.scale(p,p,[_,_,1]),p}function Wo(h){const t=h.projection,l=Gs(h.projection,h.zoom,h.width,h.height),p=ja(t,h.center),_=ja(t,u.LngLat.convert(t.center));return Math.pow(2,p*l+(1-l)*_)}function Gs(h,t,l,p,_=1/0){const v=h.range;if(!v)return 0;const E=Math.min(_,Math.max(l,p)),I=Math.log(E/1024)/Math.LN2;return u.smoothstep(v[0]+I,v[1]+I,t)}const Es=1/4e4;function ja(h,t){const l=u.clamp(t.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),p=new u.LngLat(t.lng-180*Es,l),_=new u.LngLat(t.lng+180*Es,l),v=h.project(p.lng,l),E=h.project(_.lng,l),I=u.MercatorCoordinate.fromLngLat(p),A=u.MercatorCoordinate.fromLngLat(_),O=E.x-v.x,V=E.y-v.y,H=A.x-I.x,W=A.y-I.y,te=Math.sqrt((H*H+W*W)/(O*O+V*V));return Math.log(te)/Math.LN2}function is(h,t,l){const p=Math.cos(l),_=Math.sin(l);return{x:h*p-t*_,y:h*_+t*p}}class Pl{constructor(t,l,p,_,v,E,I){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(E),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new js,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Va,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new Pl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const l=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||l)&&this._updateCameraOnTerrain(),(t||l)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const p=!Ae(l,this.getProjection());return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const l=-t*Math.PI/180;var p,_,v,E,I,A,O,V,H,W;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,E=this.angle,I=(v=this.rotationMatrix)[0],A=v[1],O=v[2],V=v[3],H=Math.sin(E),W=Math.cos(E),_[0]=I*W+O*H,_[1]=A*W+V*H,_[2]=I*-H+O*W,_[3]=A*-H+V*W)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=u.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,v=0;for(let E=0;E<l.length;E++){const I=new u.pointGeometry(l[E][0]*this.width,p+l[E][1]*(this.height-p)),A=t.pointCoordinate(I);if(!A)continue;const O=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);_+=A[3]*O,v+=O}return 0===v?NaN:_/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[l.x,l.y,l.z]:[t.x,t.y,t.z];const _=u.length(u.sub([],this._camera.position,p));return u.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let l=!1;if(t.orientation&&!u.exactEquals(t.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];u.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,l=new Al;return l.position=new u.MercatorCoordinate(t[0],t[1],t[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(t){if(!u.length$1(t))return!1;u.normalize$1(t,t);const l=u.transformQuat([],[0,0,-1],t),p=u.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;const _=$s(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=u.clamp(t[2],_/p,_/l),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,p){this._unmodified=!1,this._edgeInsets.interpolate(t,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new u.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new u.pointGeometry(0,0)),_=this.pointCoordinate(new u.pointGeometry(this.width,0)),v=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new u.pointGeometry(0,this.height)),I=Math.floor(Math.min(p.x,_.x,v.x,E.x)),A=Math.floor(Math.max(p.x,_.x,v.x,E.x)),O=1;for(let V=I-O;V<=A+O;V++)0!==V&&l.push(new u.UnwrappedTileID(V,t))}return l}coveringTiles(t){let l=this.coveringZoomLevel(t);const p=l,_=this.elevation&&!t.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==t.minzoom&&l<t.minzoom)return[];void 0!==t.maxzoom&&l>t.maxzoom&&(l=t.maxzoom);const E=this.locationCoordinate(this.center),I=this.center.lat,A=1<<l,O=[A*E.x,A*E.y,0],V="globe"===this.projection.name,H=!V,W=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,H),te=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ne=A*u.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),_e=[A*te.x,A*te.y,Q*(H?1:ne)],ee=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,oe=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,xe=t.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?Wo(this):1,fe=et=>{const zt=new u.MercatorCoordinate(et.x+25e-6,et.y,et.z),Lt=new u.MercatorCoordinate(et.x,et.y+25e-6,et.z),vt=et.toLngLat(),St=zt.toLngLat(),vn=Lt.toLngLat(),cn=this.locationCoordinate(vt),Un=this.locationCoordinate(St),tn=this.locationCoordinate(vn),Cn=Math.hypot(Un.x-cn.x,Un.y-cn.y),cr=Math.hypot(tn.x-cn.x,tn.y-cn.y);return Math.sqrt(Cn*cr)*de/25e-6},Se=et=>{const rn=oe,zt=xe;return{aabb:u.tileAABB(this,A,0,0,0,et,zt,rn,this.projection),zoom:0,x:0,y:0,minZ:zt,maxZ:rn,wrap:et,fullyVisible:!1}},Ge=[];let We=[];const $e=l,je=t.reparseOverscaled?p:l,be=et=>et*et,ht=be((Q-this._centerAltitude)*ne),lt=et=>{if(!this._elevation||!et.tileID||!v)return;const rn=this._elevation.getMinMaxForTile(et.tileID),zt=et.aabb;rn?(zt.min[2]=rn.min,zt.max[2]=rn.max,zt.center[2]=(zt.min[2]+zt.max[2])/2):(et.shouldSplit=kt(et),et.shouldSplit||(zt.min[2]=zt.max[2]=zt.center[2]=this._centerAltitude))},kt=et=>{if(et.zoom<ae)return!0;if(et.zoom===$e)return!1;if(null!=et.shouldSplit)return et.shouldSplit;const rn=et.aabb.distanceX(_e),zt=et.aabb.distanceY(_e);let Lt=ht,vt=1;if(V){Lt=be(et.aabb.distanceZ(_e));const vn=Math.pow(2,et.zoom),cn=u.latFromMercatorY((et.y+1)/vn),Un=u.latFromMercatorY(et.y/vn),tn=Math.min(Math.max(I,cn),Un),Cn=u.circumferenceAtLatitude(tn)/u.circumferenceAtLatitude(I);if(vt=tn===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Cn/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&et.zoom===$e-1&&Cn>=.9)return!0}else if(_&&(Lt=be(et.aabb.distanceZ(_e)*ne)),this.projection.isReprojectedInTileSpace&&p<=5){const vn=Math.pow(2,et.zoom),cn=fe(new u.MercatorCoordinate((et.x+.5)/vn,(et.y+.5)/vn));vt=cn>.85?1:cn}const St=rn*rn+zt*zt+Lt;return St<be((1<<$e-et.zoom)*ee*vt*((vn,cn)=>{if(cn*be(.707)<vn)return 1;const Un=Math.sqrt(cn/vn);return Un/(1.4144271570014144+(Math.pow(1.1,Un-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Lt,ht),St))};if(this.renderWorldCopies)for(let et=1;et<=3;et++)Ge.push(Se(-et)),Ge.push(Se(et));for(Ge.push(Se(0));Ge.length>0;){const et=Ge.pop(),rn=et.x,zt=et.y;let Lt=et.fullyVisible;if(!Lt){const vt=et.aabb.intersects(W);if(0===vt)continue;Lt=2===vt}if(et.zoom!==$e&&kt(et))for(let vt=0;vt<4;vt++){const St=(rn<<1)+vt%2,vn=(zt<<1)+(vt>>1),cn={aabb:v?et.aabb.quadrant(vt):u.tileAABB(this,A,et.zoom+1,St,vn,et.wrap,et.minZ,et.maxZ,this.projection),zoom:et.zoom+1,x:St,y:vn,wrap:et.wrap,fullyVisible:Lt,tileID:void 0,shouldSplit:void 0,minZ:et.minZ,maxZ:et.maxZ};_&&!V&&(cn.tileID=new u.OverscaledTileID(et.zoom+1===$e?je:et.zoom+1,et.wrap,et.zoom+1,St,vn),lt(cn)),Ge.push(cn)}else{const vt=et.zoom===$e?je:et.zoom;if(t.minzoom&&t.minzoom>vt)continue;const St=O[0]-(.5+rn+(et.wrap<<et.zoom))*(1<<l-et.zoom),vn=O[1]-.5-zt,cn=et.tileID?et.tileID:new u.OverscaledTileID(vt,et.wrap,et.zoom,rn,zt);We.push({tileID:cn,distanceSq:St*St+vn*vn})}}if(this.fogCullDistSq){const et=this.fogCullDistSq,rn=this.horizonLineFromTop();We=We.filter(zt=>{const Lt=[0,0,0,1],vt=[u.EXTENT,u.EXTENT,0,1],St=this.calculateFogTileMatrix(zt.tileID.toUnwrapped());u.transformMat4$1(Lt,Lt,St),u.transformMat4$1(vt,vt,St);const vn=u.getAABBPointSquareDist(Lt,vt);if(0===vn)return!0;let cn=!1;const Un=this._elevation;if(Un&&vn>et&&0!==rn){const tn=this.calculateProjMatrix(zt.tileID.toUnwrapped());let Cn;t.isTerrainDEM||(Cn=Un.getMinMaxForTile(zt.tileID)),Cn||(Cn={min:xe,max:oe});const cr=u.furthestTileCorner(this.rotation),Tr=[cr[0]*u.EXTENT,cr[1]*u.EXTENT,Cn.max];u.transformMat4(Tr,Tr,tn),cn=(1-Tr[1])*this.height*.5<rn}return vn<et||cn})}return We.sort((et,rn)=>et.distanceSq-rn.distanceSq).map(et=>et.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const l=u.clamp(t.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),p=this.projection.project(t.lng,l);return new u.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,l){let p,_;const v=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;p=(l.x-v.x)/I,_=(l.y-v.y)/I}else{const I=this.pointCoordinate(l),A=this.pointCoordinate(v);p=I.x-A.x,_=I.y-A.y}const E=this.locationCoordinate(t);this.setLocation(new u.MercatorCoordinate(E.x-p,E.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,l){const p=l?u.mercatorZfromAltitude(l,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new u.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,l){const p=l??this._centerAltitude,_=[t.x,t.y,0,1],v=[t.x,t.y,1,1];u.transformMat4$1(_,_,this.pixelMatrixInverse),u.transformMat4$1(v,v,this.pixelMatrixInverse);const E=v[3];u.scale$1(_,_,1/_[3]),u.scale$1(v,v,1/E);const I=_[2],A=v[2];return{p0:_,p1:v,t:I===A?0:(p-I)/(A-I)}}screenPointToMercatorRay(t){const l=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return u.transformMat4$1(l,l,this.pixelMatrixInverse),u.transformMat4$1(p,p,this.pixelMatrixInverse),u.scale$1(l,l,1/l[3]),u.scale$1(p,p,1/p[3]),l[2]=u.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=u.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,u.scale$1(l,l,1/this.worldSize),u.scale$1(p,p,1/this.worldSize),new u.Ray([l[0],l[1],l[2]],u.normalize([],u.sub([],p,l)))}rayIntersectionCoordinate(t){const{p0:l,p1:p,t:_}=t,v=u.mercatorZfromAltitude(l[2],this._center.lat),E=u.mercatorZfromAltitude(p[2],this._center.lat);return new u.MercatorCoordinate(u.number(l[0],p[0],_)/this.worldSize,u.number(l[1],p[1],_)/this.worldSize,u.number(v,E,_))}pointCoordinate(t,l=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,l)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let l=this.projection.pointCoordinate3D(this,t.x,t.y);if(l)return new u.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t);const v=.02*_,E=t.clone();for(let I=0;I<10&&_-p>v;I++){E.y=u.number(p,_,.66);const A=this.projection.pointCoordinate3D(this,E.x,E.y);A?(_=E.y,l=A):p=E.y}return l?new u.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(t,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return u.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new u.pointGeometry(_[0]/_[3],_[1]/_[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,l){const p=new u.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new u.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new u.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new u.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let I=this.pointCoordinate(p,t),A=this.pointCoordinate(_,t);const O=this.pointCoordinate(v,l),V=this.pointCoordinate(E,l),H=(W,te)=>(te.y-W.y)/(te.x-W.x);return I.y>1&&A.y>=0?I=new u.MercatorCoordinate((1-V.y)/H(V,I)+V.x,1):I.y<0&&A.y<=1&&(I=new u.MercatorCoordinate(-V.y/H(V,I)+V.x,0)),A.y>1&&I.y>=0?A=new u.MercatorCoordinate((1-O.y)/H(O,A)+O.x,1):A.y<0&&I.y<=1&&(A=new u.MercatorCoordinate(-O.y/H(O,A)+O.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(O))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const l=t.visibleDemTiles.reduce((p,_)=>{if(_.dem){const v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*t.exaggeration(),l.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,l){return this.projection.createTileMatrix(this,l,t)}calculateDistanceTileData(t){const l=t.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=t.canonical,v=1/this.height,E=this.cameraWorldSize/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*t.wrap)*E,A=_.y*E,O=this.point,V=this.angle,H=Math.sin(-V),W=-Math.cos(-V);return p[l]={bearing:[H,W],center:[(O.x-I)*v,(O.y-A)*v],scale:E/u.EXTENT*v},p[l]}calculateFogTileMatrix(t){const l=t.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return u.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(t,l=!1){const p=t.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const v=this.calculatePosMatrix(t,this.worldSize);return u.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(t){const l=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(v,E){const{scale:I}=v.tileTransform,A=I*u.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return O=new Float32Array(4),W=(V=E.inverseAdjustmentMatrix)[1],te=V[2],ne=V[3],_e=(H=[A,A])[1],O[0]=V[0]*(Q=H[0]),O[1]=W*Q,O[2]=te*_e,O[3]=ne*_e,O;var O,V,H,W,te,ne,Q,_e}(t,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const l=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),v=u.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,_[2]/=v,u.normalize(_,_);const E=t.raycast(p,_,t.exaggeration());if(E){const I=u.scaleAndAdd([],p,_,E),A=new u.MercatorCoordinate(I[0],I[1],u.mercatorZfromAltitude(I[2],u.latFromMercatorY(I[1]))),O=(A.z+u.length([A.x-p[0],A.y-p[1],A.z-p[2]*v]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const l=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=t.getAtPointOrZero(new u.MercatorCoordinate(...p)),v=this._minimumHeightOverTerrain()*Math.cos(u.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(E<v){const I=this.locationCoordinate(this._center,this._centerAltitude),A=[I.x-p[0],I.y-p[1],I.z-p[2]],O=u.length(A);A[2]-=(v-E)/this._projectionScaler;const V=u.length(A);if(0===V)return;u.scale$2(A,A,O/V*this._projectionScaler),this._camera.position=[I.x-A[0],I.y-A[1],I.z*this._projectionScaler-A[2]],this._camera.orientation=$s(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const H=this.center;return H.lat=u.clamp(H.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(H.lng=u.clamp(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const t=this._unmodified,{x:l,y:p}=this.point;let _=0,v=l,E=p;const I=this.width/2,A=this.height/2,O=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(p-A<O&&(E=O+A),p+A>V&&(E=V-A),V-O<this.height&&(_=Math.max(_,this.height/(V-O)),E=(V+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,te=this.worldSize/2-(H+W)/2;v=(l+te+this.worldSize)%this.worldSize-te,v-I<H&&(v=H+I),v+I>W&&(v=W-I),W-H<this.width&&(_=Math.max(_,this.width/(W-H)),v=(W+H)/2)}v===l&&E===p||(this.center=this.unproject(new u.pointGeometry(v,E))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,l=this.pixelsPerMeter;if("globe"===this.projection.name){const de=u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,fe=u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=de/fe}const p=Gs(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?l:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-t.x/this.width,v[9]=2*t.y/this.height;let E=u.mul([],v,_);if(this.projection.isReprojectedInTileSpace){const de=this.locationCoordinate(this.center),fe=u.identity([]);u.translate(fe,fe,[de.x*this.worldSize,de.y*this.worldSize,0]),u.multiply(fe,fe,Ht(this)),u.translate(fe,fe,[-de.x*this.worldSize,-de.y*this.worldSize,0]),u.multiply(E,E,fe),this.inverseAdjustmentMatrix=function(Se){const Ge=Ht(Se,!0);return Nt([],[Ge[0],Ge[1],Ge[4],Ge[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],E,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=E,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const I=u.invert([],v);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);u.identity(A),u.scale(A,A,[1,-1,1]),u.rotateX(A,A,this._pitch),u.rotateZ(A,A,this.angle);const O=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-t.x/this.width,O[9]=2*(t.y+V)/this.height,this.skyboxMatrix=u.multiply(A,O,A);const H=this.point,W=H.x,te=H.y,ne=this.width%2/2,Q=this.height%2/2,_e=Math.cos(this.angle),ee=Math.sin(this.angle),ae=W-Math.round(W)+_e*ne+ee*Q,oe=te-Math.round(te)+_e*Q+ee*ne,xe=new Float64Array(E);if(u.translate(xe,xe,[ae>.5?ae-1:ae,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=xe,E=u.create(),u.scale(E,E,[this.width/2,-this.height/2,1]),u.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=u.create(),u.scale(E,E,[1,-1,1]),u.translate(E,E,[-1,-1,0]),u.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=u.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=E,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(de,de,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=E;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._projectionScaler,v=[t,t,l];u.scale$2(v,v,_),u.scale$2(p,p,-1),u.multiply$2(p,p,v);const E=u.create();u.translate(E,E,p),u.scale(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,l,_)}_computeCameraPosition(t){const l=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,t/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),I=Math.max((t[2]-v)/Math.cos(p),E),A=this._zoomFromMercatorZ(I);u.scaleAndAdd(t,t,l,I),this._pitch=u.clamp(p,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(_,-Math.PI,Math.PI),this._setZoom(u.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,l){const p=Math.min(t.x,l.x),_=Math.max(t.x,l.x),v=Math.min(t.y,l.y),E=Math.max(t.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new u.pointGeometry(p,v),new u.pointGeometry(_,E),new u.pointGeometry(p,E),new u.pointGeometry(_,v)],A=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const V of I){const H=this.pointRayIntersection(V);if(H.t<0)return!0;const W=this.rayIntersectionCoordinate(H);if(W.x<A||W.y<0||W.x>O||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,l){const p=u.length(u.sub([],this._camera.position,t)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if("globe"===this.projection.name){const t=function(l,p){const _=[l[0],l[1],l[2],1];u.transformMat4$1(_,_,p);const v=Math.max(_[3],1e-6);return[_[0]/v,_[1]/v,_[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,t))}}getCameraToCenterDistance(t){const l=Gs(t,this.zoom,this.width,this.height,1024),p=t.pixelSpaceConversion(this.center.lat,this.worldSize,l);return.5/Math.tan(.5*this._fov)*this.height*p}}function $a(h,t){let l=!1,p=null;const _=()=>{p=null,l&&(h(),p=setTimeout(_,t),l=!1)};return()=>(l=!0,p||_(),p)}class Ts{constructor(t){this._hashName=t&&encodeURIComponent(t),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$a(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,u.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const l=this._map;if(!l)return"";const p=l.getCenter(),_=Math.round(100*l.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,v),I=Math.round(p.lng*E)/E,A=Math.round(p.lat*E)/E,O=l.getBearing(),V=l.getPitch();let H="";if(H+=t?`/${I}/${A}/${_}`:`${_}/${A}/${I}`,(O||V)&&(H+="/"+Math.round(10*O)/10),V&&(H+=`/${Math.round(V)}`),this._hashName){const W=this._hashName;let te=!1;const ne=u.window.location.hash.slice(1).split("&").map(Q=>{const _e=Q.split("=")[0];return _e===W?(te=!0,`${_e}=${H}`):Q}).filter(Q=>Q);return te||ne.push(`${W}=${H}`),`#${ne.join("&")}`}return`#${H}`}_getCurrentHash(){const t=u.window.location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(l[3]||0):t.getBearing();return t.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,t)}}const Ds={linearity:.3,easing:u.bezier(0,0,.3,1)},Cs=u.extend({deceleration:2500,maxSpeed:1400},Ds),sc=u.extend({deceleration:20,maxSpeed:1400},Ds),Is=u.extend({deceleration:1e3,maxSpeed:360},Ds),oh=u.extend({deceleration:1e3,maxSpeed:90},Ds);class wu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=u.exported.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const v=fa(l.pan.mag(),p,u.extend({},Cs,t||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,Ga(_,v)}if(l.zoom){const v=fa(l.zoom,p,sc);_.zoom=this._map.transform.zoom+v.amount,Ga(_,v)}if(l.bearing){const v=fa(l.bearing,p,Is);_.bearing=this._map.transform.bearing+u.clamp(v.amount,-179,179),Ga(_,v)}if(l.pitch){const v=fa(l.pitch,p,oh);_.pitch=this._map.transform.pitch+v.amount,Ga(_,v)}if(_.zoom||_.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Ga(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function fa(h,t,l){const{maxSpeed:p,linearity:_,deceleration:v}=l,E=u.clamp(h*_/(t/1e3),-p,p),I=Math.abs(E)/(v*_);return{easing:l.easing,duration:1e3*I,amount:E*(I/2)}}class qr extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p,_={}){const v=Xt(l.getCanvasContainer(),p),E=l.unproject(v);super(t,u.extend({point:v,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class hi extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){const _="touchend"===t?p.changedTouches:p.touches,v=Hn(l.getCanvasContainer(),_),E=v.map(A=>l.unproject(A)),I=v.reduce((A,O,V,H)=>A.add(O.div(H.length)),new u.pointGeometry(0,0));super(t,{points:v,point:I,lngLats:E,lngLat:l.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class Ha extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class pa{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Ha(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new qr(t.type,this._map,t))}mouseup(t){this._map.fire(new qr(t.type,this._map,t))}preclick(t){const l=u.extend({},t);l.type="preclick",this._map.fire(new qr(l.type,this._map,l))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(t),this._map.fire(new qr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new qr(t.type,this._map,t))}mouseover(t){this._map.fire(new qr(t.type,this._map,t))}mouseout(t){this._map.fire(new qr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new hi(t.type,this._map,t))}touchmove(t){this._map.fire(new hi(t.type,this._map,t))}touchend(t){this._map.fire(new hi(t.type,this._map,t))}touchcancel(t){this._map.fire(new hi(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hs{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new qr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new qr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ma{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&0===t.button&&(ut(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=Mt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(_.x,p.x),E=Math.max(_.x,p.x),I=Math.min(_.y,p.y),A=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${I}px)`,this._box.style.width=E-v+"px",this._box.style.height=A-I+"px")})}mouseupWindow(t,l){if(!this._active||0!==t.button)return;const p=this._startPos,_=l;if(this.reset(),dn(),p.x!==_.x||p.y!==_.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),bn(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new u.Event(t,{originalEvent:l}))}}function Zs(h,t){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=t[p];return l}class Eu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new u.pointGeometry(0,0);for(const E of _)v._add(E);return v.div(_.length)}(l),this.touches=Zs(p,l)))}touchmove(t,l,p){if(this.aborted||!this.centroid)return;const _=Zs(p,l);for(const v in this.touches){const E=this.touches[v],I=_[v];(!I||I.dist(E)>30)&&(this.aborted=!0)}}touchend(t,l,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Za{constructor(t){this.singleTap=new Eu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,l,p){this.singleTap.touchstart(t,l,p)}touchmove(t,l,p){this.singleTap.touchmove(t,l,p)}touchend(t,l,p){const _=this.singleTap.touchend(t,l,p);if(_){const v=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(v&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class zc{constructor(){this._zoomIn=new Za({numTouches:1,numTaps:2}),this._zoomOut=new Za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,p){this._zoomIn.touchstart(t,l,p),this._zoomOut.touchstart(t,l,p)}touchmove(t,l,p){this._zoomIn.touchmove(t,l,p),this._zoomOut.touchmove(t,l,p)}touchend(t,l,p){const _=this._zoomIn.touchend(t,l,p),v=this._zoomOut.touchend(t,l,p);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qs={0:1,2:2};class ac{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const p=Zt(t);this._correctButton(t,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(t,l){const p=this._lastPoint;if(p)if(t.preventDefault(),null!=this._eventButton&&function(_,v){const E=qs[v];return void 0===_.buttons||(_.buttons&E)!==E}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(t){this._lastPoint&&Zt(t)===this._eventButton&&(this._moved&&dn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sh extends ac{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return 0===l&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class ga extends ac{_correctButton(t,l){return 0===l&&t.ctrlKey||2===l}_move(t,l){const p=.8*(l.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class Ws extends ac{_correctButton(t,l){return 0===l&&t.ctrlKey||2===l}_move(t,l){const p=-.5*(l.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class Tu{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(t,l,p){return this._calculateTransform(t,l,p)}touchmove(t,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,l,p)}}touchend(t,l,p){this._calculateTransform(t,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,p){p.length>0&&(this._active=!0);const _=Zs(p,l),v=new u.pointGeometry(0,0),E=new u.pointGeometry(0,0);let I=0;for(const O in _){const V=_[O],H=this._touches[O];H&&(v._add(V),E._add(V.sub(H)),I++,_[O]=V)}if(this._touches=_,I<this._minTouches||!E.mag())return;const A=E.div(I);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(I),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Mt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class yo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,l,p){return{}}touchstart(t,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,p){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[v,E]=_,I=wi(p,l,v),A=wi(p,l,E);if(!I||!A)return;const O=this._aroundCenter?null:I.add(A).div(2);return this._move([I,A],O,t)}touchend(t,l,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,E=wi(p,l,_),I=wi(p,l,v);E&&I||(this._active&&dn(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wi(h,t,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return t[p]}function Ss(h,t){return Math.log(h/t)/Math.LN2}class Bc extends yo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ss(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ss(this._distance,p),pinchAround:l}}}function Nc(h,t){return 180*h.angleWith(t)/Math.PI}class Uc extends yo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Nc(this._vector,p),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,p=Nc(t,this._startVector);return Math.abs(p)<l}}function Xo(h){return Math.abs(h.y)>Math.abs(h.x)}class Vc extends yo{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Xo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,p){const _=this._lastPoints;if(!_)return;const v=t[0].sub(_[0]),E=t[1].sub(_[1]);return this._map._cooperativeGestures&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5})}gestureBeginsVertically(t,l,p){if(void 0!==this._valid)return this._valid;const _=t.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=t.y>0==l.y>0;return Xo(t)&&Xo(l)&&E}}const Xs={panStep:100,bearingStep:15,pitchStep:10};class Ji{constructor(){const t=Xs;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,p=0,_=0,v=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:I=>{const A=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Ms,zoom:l?Math.round(A)+l*(t.shiftKey?2:1):A,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ms(h){return h*(2-h)}const Ut=4.000244140625;class lc{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=t.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=u.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%Ut==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Xt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,l=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>Ut?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==O&&(O=1/O);const V=l(),H=Math.pow(2,V),W="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(W*O))),"wheel"===this._type&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),_=this._startZoom,v=this._easing;let E,I=!1;if("wheel"===this._type&&_&&v){const A=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),O=v(A);E=u.number(_,p,O),A<1?this._frameId||(this._frameId=!0):I=!0}else E=p,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:E-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=u.ease;if(this._prevEase){const p=this._prevEase,_=(u.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(v*v+1e-4)*.01,I=Math.sqrt(.0729-E*E);l=u.bezier(E,I,.25,1)}return this._prevEase={start:u.exported.now(),duration:t,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Mt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!u.window.document.fullscreenElement||!!u.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class cc{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class os{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,l){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uc{constructor(){this._tap=new Za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,l,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,l,p))}touchmove(t,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,l,p)}touchend(t,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(t,l,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Du{constructor(t,l,p){this._el=t,this._mousePan=l,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Er{constructor(t,l,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cu{constructor(t,l,p,_){this._el=t,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hc=h=>h.zoom||h.drag||h.pitch||h.rotate;class Iu extends u.Event{}class ah{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,l){const p=u.sub([],l,t);this.radius=u.length(p[2]<0?u.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){u.div(t,t,this.constants),u.normalize(t,t),u.mul$1(t,t,this.constants);const l=u.scale$2([],t,this.radius);if(l[2]>0){const p=u.scale$2([],[0,0,1],u.dot(l,[0,0,1])),_=u.scale$2([],u.normalize([],[l[0],l[1],0]),this.radius),v=u.add([],l,u.scale$2([],u.sub([],u.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function qa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class jc{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wu(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ah,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),u.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[_,v,E]of this._listeners)_.addEventListener(v,_===u.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,l,p]of this._listeners)t.removeEventListener(l,t===u.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new pa(l,t));const _=l.boxZoom=new ma(l,t);this._add("boxZoom",_);const v=new zc,E=new os;l.doubleClickZoom=new cc(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const I=new uc;this._add("tapDragZoom",I);const A=l.touchPitch=new Vc(l);this._add("touchPitch",A);const O=new ga(t),V=new Ws(t);l.dragRotate=new Er(t,O,V),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const H=new sh(t),W=new Tu(l,t);l.dragPan=new Du(p,H,W),this._add("mousePan",H),this._add("touchPan",W,["touchZoom","touchRotate"]);const te=new Uc,ne=new Bc;l.touchZoomRotate=new Cu(p,ne,te,I),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hs(l));const Q=l.scrollZoom=new lc(l,this);this._add("scrollZoom",Q,["mousePan"]);const _e=l.keyboard=new Ji;this._add("keyboard",_e);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ee]&&l[ee].enable(t[ee])}_add(t,l,p){this._handlers.push({handlerName:t,handler:l,allowed:p}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hc(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,l,p){for(const _ in t)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const p of t)this._el.contains(p.target)&&l.push(p);return l}handleEvent(t,l){this._updatingCamera=!0;const p="renderFrame"===t.type,_=p?void 0:t,v={needsRenderFrame:!1},E={},I={},A=t.touches?this._getMapTouches(t.touches):void 0,O=A?Hn(this._el,A):p?void 0:Xt(this._el,t);for(const{handlerName:W,handler:te,allowed:ne}of this._handlers){if(!te.isEnabled())continue;let Q;this._blockedByActive(I,ne,W)?te.reset():te[l||t.type]&&(Q=te[l||t.type](t,O,A),this.mergeHandlerResult(v,E,Q,W,_),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||te.isActive())&&(I[W]=te)}const V={};for(const W in this._previousActiveHandlers)I[W]||(V[W]=_);this._previousActiveHandlers=I,(Object.keys(V).length||qa(v))&&(this._changes.push([v,E,V]),this._triggerRenderFrame()),(Object.keys(I).length||qa(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=v;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(t,l,p,_,v){if(!p)return;u.extend(t,p);const E={handlerName:_,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(l.zoom=E),void 0!==p.panDelta&&(l.drag=E),void 0!==p.pitchDelta&&(l.pitch=E),void 0!==p.bearingDelta&&(l.rotate=E)}_applyChanges(){const t={},l={},p={};for(const[_,v,E]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new u.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(t.around=_.around),void 0!==_.aroundCoord&&(t.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),u.extend(l,v),u.extend(p,E);this._updateMapTransform(t,l,p),this._changes=[]}_updateMapTransform(t,l,p){const _=this._map,v=_.transform,E=ae=>[ae.x,ae.y,ae.z];if((ae=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!qa(t)){const ae=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ae!==v.zoom&&this._map._update(!0)}if(!qa(t))return void this._fireEvents(l,p,!0);let{panDelta:I,zoomDelta:A,bearingDelta:O,pitchDelta:V,around:H,aroundCoord:W,pinchAround:te}=t;void 0!==te&&(H=te),(ae=>l.drag&&!this._eventsInProgress.drag)()&&H&&(this._dragOrigin=E(v.pointCoordinate3D(H)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),H=H||_.transform.centerPoint,O&&(v.bearing+=O),V&&(v.pitch+=V),v._updateCameraState();const ne=[0,0,0];if(I){const ae=v.pointCoordinate(H);if("globe"===v.projection.name){const oe=u.latFromMercatorY(ae.y),xe=v.center.lat,de=Math.min(u.mercatorZfromAltitude(1,oe)/u.mercatorZfromAltitude(1,xe),2);I=I.rotate(-v.angle),ne[0]=-I.x/v.worldSize*de,ne[1]=-I.y/v.worldSize*de}else{const oe=v.pointCoordinate(H.sub(I));ae&&oe&&(ne[0]=oe.x-ae.x,ne[1]=oe.y-ae.y)}}const Q=v.zoom,_e=[0,0,0];if(A){const ae=E(W||v.pointCoordinate3D(H)),oe={dir:u.normalize([],u.sub([],ae,v._camera.position))};if(oe.dir[2]<0){const xe=v.zoomDeltaToMovement(ae,A);u.scale$2(_e,oe.dir,xe)}}const ee=u.add(ne,ne,_e);v._translateCameraConstrained(ee),A&&Math.abs(v.zoom-Q)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,p,!0)}_fireEvents(t,l,p){const _=hc(this._eventsInProgress),v=hc(t),E={};for(const V in t){const{originalEvent:H}=t[V];this._eventsInProgress[V]||(E[`${V}start`]=H),this._eventsInProgress[V]=t[V]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in E)this._fireEvent(V,E[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in t){const{originalEvent:H}=t[V];this._fireEvent(V,H)}const I={};let A;for(const V in this._eventsInProgress){const{handlerName:H,originalEvent:W}=this._eventsInProgress[V];this._handlersById[H].isActive()||(delete this._eventsInProgress[V],A=l[H]||W,I[`${V}end`]=A)}for(const V in I)this._fireEvent(V,I[V]);const O=hc(this._eventsInProgress);if(p&&(_||v)&&!O){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=W=>0!==W&&-this._bearingSnap<W&&W<this._bearingSnap;V?(H(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:A})):(this._map.fire(new u.Event("moveend",{originalEvent:A})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new u.Event(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Iu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const $c="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ys extends u.Evented{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,p){return t=u.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,u.extend({offset:t},l),p)}panTo(t,l,p){return this.easeTo(u.extend({center:t},l),p)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,p){return this.easeTo(u.extend({zoom:t},l),p)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,p){return this.easeTo(u.extend({bearing:t},l),p)}resetNorth(t,l){return this.rotateTo(0,u.extend({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){"globe"===this.transform.projection.name&&u.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=u.LngLatBounds.convert(t);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,l)}_extendCameraOptions(t){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=u.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=u.extend(l,t.padding),t}_cameraForBoxAndBearing(t,l,p,_){const v=this._extendCameraOptions(_),E=this.transform,I=E.padding,A=E.project(u.LngLat.convert(t)),O=E.project(u.LngLat.convert(l)),V=new u.pointGeometry(A.x,O.y),H=new u.pointGeometry(O.x,A.y),W=-u.degToRad(p),te=A.rotate(W),ne=O.rotate(W),Q=V.rotate(W),_e=H.rotate(W),ee=new u.pointGeometry(Math.max(te.x,ne.x,Q.x,_e.x),Math.max(te.y,ne.y,Q.y,_e.y)),ae=new u.pointGeometry(Math.min(te.x,ne.x,Q.x,_e.x),Math.min(te.y,ne.y,Q.y,_e.y)),oe=ee.sub(ae),xe=(E.width-((I.left||0)+(I.right||0)+v.padding.left+v.padding.right))/oe.x,de=(E.height-((I.top||0)+(I.bottom||0)+v.padding.top+v.padding.bottom))/oe.y;if(de<0||xe<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const fe=Math.min(E.scaleZoom(E.scale*Math.min(xe,de)),v.maxZoom),Se="number"==typeof v.offset.x&&"number"==typeof v.offset.y?new u.pointGeometry(v.offset.x,v.offset.y):u.pointGeometry.convert(v.offset),Ge=new u.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),We=Se.add(Ge).mult(E.scale/E.zoomScale(fe));return{center:E.unproject(A.add(O).div(2).sub(We)),zoom:fe,bearing:p}}_cameraForBox(t,l,p,_,v){const E=this._extendCameraOptions(v);p=p||0,_=_||0,t=u.LngLat.convert(t),l=u.LngLat.convert(l);const I=this.transform.clone();I.padding=E.padding;const A=this.getFreeCameraOptions(),O=new u.LngLat(.5*(t.lng+l.lng),.5*(t.lat+l.lat)),V=.5*(p+_);if(I._camera.position[2]<u.mercatorZfromAltitude(V,O.lat))return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(O),I.setFreeCameraOptions(A);const H=u.MercatorCoordinate.fromLngLat(t),W=u.MercatorCoordinate.fromLngLat(l),te=I.pointRayIntersection(I.centerPoint,V),ne=[(Q=I.rayIntersectionCoordinate(te)).x,Q.y,Q.z];var Q;const _e=I.screenPointToMercatorRay(I.centerPoint),ee="globe"!==I.projection.name;let ae,oe=0;do{const xe=Math.floor(I.zoom),de=1<<xe,fe=Math.min(de*H.x,de*W.x),Se=Math.min(de*H.y,de*W.y),Ge=Math.max(de*H.x,de*W.x),We=Math.max(de*H.y,de*W.y),$e=new u.Aabb([fe,Se,p],[Ge,We,_]),je=u.Frustum.fromInvProjectionMatrix(I.invProjMatrix,I.worldSize,xe,ee);if(2!==$e.intersects(je)){ae&&(I._camera.position=u.scaleAndAdd([],I._camera.position,_e.dir,-ae),I._updateStateFromCamera());break}const be=u.sub([],I._camera.position,ne);ae=.5*u.length(be),I._camera.position=u.scaleAndAdd([],I._camera.position,_e.dir,ae);try{I._updateStateFromCamera()}catch{return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++oe<10);return{center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch}}fitBounds(t,l,p){return"globe"===this.transform.projection.name&&u.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,l),l,p)}_raycastElevationBox(t,l){const p=this.transform.elevation;if(!p)return;const _=new u.pointGeometry(t.x,l.y),v=new u.pointGeometry(l.x,t.y),E=p.pointCoordinate(t);if(!E)return;const I=p.pointCoordinate(l);if(!I)return;const A=p.pointCoordinate(_);if(!A)return;const O=p.pointCoordinate(v);if(!O)return;const V=new u.MercatorCoordinate(E[0],E[1]).toLngLat(),H=new u.MercatorCoordinate(I[0],I[1]).toLngLat(),W=new u.MercatorCoordinate(A[0],A[1]).toLngLat(),te=new u.MercatorCoordinate(O[0],O[1]).toLngLat(),ne=Math.min(V.lng,Math.min(H.lng,Math.min(W.lng,te.lng))),Q=Math.min(V.lat,Math.min(H.lat,Math.min(W.lat,te.lat))),_e=Math.max(V.lng,Math.max(H.lng,Math.max(W.lng,te.lng))),ee=Math.max(V.lat,Math.max(H.lat,Math.max(W.lat,te.lat))),ae=Math.min(E[3],Math.min(I[3],Math.min(A[3],O[3]))),oe=Math.max(E[3],Math.max(I[3],Math.max(A[3],O[3])));return{minLngLat:new u.LngLat(ne,Q),maxLngLat:new u.LngLat(_e,ee),minAltitude:ae,maxAltitude:oe}}fitScreenCoordinates(t,l,p,_,v){let E,I,A,O;"globe"===this.transform.projection.name&&u.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const V=u.pointGeometry.convert(t),H=u.pointGeometry.convert(l),W=this._raycastElevationBox(V,H);if(W)E=W.minLngLat,I=W.maxLngLat,A=W.minAltitude,O=W.maxAltitude;else{if(this.transform.anyCornerOffEdge(V,H))return this;E=this.transform.pointLocation(V),I=this.transform.pointLocation(H)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(u.pointGeometry.convert(t)),this.transform.pointLocation(u.pointGeometry.convert(l)),p,_):this._cameraForBox(E,I,A,O,_),_,v)}_fitInternal(t,l,p){return t?(delete(l=u.extend(t,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(t,l){this.stop();const p=t.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,E=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(_=!0,p.zoom=+t.zoom),void 0!==t.center&&(p.center=u.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(v=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(E=!0,p.pitch=+t.pitch),null==t.padding||p.isPaddingEqual(t.padding)||(p.padding=t.padding),t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new u.Event("movestart",l)).fire(new u.Event("move",l)),_&&this.fire(new u.Event("zoomstart",l)).fire(new u.Event("zoom",l)).fire(new u.Event("zoomend",l)),v&&this.fire(new u.Event("rotatestart",l)).fire(new u.Event("rotate",l)).fire(new u.Event("rotateend",l)),E&&this.fire(new u.Event("pitchstart",l)).fire(new u.Event("pitch",l)).fire(new u.Event("pitchend",l)),this.fire(new u.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce($c),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return u.warnOnce($c),this;this.stop();const _=p.zoom,v=p.pitch,E=p.bearing;p.setFreeCameraOptions(t);const I=_!==p.zoom,A=v!==p.pitch,O=E!==p.bearing;return this.fire(new u.Event("movestart",l)).fire(new u.Event("move",l)),I&&this.fire(new u.Event("zoomstart",l)).fire(new u.Event("zoom",l)).fire(new u.Event("zoomend",l)),O&&this.fire(new u.Event("rotatestart",l)).fire(new u.Event("rotate",l)).fire(new u.Event("rotateend",l)),A&&this.fire(new u.Event("pitchstart",l)).fire(new u.Event("pitch",l)).fire(new u.Event("pitchend",l)),this.fire(new u.Event("moveend",l)),this}easeTo(t,l){this._stop(!1,t.easeId),(!1===(t=u.extend({offset:[0,0],duration:500,easing:u.ease},t)).animate||!t.essential&&u.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),I=this.getPadding(),A="zoom"in t?+t.zoom:_,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,V="pitch"in t?+t.pitch:E,H="padding"in t?t.padding:p.padding,W=u.pointGeometry.convert(t.offset);let te,ne,Q;if("globe"===p.projection.name){const We=u.MercatorCoordinate.fromLngLat(p.center),$e=W.rotate(-p.angle);We.x+=$e.x/p.worldSize,We.y+=$e.y/p.worldSize;const je=We.toLngLat(),be=u.LngLat.convert(t.center||je);this._normalizeCenter(be),te=p.centerPoint.add($e),ne=new u.pointGeometry(We.x,We.y).mult(p.worldSize),Q=new u.pointGeometry(u.mercatorXfromLng(be.lng),u.mercatorYfromLat(be.lat)).mult(p.worldSize).sub(ne)}else{te=p.centerPoint.add(W);const We=p.pointLocation(te),$e=u.LngLat.convert(t.center||We);this._normalizeCenter($e),ne=p.project(We),Q=p.project($e).sub(ne)}const _e=p.zoomScale(A-_);let ee,ae;t.around&&(ee=u.LngLat.convert(t.around),ae=p.locationPoint(ee));const oe=this._zooming||A!==_,xe=this._rotating||v!==O,de=this._pitching||V!==E,fe=!p.isPaddingEqual(H),Se=We=>$e=>{if(oe&&(We.zoom=u.number(_,A,$e)),xe&&(We.bearing=u.number(v,O,$e)),de&&(We.pitch=u.number(E,V,$e)),fe&&(We.interpolatePadding(I,H,$e),te=We.centerPoint.add(W)),ee)We.setLocationAtPoint(ee,ae);else{const je=We.zoomScale(We.zoom-_),be=A>_?Math.min(2,_e):Math.max(.5,_e),ht=Math.pow(be,1-$e),lt=We.unproject(ne.add(Q.mult($e*ht)).mult(je));We.setLocationAtPoint(We.renderWorldCopies?lt.wrap():lt,te)}return t.preloadOnly||this._fireMoveEvents(l),We};if(t.preloadOnly){const We=this._emulate(Se,t.duration,p);return this._preloadTiles(We),this}const Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=xe,this._pitching=de,this._padding=fe,this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,Ge),this._ease(Se(p),We=>{p.recenterOnTerrain(),this._afterEase(l,We)},t),this}_prepareEase(t,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new u.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new u.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new u.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new u.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new u.Event("move",t)),this._zooming&&this.fire(new u.Event("zoom",t)),this._rotating&&this.fire(new u.Event("rotate",t)),this._pitching&&this.fire(new u.Event("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new u.Event("zoomend",t)),_&&this.fire(new u.Event("rotateend",t)),v&&this.fire(new u.Event("pitchend",t)),this.fire(new u.Event("moveend",t))}flyTo(t,l){if(!t.essential&&u.exported.prefersReducedMotion){const Lt=u.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,l)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},t);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),I=this.getPadding(),A="zoom"in t?u.clamp(+t.zoom,p.minZoom,p.maxZoom):_,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,V="pitch"in t?+t.pitch:E,H="padding"in t?t.padding:p.padding,W=p.zoomScale(A-_),te=u.pointGeometry.convert(t.offset);let ne=p.centerPoint.add(te);const Q=p.pointLocation(ne),_e=u.LngLat.convert(t.center||Q);this._normalizeCenter(_e);const ee=p.project(Q),ae=p.project(_e).sub(ee);let oe=t.curve;const xe=Math.max(p.width,p.height),de=xe/W,fe=ae.mag();if("minZoom"in t){const Lt=u.clamp(Math.min(t.minZoom,_,A),p.minZoom,p.maxZoom),vt=xe/p.zoomScale(Lt-_);oe=Math.sqrt(vt/fe*2)}const Se=oe*oe;function Ge(Lt){const vt=(de*de-xe*xe+(Lt?-1:1)*Se*Se*fe*fe)/(2*(Lt?de:xe)*Se*fe);return Math.log(Math.sqrt(vt*vt+1)-vt)}function We(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function $e(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const je=Ge(0);let be=function(Lt){return $e(je)/$e(je+oe*Lt)},ht=function(Lt){return xe*(($e(je)*(We(vt=je+oe*Lt)/$e(vt))-We(je))/Se)/fe;var vt},lt=(Ge(1)-je)/oe;if(Math.abs(fe)<1e-6||!isFinite(lt)){if(Math.abs(xe-de)<1e-6)return this.easeTo(t,l);const Lt=de<xe?-1:1;lt=Math.abs(Math.log(de/xe))/oe,ht=function(){return 0},be=function(vt){return Math.exp(Lt*oe*vt)}}t.duration="duration"in t?+t.duration:1e3*lt/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const kt=v!==O,et=V!==E,rn=!p.isPaddingEqual(H),zt=Lt=>vt=>{const St=vt*lt,vn=1/be(St);Lt.zoom=1===vt?A:_+Lt.scaleZoom(vn),kt&&(Lt.bearing=u.number(v,O,vt)),et&&(Lt.pitch=u.number(E,V,vt)),rn&&(Lt.interpolatePadding(I,H,vt),ne=Lt.centerPoint.add(te));const cn=1===vt?_e:Lt.unproject(ee.add(ae.mult(ht(St))).mult(vn));return Lt.setLocationAtPoint(Lt.renderWorldCopies?cn.wrap():cn,ne),Lt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(l),Lt};if(t.preloadOnly){const Lt=this._emulate(zt,t.duration,p);return this._preloadTiles(Lt),this}return this._zooming=!0,this._rotating=kt,this._pitching=et,this._padding=rn,this._prepareEase(l,!1),this._ease(zt(p),()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,l,p){!1===p.animate||0===p.duration?(t(1),l()):(this._easeStart=u.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=u.wrap(t,-180,180);const p=Math.abs(t-l);return Math.abs(t-360-l)<p&&(t-=360),Math.abs(t+360-l)<p&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=t.lng-l.center.lng;t.lng+=p>180?-360:p<-180?360:0}_emulate(t,l,p){const _=Math.ceil(15*l/1e3),v=[],E=t(p.clone());for(let I=0;I<=_;I++){const A=E(I/_);v.push(A.clone())}return v}}class lh{constructor(t={}){this.options=t,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const l=this.options&&this.options.compact;return this._map=t,this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Mt("button","mapboxgl-ctrl-attrib-button",this._container),Mt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Mt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const p=this._map._getUIString(`AttributionControl.${l}`);t.setAttribute("aria-label",p),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(t){const p=l.reduce((_,v,E)=>(v.value&&(_+=`${v.key}=${v.value}${E<l.length-1?"&":""}`),_),"?");t.href=`${u.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const v=l[_];if(v.used){const E=v.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort((_,v)=>_.length-v.length),t=t.filter((_,v)=>{for(let E=v+1;E<t.length;E++)if(t[E].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class M{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Mt("div","mapboxgl-ctrl");const l=Mt("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const l in t){const p=t[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class C{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function D(h,t,l){if(h=new u.LngLat(h.lng,h.lat),t){const p=new u.LngLat(h.lng-360,h.lat),_=new u.LngLat(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),E=l.locationPoint(h).distSqr(t),I=t.x<0||t.y<0||t.x>l.width||t.y>l.height;l.locationPoint(p).distSqr(t)<E&&(I||Math.abs(p.lng-l.center.lng)<v)?h=p:l.locationPoint(_).distSqr(t)<E&&(I||Math.abs(_.lng-l.center.lng)<v)&&(h=_)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const L={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class U extends u.Evented{constructor(t,l){if(super(),(t instanceof u.window.HTMLElement||l)&&(t=u.extend({element:t},l)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=u.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Mt("div");const _=41,v=27,E=Ct("svg",{display:"block",height:_*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${_}`},this._element),I=Ct("radialGradient",{id:"shadowGradient"},Ct("defs",{},E));Ct("stop",{offset:"10%","stop-opacity":.4},I),Ct("stop",{offset:"100%","stop-opacity":.05},I),Ct("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),Ct("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),Ct("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),Ct("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=u.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in L)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(24.6+_)],"bottom-right":[-_,-1*(24.6+_)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const l=t.code,p=t.charCode||t.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map;if(!t)return!1;const l=t.unproject(this._pos),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(l)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const l=this._pos;if(!l||l.x<0||l.x>t.transform.width||l.y<0||l.y>t.transform.height)return void this._clearFadeTimer();const p=t.unproject(l);let _;t._usingGlobe()&&u.isLngLatBehindGlobe(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=.2)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const l=this._calculateXYTransform()+this._calculateZTransform(),p=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px) ${L[this._anchor]}\n            ${l}\n            translate(${p.x}px,${p.y}px)\n        `}_calculateXYTransform(){const t=this._pos,l=this._map;if("map"!==this.getPitchAlignment()||!l||!t)return"";if(!l._usingGlobe()){const A=l.getPitch();return A?`rotateX(${A}deg)`:""}const p=u.radToDeg(u.globeTiltAtLngLat(l.transform,this._lngLat)),_=t.sub(u.globeCenterToScreenPoint(l.transform)),v=p/(Math.abs(_.x)+Math.abs(_.y)),E=_.x*v,I=-_.y*v;return I||E?`rotateX(${I}deg) rotateY(${E}deg)`:""}_calculateZTransform(){const t=this._calculateRotation();return t?`rotateZ(${t}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const l=t.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),p=t.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);return this._rotation+u.radToDeg(Math.atan2(p.y,p.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){u.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=D(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===t?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._usingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=u.pointGeometry.convert(t),this._update(),this}_onMove(t){const l=this._map;if(l){if(!this._isDragging){const p=this._clickTolerance||l._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(t){const l=this._map;l&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const l=this._map;return l&&(t?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class X{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const l=u.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,l,p){this._start=this.getValue(l),this._end=t,this._startTime=l,this._endTime=l+p}}const pe={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},De={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ye(h){h.parentNode&&h.parentNode.removeChild(h)}const It={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rn{constructor(t,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new ga({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new Ws({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),ut()}move(t,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(t,l),v=_&&_.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const E=this.mousePitch.mousemoveWindow(t,l),I=E&&E.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){bn(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(u.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Xt(this.element,t)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Xt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=Hn(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=Hn(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const en={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zr={maxWidth:100,unit:"metric"};function Wr(h,t,l){const p=Ro(t),_=p/t,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=`${p}&nbsp;${v}`})}function Ro(h){const t=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/t;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),t*l}const Wa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ui(h=new u.pointGeometry(0,0),t="bottom"){if("number"==typeof h){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new u.pointGeometry(0,h);case"top-left":return new u.pointGeometry(l,l);case"top-right":return new u.pointGeometry(-l,l);case"bottom":return new u.pointGeometry(0,-h);case"bottom-left":return new u.pointGeometry(l,-l);case"bottom-right":return new u.pointGeometry(-l,-l);case"left":return new u.pointGeometry(h,0);case"right":return new u.pointGeometry(-h,0)}return new u.pointGeometry(0,0)}return h instanceof u.pointGeometry||Array.isArray(h)?u.pointGeometry.convert(h):u.pointGeometry.convert(h[t]||[0,0])}const ss={version:u.version,supported:hn,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends Ys{constructor(h){if(null!=(h=u.extend({},De,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(h.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pl(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language="auto"===h.language?u.window.navigator.language:h.language,this._worldview=h.worldview,this._renderTaskQueue=new C,this._domRenderTaskQueue=new C,this._controls=[],this._markers=[],this._mapId=u.uniqueId(),this._locale=u.extend({},pe,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new X(0),this._explicitProjection=null,this._requestManager=new u.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=u.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new jc(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Ts("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,u.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new lh({customAttribution:h.customAttribution})),this._logoControl=new M,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new u.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new u.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(h,t){if(void 0===t&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[t];return-1!==t.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new u.Event("movestart",h)).fire(new u.Event("move",h)),this.fire(new u.Event("resize",h)),t&&this.fire(new u.Event("moveend",h)),this}getBounds(){return"globe"===this.transform.projection.name&&u.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(u.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getLanguage(){return this._language}setLanguage(h){if(this._language="auto"===h?u.window.navigator.language:h,this.style)for(const t in this.style._sourceCaches){const l=this.style._sourceCaches[t]._source;l._setLanguage&&l._setLanguage(this._language)}for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){if(this._worldview=h,this.style)for(const t in this.style._sourceCaches){const l=this.style._sourceCaches[t]._source;l._setWorldview&&l._setWorldview(h)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._updateProjection(h)}_updateProjection(h){const t=this.getProjection();null===h&&(this._explicitProjection=null);const l=h||this.getProjection();let p;if(l&&"globe"===l.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(p=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(p=this.transform.setProjection(l),this.transform.mercatorFromTransition=!1),h&&(this._explicitProjection="globe"===h.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),p){if("globe"===t.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles()}this._update(!0)}return this}project(h){return this.transform.locationPoint3D(u.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(u.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(h,t,l){if("mouseenter"===h||"mouseover"===h){let p=!1;const _=E=>{const I=t.filter(O=>this.getLayer(O)),A=I.length?this.queryRenderedFeatures(E.point,{layers:I}):[];A.length?p||(p=!0,l.call(this,new qr(h,this,E.originalEvent,{features:A}))):p=!1},v=()=>{p=!1};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:v}}}if("mouseleave"===h||"mouseout"===h){let p=!1;const _=E=>{const I=t.filter(A=>this.getLayer(A));(I.length?this.queryRenderedFeatures(E.point,{layers:I}):[]).length?p=!0:p&&(p=!1,l.call(this,new qr(h,this,E.originalEvent)))},v=E=>{p&&(p=!1,l.call(this,new qr(h,this,E.originalEvent)))};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:v}}}{const p=_=>{const v=t.filter(I=>this.getLayer(I)),E=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];E.length&&(_.features=E,l.call(this,_),delete _.features)};return{layers:new Set(t),listener:l,delegates:{[h]:p}}}}on(h,t,l){if(void 0===l)return super.on(h,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(h,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,t,l){if(void 0===l)return super.once(h,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(h,t,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,t,l){if(void 0===l)return super.off(h,t);t=new Set(Array.isArray(t)?t:[t]);const p=(v,E)=>{if(v.size!==E.size)return!1;for(const I of v)if(!E.has(I))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(v=>{for(let E=0;E<v.length;E++){const I=v[E];if(I.listener===l&&p(I.layers,t)){for(const A in I.delegates)this.off(A,I.delegates[A]);return v.splice(E,1),this}}})(_),this}queryRenderedFeatures(h,t){return this.style?(void 0!==t||void 0===h||h instanceof u.pointGeometry||Array.isArray(h)||(t=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}queryTerrainElevation(h,t){const l=this.transform.elevation;return l?(t=u.extend({},{exaggerated:!0},t),l.getAtPoint(u.MercatorCoordinate.fromLngLat(h),null,t.exaggerated)):null}setStyle(h,t){return!1!==(t=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(null==t)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new go(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if("string"==typeof h){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,u.ResourceType.Style);u.getJSON(p,(_,v)=>{_?this.fire(new u.ErrorEvent(_)):v&&this._updateDiff(v,t)})}else"object"==typeof h&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(l){u.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const t in h){const l=h[t]._tiles;for(const p in l){const _=l[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(h,t,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap){const{width:I,height:A,data:O}=u.exported.getImageData(t);this.style.addImage(h,{data:new u.RGBAImage({width:I,height:A},O),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:A}=t,O=t;this.style.addImage(h,{data:new u.RGBAImage({width:I,height:A},new Uint8Array(O.data)),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0,userImage:O}),O.onAdd&&O.onAdd(this,h)}}updateImage(h,t){const l=this.style.getImage(h);if(!l)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap?u.exported.getImageData(t):t,{width:_,height:v}=p;void 0!==_&&void 0!==v?_===l.data.width&&v===l.data.height?(l.data.replace(p.data,!(t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${v})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){u.getImage(this._requestManager.transformRequest(h,u.ResourceType.Image),(l,p)=>{t(l,p instanceof u.window.HTMLImageElement?u.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,l){return this.style.setLayerZoomRange(h,t,l),this._update(!0)}setFilter(h,t,l={}){return this.style.setFilter(h,t,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,l,p={}){return this.style.setPaintProperty(h,t,l,p),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,l,p={}){return this.style.setLayoutProperty(h,t,l,p),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(h),this.transform):0}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let l,p,_,v=this._container;for(;v&&(!p||!_);){const E=u.window.getComputedStyle(v).transform;E&&"none"!==E&&(l=E.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(p=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(_=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Mt("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Mt("div","mapboxgl-canvas-container",h);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=Mt("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Mt("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=Mt("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const l=u.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const h=u.extend({},hn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(u.storeAuthState(t,!0),this.painter=new bs(t,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(t)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;const l=this.painter.context.extTimerQuery,p=u.exported.now();if(this.listens("gpu-timing-frame")&&(t=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let _=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,O=this.transform.pitch,V=u.exported.now();this.style.zoomHistory.update(A,V);const H=new u.EvaluationParameters(A,{now:V,fadeDuration:v,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=H.crossFadingFactor();1===W&&W===this._crossFadingFactor||(_=!0,this._crossFadingFactor=W),this.style.update(H)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerUpdate()):E=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const A=u.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,t),setTimeout(()=>{const O=l.getQueryObjectEXT(t,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(t),this.fire(new u.Event("gpu-timing-frame",{cpuTime:A,gpuTime:O})),u.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:O}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(A);this.fire(new u.Event("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(A);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:O}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,t=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const E=Math.abs(p-_);if(E>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,h,300)}else if(E>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===u.AUTH_ERR_MSG||401===h.status)){const t=this.painter.context.gl;u.storeAuthState(t,!1),this._logoControl instanceof M&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(h,t,l){let p=l[1]-l[0];const _=h.length/4;for(let v=0;v<t.length;v++){const E=t[v];let I=0;for(let A=0;A<E.length;A+=4)E[A]===h[A]&&E[A+1]===h[A+1]&&E[A+2]===h[A+2]&&E[A+3]===h[A+3]&&(I+=1);p+=(l[v+2]-l[v+1])*(1-I/_)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),Ye(this._canvasContainer),Ye(this._controlContainer),Ye(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=u.exported.frame(t=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(t)}))}_preloadTiles(h){const t=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(t,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){u.setCacheLimits(h,t)}get version(){return u.version}},NavigationControl:class{constructor(h){this.options=u.extend({},It,h),this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Mt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Mt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:t}):l.resetNorth({},{originalEvent:t}))}),this._compassIcon=Mt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),l=t===h.getMaxZoom(),p=t===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rn(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const l=Mt("button",h,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(h,t){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends u.Evented{constructor(h){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},en,h),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$a(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(t=>{this._supportsGeolocation="denied"!==t.state,h(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,h(this._supportsGeolocation))}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),l=h.coords;return!!t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new u.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),_=u.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),_,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new u.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=u.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Mt("button","mapboxgl-ctrl-geolocate",this._container),Mt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Mt("div","mapboxgl-user-location"),this._dotElement.appendChild(Mt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Mt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new U({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Mt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new U({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:lh,ScaleControl:class{constructor(h){this.options=u.extend({},zr,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Wr.bind(this)),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,l=t._containerHeight/2,p=t._containerWidth/2-h/2,_=t.unproject([p,l]),v=t.unproject([p+h,l]),E=_.distanceTo(v);if("imperial"===this.options.unit){const I=3.2808*E;I>5280?this._setScale(h,I/5280,"mile"):this._setScale(h,I,"foot")}else"nautical"===this.options.unit?this._setScale(h,E/1852,"nautical-mile"):E>=1e3?this._setScale(h,E/1e3,"kilometer"):this._setScale(h,E,"meter")}_setScale(h,t,l){const p=Ro(t),_=p/t;this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof u.window.HTMLElement?this._container=h.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Mt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Mt("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(h){super(),this.options=u.extend(Object.create(Wa),h),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=u.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(u.window.document.createTextNode(h))}setHTML(h){const t=u.window.document.createDocumentFragment(),l=u.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Mt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const l=this._closeButton=Mt("button","mapboxgl-popup-close-button",t);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,l=this._container,p=this._pos;if(!t||!l||!p)return"bottom";const _=l.offsetWidth,v=l.offsetHeight,E=p.x<_/2,I=p.x>t.transform.width-_/2;if(p.y+h<v)return E?"top-left":I?"top-right":"top";if(p.y>t.transform.height-v){if(E)return"bottom-left";if(I)return"bottom-right"}return E?"left":I?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,l=this._content;if(!t||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=Mt("div","mapboxgl-popup",t.getContainer()),this._tip=Mt("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=D(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:t.project(this._lngLat),v=Ui(this.options.offset),E=this._anchor=this._getAnchor(v.y),I=Ui(this.options.offset,E),A=_.add(I).round();t._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${L[E]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._usingGlobe()){const _=u.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Xa);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:U,Style:go,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:Al,Evented:u.Evented,config:u.config,prewarm:function(){rt().acquire(Me)},clearPrewarmedResources:function(){const h=Et;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(Me),Et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(h){u.config.ACCESS_TOKEN=h},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(h){u.config.API_URL=h},get workerCount(){return Ue.workerCount},set workerCount(h){Ue.workerCount=h},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){u.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){u.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return ss}),ge}()},306:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{y:()=>Ct});var ge=Be(961),re=Be(727),Wt=Be(822),u=Be(671);var jt=Be(416),nt=Be(576),Mt=Be(806);let Ct=(()=>{class ut{constructor(dt){dt&&(this._subscribe=dt)}lift(dt){const dn=new ut;return dn.source=this,dn.operator=dt,dn}subscribe(dt,dn,Xt){const Hn=function wn(ut){return ut&&ut instanceof ge.Lv||function Tt(ut){return ut&&(0,nt.m)(ut.next)&&(0,nt.m)(ut.error)&&(0,nt.m)(ut.complete)}(ut)&&(0,re.Nn)(ut)}(dt)?dt:new ge.Hp(dt,dn,Xt);return(0,Mt.x)(()=>{const{operator:Zt,source:Bt}=this;Hn.add(Zt?Zt.call(Hn,Bt):Bt?this._subscribe(Hn):this._trySubscribe(Hn))}),Hn}_trySubscribe(dt){try{return this._subscribe(dt)}catch(dn){dt.error(dn)}}forEach(dt,dn){return new(dn=ft(dn))((Xt,Hn)=>{const Zt=new ge.Hp({next:Bt=>{try{dt(Bt)}catch(Nt){Hn(Nt),Zt.unsubscribe()}},error:Hn,complete:Xt});this.subscribe(Zt)})}_subscribe(dt){var dn;return null===(dn=this.source)||void 0===dn?void 0:dn.subscribe(dt)}[Wt.L](){return this}pipe(...dt){return function hn(ut){return 0===ut.length?u.y:1===ut.length?ut[0]:function(dt){return ut.reduce((dn,Xt)=>Xt(dn),dt)}}(dt)(this)}toPromise(dt){return new(dt=ft(dt))((dn,Xt)=>{let Hn;this.subscribe(Zt=>Hn=Zt,Zt=>Xt(Zt),()=>dn(Hn))})}}return ut.create=bn=>new ut(bn),ut})();function ft(ut){var bn;return null!==(bn=ut??jt.v.Promise)&&void 0!==bn?bn:Promise}},579:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{x:()=>jt});var ge=Be(306),re=Be(727);const u=(0,Be(888).d)(Mt=>function(){Mt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ae=Be(737),hn=Be(806);let jt=(()=>{class Mt extends ge.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(ft){const Tt=new nt(this,this);return Tt.operator=ft,Tt}_throwIfClosed(){if(this.closed)throw new u}next(ft){(0,hn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Tt of this.currentObservers)Tt.next(ft)}})}error(ft){(0,hn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=ft;const{observers:Tt}=this;for(;Tt.length;)Tt.shift().error(ft)}})}complete(){(0,hn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:ft}=this;for(;ft.length;)ft.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var ft;return(null===(ft=this.observers)||void 0===ft?void 0:ft.length)>0}_trySubscribe(ft){return this._throwIfClosed(),super._trySubscribe(ft)}_subscribe(ft){return this._throwIfClosed(),this._checkFinalizedStatuses(ft),this._innerSubscribe(ft)}_innerSubscribe(ft){const{hasError:Tt,isStopped:wn,observers:ut}=this;return Tt||wn?re.Lc:(this.currentObservers=null,ut.push(ft),new re.w0(()=>{this.currentObservers=null,(0,Ae.P)(ut,ft)}))}_checkFinalizedStatuses(ft){const{hasError:Tt,thrownError:wn,isStopped:ut}=this;Tt?ft.error(wn):ut&&ft.complete()}asObservable(){const ft=new ge.y;return ft.source=this,ft}}return Mt.create=(Ct,ft)=>new nt(Ct,ft),Mt})();class nt extends jt{constructor(Ct,ft){super(),this.destination=Ct,this.source=ft}next(Ct){var ft,Tt;null===(Tt=null===(ft=this.destination)||void 0===ft?void 0:ft.next)||void 0===Tt||Tt.call(ft,Ct)}error(Ct){var ft,Tt;null===(Tt=null===(ft=this.destination)||void 0===ft?void 0:ft.error)||void 0===Tt||Tt.call(ft,Ct)}complete(){var Ct,ft;null===(ft=null===(Ct=this.destination)||void 0===Ct?void 0:Ct.complete)||void 0===ft||ft.call(Ct)}_subscribe(Ct){var ft,Tt;return null!==(Tt=null===(ft=this.source)||void 0===ft?void 0:ft.subscribe(Ct))&&void 0!==Tt?Tt:re.Lc}}},961:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{Hp:()=>dt,Lv:()=>Tt});var ge=Be(576),re=Be(727),Wt=Be(416),u=Be(849);function Ae(){}const hn=Mt("C",void 0,void 0);function Mt(Bt,Nt,gt){return{kind:Bt,value:Nt,error:gt}}var Ct=Be(410),ft=Be(806);class Tt extends re.w0{constructor(Nt){super(),this.isStopped=!1,Nt?(this.destination=Nt,(0,re.Nn)(Nt)&&Nt.add(this)):this.destination=Zt}static create(Nt,gt,rr){return new dt(Nt,gt,rr)}next(Nt){this.isStopped?Hn(function nt(Bt){return Mt("N",Bt,void 0)}(Nt),this):this._next(Nt)}error(Nt){this.isStopped?Hn(function jt(Bt){return Mt("E",void 0,Bt)}(Nt),this):(this.isStopped=!0,this._error(Nt))}complete(){this.isStopped?Hn(hn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Nt){this.destination.next(Nt)}_error(Nt){try{this.destination.error(Nt)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const wn=Function.prototype.bind;function ut(Bt,Nt){return wn.call(Bt,Nt)}class bn{constructor(Nt){this.partialObserver=Nt}next(Nt){const{partialObserver:gt}=this;if(gt.next)try{gt.next(Nt)}catch(rr){dn(rr)}}error(Nt){const{partialObserver:gt}=this;if(gt.error)try{gt.error(Nt)}catch(rr){dn(rr)}else dn(Nt)}complete(){const{partialObserver:Nt}=this;if(Nt.complete)try{Nt.complete()}catch(gt){dn(gt)}}}class dt extends Tt{constructor(Nt,gt,rr){let wt;if(super(),(0,ge.m)(Nt)||!Nt)wt={next:Nt??void 0,error:gt??void 0,complete:rr??void 0};else{let Ft;this&&Wt.v.useDeprecatedNextContext?(Ft=Object.create(Nt),Ft.unsubscribe=()=>this.unsubscribe(),wt={next:Nt.next&&ut(Nt.next,Ft),error:Nt.error&&ut(Nt.error,Ft),complete:Nt.complete&&ut(Nt.complete,Ft)}):wt=Nt}this.destination=new bn(wt)}}function dn(Bt){Wt.v.useDeprecatedSynchronousErrorHandling?(0,ft.O)(Bt):(0,u.h)(Bt)}function Hn(Bt,Nt){const{onStoppedNotification:gt}=Wt.v;gt&&Ct.z.setTimeout(()=>gt(Bt,Nt))}const Zt={closed:!0,next:Ae,error:function Xt(Bt){throw Bt},complete:Ae}},727:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{Lc:()=>hn,w0:()=>Ae,Nn:()=>jt});var ge=Be(576);const Wt=(0,Be(888).d)(Mt=>function(ft){Mt(this),this.message=ft?`${ft.length} errors occurred during unsubscription:\n${ft.map((Tt,wn)=>`${wn+1}) ${Tt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ft});var u=Be(737);class Ae{constructor(Ct){this.initialTeardown=Ct,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Ct;if(!this.closed){this.closed=!0;const{_parentage:ft}=this;if(ft)if(this._parentage=null,Array.isArray(ft))for(const ut of ft)ut.remove(this);else ft.remove(this);const{initialTeardown:Tt}=this;if((0,ge.m)(Tt))try{Tt()}catch(ut){Ct=ut instanceof Wt?ut.errors:[ut]}const{_finalizers:wn}=this;if(wn){this._finalizers=null;for(const ut of wn)try{nt(ut)}catch(bn){Ct=Ct??[],bn instanceof Wt?Ct=[...Ct,...bn.errors]:Ct.push(bn)}}if(Ct)throw new Wt(Ct)}}add(Ct){var ft;if(Ct&&Ct!==this)if(this.closed)nt(Ct);else{if(Ct instanceof Ae){if(Ct.closed||Ct._hasParent(this))return;Ct._addParent(this)}(this._finalizers=null!==(ft=this._finalizers)&&void 0!==ft?ft:[]).push(Ct)}}_hasParent(Ct){const{_parentage:ft}=this;return ft===Ct||Array.isArray(ft)&&ft.includes(Ct)}_addParent(Ct){const{_parentage:ft}=this;this._parentage=Array.isArray(ft)?(ft.push(Ct),ft):ft?[ft,Ct]:Ct}_removeParent(Ct){const{_parentage:ft}=this;ft===Ct?this._parentage=null:Array.isArray(ft)&&(0,u.P)(ft,Ct)}remove(Ct){const{_finalizers:ft}=this;ft&&(0,u.P)(ft,Ct),Ct instanceof Ae&&Ct._removeParent(this)}}Ae.EMPTY=(()=>{const Mt=new Ae;return Mt.closed=!0,Mt})();const hn=Ae.EMPTY;function jt(Mt){return Mt instanceof Ae||Mt&&"closed"in Mt&&(0,ge.m)(Mt.remove)&&(0,ge.m)(Mt.add)&&(0,ge.m)(Mt.unsubscribe)}function nt(Mt){(0,ge.m)(Mt)?Mt():Mt.unsubscribe()}},416:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{v:()=>ge});const ge={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{E:()=>re});const re=new(Be(306).y)(Ae=>Ae.complete())},76:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{D:()=>rr});var ge=Be(421),re=Be(672),Wt=Be(482),u=Be(403);function Ae(wt,Ft=0){return(0,Wt.e)((Mn,qe)=>{Mn.subscribe((0,u.x)(qe,Ke=>(0,re.f)(qe,wt,()=>qe.next(Ke),Ft),()=>(0,re.f)(qe,wt,()=>qe.complete(),Ft),Ke=>(0,re.f)(qe,wt,()=>qe.error(Ke),Ft)))})}function hn(wt,Ft=0){return(0,Wt.e)((Mn,qe)=>{qe.add(wt.schedule(()=>Mn.subscribe(qe),Ft))})}var Mt=Be(306),ft=Be(202),Tt=Be(576);function ut(wt,Ft){if(!wt)throw new Error("Iterable cannot be null");return new Mt.y(Mn=>{(0,re.f)(Mn,Ft,()=>{const qe=wt[Symbol.asyncIterator]();(0,re.f)(Mn,Ft,()=>{qe.next().then(Ke=>{Ke.done?Mn.complete():Mn.next(Ke.value)})},0,!0)})})}var bn=Be(670),dt=Be(239),dn=Be(144),Xt=Be(495),Hn=Be(206),Zt=Be(532),Bt=Be(260);function rr(wt,Ft){return Ft?function gt(wt,Ft){if(null!=wt){if((0,bn.c)(wt))return function jt(wt,Ft){return(0,ge.Xf)(wt).pipe(hn(Ft),Ae(Ft))}(wt,Ft);if((0,dn.z)(wt))return function Ct(wt,Ft){return new Mt.y(Mn=>{let qe=0;return Ft.schedule(function(){qe===wt.length?Mn.complete():(Mn.next(wt[qe++]),Mn.closed||this.schedule())})})}(wt,Ft);if((0,dt.t)(wt))return function nt(wt,Ft){return(0,ge.Xf)(wt).pipe(hn(Ft),Ae(Ft))}(wt,Ft);if((0,Hn.D)(wt))return ut(wt,Ft);if((0,Xt.T)(wt))return function wn(wt,Ft){return new Mt.y(Mn=>{let qe;return(0,re.f)(Mn,Ft,()=>{qe=wt[ft.h](),(0,re.f)(Mn,Ft,()=>{let Ke,Qe;try{({value:Ke,done:Qe}=qe.next())}catch(ot){return void Mn.error(ot)}Qe?Mn.complete():Mn.next(Ke)},0,!0)}),()=>(0,Tt.m)(qe?.return)&&qe.return()})}(wt,Ft);if((0,Bt.L)(wt))return function Nt(wt,Ft){return ut((0,Bt.Q)(wt),Ft)}(wt,Ft)}throw(0,Zt.z)(wt)}(wt,Ft):(0,ge.Xf)(wt)}},421:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{Xf:()=>wn});var ge=Be(655),re=Be(144),Wt=Be(239),u=Be(306),Ae=Be(670),hn=Be(206),jt=Be(532),nt=Be(495),Mt=Be(260),Ct=Be(576),ft=Be(849),Tt=Be(822);function wn(Bt){if(Bt instanceof u.y)return Bt;if(null!=Bt){if((0,Ae.c)(Bt))return function ut(Bt){return new u.y(Nt=>{const gt=Bt[Tt.L]();if((0,Ct.m)(gt.subscribe))return gt.subscribe(Nt);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Bt);if((0,re.z)(Bt))return function bn(Bt){return new u.y(Nt=>{for(let gt=0;gt<Bt.length&&!Nt.closed;gt++)Nt.next(Bt[gt]);Nt.complete()})}(Bt);if((0,Wt.t)(Bt))return function dt(Bt){return new u.y(Nt=>{Bt.then(gt=>{Nt.closed||(Nt.next(gt),Nt.complete())},gt=>Nt.error(gt)).then(null,ft.h)})}(Bt);if((0,hn.D)(Bt))return Xt(Bt);if((0,nt.T)(Bt))return function dn(Bt){return new u.y(Nt=>{for(const gt of Bt)if(Nt.next(gt),Nt.closed)return;Nt.complete()})}(Bt);if((0,Mt.L)(Bt))return function Hn(Bt){return Xt((0,Mt.Q)(Bt))}(Bt)}throw(0,jt.z)(Bt)}function Xt(Bt){return new u.y(Nt=>{(function Zt(Bt,Nt){var gt,rr,wt,Ft;return(0,ge.mG)(this,void 0,void 0,function*(){try{for(gt=(0,ge.KL)(Bt);!(rr=yield gt.next()).done;)if(Nt.next(rr.value),Nt.closed)return}catch(Mn){wt={error:Mn}}finally{try{rr&&!rr.done&&(Ft=gt.return)&&(yield Ft.call(gt))}finally{if(wt)throw wt.error}}Nt.complete()})})(Bt,Nt).catch(gt=>Nt.error(gt))})}},403:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{x:()=>re});var ge=Be(961);function re(u,Ae,hn,jt,nt){return new Wt(u,Ae,hn,jt,nt)}class Wt extends ge.Lv{constructor(Ae,hn,jt,nt,Mt,Ct){super(Ae),this.onFinalize=Mt,this.shouldUnsubscribe=Ct,this._next=hn?function(ft){try{hn(ft)}catch(Tt){Ae.error(Tt)}}:super._next,this._error=nt?function(ft){try{nt(ft)}catch(Tt){Ae.error(Tt)}finally{this.unsubscribe()}}:super._error,this._complete=jt?function(){try{jt()}catch(ft){Ae.error(ft)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Ae;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:hn}=this;super.unsubscribe(),!hn&&(null===(Ae=this.onFinalize)||void 0===Ae||Ae.call(this))}}}},4:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{U:()=>Wt});var ge=Be(482),re=Be(403);function Wt(u,Ae){return(0,ge.e)((hn,jt)=>{let nt=0;hn.subscribe((0,re.x)(jt,Mt=>{jt.next(u.call(Ae,Mt,nt++))}))})}},189:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{J:()=>Wt});var ge=Be(577),re=Be(671);function Wt(u=1/0){return(0,ge.z)(re.y,u)}},577:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{z:()=>nt});var ge=Be(4),re=Be(421),Wt=Be(482),u=Be(672),Ae=Be(403),jt=Be(576);function nt(Mt,Ct,ft=1/0){return(0,jt.m)(Ct)?nt((Tt,wn)=>(0,ge.U)((ut,bn)=>Ct(Tt,ut,wn,bn))((0,re.Xf)(Mt(Tt,wn))),ft):("number"==typeof Ct&&(ft=Ct),(0,Wt.e)((Tt,wn)=>function hn(Mt,Ct,ft,Tt,wn,ut,bn,dt){const dn=[];let Xt=0,Hn=0,Zt=!1;const Bt=()=>{Zt&&!dn.length&&!Xt&&Ct.complete()},Nt=rr=>Xt<Tt?gt(rr):dn.push(rr),gt=rr=>{ut&&Ct.next(rr),Xt++;let wt=!1;(0,re.Xf)(ft(rr,Hn++)).subscribe((0,Ae.x)(Ct,Ft=>{wn?.(Ft),ut?Nt(Ft):Ct.next(Ft)},()=>{wt=!0},void 0,()=>{if(wt)try{for(Xt--;dn.length&&Xt<Tt;){const Ft=dn.shift();bn?(0,u.f)(Ct,bn,()=>gt(Ft)):gt(Ft)}Bt()}catch(Ft){Ct.error(Ft)}}))};return Mt.subscribe((0,Ae.x)(Ct,Nt,()=>{Zt=!0,Bt()})),()=>{dt?.()}}(Tt,wn,Mt,ft)))}},410:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{z:()=>ge});const ge={setTimeout(re,Wt,...u){const{delegate:Ae}=ge;return Ae?.setTimeout?Ae.setTimeout(re,Wt,...u):setTimeout(re,Wt,...u)},clearTimeout(re){const{delegate:Wt}=ge;return(Wt?.clearTimeout||clearTimeout)(re)},delegate:void 0}},202:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{h:()=>re});const re=function ge(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},822:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{L:()=>ge});const ge="function"==typeof Symbol&&Symbol.observable||"@@observable"},669:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{_6:()=>hn,jO:()=>u,yG:()=>Ae});var ge=Be(576);function Wt(jt){return jt[jt.length-1]}function u(jt){return(0,ge.m)(Wt(jt))?jt.pop():void 0}function Ae(jt){return function re(jt){return jt&&(0,ge.m)(jt.schedule)}(Wt(jt))?jt.pop():void 0}function hn(jt,nt){return"number"==typeof Wt(jt)?jt.pop():nt}},737:(nr,Qt,Be)=>{"use strict";function ge(re,Wt){if(re){const u=re.indexOf(Wt);0<=u&&re.splice(u,1)}}Be.d(Qt,{P:()=>ge})},888:(nr,Qt,Be)=>{"use strict";function ge(re){const u=re(Ae=>{Error.call(Ae),Ae.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}Be.d(Qt,{d:()=>ge})},806:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{O:()=>u,x:()=>Wt});var ge=Be(416);let re=null;function Wt(Ae){if(ge.v.useDeprecatedSynchronousErrorHandling){const hn=!re;if(hn&&(re={errorThrown:!1,error:null}),Ae(),hn){const{errorThrown:jt,error:nt}=re;if(re=null,jt)throw nt}}else Ae()}function u(Ae){ge.v.useDeprecatedSynchronousErrorHandling&&re&&(re.errorThrown=!0,re.error=Ae)}},672:(nr,Qt,Be)=>{"use strict";function ge(re,Wt,u,Ae=0,hn=!1){const jt=Wt.schedule(function(){u(),hn?re.add(this.schedule(null,Ae)):this.unsubscribe()},Ae);if(re.add(jt),!hn)return jt}Be.d(Qt,{f:()=>ge})},671:(nr,Qt,Be)=>{"use strict";function ge(re){return re}Be.d(Qt,{y:()=>ge})},144:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{z:()=>ge});const ge=re=>re&&"number"==typeof re.length&&"function"!=typeof re},206:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{D:()=>re});var ge=Be(576);function re(Wt){return Symbol.asyncIterator&&(0,ge.m)(Wt?.[Symbol.asyncIterator])}},576:(nr,Qt,Be)=>{"use strict";function ge(re){return"function"==typeof re}Be.d(Qt,{m:()=>ge})},670:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{c:()=>Wt});var ge=Be(822),re=Be(576);function Wt(u){return(0,re.m)(u[ge.L])}},495:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{T:()=>Wt});var ge=Be(202),re=Be(576);function Wt(u){return(0,re.m)(u?.[ge.h])}},239:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{t:()=>re});var ge=Be(576);function re(Wt){return(0,ge.m)(Wt?.then)}},260:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{L:()=>u,Q:()=>Wt});var ge=Be(655),re=Be(576);function Wt(Ae){return(0,ge.FC)(this,arguments,function*(){const jt=Ae.getReader();try{for(;;){const{value:nt,done:Mt}=yield(0,ge.qq)(jt.read());if(Mt)return yield(0,ge.qq)(void 0);yield yield(0,ge.qq)(nt)}}finally{jt.releaseLock()}})}function u(Ae){return(0,re.m)(Ae?.getReader)}},482:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{A:()=>re,e:()=>Wt});var ge=Be(576);function re(u){return(0,ge.m)(u?.lift)}function Wt(u){return Ae=>{if(re(Ae))return Ae.lift(function(hn){try{return u(hn,this)}catch(jt){this.error(jt)}});throw new TypeError("Unable to lift unknown Observable type")}}},849:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{h:()=>Wt});var ge=Be(416),re=Be(410);function Wt(u){re.z.setTimeout(()=>{const{onUnhandledError:Ae}=ge.v;if(!Ae)throw u;Ae(u)})}},532:(nr,Qt,Be)=>{"use strict";function ge(re){return new TypeError(`You provided ${null!==re&&"object"==typeof re?"an invalid object":`'${re}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Be.d(Qt,{z:()=>ge})},655:(nr,Qt,Be)=>{"use strict";function nt(qe,Ke,Qe,ot){return new(Qe||(Qe=Promise))(function(Rt,Ln){function fn(_r){try{Dn(ot.next(_r))}catch(jr){Ln(jr)}}function Zn(_r){try{Dn(ot.throw(_r))}catch(jr){Ln(jr)}}function Dn(_r){_r.done?Rt(_r.value):function at(Rt){return Rt instanceof Qe?Rt:new Qe(function(Ln){Ln(Rt)})}(_r.value).then(fn,Zn)}Dn((ot=ot.apply(qe,Ke||[])).next())})}function dn(qe){return this instanceof dn?(this.v=qe,this):new dn(qe)}function Xt(qe,Ke,Qe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var at,ot=Qe.apply(qe,Ke||[]),Rt=[];return at={},Ln("next"),Ln("throw"),Ln("return"),at[Symbol.asyncIterator]=function(){return this},at;function Ln(ir){ot[ir]&&(at[ir]=function(Yr){return new Promise(function(Ri,ki){Rt.push([ir,Yr,Ri,ki])>1||fn(ir,Yr)})})}function fn(ir,Yr){try{!function Zn(ir){ir.value instanceof dn?Promise.resolve(ir.value.v).then(Dn,_r):jr(Rt[0][2],ir)}(ot[ir](Yr))}catch(Ri){jr(Rt[0][3],Ri)}}function Dn(ir){fn("next",ir)}function _r(ir){fn("throw",ir)}function jr(ir,Yr){ir(Yr),Rt.shift(),Rt.length&&fn(Rt[0][0],Rt[0][1])}}function Zt(qe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Qe,Ke=qe[Symbol.asyncIterator];return Ke?Ke.call(qe):(qe=function Tt(qe){var Ke="function"==typeof Symbol&&Symbol.iterator,Qe=Ke&&qe[Ke],ot=0;if(Qe)return Qe.call(qe);if(qe&&"number"==typeof qe.length)return{next:function(){return qe&&ot>=qe.length&&(qe=void 0),{value:qe&&qe[ot++],done:!qe}}};throw new TypeError(Ke?"Object is not iterable.":"Symbol.iterator is not defined.")}(qe),Qe={},ot("next"),ot("throw"),ot("return"),Qe[Symbol.asyncIterator]=function(){return this},Qe);function ot(Rt){Qe[Rt]=qe[Rt]&&function(Ln){return new Promise(function(fn,Zn){!function at(Rt,Ln,fn,Zn){Promise.resolve(Zn).then(function(Dn){Rt({value:Dn,done:fn})},Ln)}(fn,Zn,(Ln=qe[Rt](Ln)).done,Ln.value)})}}}Be.d(Qt,{FC:()=>Xt,KL:()=>Zt,mG:()=>nt,qq:()=>dn})},895:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{Do:()=>Bt,EM:()=>Fs,HT:()=>Ae,JF:()=>Qr,JJ:()=>Ki,K0:()=>jt,Mx:()=>_n,PC:()=>Kr,S$:()=>dn,V_:()=>Ct,Ye:()=>Nt,b0:()=>Zt,bD:()=>vl,ez:()=>gs,q:()=>Wt,sg:()=>Co,w_:()=>hn});var ge=Be(256);let re=null;function Wt(){return re}function Ae(z){re||(re=z)}class hn{}const jt=new ge.OlP("DocumentToken");let nt=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=ge.Yz7({token:z,factory:function(){return function Mt(){return(0,ge.LFG)(ft)}()},providedIn:"platform"}),z})();const Ct=new ge.OlP("Location Initialized");let ft=(()=>{class z extends nt{constructor(B){super(),this._doc=B,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Wt().getBaseHref(this._doc)}onPopState(B){const J=Wt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("popstate",B,!1),()=>J.removeEventListener("popstate",B)}onHashChange(B){const J=Wt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("hashchange",B,!1),()=>J.removeEventListener("hashchange",B)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(B){this.location.pathname=B}pushState(B,J,Le){Tt()?this._history.pushState(B,J,Le):this.location.hash=Le}replaceState(B,J,Le){Tt()?this._history.replaceState(B,J,Le):this.location.hash=Le}forward(){this._history.forward()}back(){this._history.back()}historyGo(B=0){this._history.go(B)}getState(){return this._history.state}}return z.\u0275fac=function(B){return new(B||z)(ge.LFG(jt))},z.\u0275prov=ge.Yz7({token:z,factory:function(){return function wn(){return new ft((0,ge.LFG)(jt))}()},providedIn:"platform"}),z})();function Tt(){return!!window.history.pushState}function ut(z,K){if(0==z.length)return K;if(0==K.length)return z;let B=0;return z.endsWith("/")&&B++,K.startsWith("/")&&B++,2==B?z+K.substring(1):1==B?z+K:z+"/"+K}function bn(z){const K=z.match(/#|\?|$/),B=K&&K.index||z.length;return z.slice(0,B-("/"===z[B-1]?1:0))+z.slice(B)}function dt(z){return z&&"?"!==z[0]?"?"+z:z}let dn=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=ge.Yz7({token:z,factory:function(){return function Xt(){const z=(0,ge.LFG)(jt).location;return new Zt((0,ge.LFG)(nt),z&&z.origin||"")}()},providedIn:"root"}),z})();const Hn=new ge.OlP("appBaseHref");let Zt=(()=>{class z extends dn{constructor(B,J){if(super(),this._platformLocation=B,this._removeListenerFns=[],null==J&&(J=this._platformLocation.getBaseHrefFromDOM()),null==J)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=J}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}prepareExternalUrl(B){return ut(this._baseHref,B)}path(B=!1){const J=this._platformLocation.pathname+dt(this._platformLocation.search),Le=this._platformLocation.hash;return Le&&B?`${J}${Le}`:J}pushState(B,J,Le,st){const Je=this.prepareExternalUrl(Le+dt(st));this._platformLocation.pushState(B,J,Je)}replaceState(B,J,Le,st){const Je=this.prepareExternalUrl(Le+dt(st));this._platformLocation.replaceState(B,J,Je)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(B=0){this._platformLocation.historyGo?.(B)}}return z.\u0275fac=function(B){return new(B||z)(ge.LFG(nt),ge.LFG(Hn,8))},z.\u0275prov=ge.Yz7({token:z,factory:z.\u0275fac}),z})(),Bt=(()=>{class z extends dn{constructor(B,J){super(),this._platformLocation=B,this._baseHref="",this._removeListenerFns=[],null!=J&&(this._baseHref=J)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}path(B=!1){let J=this._platformLocation.hash;return null==J&&(J="#"),J.length>0?J.substring(1):J}prepareExternalUrl(B){const J=ut(this._baseHref,B);return J.length>0?"#"+J:J}pushState(B,J,Le,st){let Je=this.prepareExternalUrl(Le+dt(st));0==Je.length&&(Je=this._platformLocation.pathname),this._platformLocation.pushState(B,J,Je)}replaceState(B,J,Le,st){let Je=this.prepareExternalUrl(Le+dt(st));0==Je.length&&(Je=this._platformLocation.pathname),this._platformLocation.replaceState(B,J,Je)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(B=0){this._platformLocation.historyGo?.(B)}}return z.\u0275fac=function(B){return new(B||z)(ge.LFG(nt),ge.LFG(Hn,8))},z.\u0275prov=ge.Yz7({token:z,factory:z.\u0275fac}),z})(),Nt=(()=>{class z{constructor(B){this._subject=new ge.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=B;const J=this._locationStrategy.getBaseHref();this._baseHref=bn(wt(J)),this._locationStrategy.onPopState(Le=>{this._subject.emit({url:this.path(!0),pop:!0,state:Le.state,type:Le.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(B=!1){return this.normalize(this._locationStrategy.path(B))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(B,J=""){return this.path()==this.normalize(B+dt(J))}normalize(B){return z.stripTrailingSlash(function rr(z,K){return z&&K.startsWith(z)?K.substring(z.length):K}(this._baseHref,wt(B)))}prepareExternalUrl(B){return B&&"/"!==B[0]&&(B="/"+B),this._locationStrategy.prepareExternalUrl(B)}go(B,J="",Le=null){this._locationStrategy.pushState(Le,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+dt(J)),Le)}replaceState(B,J="",Le=null){this._locationStrategy.replaceState(Le,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+dt(J)),Le)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(B=0){this._locationStrategy.historyGo?.(B)}onUrlChange(B){return this._urlChangeListeners.push(B),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(J=>{this._notifyUrlChangeListeners(J.url,J.state)})),()=>{const J=this._urlChangeListeners.indexOf(B);this._urlChangeListeners.splice(J,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(B="",J){this._urlChangeListeners.forEach(Le=>Le(B,J))}subscribe(B,J,Le){return this._subject.subscribe({next:B,error:J,complete:Le})}}return z.normalizeQueryParams=dt,z.joinWithSlash=ut,z.stripTrailingSlash=bn,z.\u0275fac=function(B){return new(B||z)(ge.LFG(dn))},z.\u0275prov=ge.Yz7({token:z,factory:function(){return function gt(){return new Nt((0,ge.LFG)(dn))}()},providedIn:"root"}),z})();function wt(z){return z.replace(/\/index.html$/,"")}var Mn=(()=>((Mn=Mn||{})[Mn.Decimal=0]="Decimal",Mn[Mn.Percent=1]="Percent",Mn[Mn.Currency=2]="Currency",Mn[Mn.Scientific=3]="Scientific",Mn))(),at=(()=>((at=at||{})[at.Decimal=0]="Decimal",at[at.Group=1]="Group",at[at.List=2]="List",at[at.PercentSign=3]="PercentSign",at[at.PlusSign=4]="PlusSign",at[at.MinusSign=5]="MinusSign",at[at.Exponential=6]="Exponential",at[at.SuperscriptingExponent=7]="SuperscriptingExponent",at[at.PerMille=8]="PerMille",at[at.Infinity=9]="Infinity",at[at.NaN=10]="NaN",at[at.TimeSeparator=11]="TimeSeparator",at[at.CurrencyDecimal=12]="CurrencyDecimal",at[at.CurrencyGroup=13]="CurrencyGroup",at))();function dr(z,K){const B=(0,ge.cg1)(z),J=B[ge.wAp.NumberSymbols][K];if(typeof J>"u"){if(K===at.CurrencyDecimal)return B[ge.wAp.NumberSymbols][at.Decimal];if(K===at.CurrencyGroup)return B[ge.wAp.NumberSymbols][at.Group]}return J}const tt=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function yi(z){const K=parseInt(z);if(isNaN(K))throw new Error("Invalid integer literal when parsing "+z);return K}function _n(z,K){K=encodeURIComponent(K);for(const B of z.split(";")){const J=B.indexOf("="),[Le,st]=-1==J?[B,""]:[B.slice(0,J),B.slice(J+1)];if(Le.trim()===K)return decodeURIComponent(st)}return null}class Yi{constructor(K,B,J,Le){this.$implicit=K,this.ngForOf=B,this.index=J,this.count=Le}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Co=(()=>{class z{constructor(B,J,Le){this._viewContainer=B,this._template=J,this._differs=Le,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(B){this._ngForOf=B,this._ngForOfDirty=!0}set ngForTrackBy(B){this._trackByFn=B}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(B){B&&(this._template=B)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const B=this._ngForOf;!this._differ&&B&&(this._differ=this._differs.find(B).create(this.ngForTrackBy))}if(this._differ){const B=this._differ.diff(this._ngForOf);B&&this._applyChanges(B)}}_applyChanges(B){const J=this._viewContainer;B.forEachOperation((Le,st,Je)=>{if(null==Le.previousIndex)J.createEmbeddedView(this._template,new Yi(Le.item,this._ngForOf,-1,-1),null===Je?void 0:Je);else if(null==Je)J.remove(null===st?void 0:st);else if(null!==st){const Yt=J.get(st);J.move(Yt,Je),qn(Yt,Le)}});for(let Le=0,st=J.length;Le<st;Le++){const Yt=J.get(Le).context;Yt.index=Le,Yt.count=st,Yt.ngForOf=this._ngForOf}B.forEachIdentityChange(Le=>{qn(J.get(Le.currentIndex),Le)})}static ngTemplateContextGuard(B,J){return!0}}return z.\u0275fac=function(B){return new(B||z)(ge.Y36(ge.s_b),ge.Y36(ge.Rgc),ge.Y36(ge.ZZ4))},z.\u0275dir=ge.lG2({type:z,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),z})();function qn(z,K){z.context.$implicit=K.item}let Kr=(()=>{class z{constructor(B,J,Le){this._ngEl=B,this._differs=J,this._renderer=Le,this._ngStyle=null,this._differ=null}set ngStyle(B){this._ngStyle=B,!this._differ&&B&&(this._differ=this._differs.find(B).create())}ngDoCheck(){if(this._differ){const B=this._differ.diff(this._ngStyle);B&&this._applyChanges(B)}}_setStyle(B,J){const[Le,st]=B.split("."),Je=-1===Le.indexOf("-")?void 0:ge.JOm.DashCase;null!=J?this._renderer.setStyle(this._ngEl.nativeElement,Le,st?`${J}${st}`:J,Je):this._renderer.removeStyle(this._ngEl.nativeElement,Le,Je)}_applyChanges(B){B.forEachRemovedItem(J=>this._setStyle(J.key,null)),B.forEachAddedItem(J=>this._setStyle(J.key,J.currentValue)),B.forEachChangedItem(J=>this._setStyle(J.key,J.currentValue))}}return z.\u0275fac=function(B){return new(B||z)(ge.Y36(ge.SBq),ge.Y36(ge.aQg),ge.Y36(ge.Qsj))},z.\u0275dir=ge.lG2({type:z,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),z})();let Ki=(()=>{class z{constructor(B){this._locale=B}transform(B,J,Le){if(!function gl(z){return!(null==z||""===z||z!=z)}(B))return null;Le=Le||this._locale;try{return function Hr(z,K,B){return function $t(z,K,B,J,Le,st,Je=!1){let Yt="",lr=!1;if(isFinite(z)){let mr=function Mr(z){let J,Le,st,Je,Yt,K=Math.abs(z)+"",B=0;for((Le=K.indexOf("."))>-1&&(K=K.replace(".","")),(st=K.search(/e/i))>0?(Le<0&&(Le=st),Le+=+K.slice(st+1),K=K.substring(0,st)):Le<0&&(Le=K.length),st=0;"0"===K.charAt(st);st++);if(st===(Yt=K.length))J=[0],Le=1;else{for(Yt--;"0"===K.charAt(Yt);)Yt--;for(Le-=st,J=[],Je=0;st<=Yt;st++,Je++)J[Je]=Number(K.charAt(st))}return Le>22&&(J=J.splice(0,21),B=Le-1,Le=1),{digits:J,exponent:B,integerLen:Le}}(z);Je&&(mr=function xn(z){if(0===z.digits[0])return z;const K=z.digits.length-z.integerLen;return z.exponent?z.exponent+=2:(0===K?z.digits.push(0,0):1===K&&z.digits.push(0),z.integerLen+=2),z}(mr));let wr=K.minInt,yn=K.minFrac,ni=K.maxFrac;if(st){const Bi=st.match(tt);if(null===Bi)throw new Error(`${st} is not a valid digit info`);const Oa=Bi[1],ca=Bi[3],xl=Bi[5];null!=Oa&&(wr=yi(Oa)),null!=ca&&(yn=yi(ca)),null!=xl?ni=yi(xl):null!=ca&&yn>ni&&(ni=yn)}!function _i(z,K,B){if(K>B)throw new Error(`The minimum number of digits after fraction (${K}) is higher than the maximum (${B}).`);let J=z.digits,Le=J.length-z.integerLen;const st=Math.min(Math.max(K,Le),B);let Je=st+z.integerLen,Yt=J[Je];if(Je>0){J.splice(Math.max(z.integerLen,Je));for(let yn=Je;yn<J.length;yn++)J[yn]=0}else{Le=Math.max(0,Le),z.integerLen=1,J.length=Math.max(1,Je=st+1),J[0]=0;for(let yn=1;yn<Je;yn++)J[yn]=0}if(Yt>=5)if(Je-1<0){for(let yn=0;yn>Je;yn--)J.unshift(0),z.integerLen++;J.unshift(1),z.integerLen++}else J[Je-1]++;for(;Le<Math.max(0,st);Le++)J.push(0);let lr=0!==st;const mr=K+z.integerLen,wr=J.reduceRight(function(yn,ni,Rr,un){return un[Rr]=(ni+=yn)<10?ni:ni-10,lr&&(0===un[Rr]&&Rr>=mr?un.pop():lr=!1),ni>=10?1:0},0);wr&&(J.unshift(wr),z.integerLen++)}(mr,yn,ni);let Rr=mr.digits,un=mr.integerLen;const Zo=mr.exponent;let _o=[];for(lr=Rr.every(Bi=>!Bi);un<wr;un++)Rr.unshift(0);for(;un<0;un++)Rr.unshift(0);un>0?_o=Rr.splice(un,Rr.length):(_o=Rr,Rr=[0]);const ys=[];for(Rr.length>=K.lgSize&&ys.unshift(Rr.splice(-K.lgSize,Rr.length).join(""));Rr.length>K.gSize;)ys.unshift(Rr.splice(-K.gSize,Rr.length).join(""));Rr.length&&ys.unshift(Rr.join("")),Yt=ys.join(dr(B,J)),_o.length&&(Yt+=dr(B,Le)+_o.join("")),Zo&&(Yt+=dr(B,at.Exponential)+"+"+Zo)}else Yt=dr(B,at.Infinity);return Yt=z<0&&!lr?K.negPre+Yt+K.negSuf:K.posPre+Yt+K.posSuf,Yt}(z,function Tn(z,K="-"){const B={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},J=z.split(";"),Le=J[0],st=J[1],Je=-1!==Le.indexOf(".")?Le.split("."):[Le.substring(0,Le.lastIndexOf("0")+1),Le.substring(Le.lastIndexOf("0")+1)],Yt=Je[0],lr=Je[1]||"";B.posPre=Yt.substring(0,Yt.indexOf("#"));for(let wr=0;wr<lr.length;wr++){const yn=lr.charAt(wr);"0"===yn?B.minFrac=B.maxFrac=wr+1:"#"===yn?B.maxFrac=wr+1:B.posSuf+=yn}const mr=Yt.split(",");if(B.gSize=mr[1]?mr[1].length:0,B.lgSize=mr[2]||mr[1]?(mr[2]||mr[1]).length:0,st){const wr=Le.length-B.posPre.length-B.posSuf.length,yn=st.indexOf("#");B.negPre=st.substring(0,yn).replace(/'/g,""),B.negSuf=st.slice(yn+wr).replace(/'/g,"")}else B.negPre=K+B.posPre,B.negSuf=B.posSuf;return B}(function An(z,K){return(0,ge.cg1)(z)[ge.wAp.NumberFormats][K]}(K,Mn.Decimal),dr(K,at.MinusSign)),K,at.Group,at.Decimal,B)}(function _l(z){if("string"==typeof z&&!isNaN(Number(z)-parseFloat(z)))return Number(z);if("number"!=typeof z)throw new Error(`${z} is not a number`);return z}(B),Le,J)}catch(st){throw function pr(z,K){return new ge.vHH(2100,!1)}()}}}return z.\u0275fac=function(B){return new(B||z)(ge.Y36(ge.soG,16))},z.\u0275pipe=ge.Yjl({name:"number",type:z,pure:!0}),z})();let gs=(()=>{class z{}return z.\u0275fac=function(B){return new(B||z)},z.\u0275mod=ge.oAB({type:z}),z.\u0275inj=ge.cJS({}),z})();const vl="browser";let Fs=(()=>{class z{}return z.\u0275prov=(0,ge.Yz7)({token:z,providedIn:"root",factory:()=>new Mo((0,ge.LFG)(jt),window)}),z})();class Mo{constructor(K,B){this.document=K,this.window=B,this.offset=()=>[0,0]}setOffset(K){this.offset=Array.isArray(K)?()=>K:K}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(K){this.supportsScrolling()&&this.window.scrollTo(K[0],K[1])}scrollToAnchor(K){if(!this.supportsScrolling())return;const B=function Os(z,K){const B=z.getElementById(K)||z.getElementsByName(K)[0];if(B)return B;if("function"==typeof z.createTreeWalker&&z.body&&(z.body.createShadowRoot||z.body.attachShadow)){const J=z.createTreeWalker(z.body,NodeFilter.SHOW_ELEMENT);let Le=J.currentNode;for(;Le;){const st=Le.shadowRoot;if(st){const Je=st.getElementById(K)||st.querySelector(`[name="${K}"]`);if(Je)return Je}Le=J.nextNode()}}return null}(this.document,K);B&&(this.scrollToElement(B),B.focus())}setHistoryScrollRestoration(K){if(this.supportScrollRestoration()){const B=this.window.history;B&&B.scrollRestoration&&(B.scrollRestoration=K)}}scrollToElement(K){const B=K.getBoundingClientRect(),J=B.left+this.window.pageXOffset,Le=B.top+this.window.pageYOffset,st=this.offset();this.window.scrollTo(J-st[0],Le-st[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const K=ao(this.window.history)||ao(Object.getPrototypeOf(this.window.history));return!(!K||!K.writable&&!K.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function ao(z){return Object.getOwnPropertyDescriptor(z,"scrollRestoration")}class Qr{}},256:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{deG:()=>Cu,tb:()=>N0,AFp:()=>O0,ip1:()=>F0,CZH:()=>mg,hGG:()=>Vw,z2F:()=>_g,sBO:()=>Dw,Sil:()=>ow,_Vd:()=>Sp,EJc:()=>rw,Xts:()=>gd,SBq:()=>Mp,lqb:()=>rl,qLn:()=>qc,vpe:()=>Pc,XFs:()=>Jt,OlP:()=>Er,zs3:()=>Ta,ZZ4:()=>ay,aQg:()=>ly,soG:()=>gg,YKP:()=>Bv,h0i:()=>Zh,PXZ:()=>yw,R0b:()=>Ma,FiY:()=>kt,Lbi:()=>ew,g9A:()=>B0,Qsj:()=>B1,FYo:()=>Uv,JOm:()=>ba,tp0:()=>rn,Rgc:()=>kp,dDg:()=>pw,eoX:()=>Z0,GfV:()=>Vv,s_b:()=>dg,ifc:()=>gi,MMx:()=>O_,hM9:()=>q1,eFA:()=>X0,G48:()=>Tw,f3M:()=>Ge,_c5:()=>Uw,c2e:()=>tw,zSh:()=>Gf,wAp:()=>zn,vHH:()=>gt,lri:()=>G0,rWj:()=>H0,D6c:()=>jw,cg1:()=>D_,kL8:()=>cv,dqk:()=>Pn,sIi:()=>na,CqO:()=>ct,QGY:()=>Ze,QP$:()=>nf,F4k:()=>Xe,RDi:()=>fc,AaK:()=>dt,TTD:()=>gs,xp6:()=>Th,uIk:()=>Gl,Suo:()=>d0,Xpm:()=>ce,lG2:()=>At,Yz7:()=>Sr,cJS:()=>ci,oAB:()=>Ie,Yjl:()=>ve,Y36:()=>ju,_UZ:()=>ue,qZA:()=>ie,TgZ:()=>q,EpF:()=>Fe,LFG:()=>fe,$8M:()=>Xs,$Z:()=>Rm,NdJ:()=>yt,CRH:()=>f0,oxw:()=>mt,ALo:()=>n0,xi3:()=>r0,Q6J:()=>k,VKq:()=>Yv,iGM:()=>u0,MAs:()=>R,KtG:()=>ua,CHM:()=>za,LSH:()=>ph,YNc:()=>w,_uU:()=>Gy,Oqu:()=>E_,hij:()=>og,lnq:()=>T_,Gf:()=>h0});var ge=Be(189),re=Be(421),Wt=Be(515),u=Be(669),Ae=Be(76),jt=Be(579),nt=Be(727),Mt=Be(306),Ct=Be(961),ft=Be(482);function wn(i,o,...a){if(!0===o)return void i();if(!1===o)return;const d=new Ct.Hp({next:()=>{d.unsubscribe(),i()}});return o(...a).subscribe(d)}function ut(i){for(let o in i)if(i[o]===ut)return o;throw Error("Could not find renamed property on target object.")}function dt(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(dt).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function dn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const Xt=ut({__forward_ref__:ut});function Hn(i){return i.__forward_ref__=Hn,i.toString=function(){return dt(this())},i}function Zt(i){return function Bt(i){return"function"==typeof i&&i.hasOwnProperty(Xt)&&i.__forward_ref__===Hn}(i)?i():i}class gt extends Error{constructor(o,a){super(function rr(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}(o,a)),this.code=o}}function wt(i){return"string"==typeof i?i:null==i?"":String(i)}function Qe(i,o){throw new gt(-201,!1)}function dr(i,o){null==i&&function An(i,o,a,d){throw new Error(`ASSERTION ERROR: ${i}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,i,null,"!=")}function Sr(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function ci(i){return{providers:i.providers||[],imports:i.imports||[]}}function Xi(i){return Vn(i,$i)||Vn(i,Ii)}function Vn(i,o){return i.hasOwnProperty(o)?i[o]:null}function Fi(i){return i&&(i.hasOwnProperty(Bo)||i.hasOwnProperty(ts))?i[Bo]:null}const $i=ut({\u0275prov:ut}),Bo=ut({\u0275inj:ut}),Ii=ut({ngInjectableDef:ut}),ts=ut({ngInjectorDef:ut});var Jt=(()=>((Jt=Jt||{})[Jt.Default=0]="Default",Jt[Jt.Host=1]="Host",Jt[Jt.Self=2]="Self",Jt[Jt.SkipSelf=4]="SkipSelf",Jt[Jt.Optional=8]="Optional",Jt))();let ui;function an(i){const o=ui;return ui=i,o}function gn(i,o,a){const d=Xi(i);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&Jt.Optional?null:void 0!==o?o:void Qe(dt(i))}function mi(i){return{toString:i}.toString()}var ar=(()=>((ar=ar||{})[ar.OnPush=0]="OnPush",ar[ar.Default=1]="Default",ar))(),gi=(()=>{return(i=gi||(gi={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",gi;var i})();const Pn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Oi={},Fn=[],In=ut({\u0275cmp:ut}),po=ut({\u0275dir:ut}),Gr=ut({\u0275pipe:ut}),To=ut({\u0275mod:ut}),le=ut({\u0275fac:ut}),$=ut({__NG_ELEMENT_ID__:ut});let Z=0;function ce(i){return mi(()=>{const a=!0===i.standalone,d={},g={type:i.type,providersResolver:null,decls:i.decls,vars:i.vars,factory:null,template:i.template||null,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:d,inputs:null,outputs:null,exportAs:i.exportAs||null,onPush:i.changeDetection===ar.OnPush,directiveDefs:null,pipeDefs:null,standalone:a,dependencies:a&&i.dependencies||null,getStandaloneInjector:null,selectors:i.selectors||Fn,viewQuery:i.viewQuery||null,features:i.features||null,data:i.data||{},encapsulation:i.encapsulation||gi.Emulated,id:"c"+Z++,styles:i.styles||Fn,_:null,setInput:null,schemas:i.schemas||null,tView:null},x=i.dependencies,T=i.features;return g.inputs=tt(i.inputs,d),g.outputs=tt(i.outputs),T&&T.forEach(P=>P(g)),g.directiveDefs=x?()=>("function"==typeof x?x():x).map(Te).filter(ze):null,g.pipeDefs=x?()=>("function"==typeof x?x():x).map(Me).filter(ze):null,g})}function Te(i){return he(i)||se(i)}function ze(i){return null!==i}const Oe={};function Ie(i){return mi(()=>{const o={type:i.type,bootstrap:i.bootstrap||Fn,declarations:i.declarations||Fn,imports:i.imports||Fn,exports:i.exports||Fn,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null};return null!=i.id&&(Oe[i.id]=i.type),o})}function tt(i,o){if(null==i)return Oi;const a={};for(const d in i)if(i.hasOwnProperty(d)){let g=i[d],x=g;Array.isArray(g)&&(x=g[1],g=g[0]),a[g]=d,o&&(o[g]=x)}return a}const At=ce;function ve(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function he(i){return i[In]||null}function se(i){return i[po]||null}function Me(i){return i[Gr]||null}function Ue(i,o){const a=i[To]||null;if(!a&&!0===o)throw new Error(`Type ${dt(i)} does not have '\u0275mod' property.`);return a}function Pr(i){return Array.isArray(i)&&"object"==typeof i[1]}function Gi(i){return Array.isArray(i)&&!0===i[1]}function Kr(i){return 0!=(8&i.flags)}function vi(i){return 2==(2&i.flags)}function Hi(i){return 1==(1&i.flags)}function pr(i){return null!==i.template}function Fr(i){return 0!=(256&i[2])}function Ho(i,o){return i.hasOwnProperty(le)?i[le]:null}class yl{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function gs(){return vl}function vl(i){return i.type.prototype.ngOnChanges&&(i.setInput=Yl),Xl}function Xl(){const i=go(this),o=i?.current;if(o){const a=i.previous;if(a===Oi)i.previous=o;else for(let d in o)a[d]=o[d];i.current=null,this.ngOnChanges(o)}}function Yl(i,o,a,d){const g=go(i)||function La(i,o){return i[_s]=o}(i,{previous:Oi,current:null}),x=g.current||(g.current={}),T=g.previous,P=this.declaredInputs[a],F=T[P];x[P]=new yl(F&&F.currentValue,o,T===Oi),i[d]=o}gs.ngInherit=!0;const _s="__ngSimpleChanges__";function go(i){return i[_s]||null}function Qr(i){for(;Array.isArray(i);)i=i[0];return i}function J(i,o){return Qr(o[i.index])}function st(i,o){return i.data[o]}function Je(i,o){return i[o]}function Yt(i,o){const a=o[i];return Pr(a)?a:a[0]}function lr(i){return 4==(4&i[2])}function mr(i){return 64==(64&i[2])}function yn(i,o){return null==o?null:i[o]}function ni(i){i[18]=0}function Rr(i,o){i[5]+=o;let a=i,d=i[3];for(;null!==d&&(1===o&&1===a[5]||-1===o&&0===a[5]);)d[5]+=o,a=d,d=d[3]}const un={lFrame:Dl(null),bindingsEnabled:!0};function ca(){return un.bindingsEnabled}function _t(){return un.lFrame.lView}function Kn(){return un.lFrame.tView}function za(i){return un.lFrame.contextLView=i,i[8]}function ua(i){return un.lFrame.contextLView=null,i}function yr(){let i=Kl();for(;null!==i&&64===i.type;)i=i.parent;return i}function Kl(){return un.lFrame.currentTNode}function Ao(i,o){const a=un.lFrame;a.currentTNode=i,a.isParent=o}function wl(){return un.lFrame.isParent}function Ni(){const i=un.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function Bs(){return un.lFrame.bindingIndex++}function yu(i,o){const a=un.lFrame;a.bindingIndex=a.bindingRootIndex=i,Ns(o)}function Ns(i){un.lFrame.currentDirectiveIndex=i}function Us(){return un.lFrame.currentQueryIndex}function tc(i){un.lFrame.currentQueryIndex=i}function vu(i){const o=i[1];return 2===o.type?o.declTNode:1===o.type?i[6]:null}function Tl(i,o,a){if(a&Jt.SkipSelf){let g=o,x=i;for(;!(g=g.parent,null!==g||a&Jt.Host||(g=vu(x),null===g||(x=x[15],10&g.type))););if(null===g)return!1;o=g,i=x}const d=un.lFrame=nc();return d.currentTNode=o,d.lView=i,!0}function ha(i){const o=nc(),a=i[1];un.lFrame=o,o.currentTNode=a.firstChild,o.lView=i,o.tView=a,o.contextLView=i,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function nc(){const i=un.lFrame,o=null===i?null:i.child;return null===o?Dl(i):o}function Dl(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function Vs(){const i=un.lFrame;return un.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const rc=Vs;function Na(){const i=Vs();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function bi(){return un.lFrame.selectedIndex}function vs(i){un.lFrame.selectedIndex=i}function Or(){const i=un.lFrame;return st(i.tView,i.selectedIndex)}function Il(i,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const x=i.data[a].type.prototype,{ngAfterContentInit:T,ngAfterContentChecked:P,ngAfterViewInit:F,ngAfterViewChecked:j,ngOnDestroy:Y}=x;T&&(i.contentHooks||(i.contentHooks=[])).push(-a,T),P&&((i.contentHooks||(i.contentHooks=[])).push(a,P),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(a,P)),F&&(i.viewHooks||(i.viewHooks=[])).push(-a,F),j&&((i.viewHooks||(i.viewHooks=[])).push(a,j),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(a,j)),null!=Y&&(i.destroyHooks||(i.destroyHooks=[])).push(a,Y)}}function Qi(i,o,a){xu(i,o,3,a)}function Sl(i,o,a,d){(3&i[2])===a&&xu(i,o,a,d)}function xs(i,o){let a=i[2];(3&a)===o&&(a&=2047,a+=1,i[2]=a)}function xu(i,o,a,d){const x=d??-1,T=o.length-1;let P=0;for(let F=void 0!==d?65535&i[18]:0;F<T;F++)if("number"==typeof o[F+1]){if(P=o[F],null!=d&&P>=d)break}else o[F]<0&&(i[18]+=65536),(P<x||-1==x)&&(bu(i,a,o,F),i[18]=(4294901760&i[18])+F+2),F++}function bu(i,o,a,d){const g=a[d]<0,x=a[d+1],P=i[g?-a[d]:a[d]];if(g){if(i[2]>>11<i[18]>>16&&(3&i[2])===o){i[2]+=2048;try{x.call(P)}finally{}}}else try{x.call(P)}finally{}}class bs{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function Gs(i,o,a){let d=0;for(;d<a.length;){const g=a[d];if("number"==typeof g){if(0!==g)break;d++;const x=a[d++],T=a[d++],P=a[d++];i.setAttribute(o,T,P,x)}else{const x=g,T=a[++d];ja(x)?i.setProperty(o,x,T):i.setAttribute(o,x,T),d++}}return d}function Es(i){return 3===i||4===i||6===i}function ja(i){return 64===i.charCodeAt(0)}function is(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const g=o[d];"number"==typeof g?a=g:0===a||Pl(i,a,g,null,-1===a||2===a?o[++d]:null)}}return i}function Pl(i,o,a,d,g){let x=0,T=i.length;if(-1===o)T=-1;else for(;x<i.length;){const P=i[x++];if("number"==typeof P){if(P===o){T=-1;break}if(P>o){T=x-1;break}}}for(;x<i.length;){const P=i[x];if("number"==typeof P)break;if(P===a){if(null===d)return void(null!==g&&(i[x+1]=g));if(d===i[x+1])return void(i[x+2]=g)}x++,null!==d&&x++,null!==g&&x++}-1!==T&&(i.splice(T,0,o),x=T+1),i.splice(x++,0,a),null!==d&&i.splice(x++,0,d),null!==g&&i.splice(x++,0,g)}function $a(i){return-1!==i}function Ts(i){return 32767&i}function Cs(i,o){let a=function Ds(i){return i>>16}(i),d=o;for(;a>0;)d=d[15],a--;return d}let sc=!0;function Is(i){const o=sc;return sc=i,o}let fa=0;const qr={};function Ha(i,o){const a=Hs(i,o);if(-1!==a)return a;const d=o[1];d.firstCreatePass&&(i.injectorIndex=o.length,pa(d.data,i),pa(o,null),pa(d.blueprint,null));const g=ma(i,o),x=i.injectorIndex;if($a(g)){const T=Ts(g),P=Cs(g,o),F=P[1].data;for(let j=0;j<8;j++)o[x+j]=P[T+j]|F[T+j]}return o[x+8]=g,x}function pa(i,o){i.push(0,0,0,0,0,0,0,0,o)}function Hs(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function ma(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let a=0,d=null,g=o;for(;null!==g;){if(d=Vc(g),null===d)return-1;if(a++,g=g[15],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return-1}function Zs(i,o,a){!function hi(i,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty($)&&(d=a[$]),null==d&&(d=a[$]=fa++);const g=255&d;o.data[i+(g>>5)]|=1<<g}(i,o,a)}function Za(i,o,a){if(a&Jt.Optional)return i;Qe()}function zc(i,o,a,d){if(a&Jt.Optional&&void 0===d&&(d=null),0==(a&(Jt.Self|Jt.Host))){const g=i[9],x=an(void 0);try{return g?g.get(o,d,a&Jt.Optional):gn(o,d,a&Jt.Optional)}finally{an(x)}}return Za(d,0,a)}function qs(i,o,a,d=Jt.Default,g){if(null!==i){if(1024&o[2]){const T=function Xo(i,o,a,d,g){let x=i,T=o;for(;null!==x&&null!==T&&1024&T[2]&&!(256&T[2]);){const P=ac(x,T,a,d|Jt.Self,qr);if(P!==qr)return P;let F=x.parent;if(!F){const j=T[21];if(j){const Y=j.get(a,qr,d);if(Y!==qr)return Y}F=Vc(T),T=T[15]}x=F}return g}(i,o,a,d,qr);if(T!==qr)return T}const x=ac(i,o,a,d,qr);if(x!==qr)return x}return zc(o,a,d,g)}function ac(i,o,a,d,g){const x=function Tu(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty($)?i[$]:void 0;return"number"==typeof o?o>=0?255&o:Bc:o}(a);if("function"==typeof x){if(!Tl(o,i,d))return d&Jt.Host?Za(g,0,d):zc(o,a,d,g);try{const T=x(d);if(null!=T||d&Jt.Optional)return T;Qe()}finally{rc()}}else if("number"==typeof x){let T=null,P=Hs(i,o),F=-1,j=d&Jt.Host?o[16][6]:null;for((-1===P||d&Jt.SkipSelf)&&(F=-1===P?ma(i,o):o[P+8],-1!==F&&wi(d,!1)?(T=o[1],P=Ts(F),o=Cs(F,o)):P=-1);-1!==P;){const Y=o[1];if(yo(x,P,Y.data)){const me=sh(P,o,a,T,d,j);if(me!==qr)return me}F=o[P+8],-1!==F&&wi(d,o[1].data[P+8]===j)&&yo(x,P,o)?(T=Y,P=Ts(F),o=Cs(F,o)):P=-1}}return g}function sh(i,o,a,d,g,x){const T=o[1],P=T.data[i+8],Y=ga(P,T,a,null==d?vi(P)&&sc:d!=T&&0!=(3&P.type),g&Jt.Host&&x===P);return null!==Y?Ws(o,T,Y,P):qr}function ga(i,o,a,d,g){const x=i.providerIndexes,T=o.data,P=1048575&x,F=i.directiveStart,Y=x>>20,Re=g?P+Y:i.directiveEnd;for(let He=d?P:P+Y;He<Re;He++){const pt=T[He];if(He<F&&a===pt||He>=F&&pt.type===a)return He}if(g){const He=T[F];if(He&&pr(He)&&He.type===a)return F}return null}function Ws(i,o,a,d){let g=i[a];const x=o.data;if(function js(i){return i instanceof bs}(g)){const T=g;T.resolving&&function Mn(i,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new gt(-200,`Circular dependency in DI detected for ${i}${a}`)}(function Ft(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():wt(i)}(x[a]));const P=Is(T.canSeeViewProviders);T.resolving=!0;const F=T.injectImpl?an(T.injectImpl):null;Tl(i,d,Jt.Default);try{g=i[a]=T.factory(void 0,x,i,d),o.firstCreatePass&&a>=d.directiveStart&&function ih(i,o,a){const{ngOnChanges:d,ngOnInit:g,ngDoCheck:x}=o.type.prototype;if(d){const T=vl(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(i,T),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,T)}g&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-i,g),x&&((a.preOrderHooks||(a.preOrderHooks=[])).push(i,x),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,x))}(a,x[a],o)}finally{null!==F&&an(F),Is(P),T.resolving=!1,rc()}}return g}function yo(i,o,a){return!!(a[o+(i>>5)]&1<<i)}function wi(i,o){return!(i&Jt.Self||i&Jt.Host&&o)}class Ss{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return qs(this._tNode,this._lView,o,d,a)}}function Bc(){return new Ss(yr(),_t())}function Vc(i){const o=i[1],a=o.type;return 2===a?o.declTNode:1===a?i[6]:null}function Xs(i){return function Eu(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const a=i.attrs;if(a){const d=a.length;let g=0;for(;g<d;){const x=a[g];if(Es(x))break;if(0===x)g+=2;else if("number"==typeof x)for(g++;g<d&&"string"==typeof a[g];)g++;else{if(x===o)return a[g+1];g+=2}}}return null}(yr(),i)}const Ms="__parameters__";function os(i,o,a){return mi(()=>{const d=function cc(i){return function(...a){if(i){const d=i(...a);for(const g in d)this[g]=d[g]}}}(o);function g(...x){if(this instanceof g)return d.apply(this,x),this;const T=new g(...x);return P.annotation=T,P;function P(F,j,Y){const me=F.hasOwnProperty(Ms)?F[Ms]:Object.defineProperty(F,Ms,{value:[]})[Ms];for(;me.length<=Y;)me.push(null);return(me[Y]=me[Y]||[]).push(T),F}}return a&&(g.prototype=Object.create(a.prototype)),g.prototype.ngMetadataName=i,g.annotationCls=g,g})}class Er{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Sr({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Cu=new Er("AnalyzeForEntryComponents");function pe(i,o){void 0===o&&(o=i);for(let a=0;a<i.length;a++){let d=i[a];Array.isArray(d)?(o===i&&(o=i.slice(0,a)),pe(d,o)):o!==i&&o.push(d)}return o}function De(i,o){i.forEach(a=>Array.isArray(a)?De(a,o):o(a))}function Ye(i,o,a){o>=i.length?i.push(a):i.splice(o,0,a)}function It(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}const W={},te="__NG_DI_FLAG__",ne="ngTempTokenPath",_e=/\n/gm,ae="__source";let oe;function xe(i){const o=oe;return oe=i,o}function de(i,o=Jt.Default){if(void 0===oe)throw new gt(-203,!1);return null===oe?gn(i,void 0,o):oe.get(i,o&Jt.Optional?null:void 0,o)}function fe(i,o=Jt.Default){return(function vr(){return ui}()||de)(Zt(i),o)}function Ge(i,o=Jt.Default){return fe(i,o)}function We(i){const o=[];for(let a=0;a<i.length;a++){const d=Zt(i[a]);if(Array.isArray(d)){if(0===d.length)throw new gt(900,!1);let g,x=Jt.Default;for(let T=0;T<d.length;T++){const P=d[T],F=je(P);"number"==typeof F?-1===F?g=P.token:x|=F:g=P}o.push(fe(g,x))}else o.push(fe(d))}return o}function $e(i,o){return i[te]=o,i.prototype[te]=o,i}function je(i){return i[te]}const kt=$e(os("Optional"),8),rn=$e(os("SkipSelf"),4);let Yo;function fc(i){Yo=i}class cf{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const Kh=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Qh=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Mi=(()=>((Mi=Mi||{})[Mi.NONE=0]="NONE",Mi[Mi.HTML=1]="HTML",Mi[Mi.STYLE=2]="STYLE",Mi[Mi.SCRIPT=3]="SCRIPT",Mi[Mi.URL=4]="URL",Mi[Mi.RESOURCE_URL=5]="RESOURCE_URL",Mi))();function ph(i){const o=function Zc(){const i=_t();return i&&i[12]}();return o?o.sanitize(Mi.URL,i)||"":function Su(i,o){const a=function Up(i){return i instanceof cf&&i.getTypeName()||null}(i);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(i,"URL")?function kl(i){return i instanceof cf?i.changingThisBreaksApplicationSecurity:i}(i):function hh(i){return(i=String(i)).match(Kh)||i.match(Qh)?i:"unsafe:"+i}(wt(i))}function ff(i){return i.ngOriginalError}class qc{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&ff(o);for(;a&&ff(a);)a=ff(a);return a||null}}const mf=new Map;let Kp=0;const vf="__ngContext__";function Vi(i,o){Pr(o)?(i[vf]=o[20],function gf(i){mf.set(i[20],i)}(o)):i[vf]=o}function vc(i){const o=i[vf];return"number"==typeof o?function Qp(i){return mf.get(i)||null}(o):o||null}function od(i){const o=vc(i);return o?Pr(o)?o:o.lView:null}const el=(()=>(typeof requestAnimationFrame<"u"&&requestAnimationFrame||setTimeout).bind(Pn))();function xa(i){return i instanceof Function?i():i}var ba=(()=>((ba=ba||{})[ba.Important=1]="Important",ba[ba.DashCase=2]="DashCase",ba))();function Ru(i,o){return undefined(i,o)}function Oo(i){const o=i[3];return Gi(o)?o[3]:o}function ud(i){return Ps(i[13])}function Xc(i){return Ps(i[4])}function Ps(i){for(;null!==i&&!Gi(i);)i=i[4];return i}function ku(i,o,a,d,g){if(null!=d){let x,T=!1;Gi(d)?x=d:Pr(d)&&(T=!0,d=d[0]);const P=Qr(d);0===i&&null!==a?null==g?nl(o,a,P):Nl(o,a,P,g||null,!0):1===i&&null!==a?Nl(o,a,P,g||null,!0):2===i?function pm(i,o,a){const d=fd(i,o);d&&function Sg(i,o,a,d){i.removeChild(o,a,d)}(i,d,o,a)}(o,P,T):3===i&&o.destroyNode(P),null!=x&&function kf(i,o,a,d,g){const x=a[7];x!==Qr(a)&&ku(o,i,d,x,g);for(let P=10;P<a.length;P++){const F=a[P];vh(F[1],F,i,o,d,x)}}(o,i,x,a,g)}}function dd(i,o,a){return i.createElement(o,a)}function Tf(i,o){const a=i[9],d=a.indexOf(o),g=o[3];512&o[2]&&(o[2]&=-513,Rr(g,-1)),a.splice(d,1)}function Df(i,o){if(i.length<=10)return;const a=10+o,d=i[a];if(d){const g=d[17];null!==g&&g!==i&&Tf(g,d),o>0&&(i[a-1][4]=d[4]);const x=It(i,10+o);!function am(i,o){vh(i,o,o[11],2,null,null),o[0]=null,o[6]=null}(d[1],d);const T=x[19];null!==T&&T.detachView(x[1]),d[3]=null,d[4]=null,d[2]&=-65}return d}function Cf(i,o){if(!(128&o[2])){const a=o[11];a.destroyNode&&vh(i,o,a,3,null,null),function wf(i){let o=i[13];if(!o)return If(i[1],i);for(;o;){let a=null;if(Pr(o))a=o[13];else{const d=o[10];d&&(a=d)}if(!a){for(;o&&!o[4]&&o!==i;)Pr(o)&&If(o[1],o),o=o[3];null===o&&(o=i),Pr(o)&&If(o[1],o),a=o&&o[4]}o=a}}(o)}}function If(i,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function cm(i,o){let a;if(null!=i&&null!=(a=i.destroyHooks))for(let d=0;d<a.length;d+=2){const g=o[a[d]];if(!(g instanceof bs)){const x=a[d+1];if(Array.isArray(x))for(let T=0;T<x.length;T+=2){const P=g[x[T]],F=x[T+1];try{F.call(P)}finally{}}else try{x.call(g)}finally{}}}}(i,o),function Ig(i,o){const a=i.cleanup,d=o[7];let g=-1;if(null!==a)for(let x=0;x<a.length-1;x+=2)if("string"==typeof a[x]){const T=a[x+1],P="function"==typeof T?T(o):Qr(o[T]),F=d[g=a[x+2]],j=a[x+3];"boolean"==typeof j?P.removeEventListener(a[x],F,j):j>=0?d[g=j]():d[g=-j].unsubscribe(),x+=2}else{const T=d[g=a[x+1]];a[x].call(T)}if(null!==d){for(let x=g+1;x<d.length;x++)d[x]();o[7]=null}}(i,o),1===o[1].type&&o[11].destroy();const a=o[17];if(null!==a&&Gi(o[3])){a!==o[3]&&Tf(a,o);const d=o[19];null!==d&&d.detachView(i)}!function _f(i){mf.delete(i[20])}(o)}}function Sf(i,o,a){return function Mf(i,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[0];if(2&d.flags){const g=i.data[d.directiveStart].encapsulation;if(g===gi.None||g===gi.Emulated)return null}return J(d,a)}(i,o.parent,a)}function Nl(i,o,a,d,g){i.insertBefore(o,a,d,g)}function nl(i,o,a){i.appendChild(o,a)}function Jo(i,o,a,d,g){null!==d?Nl(i,o,a,d,g):nl(i,o,a)}function fd(i,o){return i.parentNode(o)}let dm=function yh(i,o,a){return 40&i.type?J(i,a):null};function wa(i,o,a,d){const g=Sf(i,d,o),x=o[11],P=function hm(i,o,a){return dm(i,o,a)}(d.parent||o[6],d,o);if(null!=g)if(Array.isArray(a))for(let F=0;F<a.length;F++)Jo(x,g,a[F],P,!1);else Jo(x,g,a,P,!1)}function wc(i,o){if(null!==o){const a=o.type;if(3&a)return J(o,i);if(4&a)return Pf(-1,i[o.index]);if(8&a){const d=o.child;if(null!==d)return wc(i,d);{const g=i[o.index];return Gi(g)?Pf(-1,g):Qr(g)}}if(32&a)return Ru(o,i)()||Qr(i[o.index]);{const d=fm(i,o);return null!==d?Array.isArray(d)?d[0]:wc(Oo(i[16]),d):wc(i,o.next)}}return null}function fm(i,o){return null!==o?i[16][6].projection[o.projection]:null}function Pf(i,o){const a=10+i+1;if(a<o.length){const d=o[a],g=d[1].firstChild;if(null!==g)return wc(d,g)}return o[7]}function Rf(i,o,a,d,g,x,T){for(;null!=a;){const P=d[a.index],F=a.type;if(T&&0===o&&(P&&Vi(Qr(P),d),a.flags|=4),64!=(64&a.flags))if(8&F)Rf(i,o,a.child,d,g,x,!1),ku(o,i,g,P,x);else if(32&F){const j=Ru(a,d);let Y;for(;Y=j();)ku(o,i,g,Y,x);ku(o,i,g,P,x)}else 16&F?mm(i,o,d,a,g,x):ku(o,i,g,P,x);a=T?a.projectionNext:a.next}}function vh(i,o,a,d,g,x){Rf(a,d,i.firstChild,o,g,x,!1)}function mm(i,o,a,d,g,x){const T=a[16],F=T[6].projection[d.projection];if(Array.isArray(F))for(let j=0;j<F.length;j++)ku(o,i,g,F[j],x);else Rf(i,o,F,T[3],g,x,!0)}function Yc(i,o,a){i.setAttribute(o,"style",a)}function Lf(i,o,a){""===a?i.removeAttribute(o,"class"):i.setAttribute(o,"class",a)}function fi(i,o,a){let d=i.length;for(;;){const g=i.indexOf(o,a);if(-1===g)return g;if(0===g||i.charCodeAt(g-1)<=32){const x=o.length;if(g+x===d||i.charCodeAt(g+x)<=32)return g}a=g+1}}const Of="ng-template";function pd(i,o,a){let d=0;for(;d<i.length;){let g=i[d++];if(a&&"class"===g){if(g=i[d],-1!==fi(g.toLowerCase(),o,0))return!0}else if(1===g){for(;d<i.length&&"string"==typeof(g=i[d++]);)if(g.toLowerCase()===o)return!0;return!1}}return!1}function xh(i){return 4===i.type&&i.value!==Of}function bh(i,o,a){return o===(4!==i.type||a?i.value:Of)}function gm(i,o,a){let d=4;const g=i.attrs||[],x=function Rg(i){for(let o=0;o<i.length;o++)if(Es(i[o]))return o;return i.length}(g);let T=!1;for(let P=0;P<o.length;P++){const F=o[P];if("number"!=typeof F){if(!T)if(4&d){if(d=2|1&d,""!==F&&!bh(i,F,a)||""===F&&1===o.length){if(Js(d))return!1;T=!0}}else{const j=8&d?F:o[++P];if(8&d&&null!==i.attrs){if(!pd(i.attrs,j,a)){if(Js(d))return!1;T=!0}continue}const me=wh(8&d?"class":F,g,xh(i),a);if(-1===me){if(Js(d))return!1;T=!0;continue}if(""!==j){let Re;Re=me>x?"":g[me+1].toLowerCase();const He=8&d?Re:null;if(He&&-1!==fi(He,j,0)||2&d&&j!==Re){if(Js(d))return!1;T=!0}}}}else{if(!T&&!Js(d)&&!Js(F))return!1;if(T&&Js(F))continue;T=!1,d=F|1&d}}return Js(d)||T}function Js(i){return 0==(1&i)}function wh(i,o,a,d){if(null===o)return-1;let g=0;if(d||!a){let x=!1;for(;g<o.length;){const T=o[g];if(T===i)return g;if(3===T||6===T)x=!0;else{if(1===T||2===T){let P=o[++g];for(;"string"==typeof P;)P=o[++g];continue}if(4===T)break;if(0===T){g+=4;continue}}g+=x?1:2}return-1}return function _m(i,o){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){const d=i[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,i)}function md(i,o,a=!1){for(let d=0;d<o.length;d++)if(gm(i,o[d],a))return!0;return!1}function ym(i,o){return i?":not("+o.trim()+")":o}function Bf(i){let o=i[0],a=1,d=2,g="",x=!1;for(;a<i.length;){let T=i[a];if("string"==typeof T)if(2&d){const P=i[++a];g+="["+T+(P.length>0?'="'+P+'"':"")+"]"}else 8&d?g+="."+T:4&d&&(g+=" "+T);else""!==g&&!Js(T)&&(o+=ym(x,g),g=""),d=T,x=x||!Js(d);a++}return""!==g&&(o+=ym(x,g)),o}const Gn={};function Th(i){vm(Kn(),_t(),bi()+i,!1)}function vm(i,o,a,d){if(!d)if(3==(3&o[2])){const x=i.preOrderCheckHooks;null!==x&&Qi(o,x,a)}else{const x=i.preOrderHooks;null!==x&&Sl(o,x,0,a)}vs(a)}const gd=new Er("ENVIRONMENT_INITIALIZER"),Vf=new Er("INJECTOR_DEF_TYPES");function Bg(...i){return{\u0275providers:wm(0,i)}}function wm(i,...o){const a=[],d=new Set;let g;return De(o,x=>{const T=x;Ou(T,a,[],d)&&(g||(g=[]),g.push(T))}),void 0!==g&&Ec(g,a),a}function Ec(i,o){for(let a=0;a<i.length;a++){const{providers:g}=i[a];De(g,x=>{o.push(x)})}}function Ou(i,o,a,d){if(!(i=Zt(i)))return!1;let g=null,x=Fi(i);const T=!x&&he(i);if(x||T){if(T&&!T.standalone)return!1;g=i}else{const F=i.ngModule;if(x=Fi(F),!x)return!1;g=F}const P=d.has(g);if(T){if(P)return!1;if(d.add(g),T.dependencies){const F="function"==typeof T.dependencies?T.dependencies():T.dependencies;for(const j of F)Ou(j,o,a,d)}}else{if(!x)return!1;{if(null!=x.imports&&!P){let j;d.add(g);try{De(x.imports,Y=>{Ou(Y,o,a,d)&&(j||(j=[]),j.push(Y))})}finally{}void 0!==j&&Ec(j,o)}if(!P){const j=Ho(g)||(()=>new g);o.push({provide:g,useFactory:j,deps:Fn},{provide:Vf,useValue:g,multi:!0},{provide:gd,useValue:()=>fe(g),multi:!0})}const F=x.providers;null==F||P||De(F,Y=>{o.push(Y)})}}return g!==i&&void 0!==i.providers}const Ng=ut({provide:String,useValue:ut});function Kc(i){return null!==i&&"object"==typeof i&&Ng in i}function Ea(i){return"function"==typeof i}const _d=new Er("INJECTOR",-1);class $f{get(o,a=W){if(a===W){const d=new Error(`NullInjectorError: No provider for ${dt(o)}!`);throw d.name="NullInjectorError",d}return a}}const Gf=new Er("Set Injector scope."),Dh={},yd={};let vd;function lo(){return void 0===vd&&(vd=new $f),vd}class rl{}class Bu extends rl{constructor(o,a,d,g){super(),this.parent=a,this.source=d,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Uu(o,T=>this.processProvider(T)),this.records.set(_d,Nu(void 0,this)),g.has("environment")&&this.records.set(rl,Nu(void 0,this));const x=this.records.get(Gf);null!=x&&"string"==typeof x.value&&this.scopes.add(x.value),this.injectorDefTypes=new Set(this.get(Vf.multi,Fn,Jt.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}get(o,a=W,d=Jt.Default){this.assertNotDestroyed();const g=xe(this),x=an(void 0);try{if(!(d&Jt.SkipSelf)){let P=this.records.get(o);if(void 0===P){const F=function $g(i){return"function"==typeof i||"object"==typeof i&&i instanceof Er}(o)&&Xi(o);P=F&&this.injectableDefInScope(F)?Nu(xd(o),Dh):null,this.records.set(o,P)}if(null!=P)return this.hydrate(o,P)}return(d&Jt.Self?lo():this.parent).get(o,a=d&Jt.Optional&&a===W?null:a)}catch(T){if("NullInjectorError"===T.name){if((T[ne]=T[ne]||[]).unshift(dt(o)),g)throw T;return function be(i,o,a,d){const g=i[ne];throw o[ae]&&g.unshift(o[ae]),i.message=function ht(i,o,a,d=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let g=dt(o);if(Array.isArray(o))g=o.map(dt).join(" -> ");else if("object"==typeof o){let x=[];for(let T in o)if(o.hasOwnProperty(T)){let P=o[T];x.push(T+":"+("string"==typeof P?JSON.stringify(P):dt(P)))}g=`{${x.join(", ")}}`}return`${a}${d?"("+d+")":""}[${g}]: ${i.replace(_e,"\n  ")}`}("\n"+i.message,g,a,d),i.ngTokenPath=g,i[ne]=null,i}(T,o,"R3InjectorError",this.source)}throw T}finally{an(x),xe(g)}}resolveInjectorInitializers(){const o=xe(this),a=an(void 0);try{const d=this.get(gd.multi,Fn,Jt.Self);for(const g of d)g()}finally{xe(o),an(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(dt(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new gt(205,!1)}processProvider(o){let a=Ea(o=Zt(o))?o:Zt(o&&o.provide);const d=function Em(i){return Kc(i)?Nu(void 0,i.useValue):Nu(function Tm(i,o,a){let d;if(Ea(i)){const g=Zt(i);return Ho(g)||xd(g)}if(Kc(i))d=()=>Zt(i.useValue);else if(function jf(i){return!(!i||!i.useFactory)}(i))d=()=>i.useFactory(...We(i.deps||[]));else if(function zu(i){return!(!i||!i.useExisting)}(i))d=()=>fe(Zt(i.useExisting));else{const g=Zt(i&&(i.useClass||i.provide));if(!function Vg(i){return!!i.deps}(i))return Ho(g)||xd(g);d=()=>new g(...We(i.deps))}return d}(i),Dh)}(o);if(Ea(o)||!0!==o.multi)this.records.get(a);else{let g=this.records.get(a);g||(g=Nu(void 0,Dh,!0),g.factory=()=>We(g.multi),this.records.set(a,g)),a=o,g.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===Dh&&(a.value=yd,a.value=a.factory()),"object"==typeof a.value&&a.value&&function jg(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=Zt(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function xd(i){const o=Xi(i),a=null!==o?o.factory:Ho(i);if(null!==a)return a;if(i instanceof Er)throw new gt(204,!1);if(i instanceof Function)return function bd(i){const o=i.length;if(o>0)throw function Rn(i,o){const a=[];for(let d=0;d<i;d++)a.push(o);return a}(o,"?"),new gt(204,!1);const a=function Ci(i){const o=i&&(i[$i]||i[Ii]);if(o){const a=function Yn(i){if(i.hasOwnProperty("name"))return i.name;const o=(""+i).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(i);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(i);return null!==a?()=>a.factory(i):()=>new i}(i);throw new gt(204,!1)}function Nu(i,o,a=!1){return{factory:i,value:o,multi:a?[]:void 0}}function Gg(i){return!!i.\u0275providers}function Uu(i,o){for(const a of i)Array.isArray(a)?Uu(a,o):Gg(a)?Uu(a.\u0275providers,o):o(a)}function Dm(i,o=null,a=null,d){const g=Hf(i,o,a,d);return g.resolveInjectorInitializers(),g}function Hf(i,o=null,a=null,d,g=new Set){const x=[a||Fn,Bg(i)];return d=d||("object"==typeof i?void 0:dt(i)),new Bu(x,o||lo(),d||null,g)}let Ta=(()=>{class i{static create(a,d){if(Array.isArray(a))return Dm({name:""},d,a,"");{const g=a.name??"";return Dm({name:g},a.parent,a.providers,g)}}}return i.THROW_IF_NOT_FOUND=W,i.NULL=new $f,i.\u0275prov=Sr({token:i,providedIn:"any",factory:()=>fe(_d)}),i.__NG_ELEMENT_ID__=-1,i})();function ju(i,o=Jt.Default){const a=_t();return null===a?fe(i,o):qs(yr(),a,Zt(i),o)}function Rm(){throw new Error("invalid")}function Sc(i,o){const a=i.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const g=a[d],x=a[d+1];if(-1!==x){const T=i.data[x];tc(g),T.contentQueries(2,o[x],x)}}}function bo(i,o,a,d,g,x,T,P,F,j,Y){const me=o.blueprint.slice();return me[0]=g,me[2]=76|d,(null!==Y||i&&1024&i[2])&&(me[2]|=1024),ni(me),me[3]=me[15]=i,me[8]=a,me[10]=T||i&&i[10],me[11]=P||i&&i[11],me[12]=F||i&&i[12]||null,me[9]=j||i&&i[9]||null,me[6]=x,me[20]=function Dg(){return Kp++}(),me[21]=Y,me[16]=2==o.type?i[16]:me,me}function no(i,o,a,d,g){let x=i.data[o];if(null===x)x=function lp(i,o,a,d,g){const x=Kl(),T=wl(),F=i.data[o]=function Gm(i,o,a,d,g,x){return{type:a,index:d,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:x,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,T?x:x&&x.parent,a,o,d,g);return null===i.firstChild&&(i.firstChild=F),null!==x&&(T?null==x.child&&null!==F.parent&&(x.child=F):null===x.next&&(x.next=F)),F}(i,o,a,d,g),function El(){return un.lFrame.inI18n}()&&(x.flags|=64);else if(64&x.type){x.type=a,x.value=d,x.attrs=g;const T=function Ba(){const i=un.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();x.injectorIndex=null===T?-1:T.injectorIndex}return Ao(x,!0),x}function eu(i,o,a,d){if(0===a)return-1;const g=o.length;for(let x=0;x<a;x++)o.push(d),i.blueprint.push(d),i.data.push(null);return g}function Ld(i,o,a){ha(o);try{const d=i.viewQuery;null!==d&&mp(1,d,a);const g=i.template;null!==g&&jm(i,o,g,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Sc(i,o),i.staticViewQueries&&mp(2,i.viewQuery,a);const x=i.components;null!==x&&function Hu(i,o){for(let a=0;a<o.length;a++)__(i,o[a])}(o,x)}catch(d){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),d}finally{o[2]&=-5,Na()}}function tu(i,o,a,d){const g=o[2];if(128!=(128&g)){ha(o);try{ni(o),function Lc(i){return un.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==a&&jm(i,o,a,2,d);const T=3==(3&g);if(T){const j=i.preOrderCheckHooks;null!==j&&Qi(o,j,null)}else{const j=i.preOrderHooks;null!==j&&Sl(o,j,0,null),xs(o,0)}if(function Ud(i){for(let o=ud(i);null!==o;o=Xc(o)){if(!o[2])continue;const a=o[9];for(let d=0;d<a.length;d++){const g=a[d],x=g[3];0==(512&g[2])&&Rr(x,1),g[2]|=512}}}(o),function g_(i){for(let o=ud(i);null!==o;o=Xc(o))for(let a=10;a<o.length;a++){const d=o[a],g=d[1];mr(d)&&tu(g,d,g.template,d[8])}}(o),null!==i.contentQueries&&Sc(i,o),T){const j=i.contentCheckHooks;null!==j&&Qi(o,j)}else{const j=i.contentHooks;null!==j&&Sl(o,j,1),xs(o,1)}!function Oh(i,o){const a=i.hostBindingOpCodes;if(null!==a)try{for(let d=0;d<a.length;d++){const g=a[d];if(g<0)vs(~g);else{const x=g,T=a[++d],P=a[++d];yu(T,x),P(2,o[x])}}}finally{vs(-1)}}(i,o);const P=i.components;null!==P&&function ap(i,o){for(let a=0;a<o.length;a++)Vd(i,o[a])}(o,P);const F=i.viewQuery;if(null!==F&&mp(2,F,d),T){const j=i.viewCheckHooks;null!==j&&Qi(o,j)}else{const j=i.viewHooks;null!==j&&Sl(o,j,2),xs(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,Rr(o[3],-1))}finally{Na()}}}function sl(i,o,a,d){const g=o[10],T=lr(o);try{!T&&g.begin&&g.begin(),T&&Ld(i,o,d),tu(i,o,a,d)}finally{!T&&g.end&&g.end()}}function jm(i,o,a,d,g){const x=bi(),T=2&d;try{vs(-1),T&&o.length>22&&vm(i,o,22,!1),a(d,g)}finally{vs(x)}}function Od(i,o,a){!ca()||(function Nh(i,o,a,d){const g=a.directiveStart,x=a.directiveEnd;i.firstCreatePass||Ha(a,o),Vi(d,o);const T=a.initialInputs;for(let P=g;P<x;P++){const F=i.data[P],j=pr(F);j&&f_(o,a,F);const Y=Ws(o,i,P,a);Vi(Y,o),null!==T&&Zm(0,P-g,Y,F,0,T),j&&(Yt(a.index,o)[8]=Y)}}(i,o,a,J(a,o)),128==(128&a.flags)&&function Bd(i,o,a){const d=a.directiveStart,g=a.directiveEnd,x=a.index,T=function Jl(){return un.lFrame.currentDirectiveIndex}();try{vs(x);for(let P=d;P<g;P++){const F=i.data[P],j=o[P];Ns(P),(null!==F.hostBindings||0!==F.hostVars||null!==F.hostAttrs)&&Hm(F,j)}}finally{vs(-1),Ns(T)}}(i,o,a))}function co(i,o,a=J){const d=o.localNames;if(null!==d){let g=o.index+1;for(let x=0;x<d.length;x+=2){const T=d[x+1],P=-1===T?a(o,i):i[T];i[g++]=P}}}function cp(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=Zu(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function Zu(i,o,a,d,g,x,T,P,F,j){const Y=22+d,me=Y+g,Re=function zh(i,o){const a=[];for(let d=0;d<o;d++)a.push(d<i?null:Gn);return a}(Y,me),He="function"==typeof j?j():j;return Re[1]={type:i,blueprint:Re,template:a,queries:null,viewQuery:P,declTNode:o,data:Re.slice().fill(null,Y),bindingStartIndex:Y,expandoStartIndex:me,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof x?x():x,pipeRegistry:"function"==typeof T?T():T,firstChild:null,schemas:F,consts:He,incompleteFirstPass:!1}}function zd(i,o,a,d){const g=Wm(o);null===a?g.push(d):(g.push(a),i.firstCreatePass&&Yu(i).push(d,g.length-1))}function up(i,o,a){for(let d in i)if(i.hasOwnProperty(d)){const g=i[d];(a=null===a?{}:a).hasOwnProperty(d)?a[d].push(o,g):a[d]=[o,g]}return a}function iu(i,o,a,d){let g=!1;if(ca()){const x=function h_(i,o,a){const d=i.directiveRegistry;let g=null;if(d)for(let x=0;x<d.length;x++){const T=d[x];md(a,T.selectors,!1)&&(g||(g=[]),Zs(Ha(a,o),i,T.type),pr(T)?(ou(i,a),g.unshift(T)):g.push(T))}return g}(i,o,a),T=null===d?null:{"":-1};if(null!==x){g=!0,hp(a,i.data.length,x.length);for(let Y=0;Y<x.length;Y++){const me=x[Y];me.providersResolver&&me.providersResolver(me)}let P=!1,F=!1,j=eu(i,o,x.length,null);for(let Y=0;Y<x.length;Y++){const me=x[Y];a.mergedAttrs=is(a.mergedAttrs,me.hostAttrs),dp(i,a,o,j,me),d_(j,me,T),null!==me.contentQueries&&(a.flags|=8),(null!==me.hostBindings||null!==me.hostAttrs||0!==me.hostVars)&&(a.flags|=128);const Re=me.type.prototype;!P&&(Re.ngOnChanges||Re.ngOnInit||Re.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(a.index),P=!0),!F&&(Re.ngOnChanges||Re.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(a.index),F=!0),j++}!function a_(i,o){const d=o.directiveEnd,g=i.data,x=o.attrs,T=[];let P=null,F=null;for(let j=o.directiveStart;j<d;j++){const Y=g[j],me=Y.inputs,Re=null===x||xh(o)?null:p_(me,x);T.push(Re),P=up(me,j,P),F=up(Y.outputs,j,F)}null!==P&&(P.hasOwnProperty("class")&&(o.flags|=16),P.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=T,o.inputs=P,o.outputs=F}(i,a)}T&&function Nd(i,o,a){if(o){const d=i.localNames=[];for(let g=0;g<o.length;g+=2){const x=a[o[g+1]];if(null==x)throw new gt(-301,!1);d.push(o[g],x)}}}(a,d,T)}return a.mergedAttrs=is(a.mergedAttrs,a.attrs),g}function qu(i,o,a,d,g,x){const T=x.hostBindings;if(T){let P=i.hostBindingOpCodes;null===P&&(P=i.hostBindingOpCodes=[]);const F=~o.index;(function Bh(i){let o=i.length;for(;o>0;){const a=i[--o];if("number"==typeof a&&a<0)return a}return 0})(P)!=F&&P.push(F),P.push(d,g,T)}}function Hm(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function ou(i,o){o.flags|=2,(i.components||(i.components=[])).push(o.index)}function d_(i,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=i;pr(o)&&(a[""]=i)}}function hp(i,o,a){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+a,i.providerIndexes=o}function dp(i,o,a,d,g){i.data[d]=g;const x=g.factory||(g.factory=Ho(g.type)),T=new bs(x,pr(g),ju);i.blueprint[d]=T,a[d]=T,qu(i,o,0,d,eu(i,a,g.hostVars,Gn),g)}function f_(i,o,a){const d=J(o,i),g=cp(a),x=i[10],T=Xu(i,bo(i,g,null,a.onPush?32:16,d,o,x,x.createRenderer(d,a),null,null,null));i[o.index]=T}function Ca(i,o,a,d,g,x){const T=J(i,o);!function fp(i,o,a,d,g,x,T){if(null==x)i.removeAttribute(o,g,a);else{const P=null==T?wt(x):T(x,d||"",g);i.setAttribute(o,g,P,a)}}(o[11],T,x,i.value,a,d,g)}function Zm(i,o,a,d,g,x){const T=x[o];if(null!==T){const P=d.setInput;for(let F=0;F<T.length;){const j=T[F++],Y=T[F++],me=T[F++];null!==P?d.setInput(a,me,j,Y):a[Y]=me}}}function p_(i,o){let a=null,d=0;for(;d<o.length;){const g=o[d];if(0!==g)if(5!==g){if("number"==typeof g)break;i.hasOwnProperty(g)&&(null===a&&(a=[]),a.push(g,i[g],o[d+1])),d+=2}else d+=2;else d+=4}return a}function qm(i,o,a,d){return new Array(i,!0,!1,o,null,0,d,a,null,null)}function Vd(i,o){const a=Yt(o,i);if(mr(a)){const d=a[1];48&a[2]?tu(d,a,d.template,a[8]):a[5]>0&&Wu(a)}}function Wu(i){for(let d=ud(i);null!==d;d=Xc(d))for(let g=10;g<d.length;g++){const x=d[g];if(512&x[2]){const T=x[1];tu(T,x,T.template,x[8])}else x[5]>0&&Wu(x)}const a=i[1].components;if(null!==a)for(let d=0;d<a.length;d++){const g=Yt(a[d],i);mr(g)&&g[5]>0&&Wu(g)}}function __(i,o){const a=Yt(o,i),d=a[1];(function pp(i,o){for(let a=o.length;a<i.blueprint.length;a++)o.push(i.blueprint[a])})(d,a),Ld(d,a,a[8])}function Xu(i,o){return i[13]?i[14][4]=o:i[13]=o,i[14]=o,o}function al(i){for(;i;){i[2]|=32;const o=Oo(i);if(Fr(i)&&!o)return i;i=o}return null}function Uh(i){!function jd(i){for(let o=0;o<i.components.length;o++){const a=i.components[o],d=od(a);if(null!==d){const g=d[1];sl(g,d,g.template,a)}}}(i[8])}function mp(i,o,a){tc(0),o(i,a)}const gp=(()=>Promise.resolve(null))();function Wm(i){return i[7]||(i[7]=[])}function Yu(i){return i.cleanup||(i.cleanup=[])}function Xm(i,o){const a=i[9],d=a?a.get(qc,null):null;d&&d.handleError(o)}function Ym(i,o,a,d,g){for(let x=0;x<a.length;){const T=a[x++],P=a[x++],F=o[T],j=i.data[T];null!==j.setInput?j.setInput(F,g,d,P):F[P]=g}}function ll(i,o,a){const d=function B(i,o){return Qr(o[i])}(o,i);!function bc(i,o,a){i.setValue(o,a)}(i[11],d,a)}function Hd(i,o,a){let d=a?i.styles:null,g=a?i.classes:null,x=0;if(null!==o)for(let T=0;T<o.length;T++){const P=o[T];"number"==typeof P?x=P:1==x?g=dn(g,P):2==x&&(d=dn(d,P+": "+o[++T]+";"))}a?i.styles=d:i.stylesWithoutHost=d,a?i.classes=g:i.classesWithoutHost=g}function ul(){const i=yr();Il(_t()[1],i)}let jh=null;function Ac(){if(!jh){const i=Pn.Symbol;if(i&&i.iterator)jh=i.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const d=o[a];"entries"!==d&&"size"!==d&&Map.prototype[d]===Map.prototype.entries&&(jh=d)}}}return jh}function na(i){return!!vp(i)&&(Array.isArray(i)||!(i instanceof Map)&&Ac()in i)}function vp(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function ra(i,o,a){return i[o]=a}function si(i,o,a){return!Object.is(i[o],a)&&(i[o]=a,!0)}function $l(i,o,a,d){const g=si(i,o,a);return si(i,o+1,d)||g}function Gl(i,o,a,d){const g=_t();return si(g,Bs(),o)&&(Kn(),Ca(Or(),g,i,o,a,d)),Gl}function Hl(i,o,a,d,g,x,T,P){const j=function Qu(i,o,a,d,g){const x=$l(i,o,a,d);return si(i,o+2,g)||x}(i,function Zi(){return un.lFrame.bindingIndex}(),a,g,T);return function rs(i){const o=un.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,a}(3),j?o+wt(a)+d+wt(g)+x+wt(T)+P:Gn}function w(i,o,a,d,g,x,T,P){const F=_t(),j=Kn(),Y=i+22,me=j.firstCreatePass?function b(i,o,a,d,g,x,T,P,F){const j=o.consts,Y=no(o,i,4,T||null,yn(j,P));iu(o,a,Y,yn(j,F)),Il(o,Y);const me=Y.tViews=Zu(2,Y,d,g,x,o.directiveRegistry,o.pipeRegistry,null,o.schemas,j);return null!==o.queries&&(o.queries.template(o,Y),me.queries=o.queries.embeddedTView(Y)),Y}(Y,j,F,o,a,d,g,x,T):j.data[Y];Ao(me,!1);const Re=F[11].createComment("");wa(j,F,Re,me),Vi(Re,F),Xu(F,F[Y]=qm(Re,F,Re,me)),Hi(me)&&Od(j,F,me),null!=T&&co(F,me,P)}function R(i){return Je(function Ql(){return un.lFrame.contextLView}(),22+i)}function k(i,o,a){const d=_t();return si(d,Bs(),o)&&function cs(i,o,a,d,g,x,T,P){const F=J(o,a);let Y,j=o.inputs;!P&&null!=j&&(Y=j[d])?(Ym(i,a,Y,d,g),vi(o)&&function nu(i,o){const a=Yt(o,i);16&a[2]||(a[2]|=32)}(a,o.index)):3&o.type&&(d=function l_(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(d),g=null!=T?T(g,o.value||"",d):g,x.setProperty(F,d,g))}(Kn(),Or(),d,i,o,d[11],a,!1),k}function N(i,o,a,d,g){const T=g?"class":"style";Ym(i,a,o.inputs[T],T,d)}function q(i,o,a,d){const g=_t(),x=Kn(),T=22+i,P=g[11],F=g[T]=dd(P,o,function oc(){return un.lFrame.currentNamespace}()),j=x.firstCreatePass?function G(i,o,a,d,g,x,T){const P=o.consts,j=no(o,i,2,g,yn(P,x));return iu(o,a,j,yn(P,T)),null!==j.attrs&&Hd(j,j.attrs,!1),null!==j.mergedAttrs&&Hd(j,j.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,j),j}(T,x,g,0,o,a,d):x.data[T];Ao(j,!0);const Y=j.mergedAttrs;null!==Y&&Gs(P,F,Y);const me=j.classes;null!==me&&Lf(P,F,me);const Re=j.styles;return null!==Re&&Yc(P,F,Re),64!=(64&j.flags)&&wa(x,g,F,j),0===function ys(){return un.lFrame.elementDepthCount}()&&Vi(F,g),function Bi(){un.lFrame.elementDepthCount++}(),Hi(j)&&(Od(x,g,j),function Fd(i,o,a){if(Kr(o)){const g=o.directiveEnd;for(let x=o.directiveStart;x<g;x++){const T=i.data[x];T.contentQueries&&T.contentQueries(1,a[x],x)}}}(x,j,g)),null!==d&&co(g,j),q}function ie(){let i=yr();wl()?function zs(){un.lFrame.isParent=!1}():(i=i.parent,Ao(i,!1));const o=i;!function Oa(){un.lFrame.elementDepthCount--}();const a=Kn();return a.firstCreatePass&&(Il(a,i),Kr(i)&&a.queries.elementEnd(i)),null!=o.classesWithoutHost&&function Al(i){return 0!=(16&i.flags)}(o)&&N(a,o,_t(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Va(i){return 0!=(32&i.flags)}(o)&&N(a,o,_t(),o.stylesWithoutHost,!1),ie}function ue(i,o,a,d){return q(i,o,a,d),ie(),ue}function Fe(){return _t()}function Ze(i){return!!i&&"function"==typeof i.then}function Xe(i){return!!i&&"function"==typeof i.subscribe}const ct=Xe;function yt(i,o,a,d){const g=_t(),x=Kn(),T=yr();return function xt(i,o,a,d,g,x,T,P){const F=Hi(d),Y=i.firstCreatePass&&Yu(i),me=o[8],Re=Wm(o);let He=!0;if(3&d.type||P){const Kt=J(d,o),sn=P?P(Kt):Kt,Sn=Re.length,Dt=P?br=>P(Qr(br[d.index])):d.index;let kn=null;if(!P&&F&&(kn=function it(i,o,a,d){const g=i.cleanup;if(null!=g)for(let x=0;x<g.length-1;x+=2){const T=g[x];if(T===a&&g[x+1]===d){const P=o[7],F=g[x+2];return P.length>F?P[F]:null}"string"==typeof T&&(x+=2)}return null}(i,o,g,d.index)),null!==kn)(kn.__ngLastListenerFn__||kn).__ngNextListenerFn__=x,kn.__ngLastListenerFn__=x,He=!1;else{x=Gt(d,o,me,x,!1);const br=a.listen(sn,g,x);Re.push(x,br),Y&&Y.push(g,Dt,Sn,Sn+1)}}else x=Gt(d,o,me,x,!1);const pt=d.outputs;let Pt;if(He&&null!==pt&&(Pt=pt[g])){const Kt=Pt.length;if(Kt)for(let sn=0;sn<Kt;sn+=2){const Di=o[Pt[sn]][Pt[sn+1]].subscribe(x),Wh=Re.length;Re.push(x,Di),Y&&Y.push(g,d.index,Wh,-(Wh+1))}}}(x,g,g[11],T,i,o,0,d),yt}function bt(i,o,a,d){try{return!1!==a(d)}catch(g){return Xm(i,g),!1}}function Gt(i,o,a,d,g){return function x(T){if(T===Function)return d;al(2&i.flags?Yt(i.index,o):o);let F=bt(o,0,d,T),j=x.__ngNextListenerFn__;for(;j;)F=bt(o,0,j,T)&&F,j=j.__ngNextListenerFn__;return g&&!1===F&&(T.preventDefault(),T.returnValue=!1),F}}function mt(i=1){return function Oc(i){return(un.lFrame.contextLView=function da(i,o){for(;i>0;)o=o[15],i--;return o}(i,un.lFrame.contextLView))[8]}(i)}function Gy(i,o=""){const a=_t(),d=Kn(),g=i+22,x=d.firstCreatePass?no(d,g,1,o,null):d.data[g],T=a[g]=function hd(i,o){return i.createText(o)}(a[11],o);wa(d,a,T,x),Ao(x,!1)}function E_(i){return og("",i,""),E_}function og(i,o,a){const d=_t(),g=function cu(i,o,a,d){return si(i,Bs(),a)?o+wt(a)+d:Gn}(d,i,o,a);return g!==Gn&&ll(d,bi(),g),og}function T_(i,o,a,d,g,x,T){const P=_t(),F=Hl(P,i,o,a,d,g,x,T);return F!==Gn&&ll(P,bi(),F),T_}const Hh=void 0;var kx=["en",[["a","p"],["AM","PM"],Hh],[["AM","PM"],Hh,Hh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Hh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Hh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Hh,"{1} 'at' {0}",Hh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Rx(i){const a=Math.floor(Math.abs(i)),d=i.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let Kd={};function D_(i){const o=function Lx(i){return i.toLowerCase().replace(/_/g,"-")}(i);let a=uv(o);if(a)return a;const d=o.split("-")[0];if(a=uv(d),a)return a;if("en"===d)return kx;throw new gt(701,!1)}function cv(i){return D_(i)[zn.PluralCase]}function uv(i){return i in Kd||(Kd[i]=Pn.ng&&Pn.ng.common&&Pn.ng.common.locales&&Pn.ng.common.locales[i]),Kd[i]}var zn=(()=>((zn=zn||{})[zn.LocaleId=0]="LocaleId",zn[zn.DayPeriodsFormat=1]="DayPeriodsFormat",zn[zn.DayPeriodsStandalone=2]="DayPeriodsStandalone",zn[zn.DaysFormat=3]="DaysFormat",zn[zn.DaysStandalone=4]="DaysStandalone",zn[zn.MonthsFormat=5]="MonthsFormat",zn[zn.MonthsStandalone=6]="MonthsStandalone",zn[zn.Eras=7]="Eras",zn[zn.FirstDayOfWeek=8]="FirstDayOfWeek",zn[zn.WeekendRange=9]="WeekendRange",zn[zn.DateFormat=10]="DateFormat",zn[zn.TimeFormat=11]="TimeFormat",zn[zn.DateTimeFormat=12]="DateTimeFormat",zn[zn.NumberSymbols=13]="NumberSymbols",zn[zn.NumberFormats=14]="NumberFormats",zn[zn.CurrencyCode=15]="CurrencyCode",zn[zn.CurrencySymbol=16]="CurrencySymbol",zn[zn.CurrencyName=17]="CurrencyName",zn[zn.Currencies=18]="Currencies",zn[zn.Directionality=19]="Directionality",zn[zn.PluralCase=20]="PluralCase",zn[zn.ExtraData=21]="ExtraData",zn))();const Qd="en-US";let hv=Qd;class L1{resolveComponentFactory(o){throw function k1(i){const o=Error(`No component factory found for ${dt(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let Sp=(()=>{class i{}return i.NULL=new L1,i})();class Zh{}class Bv{}class Nv{}function O1(){return ef(yr(),_t())}function ef(i,o){return new Mp(J(i,o))}let Mp=(()=>{class i{constructor(a){this.nativeElement=a}}return i.__NG_ELEMENT_ID__=O1,i})();function z1(i){return i instanceof Mp?i.nativeElement:i}class Uv{}let B1=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function N1(){const i=_t(),a=Yt(yr().index,i);return(Pr(a)?a:i)[11]}(),i})(),U1=(()=>{class i{}return i.\u0275prov=Sr({token:i,providedIn:"root",factory:()=>null}),i})();class Vv{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const V1=new Vv("14.0.6"),R_={};function ug(i,o,a,d,g=!1){for(;null!==a;){const x=o[a.index];if(null!==x&&d.push(Qr(x)),Gi(x))for(let P=10;P<x.length;P++){const F=x[P],j=F[1].firstChild;null!==j&&ug(F[1],F,j,d)}const T=a.type;if(8&T)ug(i,o,a.child,d);else if(32&T){const P=Ru(a,o);let F;for(;F=P();)d.push(F)}else if(16&T){const P=fm(o,a);if(Array.isArray(P))d.push(...P);else{const F=Oo(o[16]);ug(F[1],F,P,d,!0)}}a=g?a.projectionNext:a.next}return d}class Ap{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return ug(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(Gi(o)){const a=o[8],d=a?a.indexOf(this):-1;d>-1&&(Df(o,d),It(a,d))}this._attachedToViewContainer=!1}Cf(this._lView[1],this._lView)}onDestroy(o){zd(this._lView[1],this._lView,null,o)}markForCheck(){al(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function $d(i,o,a){const d=o[10];d.begin&&d.begin();try{tu(i,o,i.template,a)}catch(g){throw Xm(o,g),g}finally{d.end&&d.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new gt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function bf(i,o){vh(i,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new gt(902,!1);this._appRef=o}}class j1 extends Ap{constructor(o){super(o),this._view=o}detectChanges(){Uh(this._view)}checkNoChanges(){}get context(){return null}}class k_ extends Sp{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=he(o);return new L_(a,this.ngModule)}}function jv(i){const o=[];for(let a in i)i.hasOwnProperty(a)&&o.push({propName:i[a],templateName:a});return o}class G1{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){const g=this.injector.get(o,R_,d);return g!==R_||a===R_?g:this.parentInjector.get(o,a,d)}}class L_ extends Nv{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function kg(i){return i.map(Bf).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return jv(this.componentDef.inputs)}get outputs(){return jv(this.componentDef.outputs)}create(o,a,d,g){let x=(g=g||this.ngModule)instanceof rl?g:g?.injector;x&&null!==this.componentDef.getStandaloneInjector&&(x=this.componentDef.getStandaloneInjector(x)||x);const T=x?new G1(o,x):o,P=T.get(Uv,null);if(null===P)throw new gt(407,!1);const F=T.get(U1,null),j=P.createRenderer(null,this.componentDef),Y=this.componentDef.selectors[0][0]||"div",me=d?function $m(i,o,a){return i.selectRootElement(o,a===gi.ShadowDom)}(j,d,this.componentDef.encapsulation):dd(P.createRenderer(null,this.componentDef),Y,function $1(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(Y)),Re=this.componentDef.onPush?288:272,He=function Mc(i,o){return{components:[],scheduler:i||el,clean:gp,playerHandler:o||null,flags:0}}(),pt=Zu(0,null,null,1,0,null,null,null,null,null),Pt=bo(null,pt,He,Re,null,null,P,j,F,T,null);let Kt,sn;ha(Pt);try{const Sn=function ta(i,o,a,d,g,x){const T=a[1];a[22]=i;const F=no(T,22,2,"#host",null),j=F.mergedAttrs=o.hostAttrs;null!==j&&(Hd(F,j,!0),null!==i&&(Gs(g,i,j),null!==F.classes&&Lf(g,i,F.classes),null!==F.styles&&Yc(g,i,F.styles)));const Y=d.createRenderer(i,o),me=bo(a,cp(o),null,o.onPush?32:16,a[22],F,d,Y,x||null,null,null);return T.firstCreatePass&&(Zs(Ha(F,a),T,o.type),ou(T,F),hp(F,a.length,1)),Xu(a,me),a[22]=me}(me,this.componentDef,Pt,P,j);if(me)if(d)Gs(j,me,["ng-version",V1.full]);else{const{attrs:Dt,classes:kn}=function Nf(i){const o=[],a=[];let d=1,g=2;for(;d<i.length;){let x=i[d];if("string"==typeof x)2===g?""!==x&&o.push(x,i[++d]):8===g&&a.push(x);else{if(!Js(g))break;g=x}d++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);Dt&&Gs(j,me,Dt),kn&&kn.length>0&&Lf(j,me,kn.join(" "))}if(sn=st(pt,22),void 0!==a){const Dt=sn.projection=[];for(let kn=0;kn<this.ngContentSelectors.length;kn++){const br=a[kn];Dt.push(null!=br?Array.from(br):null)}}Kt=function cl(i,o,a,d,g){const x=a[1],T=function u_(i,o,a){const d=yr();i.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),dp(i,d,o,eu(i,o,1,null),a));const g=Ws(o,i,d.directiveStart,d);Vi(g,o);const x=J(d,o);return x&&Vi(x,o),g}(x,a,o);if(d.components.push(T),i[8]=T,null!==g)for(const F of g)F(T,o);if(o.contentQueries){const F=yr();o.contentQueries(1,T,F.directiveStart)}const P=yr();return!x.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(vs(P.index),qu(a[1],P,0,P.directiveStart,P.directiveEnd,o),Hm(o,T)),T}(Sn,this.componentDef,Pt,He,[ul]),Ld(pt,Pt,null)}finally{Na()}return new Z1(this.componentType,Kt,ef(sn,Pt),Pt,sn)}}class Z1 extends class F1{}{constructor(o,a,d,g,x){super(),this.location=d,this._rootLView=g,this._tNode=x,this.instance=a,this.hostView=this.changeDetectorRef=new j1(g),this.componentType=o}get injector(){return new Ss(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function q1(i,o){return new $v(i,o??null)}class $v extends Zh{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new k_(this);const d=Ue(o);this._bootstrapComponents=xa(d.bootstrap),this._r3Injector=Hf(o,a,[{provide:Zh,useValue:this},{provide:Sp,useValue:this.componentFactoryResolver}],dt(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(o)}get(o,a=Ta.THROW_IF_NOT_FOUND,d=Jt.Default){return o===Ta||o===Zh||o===_d?this:this._r3Injector.get(o,a,d)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class F_ extends Bv{constructor(o){super(),this.moduleType=o}create(o){return new $v(this.moduleType,o)}}class W1 extends Zh{constructor(o,a,d){super(),this.componentFactoryResolver=new k_(this),this.instance=null;const g=new Bu([...o,{provide:Zh,useValue:this},{provide:Sp,useValue:this.componentFactoryResolver}],a||lo(),d,new Set(["environment"]));this.injector=g,g.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function O_(i,o=null,a=null){return new W1(i,o,a).injector}function Yv(i,o,a,d){return function Kv(i,o,a,d,g,x){const T=o+a;return si(i,T,g)?ra(i,T+1,x?d.call(x,g):d(g)):Pp(i,T+1)}(_t(),Ni(),i,o,a,d)}function Pp(i,o){const a=i[o];return a===Gn?void 0:a}function n0(i,o){const a=Kn();let d;const g=i+22;a.firstCreatePass?(d=function pb(i,o){if(o)for(let a=o.length-1;a>=0;a--){const d=o[a];if(i===d.name)return d}}(o,a.pipeRegistry),a.data[g]=d,d.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(g,d.onDestroy)):d=a.data[g];const x=d.factory||(d.factory=Ho(d.type)),T=an(ju);try{const P=Is(!1),F=x();return Is(P),function S(i,o,a,d){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),o[a]=d}(a,_t(),g,F),F}finally{an(T)}}function r0(i,o,a,d){const g=i+22,x=_t(),T=Je(x,g);return function Rp(i,o){return i[1].data[o].pure}(x,g)?function Qv(i,o,a,d,g,x,T){const P=o+a;return $l(i,P,g,x)?ra(i,P+2,T?d.call(T,g,x):d(g,x)):Pp(i,P+2)}(x,Ni(),o,T.transform,a,d,T):T.transform(a,d)}function B_(i){return o=>{setTimeout(i,void 0,o)}}const Pc=class vb extends jt.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let g=o,x=a||(()=>null),T=d;if(o&&"object"==typeof o){const F=o;g=F.next?.bind(F),x=F.error?.bind(F),T=F.complete?.bind(F)}this.__isAsync&&(x=B_(x),g&&(g=B_(g)),T&&(T=B_(T)));const P=super.subscribe({next:g,error:x,complete:T});return o instanceof nt.w0&&o.add(P),P}};function xb(){return this._results[Ac()]()}class N_{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=Ac(),d=N_.prototype;d[a]||(d[a]=xb)}get changes(){return this._changes||(this._changes=new Pc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const g=pe(o);(this._changesDetected=!function X(i,o,a){if(i.length!==o.length)return!1;for(let d=0;d<i.length;d++){let g=i[d],x=o[d];if(a&&(g=a(g),x=a(x)),x!==g)return!1}return!0}(d._results,g,a))&&(d._results=g,d.length=g.length,d.last=g[this.length-1],d.first=g[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let kp=(()=>{class i{}return i.__NG_ELEMENT_ID__=Eb,i})();const bb=kp,wb=class extends bb{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}createEmbeddedView(o,a){const d=this._declarationTContainer.tViews,g=bo(this._declarationLView,d,o,16,null,d.declTNode,null,null,null,null,a||null);g[17]=this._declarationLView[this._declarationTContainer.index];const T=this._declarationLView[19];return null!==T&&(g[19]=T.createEmbeddedView(d)),Ld(d,g,o),new Ap(g)}};function Eb(){return hg(yr(),_t())}function hg(i,o){return 4&i.type?new wb(o,i,ef(i,o)):null}let dg=(()=>{class i{}return i.__NG_ELEMENT_ID__=Tb,i})();function Tb(){return a0(yr(),_t())}const Db=dg,o0=class extends Db{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return ef(this._hostTNode,this._hostLView)}get injector(){return new Ss(this._hostTNode,this._hostLView)}get parentInjector(){const o=ma(this._hostTNode,this._hostLView);if($a(o)){const a=Cs(o,this._hostLView),d=Ts(o);return new Ss(a[1].data[d+8],a)}return new Ss(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=s0(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,d){let g,x;"number"==typeof d?g=d:null!=d&&(g=d.index,x=d.injector);const T=o.createEmbeddedView(a||{},x);return this.insert(T,g),T}createComponent(o,a,d,g,x){const T=o&&!function L(i){return"function"==typeof i}(o);let P;if(T)P=a;else{const me=a||{};P=me.index,d=me.injector,g=me.projectableNodes,x=me.environmentInjector||me.ngModuleRef}const F=T?o:new L_(he(o)),j=d||this.parentInjector;if(!x&&null==F.ngModule){const Re=(T?j:this.parentInjector).get(rl,null);Re&&(x=Re)}const Y=F.create(j,g,void 0,x);return this.insert(Y.hostView,P),Y}insert(o,a){const d=o._lView,g=d[1];if(function wr(i){return Gi(i[3])}(d)){const Y=this.indexOf(o);if(-1!==Y)this.detach(Y);else{const me=d[3],Re=new o0(me,me[6],me[3]);Re.detach(Re.indexOf(o))}}const x=this._adjustIndex(a),T=this._lContainer;!function Ef(i,o,a,d){const g=10+d,x=a.length;d>0&&(a[g-1][4]=o),d<x-10?(o[4]=a[g],Ye(a,10+d,o)):(a.push(o),o[4]=null),o[3]=a;const T=o[17];null!==T&&a!==T&&function Rs(i,o){const a=i[9];o[16]!==o[3][3][16]&&(i[2]=!0),null===a?i[9]=[o]:a.push(o)}(T,o);const P=o[19];null!==P&&P.insertView(i),o[2]|=64}(g,d,T,x);const P=Pf(x,T),F=d[11],j=fd(F,T[7]);return null!==j&&function lm(i,o,a,d,g,x){d[0]=g,d[6]=o,vh(i,d,a,1,g,x)}(g,T[6],F,d,j,P),o.attachToViewContainerRef(),Ye(U_(T),x,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=s0(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=Df(this._lContainer,a);d&&(It(U_(this._lContainer),a),Cf(d[1],d))}detach(o){const a=this._adjustIndex(o,-1),d=Df(this._lContainer,a);return d&&null!=It(U_(this._lContainer),a)?new Ap(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function s0(i){return i[8]}function U_(i){return i[8]||(i[8]=[])}function a0(i,o){let a;const d=o[i.index];if(Gi(d))a=d;else{let g;if(8&i.type)g=Qr(d);else{const x=o[11];g=x.createComment("");const T=J(i,o);Nl(x,fd(x,T),g,function Mg(i,o){return i.nextSibling(o)}(x,T),!1)}o[i.index]=a=qm(d,o,g,i),Xu(o,a)}return new o0(a,i,o)}class V_{constructor(o){this.queryList=o,this.matches=null}clone(){return new V_(this.queryList)}setDirty(){this.queryList.setDirty()}}class j_{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,g=[];for(let x=0;x<d;x++){const T=a.getByIndex(x);g.push(this.queries[T.indexInDeclarationView].clone())}return new j_(g)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==g0(o,a).matches&&this.queries[a].setDirty()}}class l0{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class $_{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const g=null!==a?a.length:0,x=this.getByIndex(d).embeddedTView(o,g);x&&(x.indexInDeclarationView=d,null!==a?a.push(x):a=[x])}return null!==a?new $_(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class G_{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new G_(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let g=0;g<d.length;g++){const x=d[g];this.matchTNodeWithReadOption(o,a,Sb(a,x)),this.matchTNodeWithReadOption(o,a,ga(a,o,x,!1,!1))}else d===kp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,ga(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const g=this.metadata.read;if(null!==g)if(g===Mp||g===dg||g===kp&&4&a.type)this.addMatch(a.index,-2);else{const x=ga(a,o,g,!1,!1);null!==x&&this.addMatch(a.index,x)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function Sb(i,o){const a=i.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function Ab(i,o,a,d){return-1===a?function Mb(i,o){return 11&i.type?ef(i,o):4&i.type?hg(i,o):null}(o,i):-2===a?function Pb(i,o,a){return a===Mp?ef(o,i):a===kp?hg(o,i):a===dg?a0(o,i):void 0}(i,o,d):Ws(i,i[1],a,o)}function c0(i,o,a,d){const g=o[19].queries[d];if(null===g.matches){const x=i.data,T=a.matches,P=[];for(let F=0;F<T.length;F+=2){const j=T[F];P.push(j<0?null:Ab(o,x[j],T[F+1],a.metadata.read))}g.matches=P}return g.matches}function H_(i,o,a,d){const g=i.queries.getByIndex(a),x=g.matches;if(null!==x){const T=c0(i,o,g,a);for(let P=0;P<x.length;P+=2){const F=x[P];if(F>0)d.push(T[P/2]);else{const j=x[P+1],Y=o[-F];for(let me=10;me<Y.length;me++){const Re=Y[me];Re[17]===Re[3]&&H_(Re[1],Re,j,d)}if(null!==Y[9]){const me=Y[9];for(let Re=0;Re<me.length;Re++){const He=me[Re];H_(He[1],He,j,d)}}}}}return d}function u0(i){const o=_t(),a=Kn(),d=Us();tc(d+1);const g=g0(a,d);if(i.dirty&&lr(o)===(2==(2&g.metadata.flags))){if(null===g.matches)i.reset([]);else{const x=g.crossesNgTemplate?H_(a,o,d,[]):c0(a,o,g,d);i.reset(x,z1),i.notifyOnChanges()}return!0}return!1}function h0(i,o,a){const d=Kn();d.firstCreatePass&&(m0(d,new l0(i,o,a),-1),2==(2&o)&&(d.staticViewQueries=!0)),p0(d,_t(),o)}function d0(i,o,a,d){const g=Kn();if(g.firstCreatePass){const x=yr();m0(g,new l0(o,a,d),x.index),function kb(i,o){const a=i.contentQueries||(i.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(i.queries.length-1,o)}(g,i),2==(2&a)&&(g.staticContentQueries=!0)}p0(g,_t(),a)}function f0(){return function Rb(i,o){return i[19].queries[o].queryList}(_t(),Us())}function p0(i,o,a){const d=new N_(4==(4&a));zd(i,o,d,d.destroy),null===o[19]&&(o[19]=new j_),o[19].queries.push(new V_(d))}function m0(i,o,a){null===i.queries&&(i.queries=new $_),i.queries.track(new G_(o,a))}function g0(i,o){return i.queries.getByIndex(o)}function nf(i){const o=he(i)||se(i)||Me(i);return null!==o&&o.standalone}function pg(...i){}const F0=new Er("Application Initializer");let mg=(()=>{class i{constructor(a){this.appInits=a,this.resolve=pg,this.reject=pg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,g)=>{this.resolve=d,this.reject=g})}runInitializers(){if(this.initialized)return;const a=[],d=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const x=this.appInits[g]();if(Ze(x))a.push(x);else if(ct(x)){const T=new Promise((P,F)=>{x.subscribe({complete:P,error:F})});a.push(T)}}Promise.all(a).then(()=>{d()}).catch(g=>{this.reject(g)}),0===a.length&&d(),this.initialized=!0}}return i.\u0275fac=function(a){return new(a||i)(fe(F0,8))},i.\u0275prov=Sr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const O0=new Er("AppId",{providedIn:"root",factory:function z0(){return`${Y_()}${Y_()}${Y_()}`}});function Y_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const B0=new Er("Platform Initializer"),ew=new Er("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),N0=new Er("appBootstrapListener");let tw=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Sr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const gg=new Er("LocaleId",{providedIn:"root",factory:()=>Ge(gg,Jt.Optional|Jt.SkipSelf)||function nw(){return typeof $localize<"u"&&$localize.locale||Qd}()}),rw=new Er("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class iw{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let ow=(()=>{class i{compileModuleSync(a){return new F_(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const d=this.compileModuleSync(a),x=xa(Ue(a).declarations).reduce((T,P)=>{const F=he(P);return F&&T.push(new L_(F)),T},[]);return new iw(d,x)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Sr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const lw=(()=>Promise.resolve(0))();function K_(i){typeof Zone>"u"?lw.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Ma{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pc(!1),this.onMicrotaskEmpty=new Pc(!1),this.onStable=new Pc(!1),this.onError=new Pc(!1),typeof Zone>"u")throw new gt(908,!1);Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!d&&a,g.shouldCoalesceRunChangeDetection=d,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function cw(){let i=Pn.requestAnimationFrame,o=Pn.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a);const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function dw(i){const o=()=>{!function hw(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(Pn,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,J_(i),i.isCheckStableRunning=!0,Q_(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),J_(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,g,x,T,P)=>{try{return j0(i),a.invokeTask(g,x,T,P)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===x.type||i.shouldCoalesceRunChangeDetection)&&o(),$0(i)}},onInvoke:(a,d,g,x,T,P,F)=>{try{return j0(i),a.invoke(g,x,T,P,F)}finally{i.shouldCoalesceRunChangeDetection&&o(),$0(i)}},onHasTask:(a,d,g,x)=>{a.hasTask(g,x),d===g&&("microTask"==x.change?(i._hasPendingMicrotasks=x.microTask,J_(i),Q_(i)):"macroTask"==x.change&&(i.hasPendingMacrotasks=x.macroTask))},onHandleError:(a,d,g,x)=>(a.handleError(g,x),i.runOutsideAngular(()=>i.onError.emit(x)),!1)})}(g)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ma.isInAngularZone())throw new gt(909,!1)}static assertNotInAngularZone(){if(Ma.isInAngularZone())throw new gt(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,g){const x=this._inner,T=x.scheduleEventTask("NgZoneEvent: "+g,o,uw,pg,pg);try{return x.runTask(T,a,d)}finally{x.cancelTask(T)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const uw={};function Q_(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function J_(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function j0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function $0(i){i._nesting--,Q_(i)}class fw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Pc,this.onMicrotaskEmpty=new Pc,this.onStable=new Pc,this.onError=new Pc}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,g){return o.apply(a,d)}}const G0=new Er(""),H0=new Er("");let ey,pw=(()=>{class i{constructor(a,d,g){this._ngZone=a,this.registry=d,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ey||(function mw(i){ey=i}(g),g.addToWindow(d)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ma.assertNotInAngularZone(),K_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())K_(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(d=>!d.updateCb||!d.updateCb(a)||(clearTimeout(d.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,d,g){let x=-1;d&&d>0&&(x=setTimeout(()=>{this._callbacks=this._callbacks.filter(T=>T.timeoutId!==x),a(this._didWork,this.getPendingTasks())},d)),this._callbacks.push({doneCb:a,timeoutId:x,updateCb:g})}whenStable(a,d,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,d,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,d,g){return[]}}return i.\u0275fac=function(a){return new(a||i)(fe(Ma),fe(Z0),fe(H0))},i.\u0275prov=Sr({token:i,factory:i.\u0275fac}),i})(),Z0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(a,d){this._applications.set(a,d)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,d=!0){return ey?.findTestabilityInTree(this,a,d)??null}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Sr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})(),nh=null;const q0=new Er("AllowMultipleToken"),ty=new Er("PlatformDestroyListeners");class yw{constructor(o,a){this.name=o,this.token=a}}function X0(i,o,a=[]){const d=`Platform: ${o}`,g=new Er(d);return(x=[])=>{let T=ny();if(!T||T.injector.get(q0,!1)){const P=[...a,...x,{provide:g,useValue:!0}];i?i(P):function vw(i){if(nh&&!nh.get(q0,!1))throw new gt(400,!1);nh=i;const o=i.get(K0);(function W0(i){const o=i.get(B0,null);o&&o.forEach(a=>a())})(i)}(function Y0(i=[],o){return Ta.create({name:o,providers:[{provide:Gf,useValue:"platform"},{provide:ty,useValue:new Set([()=>nh=null])},...i]})}(P,d))}return function bw(i){const o=ny();if(!o)throw new gt(401,!1);return o}()}}function ny(){return nh?.get(K0)??null}let K0=(()=>{class i{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,d){const g=function ww(i,o){let a;return a="noop"===i?new fw:("zone.js"===i?void 0:i)||new Ma(o),a}(d?.ngZone,function Q0(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(d)),x=[{provide:Ma,useValue:g}];return g.run(()=>{const T=Ta.create({providers:x,parent:this.injector,name:a.moduleType.name}),P=a.create(T),F=P.injector.get(qc,null);if(!F)throw new gt(402,!1);return g.runOutsideAngular(()=>{const j=g.onError.subscribe({next:Y=>{F.handleError(Y)}});P.onDestroy(()=>{yg(this._modules,P),j.unsubscribe()})}),function J0(i,o,a){try{const d=a();return Ze(d)?d.catch(g=>{throw o.runOutsideAngular(()=>i.handleError(g)),g}):d}catch(d){throw o.runOutsideAngular(()=>i.handleError(d)),d}}(F,g,()=>{const j=P.injector.get(mg);return j.runInitializers(),j.donePromise.then(()=>(function dv(i){dr(i,"Expected localeId to be defined"),"string"==typeof i&&(hv=i.toLowerCase().replace(/_/g,"-"))}(P.injector.get(gg,Qd)||Qd),this._moduleDoBootstrap(P),P))})})}bootstrapModule(a,d=[]){const g=ex({},d);return function gw(i,o,a){const d=new F_(a);return Promise.resolve(d)}(0,0,a).then(x=>this.bootstrapModuleFactory(x,g))}_moduleDoBootstrap(a){const d=a.injector.get(_g);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(g=>d.bootstrap(g));else{if(!a.instance.ngDoBootstrap)throw new gt(403,!1);a.instance.ngDoBootstrap(d)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new gt(404,!1);this._modules.slice().forEach(d=>d.destroy()),this._destroyListeners.forEach(d=>d());const a=this._injector.get(ty,null);a&&(a.forEach(d=>d()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(a){return new(a||i)(fe(Ta))},i.\u0275prov=Sr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function ex(i,o){return Array.isArray(o)?o.reduce(ex,i):{...i,...o}}let _g=(()=>{class i{constructor(a,d,g){this._zone=a,this._injector=d,this._exceptionHandler=g,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const x=new Mt.y(P=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{P.next(this._stable),P.complete()})}),T=new Mt.y(P=>{let F;this._zone.runOutsideAngular(()=>{F=this._zone.onStable.subscribe(()=>{Ma.assertNotInAngularZone(),K_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,P.next(!0))})})});const j=this._zone.onUnstable.subscribe(()=>{Ma.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{P.next(!1)}))});return()=>{F.unsubscribe(),j.unsubscribe()}});this.isStable=function hn(...i){const o=(0,u.yG)(i),a=(0,u._6)(i,1/0),d=i;return d.length?1===d.length?(0,re.Xf)(d[0]):(0,ge.J)(a)((0,Ae.D)(d,o)):Wt.E}(x,T.pipe(function Tt(i={}){const{connector:o=(()=>new jt.x),resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:g=!0}=i;return x=>{let T,P,F,j=0,Y=!1,me=!1;const Re=()=>{P?.unsubscribe(),P=void 0},He=()=>{Re(),T=F=void 0,Y=me=!1},pt=()=>{const Pt=T;He(),Pt?.unsubscribe()};return(0,ft.e)((Pt,Kt)=>{j++,!me&&!Y&&Re();const sn=F=F??o();Kt.add(()=>{j--,0===j&&!me&&!Y&&(P=wn(pt,g))}),sn.subscribe(Kt),!T&&j>0&&(T=new Ct.Hp({next:Sn=>sn.next(Sn),error:Sn=>{me=!0,Re(),P=wn(He,a,Sn),sn.error(Sn)},complete:()=>{Y=!0,Re(),P=wn(He,d),sn.complete()}}),(0,re.Xf)(Pt).subscribe(T))})(x)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(a,d){const g=a instanceof Nv;if(!this._injector.get(mg).done)throw!g&&nf(a),new gt(405,false);let T;T=g?a:this._injector.get(Sp).resolveComponentFactory(a),this.componentTypes.push(T.componentType);const P=function _w(i){return i.isBoundToModule}(T)?void 0:this._injector.get(Zh),j=T.create(Ta.NULL,[],d||T.selector,P),Y=j.location.nativeElement,me=j.injector.get(G0,null);return me?.registerApplication(Y),j.onDestroy(()=>{this.detachView(j.hostView),yg(this.components,j),me?.unregisterApplication(Y)}),this._loadComponent(j),j}tick(){if(this._runningTick)throw new gt(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){const d=a;yg(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(N0,[]).concat(this._bootstrapListeners).forEach(g=>g(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>yg(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new gt(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(a){return new(a||i)(fe(Ma),fe(Ta),fe(qc))},i.\u0275prov=Sr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function yg(i,o){const a=i.indexOf(o);a>-1&&i.splice(a,1)}let nx=!0;function Tw(){nx=!1}let Dw=(()=>{class i{}return i.__NG_ELEMENT_ID__=Cw,i})();function Cw(i){return function Iw(i,o,a){if(vi(i)&&!a){const d=Yt(i.index,o);return new Ap(d,d)}return 47&i.type?new Ap(o[16],o):null}(yr(),_t(),16==(16&i))}class ax{constructor(){}supports(o){return na(o)}create(o){return new kw(o)}}const Rw=(i,o)=>o;class kw{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Rw}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,g=0,x=null;for(;a||d;){const T=!d||a&&a.currentIndex<cx(d,g,x)?a:d,P=cx(T,g,x),F=T.currentIndex;if(T===d)g--,d=d._nextRemoved;else if(a=a._next,null==T.previousIndex)g++;else{x||(x=[]);const j=P-g,Y=F-g;if(j!=Y){for(let Re=0;Re<j;Re++){const He=Re<x.length?x[Re]:x[Re]=0,pt=He+Re;Y<=pt&&pt<j&&(x[Re]=He+1)}x[T.previousIndex]=Y-j}}P!==F&&o(T,P,F)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!na(o))throw new gt(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let g,x,T,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let P=0;P<this.length;P++)x=o[P],T=this._trackByFn(P,x),null!==a&&Object.is(a.trackById,T)?(d&&(a=this._verifyReinsertion(a,x,T,P)),Object.is(a.item,x)||this._addIdentityChange(a,x)):(a=this._mismatch(a,x,T,P),d=!0),a=a._next}else g=0,function qd(i,o){if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else{const a=i[Ac()]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,P=>{T=this._trackByFn(g,P),null!==a&&Object.is(a.trackById,T)?(d&&(a=this._verifyReinsertion(a,P,T,g)),Object.is(a.item,P)||this._addIdentityChange(a,P)):(a=this._mismatch(a,P,T,g),d=!0),a=a._next,g++}),this.length=g;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,g){let x;return null===o?x=this._itTail:(x=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,x,g)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,g))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,x,g)):o=this._addAfter(new Lw(a,d),x,g),o}_verifyReinsertion(o,a,d,g){let x=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==x?o=this._reinsertAfter(x,o._prev,g):o.currentIndex!=g&&(o.currentIndex=g,this._addToMoves(o,g)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const g=o._prevRemoved,x=o._nextRemoved;return null===g?this._removalsHead=x:g._nextRemoved=x,null===x?this._removalsTail=g:x._prevRemoved=g,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const g=null===a?this._itHead:a._next;return o._next=g,o._prev=a,null===g?this._itTail=o:g._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new lx),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new lx),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Lw{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Fw{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class lx{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new Fw,this.map.set(a,d)),d.add(o)}get(o,a){const g=this.map.get(o);return g?g.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function cx(i,o,a){const d=i.previousIndex;if(null===d)return d;let g=0;return a&&d<a.length&&(g=a[d]),d+o+g}class ux{constructor(){}supports(o){return o instanceof Map||vp(o)}create(){return new Ow}}class Ow{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||vp(o)))throw new gt(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,g)=>{if(a&&a.key===g)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const x=this._getOrCreateRecordForKey(g,d);a=this._insertBeforeOrAppend(a,x)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const g=this._records.get(o);this._maybeAddToChanges(g,a);const x=g._prev,T=g._next;return x&&(x._next=T),T&&(T._prev=x),g._next=null,g._prev=null,g}const d=new zw(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class zw{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function hx(){return new ay([new ax])}let ay=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(null!=d){const g=d.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||hx()),deps:[[i,new rn,new kt]]}}find(a){const d=this.factories.find(g=>g.supports(a));if(null!=d)return d;throw new gt(901,!1)}}return i.\u0275prov=Sr({token:i,providedIn:"root",factory:hx}),i})();function dx(){return new ly([new ux])}let ly=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(d){const g=d.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||dx()),deps:[[i,new rn,new kt]]}}find(a){const d=this.factories.find(g=>g.supports(a));if(d)return d;throw new gt(901,!1)}}return i.\u0275prov=Sr({token:i,providedIn:"root",factory:dx}),i})();const Uw=X0(null,"core",[]);let Vw=(()=>{class i{constructor(a){}}return i.\u0275fac=function(a){return new(a||i)(fe(_g))},i.\u0275mod=Ie({type:i}),i.\u0275inj=ci({}),i})();function jw(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},481:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{Dx:()=>ui,b2:()=>$i,q6:()=>Vn});var ge=Be(895),re=Be(256);class Wt extends ge.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends Wt{static makeCurrent(){(0,ge.HT)(new u)}onAndCancel(he,se,Me){return he.addEventListener(se,Me,!1),()=>{he.removeEventListener(se,Me,!1)}}dispatchEvent(he,se){he.dispatchEvent(se)}remove(he){he.parentNode&&he.parentNode.removeChild(he)}createElement(he,se){return(se=se||this.getDefaultDocument()).createElement(he)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(he){return he.nodeType===Node.ELEMENT_NODE}isShadowRoot(he){return he instanceof DocumentFragment}getGlobalEventTarget(he,se){return"window"===se?window:"document"===se?he:"body"===se?he.body:null}getBaseHref(he){const se=function hn(){return Ae=Ae||document.querySelector("base"),Ae?Ae.getAttribute("href"):null}();return null==se?null:function nt(ve){jt=jt||document.createElement("a"),jt.setAttribute("href",ve);const he=jt.pathname;return"/"===he.charAt(0)?he:`/${he}`}(se)}resetBaseElement(){Ae=null}getUserAgent(){return window.navigator.userAgent}getCookie(he){return(0,ge.Mx)(document.cookie,he)}}let jt,Ae=null;const Mt=new re.OlP("TRANSITION_ID"),ft=[{provide:re.ip1,useFactory:function Ct(ve,he,se){return()=>{se.get(re.CZH).donePromise.then(()=>{const Me=(0,ge.q)(),Ue=he.querySelectorAll(`style[ng-transition="${ve}"]`);for(let Et=0;Et<Ue.length;Et++)Me.remove(Ue[Et])})}},deps:[Mt,ge.K0,re.zs3],multi:!0}];let wn=(()=>{class ve{build(){return new XMLHttpRequest}}return ve.\u0275fac=function(se){return new(se||ve)},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})();const ut=new re.OlP("EventManagerPlugins");let bn=(()=>{class ve{constructor(se,Me){this._zone=Me,this._eventNameToPlugin=new Map,se.forEach(Ue=>Ue.manager=this),this._plugins=se.slice().reverse()}addEventListener(se,Me,Ue){return this._findPluginFor(Me).addEventListener(se,Me,Ue)}addGlobalEventListener(se,Me,Ue){return this._findPluginFor(Me).addGlobalEventListener(se,Me,Ue)}getZone(){return this._zone}_findPluginFor(se){const Me=this._eventNameToPlugin.get(se);if(Me)return Me;const Ue=this._plugins;for(let Et=0;Et<Ue.length;Et++){const rt=Ue[Et];if(rt.supports(se))return this._eventNameToPlugin.set(se,rt),rt}throw new Error(`No event manager plugin found for event ${se}`)}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(ut),re.LFG(re.R0b))},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})();class dt{constructor(he){this._doc=he}addGlobalEventListener(he,se,Me){const Ue=(0,ge.q)().getGlobalEventTarget(this._doc,he);if(!Ue)throw new Error(`Unsupported event target ${Ue} for event ${se}`);return this.addEventListener(Ue,se,Me)}}let dn=(()=>{class ve{constructor(){this._stylesSet=new Set}addStyles(se){const Me=new Set;se.forEach(Ue=>{this._stylesSet.has(Ue)||(this._stylesSet.add(Ue),Me.add(Ue))}),this.onStylesAdded(Me)}onStylesAdded(se){}getAllStyles(){return Array.from(this._stylesSet)}}return ve.\u0275fac=function(se){return new(se||ve)},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})(),Xt=(()=>{class ve extends dn{constructor(se){super(),this._doc=se,this._hostNodes=new Map,this._hostNodes.set(se.head,[])}_addStylesToHost(se,Me,Ue){se.forEach(Et=>{const rt=this._doc.createElement("style");rt.textContent=Et,Ue.push(Me.appendChild(rt))})}addHost(se){const Me=[];this._addStylesToHost(this._stylesSet,se,Me),this._hostNodes.set(se,Me)}removeHost(se){const Me=this._hostNodes.get(se);Me&&Me.forEach(Hn),this._hostNodes.delete(se)}onStylesAdded(se){this._hostNodes.forEach((Me,Ue)=>{this._addStylesToHost(se,Ue,Me)})}ngOnDestroy(){this._hostNodes.forEach(se=>se.forEach(Hn))}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(ge.K0))},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})();function Hn(ve){(0,ge.q)().remove(ve)}const Zt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Bt=/%COMP%/g;function qe(ve,he,se){for(let Me=0;Me<he.length;Me++){let Ue=he[Me];Array.isArray(Ue)?qe(ve,Ue,se):(Ue=Ue.replace(Bt,ve),se.push(Ue))}return se}function Ke(ve){return he=>{if("__ngUnwrap__"===he)return ve;!1===ve(he)&&(he.preventDefault(),he.returnValue=!1)}}let ot=(()=>{class ve{constructor(se,Me,Ue){this.eventManager=se,this.sharedStylesHost=Me,this.appId=Ue,this.rendererByCompId=new Map,this.defaultRenderer=new at(se)}createRenderer(se,Me){if(!se||!Me)return this.defaultRenderer;switch(Me.encapsulation){case re.ifc.Emulated:{let Ue=this.rendererByCompId.get(Me.id);return Ue||(Ue=new Zn(this.eventManager,this.sharedStylesHost,Me,this.appId),this.rendererByCompId.set(Me.id,Ue)),Ue.applyToHost(se),Ue}case 1:case re.ifc.ShadowDom:return new Dn(this.eventManager,this.sharedStylesHost,se,Me);default:if(!this.rendererByCompId.has(Me.id)){const Ue=qe(Me.id,Me.styles,[]);this.sharedStylesHost.addStyles(Ue),this.rendererByCompId.set(Me.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(bn),re.LFG(Xt),re.LFG(re.AFp))},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})();class at{constructor(he){this.eventManager=he,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(he,se){return se?document.createElementNS(Zt[se]||se,he):document.createElement(he)}createComment(he){return document.createComment(he)}createText(he){return document.createTextNode(he)}appendChild(he,se){(fn(he)?he.content:he).appendChild(se)}insertBefore(he,se,Me){he&&(fn(he)?he.content:he).insertBefore(se,Me)}removeChild(he,se){he&&he.removeChild(se)}selectRootElement(he,se){let Me="string"==typeof he?document.querySelector(he):he;if(!Me)throw new Error(`The selector "${he}" did not match any elements`);return se||(Me.textContent=""),Me}parentNode(he){return he.parentNode}nextSibling(he){return he.nextSibling}setAttribute(he,se,Me,Ue){if(Ue){se=Ue+":"+se;const Et=Zt[Ue];Et?he.setAttributeNS(Et,se,Me):he.setAttribute(se,Me)}else he.setAttribute(se,Me)}removeAttribute(he,se,Me){if(Me){const Ue=Zt[Me];Ue?he.removeAttributeNS(Ue,se):he.removeAttribute(`${Me}:${se}`)}else he.removeAttribute(se)}addClass(he,se){he.classList.add(se)}removeClass(he,se){he.classList.remove(se)}setStyle(he,se,Me,Ue){Ue&(re.JOm.DashCase|re.JOm.Important)?he.style.setProperty(se,Me,Ue&re.JOm.Important?"important":""):he.style[se]=Me}removeStyle(he,se,Me){Me&re.JOm.DashCase?he.style.removeProperty(se):he.style[se]=""}setProperty(he,se,Me){he[se]=Me}setValue(he,se){he.nodeValue=se}listen(he,se,Me){return"string"==typeof he?this.eventManager.addGlobalEventListener(he,se,Ke(Me)):this.eventManager.addEventListener(he,se,Ke(Me))}}function fn(ve){return"TEMPLATE"===ve.tagName&&void 0!==ve.content}class Zn extends at{constructor(he,se,Me,Ue){super(he),this.component=Me;const Et=qe(Ue+"-"+Me.id,Me.styles,[]);se.addStyles(Et),this.contentAttr=function Ft(ve){return"_ngcontent-%COMP%".replace(Bt,ve)}(Ue+"-"+Me.id),this.hostAttr=function Mn(ve){return"_nghost-%COMP%".replace(Bt,ve)}(Ue+"-"+Me.id)}applyToHost(he){super.setAttribute(he,this.hostAttr,"")}createElement(he,se){const Me=super.createElement(he,se);return super.setAttribute(Me,this.contentAttr,""),Me}}class Dn extends at{constructor(he,se,Me,Ue){super(he),this.sharedStylesHost=se,this.hostEl=Me,this.shadowRoot=Me.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Et=qe(Ue.id,Ue.styles,[]);for(let rt=0;rt<Et.length;rt++){const $t=document.createElement("style");$t.textContent=Et[rt],this.shadowRoot.appendChild($t)}}nodeOrShadowRoot(he){return he===this.hostEl?this.shadowRoot:he}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(he,se){return super.appendChild(this.nodeOrShadowRoot(he),se)}insertBefore(he,se,Me){return super.insertBefore(this.nodeOrShadowRoot(he),se,Me)}removeChild(he,se){return super.removeChild(this.nodeOrShadowRoot(he),se)}parentNode(he){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(he)))}}let _r=(()=>{class ve extends dt{constructor(se){super(se)}supports(se){return!0}addEventListener(se,Me,Ue){return se.addEventListener(Me,Ue,!1),()=>this.removeEventListener(se,Me,Ue)}removeEventListener(se,Me,Ue){return se.removeEventListener(Me,Ue)}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(ge.K0))},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})();const jr=["alt","control","meta","shift"],Yr={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ri={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},ki={alt:ve=>ve.altKey,control:ve=>ve.ctrlKey,meta:ve=>ve.metaKey,shift:ve=>ve.shiftKey};let dr=(()=>{class ve extends dt{constructor(se){super(se)}supports(se){return null!=ve.parseEventName(se)}addEventListener(se,Me,Ue){const Et=ve.parseEventName(Me),rt=ve.eventCallback(Et.fullKey,Ue,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,ge.q)().onAndCancel(se,Et.domEventName,rt))}static parseEventName(se){const Me=se.toLowerCase().split("."),Ue=Me.shift();if(0===Me.length||"keydown"!==Ue&&"keyup"!==Ue)return null;const Et=ve._normalizeKey(Me.pop());let rt="";if(jr.forEach(nn=>{const ke=Me.indexOf(nn);ke>-1&&(Me.splice(ke,1),rt+=nn+".")}),rt+=Et,0!=Me.length||0===Et.length)return null;const $t={};return $t.domEventName=Ue,$t.fullKey=rt,$t}static getEventFullKey(se){let Me="",Ue=function An(ve){let he=ve.key;if(null==he){if(he=ve.keyIdentifier,null==he)return"Unidentified";he.startsWith("U+")&&(he=String.fromCharCode(parseInt(he.substring(2),16)),3===ve.location&&Ri.hasOwnProperty(he)&&(he=Ri[he]))}return Yr[he]||he}(se);return Ue=Ue.toLowerCase()," "===Ue?Ue="space":"."===Ue&&(Ue="dot"),jr.forEach(Et=>{Et!=Ue&&ki[Et](se)&&(Me+=Et+".")}),Me+=Ue,Me}static eventCallback(se,Me,Ue){return Et=>{ve.getEventFullKey(Et)===se&&Ue.runGuarded(()=>Me(Et))}}static _normalizeKey(se){return"esc"===se?"escape":se}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(ge.K0))},ve.\u0275prov=re.Yz7({token:ve,factory:ve.\u0275fac}),ve})();const Vn=(0,re.eFA)(re._c5,"browser",[{provide:re.Lbi,useValue:ge.bD},{provide:re.g9A,useValue:function Sr(){u.makeCurrent()},multi:!0},{provide:ge.K0,useFactory:function ci(){return(0,re.RDi)(document),document},deps:[]}]),Ci=new re.OlP(""),Yn=[{provide:re.rWj,useClass:class Tt{addToWindow(he){re.dqk.getAngularTestability=(Me,Ue=!0)=>{const Et=he.findTestabilityInTree(Me,Ue);if(null==Et)throw new Error("Could not find testability for element.");return Et},re.dqk.getAllAngularTestabilities=()=>he.getAllTestabilities(),re.dqk.getAllAngularRootElements=()=>he.getAllRootElements(),re.dqk.frameworkStabilizers||(re.dqk.frameworkStabilizers=[]),re.dqk.frameworkStabilizers.push(Me=>{const Ue=re.dqk.getAllAngularTestabilities();let Et=Ue.length,rt=!1;const $t=function(nn){rt=rt||nn,Et--,0==Et&&Me(rt)};Ue.forEach(function(nn){nn.whenStable($t)})})}findTestabilityInTree(he,se,Me){return null==se?null:he.getTestability(se)??(Me?(0,ge.q)().isShadowRoot(se)?this.findTestabilityInTree(he,se.host,!0):this.findTestabilityInTree(he,se.parentElement,!0):null)}},deps:[]},{provide:re.lri,useClass:re.dDg,deps:[re.R0b,re.eoX,re.rWj]},{provide:re.dDg,useClass:re.dDg,deps:[re.R0b,re.eoX,re.rWj]}],Fi=[{provide:re.zSh,useValue:"root"},{provide:re.qLn,useFactory:function oo(){return new re.qLn},deps:[]},{provide:ut,useClass:_r,multi:!0,deps:[ge.K0,re.R0b,re.Lbi]},{provide:ut,useClass:dr,multi:!0,deps:[ge.K0]},{provide:ot,useClass:ot,deps:[bn,Xt,re.AFp]},{provide:re.FYo,useExisting:ot},{provide:dn,useExisting:Xt},{provide:Xt,useClass:Xt,deps:[ge.K0]},{provide:bn,useClass:bn,deps:[ut,re.R0b]},{provide:ge.JF,useClass:wn,deps:[]},[]];let $i=(()=>{class ve{constructor(se){}static withServerTransition(se){return{ngModule:ve,providers:[{provide:re.AFp,useValue:se.appId},{provide:Mt,useExisting:re.AFp},ft]}}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(Ci,12))},ve.\u0275mod=re.oAB({type:ve}),ve.\u0275inj=re.cJS({providers:[...Fi,...Yn],imports:[ge.ez,re.hGG]}),ve})(),ui=(()=>{class ve{constructor(se){this._doc=se}getTitle(){return this._doc.title}setTitle(se){this._doc.title=se||""}}return ve.\u0275fac=function(se){return new(se||ve)(re.LFG(ge.K0))},ve.\u0275prov=re.Yz7({token:ve,factory:function(se){let Me=null;return Me=se?new se:function Jt(){return new ui((0,re.LFG)(ge.K0))}(),Me},providedIn:"root"}),ve})();typeof window<"u"&&window},944:(nr,Qt,Be)=>{"use strict";Be.d(Qt,{rH:()=>Hs,Od:()=>Zs,Bz:()=>Vc,lC:()=>Os});var ge=Be(895),re=Be(256),Wt=Be(669),u=Be(76);function Ae(...M){const C=(0,Wt.yG)(M);return(0,u.D)(M,C)}var hn=Be(579);class jt extends hn.x{constructor(C){super(),this._value=C}get value(){return this.getValue()}_subscribe(C){const D=super._subscribe(C);return!D.closed&&C.next(this._value),D}getValue(){const{hasError:C,thrownError:D,_value:L}=this;if(C)throw D;return this._throwIfClosed(),L}next(C){super.next(this._value=C)}}var nt=Be(306);const{isArray:Mt}=Array,{getPrototypeOf:Ct,prototype:ft,keys:Tt}=Object;var bn=Be(671),dt=Be(4);const{isArray:dn}=Array;var Bt=Be(403),Nt=Be(672);function gt(...M){const C=(0,Wt.yG)(M),D=(0,Wt.jO)(M),{args:L,keys:U}=function wn(M){if(1===M.length){const C=M[0];if(Mt(C))return{args:C,keys:null};if(function ut(M){return M&&"object"==typeof M&&Ct(M)===ft}(C)){const D=Tt(C);return{args:D.map(L=>C[L]),keys:D}}}return{args:M,keys:null}}(M);if(0===L.length)return(0,u.D)([],C);const X=new nt.y(function rr(M,C,D=bn.y){return L=>{wt(C,()=>{const{length:U}=M,X=new Array(U);let pe=U,De=U;for(let Ye=0;Ye<U;Ye++)wt(C,()=>{const It=(0,u.D)(M[Ye],C);let Rn=!1;It.subscribe((0,Bt.x)(L,en=>{X[Ye]=en,Rn||(Rn=!0,De--),De||L.next(D(X.slice()))},()=>{--pe||L.complete()}))},L)},L)}}(L,C,U?pe=>function Zt(M,C){return M.reduce((D,L,U)=>(D[L]=C[U],D),{})}(U,pe):bn.y));return D?X.pipe(function Hn(M){return(0,dt.U)(C=>function Xt(M,C){return dn(C)?M(...C):M(C)}(M,C))}(D)):X}function wt(M,C,D){M?(0,Nt.f)(D,M,C):C()}var Ft=Be(576);function Mn(M,C){const D=(0,Ft.m)(M)?M:()=>M,L=U=>U.error(D());return new nt.y(C?U=>C.schedule(L,0,U):L)}const Ke=(0,Be(888).d)(M=>function(){M(this),this.name="EmptyError",this.message="no elements in sequence"});var Qe=Be(189);function at(...M){return function ot(){return(0,Qe.J)(1)}()((0,u.D)(M,(0,Wt.yG)(M)))}var Rt=Be(421);function Ln(M){return new nt.y(C=>{(0,Rt.Xf)(M()).subscribe(C)})}var fn=Be(727),Zn=Be(482);function Dn(){return(0,Zn.e)((M,C)=>{let D=null;M._refCount++;const L=(0,Bt.x)(C,void 0,void 0,void 0,()=>{if(!M||M._refCount<=0||0<--M._refCount)return void(D=null);const U=M._connection,X=D;D=null,U&&(!X||U===X)&&U.unsubscribe(),C.unsubscribe()});M.subscribe(L),L.closed||(D=M.connect())})}class _r extends nt.y{constructor(C,D){super(),this.source=C,this.subjectFactory=D,this._subject=null,this._refCount=0,this._connection=null,(0,Zn.A)(C)&&(this.lift=C.lift)}_subscribe(C){return this.getSubject().subscribe(C)}getSubject(){const C=this._subject;return(!C||C.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:C}=this;this._subject=this._connection=null,C?.unsubscribe()}connect(){let C=this._connection;if(!C){C=this._connection=new fn.w0;const D=this.getSubject();C.add(this.source.subscribe((0,Bt.x)(D,void 0,()=>{this._teardown(),D.complete()},L=>{this._teardown(),D.error(L)},()=>this._teardown()))),C.closed&&(this._connection=null,C=fn.w0.EMPTY)}return C}refCount(){return Dn()(this)}}var jr=Be(515);function ir(M,C){return(0,Zn.e)((D,L)=>{let U=null,X=0,pe=!1;const De=()=>pe&&!U&&L.complete();D.subscribe((0,Bt.x)(L,Ye=>{U?.unsubscribe();let It=0;const Rn=X++;(0,Rt.Xf)(M(Ye,Rn)).subscribe(U=(0,Bt.x)(L,en=>L.next(C?C(Ye,en,Rn,It++):en),()=>{U=null,De()}))},()=>{pe=!0,De()}))})}function Yr(M){return M<=0?()=>jr.E:(0,Zn.e)((C,D)=>{let L=0;C.subscribe((0,Bt.x)(D,U=>{++L<=M&&(D.next(U),M<=L&&D.complete())}))})}function ki(M,C,D,L,U){return(X,pe)=>{let De=D,Ye=C,It=0;X.subscribe((0,Bt.x)(pe,Rn=>{const en=It++;Ye=De?M(Ye,Rn,en):(De=!0,Rn),L&&pe.next(Ye)},U&&(()=>{De&&pe.next(Ye),pe.complete()})))}}function dr(M,C){return(0,Zn.e)(ki(M,C,arguments.length>=2,!0))}function An(M,C){return(0,Zn.e)((D,L)=>{let U=0;D.subscribe((0,Bt.x)(L,X=>M.call(C,X,U++)&&L.next(X)))})}function Li(M){return(0,Zn.e)((C,D)=>{let X,L=null,U=!1;L=C.subscribe((0,Bt.x)(D,void 0,void 0,pe=>{X=(0,Rt.Xf)(M(pe,Li(M)(C))),L?(L.unsubscribe(),L=null,X.subscribe(D)):U=!0})),U&&(L.unsubscribe(),L=null,X.subscribe(D))})}var En=Be(577);function io(M,C){return(0,Ft.m)(C)?(0,En.z)(M,C,1):(0,En.z)(M,1)}function Sr(M){return M<=0?()=>jr.E:(0,Zn.e)((C,D)=>{let L=[];C.subscribe((0,Bt.x)(D,U=>{L.push(U),M<L.length&&L.shift()},()=>{for(const U of L)D.next(U);D.complete()},void 0,()=>{L=null}))})}function oo(M=ci){return(0,Zn.e)((C,D)=>{let L=!1;C.subscribe((0,Bt.x)(D,U=>{L=!0,D.next(U)},()=>L?D.complete():D.error(M())))})}function ci(){return new Ke}function Xi(M){return(0,Zn.e)((C,D)=>{let L=!1;C.subscribe((0,Bt.x)(D,U=>{L=!0,D.next(U)},()=>{L||D.next(M),D.complete()}))})}function Ci(M,C){const D=arguments.length>=2;return L=>L.pipe(M?An((U,X)=>M(U,X,L)):bn.y,Yr(1),D?Xi(C):oo(()=>new Ke))}function Yn(M,C,D){const L=(0,Ft.m)(M)||C||D?{next:M,error:C,complete:D}:M;return L?(0,Zn.e)((U,X)=>{var pe;null===(pe=L.subscribe)||void 0===pe||pe.call(L);let De=!0;U.subscribe((0,Bt.x)(X,Ye=>{var It;null===(It=L.next)||void 0===It||It.call(L,Ye),X.next(Ye)},()=>{var Ye;De=!1,null===(Ye=L.complete)||void 0===Ye||Ye.call(L),X.complete()},Ye=>{var It;De=!1,null===(It=L.error)||void 0===It||It.call(L,Ye),X.error(Ye)},()=>{var Ye,It;De&&(null===(Ye=L.unsubscribe)||void 0===Ye||Ye.call(L)),null===(It=L.finalize)||void 0===It||It.call(L)}))}):bn.y}function $i(M){return(0,Zn.e)((C,D)=>{try{C.subscribe(D)}finally{D.add(M)}})}var Bo=Be(481);class Ii{constructor(C,D){this.id=C,this.url=D}}class ts extends Ii{constructor(C,D,L="imperative",U=null){super(C,D),this.type=0,this.navigationTrigger=L,this.restoredState=U}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Jt extends Ii{constructor(C,D,L){super(C,D),this.urlAfterRedirects=L,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ui extends Ii{constructor(C,D,L){super(C,D),this.reason=L,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class vr extends Ii{constructor(C,D,L){super(C,D),this.error=L,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class an extends Ii{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gn extends Ii{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class No extends Ii{constructor(C,D,L,U,X){super(C,D),this.urlAfterRedirects=L,this.state=U,this.shouldActivate=X,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class mi extends Ii{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ar extends Ii{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Uo{constructor(C){this.route=C,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Si{constructor(C){this.route=C,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class gi{constructor(C){this.snapshot=C,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Pn{constructor(C){this.snapshot=C,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Aa{constructor(C){this.snapshot=C,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xr{constructor(C){this.snapshot=C,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Oi{constructor(C,D,L){this.routerEvent=C,this.position=D,this.anchor=L,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const In="primary";class po{constructor(C){this.params=C||{}}has(C){return Object.prototype.hasOwnProperty.call(this.params,C)}get(C){if(this.has(C)){const D=this.params[C];return Array.isArray(D)?D[0]:D}return null}getAll(C){if(this.has(C)){const D=this.params[C];return Array.isArray(D)?D:[D]}return[]}get keys(){return Object.keys(this.params)}}function Gr(M){return new po(M)}const To="Redirecting to ",le="ngNavigationCancelingError";function $(M){const C=Error("NavigationCancelingError: "+(M||""));return C[le]=!0,C}function ce(M,C,D){const L=D.path.split("/");if(L.length>M.length||"full"===D.pathMatch&&(C.hasChildren()||L.length<M.length))return null;const U={};for(let X=0;X<L.length;X++){const pe=L[X],De=M[X];if(pe.startsWith(":"))U[pe.substring(1)]=De;else if(pe!==De.path)return null}return{consumed:M.slice(0,L.length),posParams:U}}function Te(M,C){const D=M?Object.keys(M):void 0,L=C?Object.keys(C):void 0;if(!D||!L||D.length!=L.length)return!1;let U;for(let X=0;X<D.length;X++)if(U=D[X],!ze(M[U],C[U]))return!1;return!0}function ze(M,C){if(Array.isArray(M)&&Array.isArray(C)){if(M.length!==C.length)return!1;const D=[...M].sort(),L=[...C].sort();return D.every((U,X)=>L[X]===U)}return M===C}function Oe(M){return Array.prototype.concat.apply([],M)}function Ie(M){return M.length>0?M[M.length-1]:null}function tt(M,C){for(const D in M)M.hasOwnProperty(D)&&C(M[D],D)}function At(M){return(0,re.CqO)(M)?M:(0,re.QGY)(M)?(0,u.D)(Promise.resolve(M)):Ae(M)}const se={exact:function rt(M,C,D){if(!yi(M.segments,C.segments)||!Hr(M.segments,C.segments,D)||M.numberOfChildren!==C.numberOfChildren)return!1;for(const L in C.children)if(!M.children[L]||!rt(M.children[L],C.children[L],D))return!1;return!0},subset:nn},Me={exact:function Et(M,C){return Te(M,C)},subset:function $t(M,C){return Object.keys(C).length<=Object.keys(M).length&&Object.keys(C).every(D=>ze(M[D],C[D]))},ignored:()=>!0};function Ue(M,C,D){return se[D.paths](M.root,C.root,D.matrixParams)&&Me[D.queryParams](M.queryParams,C.queryParams)&&!("exact"===D.fragment&&M.fragment!==C.fragment)}function nn(M,C,D){return ke(M,C,C.segments,D)}function ke(M,C,D,L){if(M.segments.length>D.length){const U=M.segments.slice(0,D.length);return!(!yi(U,D)||C.hasChildren()||!Hr(U,D,L))}if(M.segments.length===D.length){if(!yi(M.segments,D)||!Hr(M.segments,D,L))return!1;for(const U in C.children)if(!M.children[U]||!nn(M.children[U],C.children[U],L))return!1;return!0}{const U=D.slice(0,M.segments.length),X=D.slice(M.segments.length);return!!(yi(M.segments,U)&&Hr(M.segments,U,L)&&M.children[In])&&ke(M.children[In],C,X,L)}}function Hr(M,C,D){return C.every((L,U)=>Me[D](M[U].parameters,L.parameters))}class Tn{constructor(C,D,L){this.root=C,this.queryParams=D,this.fragment=L}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Gr(this.queryParams)),this._queryParamMap}toString(){return $n.serialize(this)}}class xn{constructor(C,D){this.segments=C,this.children=D,this.parent=null,tt(D,(L,U)=>L.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return _n(this)}}class Mr{constructor(C,D){this.path=C,this.parameters=D}get parameterMap(){return this._parameterMap||(this._parameterMap=Gr(this.parameters)),this._parameterMap}toString(){return Ar(this)}}function yi(M,C){return M.length===C.length&&M.every((D,L)=>D.path===C[L].path)}class Do{}class Ot{parse(C){const D=new Pr(C);return new Tn(D.parseRootSegment(),D.parseQueryParams(),D.parseFragment())}serialize(C){const D=`/${fr(C.root,!0)}`,L=function Vo(M){const C=Object.keys(M).map(D=>{const L=M[D];return Array.isArray(L)?L.map(U=>`${mn(D)}=${mn(U)}`).join("&"):`${mn(D)}=${mn(L)}`}).filter(D=>!!D);return C.length?`?${C.join("&")}`:""}(C.queryParams);return`${D}${L}${"string"==typeof C.fragment?`#${function ei(M){return encodeURI(M)}(C.fragment)}`:""}`}}const $n=new Ot;function _n(M){return M.segments.map(C=>Ar(C)).join("/")}function fr(M,C){if(!M.hasChildren())return _n(M);if(C){const D=M.children[In]?fr(M.children[In],!1):"",L=[];return tt(M.children,(U,X)=>{X!==In&&L.push(`${X}:${fr(U,!1)}`)}),L.length>0?`${D}(${L.join("//")})`:D}{const D=function Bn(M,C){let D=[];return tt(M.children,(L,U)=>{U===In&&(D=D.concat(C(L,U)))}),tt(M.children,(L,U)=>{U!==In&&(D=D.concat(C(L,U)))}),D}(M,(L,U)=>U===In?[fr(M.children[In],!1)]:[`${U}:${fr(L,!1)}`]);return 1===Object.keys(M.children).length&&null!=M.children[In]?`${_n(M)}/${D[0]}`:`${_n(M)}/(${D.join("//")})`}}function so(M){return encodeURIComponent(M).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function mn(M){return so(M).replace(/%3B/gi,";")}function Yi(M){return so(M).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Co(M){return decodeURIComponent(M)}function qn(M){return Co(M.replace(/\+/g,"%20"))}function Ar(M){return`${Yi(M.path)}${function ql(M){return Object.keys(M).map(C=>`;${Yi(C)}=${Yi(M[C])}`).join("")}(M.parameters)}`}const ds=/^[^\/()?;=#]+/;function zi(M){const C=M.match(ds);return C?C[0]:""}const mo=/^[^=?&#]+/,Jn=/^[^&#]+/;class Pr{constructor(C){this.url=C,this.remaining=C}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new xn([],{}):new xn([],this.parseChildren())}parseQueryParams(){const C={};if(this.consumeOptional("?"))do{this.parseQueryParam(C)}while(this.consumeOptional("&"));return C}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const C=[];for(this.peekStartsWith("(")||C.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),C.push(this.parseSegment());let D={};this.peekStartsWith("/(")&&(this.capture("/"),D=this.parseParens(!0));let L={};return this.peekStartsWith("(")&&(L=this.parseParens(!1)),(C.length>0||Object.keys(D).length>0)&&(L[In]=new xn(C,D)),L}parseSegment(){const C=zi(this.remaining);if(""===C&&this.peekStartsWith(";"))throw new re.vHH(4009,!1);return this.capture(C),new Mr(Co(C),this.parseMatrixParams())}parseMatrixParams(){const C={};for(;this.consumeOptional(";");)this.parseParam(C);return C}parseParam(C){const D=zi(this.remaining);if(!D)return;this.capture(D);let L="";if(this.consumeOptional("=")){const U=zi(this.remaining);U&&(L=U,this.capture(L))}C[Co(D)]=Co(L)}parseQueryParam(C){const D=function ns(M){const C=M.match(mo);return C?C[0]:""}(this.remaining);if(!D)return;this.capture(D);let L="";if(this.consumeOptional("=")){const pe=function Zr(M){const C=M.match(Jn);return C?C[0]:""}(this.remaining);pe&&(L=pe,this.capture(L))}const U=qn(D),X=qn(L);if(C.hasOwnProperty(U)){let pe=C[U];Array.isArray(pe)||(pe=[pe],C[U]=pe),pe.push(X)}else C[U]=X}parseParens(C){const D={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const L=zi(this.remaining),U=this.remaining[L.length];if("/"!==U&&")"!==U&&";"!==U)throw new re.vHH(4010,!1);let X;L.indexOf(":")>-1?(X=L.slice(0,L.indexOf(":")),this.capture(X),this.capture(":")):C&&(X=In);const pe=this.parseChildren();D[X]=1===Object.keys(pe).length?pe[In]:new xn([],pe),this.consumeOptional("//")}return D}peekStartsWith(C){return this.remaining.startsWith(C)}consumeOptional(C){return!!this.peekStartsWith(C)&&(this.remaining=this.remaining.substring(C.length),!0)}capture(C){if(!this.consumeOptional(C))throw new re.vHH(4011,!1)}}class Gi{constructor(C){this._root=C}get root(){return this._root.value}parent(C){const D=this.pathFromRoot(C);return D.length>1?D[D.length-2]:null}children(C){const D=Kr(C,this._root);return D?D.children.map(L=>L.value):[]}firstChild(C){const D=Kr(C,this._root);return D&&D.children.length>0?D.children[0].value:null}siblings(C){const D=vi(C,this._root);return D.length<2?[]:D[D.length-2].children.map(U=>U.value).filter(U=>U!==C)}pathFromRoot(C){return vi(C,this._root).map(D=>D.value)}}function Kr(M,C){if(M===C.value)return C;for(const D of C.children){const L=Kr(M,D);if(L)return L}return null}function vi(M,C){if(M===C.value)return[C];for(const D of C.children){const L=vi(M,D);if(L.length)return L.unshift(C),L}return[]}class Hi{constructor(C,D){this.value=C,this.children=D}toString(){return`TreeNode(${this.value})`}}function pr(M){const C={};return M&&M.children.forEach(D=>C[D.value.outlet]=D),C}class Fr extends Gi{constructor(C,D){super(C),this.snapshot=D,$o(this,C)}toString(){return this.snapshot.toString()}}function fs(M,C){const D=function pl(M,C){const pe=new ps([],{},{},"",{},In,C,null,M.root,-1,{});return new jo("",new Hi(pe,[]))}(M,C),L=new jt([new Mr("",{})]),U=new jt({}),X=new jt({}),pe=new jt({}),De=new jt(""),Ye=new Io(L,U,pe,De,X,In,C,D.root);return Ye.snapshot=D.root,new Fr(new Hi(Ye,[]),D)}class Io{constructor(C,D,L,U,X,pe,De,Ye){this.url=C,this.params=D,this.queryParams=L,this.fragment=U,this.data=X,this.outlet=pe,this.component=De,this._futureSnapshot=Ye}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,dt.U)(C=>Gr(C)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,dt.U)(C=>Gr(C)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function xi(M,C="emptyOnly"){const D=M.pathFromRoot;let L=0;if("always"!==C)for(L=D.length-1;L>=1;){const U=D[L],X=D[L-1];if(U.routeConfig&&""===U.routeConfig.path)L--;else{if(X.component)break;L--}}return function ml(M){return M.reduce((C,D)=>({params:{...C.params,...D.params},data:{...C.data,...D.data},resolve:{...D.data,...C.resolve,...D.routeConfig?.data,...D._resolvedData}}),{params:{},data:{},resolve:{}})}(D.slice(L))}class ps{constructor(C,D,L,U,X,pe,De,Ye,It,Rn,en,zr){this.url=C,this.params=D,this.queryParams=L,this.fragment=U,this.data=X,this.outlet=pe,this.component=De,this.routeConfig=Ye,this._urlSegment=It,this._lastPathIndex=Rn,this._correctedLastPathIndex=zr??Rn,this._resolve=en}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Gr(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Gr(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(L=>L.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class jo extends Gi{constructor(C,D){super(D),this.url=C,$o(this,D)}toString(){return Pa(this._root)}}function $o(M,C){C.value._routerState=M,C.children.forEach(D=>$o(M,D))}function Pa(M){const C=M.children.length>0?` { ${M.children.map(Pa).join(", ")} } `:"";return`${M.value}${C}`}function Wl(M){if(M.snapshot){const C=M.snapshot,D=M._futureSnapshot;M.snapshot=D,Te(C.queryParams,D.queryParams)||M.queryParams.next(D.queryParams),C.fragment!==D.fragment&&M.fragment.next(D.fragment),Te(C.params,D.params)||M.params.next(D.params),function ye(M,C){if(M.length!==C.length)return!1;for(let D=0;D<M.length;++D)if(!Te(M[D],C[D]))return!1;return!0}(C.url,D.url)||M.url.next(D.url),Te(C.data,D.data)||M.data.next(D.data)}else M.snapshot=M._futureSnapshot,M.data.next(M._futureSnapshot.data)}function Ra(M,C){const D=Te(M.params,C.params)&&function _i(M,C){return yi(M,C)&&M.every((D,L)=>Te(D.parameters,C[L].parameters))}(M.url,C.url);return D&&!(!M.parent!=!C.parent)&&(!M.parent||Ra(M.parent,C.parent))}function ka(M,C,D){if(D&&M.shouldReuseRoute(C.value,D.value.snapshot)){const L=D.value;L._futureSnapshot=C.value;const U=function Rc(M,C,D){return C.children.map(L=>{for(const U of D.children)if(M.shouldReuseRoute(L.value,U.value.snapshot))return ka(M,L,U);return ka(M,L)})}(M,C,D);return new Hi(L,U)}{if(M.shouldAttach(C.value)){const X=M.retrieve(C.value);if(null!==X){const pe=X.route;return pe.value._futureSnapshot=C.value,pe.children=C.children.map(De=>ka(M,De)),pe}}const L=function sa(M){return new Io(new jt(M.url),new jt(M.params),new jt(M.queryParams),new jt(M.fragment),new jt(M.data),M.outlet,M.component,M)}(C.value),U=C.children.map(X=>ka(M,X));return new Hi(L,U)}}function Ki(M){return"object"==typeof M&&null!=M&&!M.outlets&&!M.segmentPath}function Go(M){return"object"==typeof M&&null!=M&&M.outlets}function aa(M,C,D,L,U){let X={};if(L&&tt(L,(De,Ye)=>{X[Ye]=Array.isArray(De)?De.map(It=>`${It}`):`${De}`}),M===C)return new Tn(D,X,U);const pe=gl(M,C,D);return new Tn(pe,X,U)}function gl(M,C,D){const L={};return tt(M.children,(U,X)=>{L[X]=U===C?D:gl(U,C,D)}),new xn(M.segments,L)}class _l{constructor(C,D,L){if(this.isAbsolute=C,this.numberOfDoubleDots=D,this.commands=L,C&&L.length>0&&Ki(L[0]))throw new re.vHH(4003,false);const U=L.find(Go);if(U&&U!==Ie(L))throw new re.vHH(4004,false)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class yl{constructor(C,D,L){this.segmentGroup=C,this.processChildren=D,this.index=L}}function Yl(M,C,D){if(M||(M=new xn([],{})),0===M.segments.length&&M.hasChildren())return _s(M,C,D);const L=function go(M,C,D){let L=0,U=C;const X={match:!1,pathIndex:0,commandIndex:0};for(;U<M.segments.length;){if(L>=D.length)return X;const pe=M.segments[U],De=D[L];if(Go(De))break;const Ye=`${De}`,It=L<D.length-1?D[L+1]:null;if(U>0&&void 0===Ye)break;if(Ye&&It&&"object"==typeof It&&void 0===It.outlets){if(!ti(Ye,It,pe))return X;L+=2}else{if(!ti(Ye,{},pe))return X;L++}U++}return{match:!0,pathIndex:U,commandIndex:L}}(M,C,D),U=D.slice(L.commandIndex);if(L.match&&L.pathIndex<M.segments.length){const X=new xn(M.segments.slice(0,L.pathIndex),{});return X.children[In]=new xn(M.segments.slice(L.pathIndex),M.children),_s(X,0,U)}return L.match&&0===U.length?new xn(M.segments,{}):L.match&&!M.hasChildren()?La(M,C,D):L.match?_s(M,0,U):La(M,C,D)}function _s(M,C,D){if(0===D.length)return new xn(M.segments,{});{const L=function Xl(M){return Go(M[0])?M[0].outlets:{[In]:M}}(D),U={};return tt(L,(X,pe)=>{"string"==typeof X&&(X=[X]),null!==X&&(U[pe]=Yl(M.children[pe],C,X))}),tt(M.children,(X,pe)=>{void 0===L[pe]&&(U[pe]=X)}),new xn(M.segments,U)}}function La(M,C,D){const L=M.segments.slice(0,C);let U=0;for(;U<D.length;){const X=D[U];if(Go(X)){const Ye=Fa(X.outlets);return new xn(L,Ye)}if(0===U&&Ki(D[0])){L.push(new Mr(M.segments[C].path,la(D[0]))),U++;continue}const pe=Go(X)?X.outlets[In]:`${X}`,De=U<D.length-1?D[U+1]:null;pe&&De&&Ki(De)?(L.push(new Mr(pe,la(De))),U+=2):(L.push(new Mr(pe,{})),U++)}return new xn(L,{})}function Fa(M){const C={};return tt(M,(D,L)=>{"string"==typeof D&&(D=[D]),null!==D&&(C[L]=La(new xn([],{}),0,D))}),C}function la(M){const C={};return tt(M,(D,L)=>C[L]=`${D}`),C}function ti(M,C,D){return M==D.path&&Te(C,D.parameters)}class Fs{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Mo,this.attachRef=null}}class Mo{constructor(){this.contexts=new Map}onChildOutletCreated(C,D){const L=this.getOrCreateContext(C);L.outlet=D,this.contexts.set(C,L)}onChildOutletDestroyed(C){const D=this.getContext(C);D&&(D.outlet=null,D.attachRef=null)}onOutletDeactivated(){const C=this.contexts;return this.contexts=new Map,C}onOutletReAttached(C){this.contexts=C}getOrCreateContext(C){let D=this.getContext(C);return D||(D=new Fs,this.contexts.set(C,D)),D}getContext(C){return this.contexts.get(C)||null}}const ao=!1;let Os=(()=>{class M{constructor(D,L,U,X,pe){this.parentContexts=D,this.location=L,this.changeDetector=X,this.environmentInjector=pe,this.activated=null,this._activatedRoute=null,this.activateEvents=new re.vpe,this.deactivateEvents=new re.vpe,this.attachEvents=new re.vpe,this.detachEvents=new re.vpe,this.name=U||In,D.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const D=this.parentContexts.getContext(this.name);D&&D.route&&(D.attachRef?this.attach(D.attachRef,D.route):this.activateWith(D.route,D.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new re.vHH(4012,ao);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new re.vHH(4012,ao);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new re.vHH(4012,ao);this.location.detach();const D=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(D.instance),D}attach(D,L){this.activated=D,this._activatedRoute=L,this.location.insert(D.hostView),this.attachEvents.emit(D.instance)}deactivate(){if(this.activated){const D=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(D)}}activateWith(D,L){if(this.isActivated)throw new re.vHH(4013,ao);this._activatedRoute=D;const U=this.location,pe=D._futureSnapshot.component,De=this.parentContexts.getOrCreateContext(this.name).children,Ye=new or(D,De,U.injector);if(L&&function Qr(M){return!!M.resolveComponentFactory}(L)){const It=L.resolveComponentFactory(pe);this.activated=U.createComponent(It,U.length,Ye)}else this.activated=U.createComponent(pe,{index:U.length,injector:Ye,environmentInjector:L??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return M.\u0275fac=function(D){return new(D||M)(re.Y36(Mo),re.Y36(re.s_b),re.$8M("name"),re.Y36(re.sBO),re.Y36(re.lqb))},M.\u0275dir=re.lG2({type:M,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),M})();class or{constructor(C,D,L){this.route=C,this.childContexts=D,this.parent=L}get(C,D){return C===Io?this.route:C===Mo?this.childContexts:this.parent.get(C,D)}}let z=(()=>{class M{}return M.\u0275fac=function(D){return new(D||M)},M.\u0275cmp=re.Xpm({type:M,selectors:[["ng-component"]],decls:1,vars:0,template:function(D,L){1&D&&re._UZ(0,"router-outlet")},dependencies:[Os],encapsulation:2}),M})();function K(M,C){return M.providers&&!M._injector&&(M._injector=(0,re.MMx)(M.providers,C,`Route: ${M.path}`)),M._injector??C}function wr(M){const C=M.children&&M.children.map(wr),D=C?{...M,children:C}:{...M};return!D.component&&!D.loadComponent&&(C||D.loadChildren)&&D.outlet&&D.outlet!==In&&(D.component=z),D}function yn(M){return M.outlet||In}function ni(M,C){const D=M.filter(L=>yn(L)===C);return D.push(...M.filter(L=>yn(L)!==C)),D}function Rr(M){if(!M)return null;if(M.routeConfig?._injector)return M.routeConfig._injector;for(let C=M.parent;C;C=C.parent){const D=C.routeConfig;if(D?._loadedInjector)return D._loadedInjector;if(D?._injector)return D._injector}return null}class Zo{constructor(C,D,L,U){this.routeReuseStrategy=C,this.futureState=D,this.currState=L,this.forwardEvent=U}activate(C){const D=this.futureState._root,L=this.currState?this.currState._root:null;this.deactivateChildRoutes(D,L,C),Wl(this.futureState.root),this.activateChildRoutes(D,L,C)}deactivateChildRoutes(C,D,L){const U=pr(D);C.children.forEach(X=>{const pe=X.value.outlet;this.deactivateRoutes(X,U[pe],L),delete U[pe]}),tt(U,(X,pe)=>{this.deactivateRouteAndItsChildren(X,L)})}deactivateRoutes(C,D,L){const U=C.value,X=D?D.value:null;if(U===X)if(U.component){const pe=L.getContext(U.outlet);pe&&this.deactivateChildRoutes(C,D,pe.children)}else this.deactivateChildRoutes(C,D,L);else X&&this.deactivateRouteAndItsChildren(D,L)}deactivateRouteAndItsChildren(C,D){C.value.component&&this.routeReuseStrategy.shouldDetach(C.value.snapshot)?this.detachAndStoreRouteSubtree(C,D):this.deactivateRouteAndOutlet(C,D)}detachAndStoreRouteSubtree(C,D){const L=D.getContext(C.value.outlet),U=L&&C.value.component?L.children:D,X=pr(C);for(const pe of Object.keys(X))this.deactivateRouteAndItsChildren(X[pe],U);if(L&&L.outlet){const pe=L.outlet.detach(),De=L.children.onOutletDeactivated();this.routeReuseStrategy.store(C.value.snapshot,{componentRef:pe,route:C,contexts:De})}}deactivateRouteAndOutlet(C,D){const L=D.getContext(C.value.outlet),U=L&&C.value.component?L.children:D,X=pr(C);for(const pe of Object.keys(X))this.deactivateRouteAndItsChildren(X[pe],U);L&&L.outlet&&(L.outlet.deactivate(),L.children.onOutletDeactivated(),L.attachRef=null,L.resolver=null,L.route=null)}activateChildRoutes(C,D,L){const U=pr(D);C.children.forEach(X=>{this.activateRoutes(X,U[X.value.outlet],L),this.forwardEvent(new xr(X.value.snapshot))}),C.children.length&&this.forwardEvent(new Pn(C.value.snapshot))}activateRoutes(C,D,L){const U=C.value,X=D?D.value:null;if(Wl(U),U===X)if(U.component){const pe=L.getOrCreateContext(U.outlet);this.activateChildRoutes(C,D,pe.children)}else this.activateChildRoutes(C,D,L);else if(U.component){const pe=L.getOrCreateContext(U.outlet);if(this.routeReuseStrategy.shouldAttach(U.snapshot)){const De=this.routeReuseStrategy.retrieve(U.snapshot);this.routeReuseStrategy.store(U.snapshot,null),pe.children.onOutletReAttached(De.contexts),pe.attachRef=De.componentRef,pe.route=De.route.value,pe.outlet&&pe.outlet.attach(De.componentRef,De.route.value),Wl(De.route.value),this.activateChildRoutes(C,null,pe.children)}else{const De=Rr(U.snapshot),Ye=De?.get(re._Vd)??null;pe.attachRef=null,pe.route=U,pe.resolver=Ye,pe.injector=De,pe.outlet&&pe.outlet.activateWith(U,pe.injector),this.activateChildRoutes(C,null,pe.children)}}else this.activateChildRoutes(C,null,L)}}function _o(M){return"function"==typeof M}function Bi(M){return M instanceof Tn}const _t=Symbol("INITIAL_VALUE");function Kn(){return ir(M=>gt(M.map(C=>C.pipe(Yr(1),function Ri(...M){const C=(0,Wt.yG)(M);return(0,Zn.e)((D,L)=>{(C?at(M,D,C):at(M,D)).subscribe(L)})}(_t)))).pipe(dr((C,D)=>{let L=!1;return D.reduce((U,X,pe)=>U!==_t?U:(X===_t&&(L=!0),L||!1!==X&&pe!==D.length-1&&!Bi(X)?U:X),C)},_t),An(C=>C!==_t),(0,dt.U)(C=>Bi(C)?C:!0===C),Yr(1)))}const za={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ua(M,C,D){if(""===C.path)return"full"===C.pathMatch&&(M.hasChildren()||D.length>0)?{...za}:{matched:!0,consumedSegments:[],remainingSegments:D,parameters:{},positionalParamSegments:{}};const U=(C.matcher||ce)(D,M,C);if(!U)return{...za};const X={};tt(U.posParams,(De,Ye)=>{X[Ye]=De.path});const pe=U.consumed.length>0?{...X,...U.consumed[U.consumed.length-1].parameters}:X;return{matched:!0,consumedSegments:U.consumed,remainingSegments:D.slice(U.consumed.length),parameters:pe,positionalParamSegments:U.posParams??{}}}function yr(M,C,D,L,U="corrected"){if(D.length>0&&function Ao(M,C,D){return D.some(L=>zs(M,C,L)&&yn(L)!==In)}(M,D,L)){const pe=new xn(C,function Ba(M,C,D,L){const U={};U[In]=L,L._sourceSegment=M,L._segmentIndexShift=C.length;for(const X of D)if(""===X.path&&yn(X)!==In){const pe=new xn([],{});pe._sourceSegment=M,pe._segmentIndexShift=C.length,U[yn(X)]=pe}return U}(M,C,L,new xn(D,M.children)));return pe._sourceSegment=M,pe._segmentIndexShift=C.length,{segmentGroup:pe,slicedSegments:[]}}if(0===D.length&&function wl(M,C,D){return D.some(L=>zs(M,C,L))}(M,D,L)){const pe=new xn(M.segments,function Kl(M,C,D,L,U,X){const pe={};for(const De of L)if(zs(M,D,De)&&!U[yn(De)]){const Ye=new xn([],{});Ye._sourceSegment=M,Ye._segmentIndexShift="legacy"===X?M.segments.length:C.length,pe[yn(De)]=Ye}return{...U,...pe}}(M,C,D,L,M.children,U));return pe._sourceSegment=M,pe._segmentIndexShift=C.length,{segmentGroup:pe,slicedSegments:D}}const X=new xn(M.segments,M.children);return X._sourceSegment=M,X._segmentIndexShift=C.length,{segmentGroup:X,slicedSegments:D}}function zs(M,C,D){return(!(M.hasChildren()||C.length>0)||"full"!==D.pathMatch)&&""===D.path}function rh(M,C,D,L){return!!(yn(M)===L||L!==In&&zs(C,D,M))&&("**"===M.path||ua(C,M,D).matched)}function Ql(M,C,D){return 0===C.length&&!M.children[D]}const kc=!1;class qo{constructor(C){this.segmentGroup=C||null}}class Ni{constructor(C){this.urlTree=C}}function Zi(M){return Mn(new qo(M))}function Lc(M){return Mn(new Ni(M))}class Fc{constructor(C,D,L,U,X){this.injector=C,this.configLoader=D,this.urlSerializer=L,this.urlTree=U,this.config=X,this.allowRedirects=!0}apply(){const C=yr(this.urlTree.root,[],[],this.config).segmentGroup,D=new xn(C.segments,C.children);return this.expandSegmentGroup(this.injector,this.config,D,In).pipe((0,dt.U)(X=>this.createUrlTree(Jl(X),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Li(X=>{if(X instanceof Ni)return this.allowRedirects=!1,this.match(X.urlTree);throw X instanceof qo?this.noMatchError(X):X}))}match(C){return this.expandSegmentGroup(this.injector,this.config,C.root,In).pipe((0,dt.U)(U=>this.createUrlTree(Jl(U),C.queryParams,C.fragment))).pipe(Li(U=>{throw U instanceof qo?this.noMatchError(U):U}))}noMatchError(C){return new re.vHH(4002,kc)}createUrlTree(C,D,L){const U=C.segments.length>0?new xn([],{[In]:C}):C;return new Tn(U,D,L)}expandSegmentGroup(C,D,L,U){return 0===L.segments.length&&L.hasChildren()?this.expandChildren(C,D,L).pipe((0,dt.U)(X=>new xn([],X))):this.expandSegment(C,L,D,L.segments,U,!0)}expandChildren(C,D,L){const U=[];for(const X of Object.keys(L.children))"primary"===X?U.unshift(X):U.push(X);return(0,u.D)(U).pipe(io(X=>{const pe=L.children[X],De=ni(D,X);return this.expandSegmentGroup(C,De,pe,X).pipe((0,dt.U)(Ye=>({segment:Ye,outlet:X})))}),dr((X,pe)=>(X[pe.outlet]=pe.segment,X),{}),function Vn(M,C){const D=arguments.length>=2;return L=>L.pipe(M?An((U,X)=>M(U,X,L)):bn.y,Sr(1),D?Xi(C):oo(()=>new Ke))}())}expandSegment(C,D,L,U,X,pe){return(0,u.D)(L).pipe(io(De=>this.expandSegmentAgainstRoute(C,D,L,De,U,X,pe).pipe(Li(It=>{if(It instanceof qo)return Ae(null);throw It}))),Ci(De=>!!De),Li((De,Ye)=>{if(De instanceof Ke||"EmptyError"===De.name)return Ql(D,U,X)?Ae(new xn([],{})):Zi(D);throw De}))}expandSegmentAgainstRoute(C,D,L,U,X,pe,De){return rh(U,D,X,pe)?void 0===U.redirectTo?this.matchSegmentAgainstRoute(C,D,U,X,pe):De&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(C,D,L,U,X,pe):Zi(D):Zi(D)}expandSegmentAgainstRouteUsingRedirect(C,D,L,U,X,pe){return"**"===U.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(C,L,U,pe):this.expandRegularSegmentAgainstRouteUsingRedirect(C,D,L,U,X,pe)}expandWildCardWithParamsAgainstRouteUsingRedirect(C,D,L,U){const X=this.applyRedirectCommands([],L.redirectTo,{});return L.redirectTo.startsWith("/")?Lc(X):this.lineralizeSegments(L,X).pipe((0,En.z)(pe=>{const De=new xn(pe,{});return this.expandSegment(C,De,D,pe,U,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(C,D,L,U,X,pe){const{matched:De,consumedSegments:Ye,remainingSegments:It,positionalParamSegments:Rn}=ua(D,U,X);if(!De)return Zi(D);const en=this.applyRedirectCommands(Ye,U.redirectTo,Rn);return U.redirectTo.startsWith("/")?Lc(en):this.lineralizeSegments(U,en).pipe((0,En.z)(zr=>this.expandSegment(C,D,L,zr.concat(It),pe,!1)))}matchSegmentAgainstRoute(C,D,L,U,X){if("**"===L.path)return C=K(L,C),L.loadChildren?(L._loadedRoutes?Ae({routes:L._loadedRoutes,injector:L._loadedInjector}):this.configLoader.loadChildren(C,L)).pipe((0,dt.U)(en=>(L._loadedRoutes=en.routes,L._loadedInjector=en.injector,new xn(U,{})))):Ae(new xn(U,{}));const{matched:pe,consumedSegments:De,remainingSegments:Ye}=ua(D,L,U);return pe?(C=K(L,C),this.getChildConfig(C,L,U).pipe((0,En.z)(Rn=>{const en=Rn.injector??C,zr=Rn.routes,{segmentGroup:Wr,slicedSegments:Ro}=yr(D,De,Ye,zr),Wa=new xn(Wr.segments,Wr.children);if(0===Ro.length&&Wa.hasChildren())return this.expandChildren(en,zr,Wa).pipe((0,dt.U)(h=>new xn(De,h)));if(0===zr.length&&0===Ro.length)return Ae(new xn(De,{}));const Xa=yn(L)===X;return this.expandSegment(en,Wa,zr,Ro,Xa?In:X,!0).pipe((0,dt.U)(ss=>new xn(De.concat(ss.segments),ss.children)))}))):Zi(D)}getChildConfig(C,D,L){return D.children?Ae({routes:D.children,injector:C}):D.loadChildren?void 0!==D._loadedRoutes?Ae({routes:D._loadedRoutes,injector:D._loadedInjector}):this.runCanLoadGuards(C,D,L).pipe((0,En.z)(U=>U?this.configLoader.loadChildren(C,D).pipe(Yn(X=>{D._loadedRoutes=X.routes,D._loadedInjector=X.injector})):function rs(M){return Mn($(kc))}())):Ae({routes:[],injector:C})}runCanLoadGuards(C,D,L){const U=D.canLoad;return U&&0!==U.length?Ae(U.map(pe=>{const De=C.get(pe);return At(function Oa(M){return M&&_o(M.canLoad)}(De)?De.canLoad(D,L):De(D,L))})).pipe(Kn(),Yn(pe=>{if(!Bi(pe))return;const De=$(To+this.urlSerializer.serialize(pe));throw De.url=pe,De}),(0,dt.U)(pe=>!0===pe)):Ae(!0)}lineralizeSegments(C,D){let L=[],U=D.root;for(;;){if(L=L.concat(U.segments),0===U.numberOfChildren)return Ae(L);if(U.numberOfChildren>1||!U.children[In])return Mn(new re.vHH(4e3,kc));U=U.children[In]}}applyRedirectCommands(C,D,L){return this.applyRedirectCreatreUrlTree(D,this.urlSerializer.parse(D),C,L)}applyRedirectCreatreUrlTree(C,D,L,U){const X=this.createSegmentGroup(C,D.root,L,U);return new Tn(X,this.createQueryParams(D.queryParams,this.urlTree.queryParams),D.fragment)}createQueryParams(C,D){const L={};return tt(C,(U,X)=>{if("string"==typeof U&&U.startsWith(":")){const De=U.substring(1);L[X]=D[De]}else L[X]=U}),L}createSegmentGroup(C,D,L,U){const X=this.createSegments(C,D.segments,L,U);let pe={};return tt(D.children,(De,Ye)=>{pe[Ye]=this.createSegmentGroup(C,De,L,U)}),new xn(X,pe)}createSegments(C,D,L,U){return D.map(X=>X.path.startsWith(":")?this.findPosParam(C,X,U):this.findOrReturn(X,L))}findPosParam(C,D,L){const U=L[D.path.substring(1)];if(!U)throw new re.vHH(4001,kc);return U}findOrReturn(C,D){let L=0;for(const U of D){if(U.path===C.path)return D.splice(L),U;L++}return C}}function Jl(M){const C={};for(const L of Object.keys(M.children)){const X=Jl(M.children[L]);(X.segments.length>0||X.hasChildren())&&(C[L]=X)}return function yu(M){if(1===M.numberOfChildren&&M.children[In]){const C=M.children[In];return new xn(M.segments.concat(C.segments),C.children)}return M}(new xn(M.segments,C))}class ec{constructor(C){this.path=C,this.route=this.path[this.path.length-1]}}class Us{constructor(C,D){this.component=C,this.route=D}}function tc(M,C,D){const L=M._root;return ha(L,C?C._root:null,D,[L.value])}function Tl(M,C,D){return(Rr(C)??D).get(M)}function ha(M,C,D,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const X=pr(C);return M.children.forEach(pe=>{(function nc(M,C,D,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const X=M.value,pe=C?C.value:null,De=D?D.getContext(M.value.outlet):null;if(pe&&X.routeConfig===pe.routeConfig){const Ye=function Dl(M,C,D){if("function"==typeof D)return D(M,C);switch(D){case"pathParamsChange":return!yi(M.url,C.url);case"pathParamsOrQueryParamsChange":return!yi(M.url,C.url)||!Te(M.queryParams,C.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ra(M,C)||!Te(M.queryParams,C.queryParams);default:return!Ra(M,C)}}(pe,X,X.routeConfig.runGuardsAndResolvers);Ye?U.canActivateChecks.push(new ec(L)):(X.data=pe.data,X._resolvedData=pe._resolvedData),ha(M,C,X.component?De?De.children:null:D,L,U),Ye&&De&&De.outlet&&De.outlet.isActivated&&U.canDeactivateChecks.push(new Us(De.outlet.component,pe))}else pe&&Vs(C,De,U),U.canActivateChecks.push(new ec(L)),ha(M,null,X.component?De?De.children:null:D,L,U)})(pe,X[pe.value.outlet],D,L.concat([pe.value]),U),delete X[pe.value.outlet]}),tt(X,(pe,De)=>Vs(pe,D.getContext(De),U)),U}function Vs(M,C,D){const L=pr(M),U=M.value;tt(L,(X,pe)=>{Vs(X,U.component?C?C.children.getContext(pe):null:C,D)}),D.canDeactivateChecks.push(new Us(U.component&&C&&C.outlet&&C.outlet.isActivated?C.outlet.component:null,U))}class ic{}function Qn(M){return new nt.y(C=>C.error(M))}class ih{constructor(C,D,L,U,X,pe){this.rootComponentType=C,this.config=D,this.urlTree=L,this.url=U,this.paramsInheritanceStrategy=X,this.relativeLinkResolution=pe}recognize(){const C=yr(this.urlTree.root,[],[],this.config.filter(pe=>void 0===pe.redirectTo),this.relativeLinkResolution).segmentGroup,D=this.processSegmentGroup(this.config,C,In);if(null===D)return null;const L=new ps([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},In,this.rootComponentType,null,this.urlTree.root,-1,{}),U=new Hi(L,D),X=new jo(this.url,U);return this.inheritParamsAndData(X._root),X}inheritParamsAndData(C){const D=C.value,L=xi(D,this.paramsInheritanceStrategy);D.params=Object.freeze(L.params),D.data=Object.freeze(L.data),C.children.forEach(U=>this.inheritParamsAndData(U))}processSegmentGroup(C,D,L){return 0===D.segments.length&&D.hasChildren()?this.processChildren(C,D):this.processSegment(C,D,D.segments,L)}processChildren(C,D){const L=[];for(const X of Object.keys(D.children)){const pe=D.children[X],De=ni(C,X),Ye=this.processSegmentGroup(De,pe,X);if(null===Ye)return null;L.push(...Ye)}const U=xs(L);return function Il(M){M.sort((C,D)=>C.value.outlet===In?-1:D.value.outlet===In?1:C.value.outlet.localeCompare(D.value.outlet))}(U),U}processSegment(C,D,L,U){for(const X of C){const pe=this.processSegmentAgainstRoute(X,D,L,U);if(null!==pe)return pe}return Ql(D,L,U)?[]:null}processSegmentAgainstRoute(C,D,L,U){if(C.redirectTo||!rh(C,D,L,U))return null;let X,pe=[],De=[];if("**"===C.path){const Wr=L.length>0?Ie(L).parameters:{},Ro=Po(D)+L.length;X=new ps(L,Wr,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,js(C),yn(C),C.component??C._loadedComponent??null,C,bu(D),Ro,Ml(C),Ro)}else{const Wr=ua(D,C,L);if(!Wr.matched)return null;pe=Wr.consumedSegments,De=Wr.remainingSegments;const Ro=Po(D)+pe.length;X=new ps(pe,Wr.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,js(C),yn(C),C.component??C._loadedComponent??null,C,bu(D),Ro,Ml(C),Ro)}const Ye=function Qi(M){return M.children?M.children:M.loadChildren?M._loadedRoutes:[]}(C),{segmentGroup:It,slicedSegments:Rn}=yr(D,pe,De,Ye.filter(Wr=>void 0===Wr.redirectTo),this.relativeLinkResolution);if(0===Rn.length&&It.hasChildren()){const Wr=this.processChildren(Ye,It);return null===Wr?null:[new Hi(X,Wr)]}if(0===Ye.length&&0===Rn.length)return[new Hi(X,[])];const en=yn(C)===U,zr=this.processSegment(Ye,It,Rn,en?In:U);return null===zr?null:[new Hi(X,zr)]}}function Sl(M){const C=M.value.routeConfig;return C&&""===C.path&&void 0===C.redirectTo}function xs(M){const C=[],D=new Set;for(const L of M){if(!Sl(L)){C.push(L);continue}const U=C.find(X=>L.value.routeConfig===X.value.routeConfig);void 0!==U?(U.children.push(...L.children),D.add(U)):C.push(L)}for(const L of D){const U=xs(L.children);C.push(new Hi(L.value,U))}return C.filter(L=>!D.has(L))}function bu(M){let C=M;for(;C._sourceSegment;)C=C._sourceSegment;return C}function Po(M){let C=M,D=C._segmentIndexShift??0;for(;C._sourceSegment;)C=C._sourceSegment,D+=C._segmentIndexShift??0;return D-1}function js(M){return M.data||{}}function Ml(M){return M.resolve||{}}const $s=Symbol("RouteTitle");function Es(M){return"string"==typeof M.title||null===M.title}function ja(M){return ir(C=>{const D=M(C);return D?(0,u.D)(D).pipe((0,dt.U)(()=>C)):Ae(C)})}class $a extends class Pl{shouldDetach(C){return!1}store(C,D){}shouldAttach(C){return!1}retrieve(C){return null}shouldReuseRoute(C,D){return C.routeConfig===D.routeConfig}}{}const Ds=new re.OlP("ROUTES");let Cs=(()=>{class M{constructor(D,L){this.injector=D,this.compiler=L,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(D){if(this.componentLoaders.get(D))return this.componentLoaders.get(D);if(D._loadedComponent)return Ae(D._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(D);const L=At(D.loadComponent()).pipe(Yn(X=>{this.onLoadEndListener&&this.onLoadEndListener(D),D._loadedComponent=X}),$i(()=>{this.componentLoaders.delete(D)})),U=new _r(L,()=>new hn.x).pipe(Dn());return this.componentLoaders.set(D,U),U}loadChildren(D,L){if(this.childrenLoaders.get(L))return this.childrenLoaders.get(L);if(L._loadedRoutes)return Ae({routes:L._loadedRoutes,injector:L._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(L);const X=this.loadModuleFactoryOrRoutes(L.loadChildren).pipe((0,dt.U)(De=>{this.onLoadEndListener&&this.onLoadEndListener(L);let Ye,It,Rn=!1;Array.isArray(De)?It=De:(Ye=De.create(D).injector,It=Oe(Ye.get(Ds,[],re.XFs.Self|re.XFs.Optional)));return{routes:It.map(wr),injector:Ye}}),$i(()=>{this.childrenLoaders.delete(L)})),pe=new _r(X,()=>new hn.x).pipe(Dn());return this.childrenLoaders.set(L,pe),pe}loadModuleFactoryOrRoutes(D){return At(D()).pipe((0,En.z)(L=>L instanceof re.YKP||Array.isArray(L)?Ae(L):(0,u.D)(this.compiler.compileModuleAsync(L))))}}return M.\u0275fac=function(D){return new(D||M)(re.LFG(re.zs3),re.LFG(re.Sil))},M.\u0275prov=re.Yz7({token:M,factory:M.\u0275fac}),M})();class Is{shouldProcessUrl(C){return!0}extract(C){return C}merge(C,D){return C}}function wu(M){throw M}function Ga(M,C,D){return C.parse("/")}const fa={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},qr={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let hi=(()=>{class M{constructor(D,L,U,X,pe,De,Ye){this.rootComponentType=D,this.urlSerializer=L,this.rootContexts=U,this.location=X,this.config=Ye,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new hn.x,this.errorHandler=wu,this.malformedUriErrorHandler=Ga,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Ae(void 0),this.urlHandlingStrategy=new Is,this.routeReuseStrategy=new $a,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=pe.get(Cs),this.configLoader.onLoadEndListener=zr=>this.triggerEvent(new Si(zr)),this.configLoader.onLoadStartListener=zr=>this.triggerEvent(new Uo(zr)),this.ngModule=pe.get(re.h0i),this.console=pe.get(re.c2e);const en=pe.get(re.R0b);this.isNgZoneEnabled=en instanceof re.R0b&&re.R0b.isInAngularZone(),this.resetConfig(Ye),this.currentUrlTree=function he(){return new Tn(new xn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=fs(this.currentUrlTree,this.rootComponentType),this.transitions=new jt({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(D){const L=this.events;return D.pipe(An(U=>0!==U.id),(0,dt.U)(U=>({...U,extractedUrl:this.urlHandlingStrategy.extract(U.rawUrl)})),ir(U=>{let X=!1,pe=!1;return Ae(U).pipe(Yn(De=>{this.currentNavigation={id:De.id,initialUrl:De.rawUrl,extractedUrl:De.extractedUrl,trigger:De.source,extras:De.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ir(De=>{const Ye=this.browserUrlTree.toString(),It=!this.navigated||De.extractedUrl.toString()!==Ye||Ye!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||It)&&this.urlHandlingStrategy.shouldProcessUrl(De.rawUrl))return pa(De.source)&&(this.browserUrlTree=De.extractedUrl),Ae(De).pipe(ir(en=>{const zr=this.transitions.getValue();return L.next(new ts(en.id,this.serializeUrl(en.extractedUrl),en.source,en.restoredState)),zr!==this.transitions.getValue()?jr.E:Promise.resolve(en)}),function Ns(M,C,D,L){return ir(U=>function El(M,C,D,L,U){return new Fc(M,C,D,L,U).apply()}(M,C,D,U.extractedUrl,L).pipe((0,dt.U)(X=>({...U,urlAfterRedirects:X}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Yn(en=>{this.currentNavigation={...this.currentNavigation,finalUrl:en.urlAfterRedirects}}),function ws(M,C,D,L,U){return(0,En.z)(X=>function oc(M,C,D,L,U="emptyOnly",X="legacy"){try{const pe=new ih(M,C,D,L,U,X).recognize();return null===pe?Qn(new ic):Ae(pe)}catch(pe){return Qn(pe)}}(M,C,X.urlAfterRedirects,D(X.urlAfterRedirects),L,U).pipe((0,dt.U)(pe=>({...X,targetSnapshot:pe}))))}(this.rootComponentType,this.config,en=>this.serializeUrl(en),this.paramsInheritanceStrategy,this.relativeLinkResolution),Yn(en=>{if("eager"===this.urlUpdateStrategy){if(!en.extras.skipLocationChange){const Wr=this.urlHandlingStrategy.merge(en.urlAfterRedirects,en.rawUrl);this.setBrowserUrl(Wr,en)}this.browserUrlTree=en.urlAfterRedirects}const zr=new an(en.id,this.serializeUrl(en.extractedUrl),this.serializeUrl(en.urlAfterRedirects),en.targetSnapshot);L.next(zr)}));if(It&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:zr,extractedUrl:Wr,source:Ro,restoredState:Wa,extras:Xa}=De,Ui=new ts(zr,this.serializeUrl(Wr),Ro,Wa);L.next(Ui);const ss=fs(Wr,this.rootComponentType).snapshot;return Ae({...De,targetSnapshot:ss,urlAfterRedirects:Wr,extras:{...Xa,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=De.rawUrl,De.resolve(null),jr.E}),Yn(De=>{const Ye=new gn(De.id,this.serializeUrl(De.extractedUrl),this.serializeUrl(De.urlAfterRedirects),De.targetSnapshot);this.triggerEvent(Ye)}),(0,dt.U)(De=>({...De,guards:tc(De.targetSnapshot,De.currentSnapshot,this.rootContexts)})),function rc(M,C){return(0,En.z)(D=>{const{targetSnapshot:L,currentSnapshot:U,guards:{canActivateChecks:X,canDeactivateChecks:pe}}=D;return 0===pe.length&&0===X.length?Ae({...D,guardsResult:!0}):function Na(M,C,D,L){return(0,u.D)(M).pipe((0,En.z)(U=>function Ua(M,C,D,L,U){const X=C&&C.routeConfig?C.routeConfig.canDeactivate:null;return X&&0!==X.length?Ae(X.map(De=>{const Ye=Tl(De,C,U);return At(function bl(M){return M&&_o(M.canDeactivate)}(Ye)?Ye.canDeactivate(M,C,D,L):Ye(M,C,D,L)).pipe(Ci())})).pipe(Kn()):Ae(!0)}(U.component,U.route,D,C,L)),Ci(U=>!0!==U,!0))}(pe,L,U,M).pipe((0,En.z)(De=>De&&function ys(M){return"boolean"==typeof M}(De)?function Oc(M,C,D,L){return(0,u.D)(C).pipe(io(U=>at(function bi(M,C){return null!==M&&C&&C(new gi(M)),Ae(!0)}(U.route.parent,L),function da(M,C){return null!==M&&C&&C(new Aa(M)),Ae(!0)}(U.route,L),function Or(M,C,D){const L=C[C.length-1],X=C.slice(0,C.length-1).reverse().map(pe=>function vu(M){const C=M.routeConfig?M.routeConfig.canActivateChild:null;return C&&0!==C.length?{node:M,guards:C}:null}(pe)).filter(pe=>null!==pe).map(pe=>Ln(()=>Ae(pe.guards.map(Ye=>{const It=Tl(Ye,pe.node,D);return At(function xl(M){return M&&_o(M.canActivateChild)}(It)?It.canActivateChild(L,M):It(L,M)).pipe(Ci())})).pipe(Kn())));return Ae(X).pipe(Kn())}(M,U.path,D),function vs(M,C,D){const L=C.routeConfig?C.routeConfig.canActivate:null;if(!L||0===L.length)return Ae(!0);const U=L.map(X=>Ln(()=>{const pe=Tl(X,C,D);return At(function ca(M){return M&&_o(M.canActivate)}(pe)?pe.canActivate(C,M):pe(C,M)).pipe(Ci())}));return Ae(U).pipe(Kn())}(M,U.route,D))),Ci(U=>!0!==U,!0))}(L,X,M,C):Ae(De)),(0,dt.U)(De=>({...D,guardsResult:De})))})}(this.ngModule.injector,De=>this.triggerEvent(De)),Yn(De=>{if(Bi(De.guardsResult)){const It=$(`Redirecting to "${this.serializeUrl(De.guardsResult)}"`);throw It.url=De.guardsResult,It}const Ye=new No(De.id,this.serializeUrl(De.extractedUrl),this.serializeUrl(De.urlAfterRedirects),De.targetSnapshot,!!De.guardsResult);this.triggerEvent(Ye)}),An(De=>!!De.guardsResult||(this.restoreHistory(De),this.cancelNavigationTransition(De,""),!1)),ja(De=>{if(De.guards.canActivateChecks.length)return Ae(De).pipe(Yn(Ye=>{const It=new mi(Ye.id,this.serializeUrl(Ye.extractedUrl),this.serializeUrl(Ye.urlAfterRedirects),Ye.targetSnapshot);this.triggerEvent(It)}),ir(Ye=>{let It=!1;return Ae(Ye).pipe(function Al(M,C){return(0,En.z)(D=>{const{targetSnapshot:L,guards:{canActivateChecks:U}}=D;if(!U.length)return Ae(D);let X=0;return(0,u.D)(U).pipe(io(pe=>function Va(M,C,D,L){const U=M.routeConfig,X=M._resolve;return void 0!==U?.title&&!Es(U)&&(X[$s]=U.title),function Ht(M,C,D,L){const U=function Wo(M){return[...Object.keys(M),...Object.getOwnPropertySymbols(M)]}(M);if(0===U.length)return Ae({});const X={};return(0,u.D)(U).pipe((0,En.z)(pe=>function Gs(M,C,D,L){const U=Tl(M,C,L);return At(U.resolve?U.resolve(C,D):U(C,D))}(M[pe],C,D,L).pipe(Ci(),Yn(De=>{X[pe]=De}))),Sr(1),function Fi(M){return(0,dt.U)(()=>M)}(X),Li(pe=>pe instanceof Ke?jr.E:Mn(pe)))}(X,M,C,L).pipe((0,dt.U)(pe=>(M._resolvedData=pe,M.data=xi(M,D).resolve,U&&Es(U)&&(M.data[$s]=U.title),null)))}(pe.route,L,M,C)),Yn(()=>X++),Sr(1),(0,En.z)(pe=>X===U.length?Ae(D):jr.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Yn({next:()=>It=!0,complete:()=>{It||(this.restoreHistory(Ye),this.cancelNavigationTransition(Ye,"At least one route resolver didn't emit any value."))}}))}),Yn(Ye=>{const It=new ar(Ye.id,this.serializeUrl(Ye.extractedUrl),this.serializeUrl(Ye.urlAfterRedirects),Ye.targetSnapshot);this.triggerEvent(It)}))}),ja(De=>{const Ye=It=>{const Rn=[];It.routeConfig?.loadComponent&&!It.routeConfig._loadedComponent&&Rn.push(this.configLoader.loadComponent(It.routeConfig).pipe(Yn(en=>{It.component=en}),(0,dt.U)(()=>{})));for(const en of It.children)Rn.push(...Ye(en));return Rn};return gt(Ye(De.targetSnapshot.root)).pipe(Xi(),Yr(1))}),ja(()=>this.afterPreactivation()),(0,dt.U)(De=>{const Ye=function oa(M,C,D){const L=ka(M,C._root,D?D._root:void 0);return new Fr(L,C)}(this.routeReuseStrategy,De.targetSnapshot,De.currentRouterState);return{...De,targetRouterState:Ye}}),Yn(De=>{this.currentUrlTree=De.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(De.urlAfterRedirects,De.rawUrl),this.routerState=De.targetRouterState,"deferred"===this.urlUpdateStrategy&&(De.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,De),this.browserUrlTree=De.urlAfterRedirects)}),((M,C,D)=>(0,dt.U)(L=>(new Zo(C,L.targetRouterState,L.currentRouterState,D).activate(M),L)))(this.rootContexts,this.routeReuseStrategy,De=>this.triggerEvent(De)),Yn({next(){X=!0},complete(){X=!0}}),$i(()=>{X||pe||this.cancelNavigationTransition(U,`Navigation ID ${U.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===U.id&&(this.currentNavigation=null)}),Li(De=>{if(pe=!0,function Z(M){return M&&M[le]}(De)){const Ye=Bi(De.url);Ye||(this.navigated=!0,this.restoreHistory(U,!0));const It=new ui(U.id,this.serializeUrl(U.extractedUrl),De.message);if(L.next(It),Ye){const Rn=this.urlHandlingStrategy.merge(De.url,this.rawUrlTree),en={skipLocationChange:U.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||pa(U.source)};this.scheduleNavigation(Rn,"imperative",null,en,{resolve:U.resolve,reject:U.reject,promise:U.promise})}else U.resolve(!1)}else{this.restoreHistory(U,!0);const Ye=new vr(U.id,this.serializeUrl(U.extractedUrl),De);L.next(Ye);try{U.resolve(this.errorHandler(De))}catch(It){U.reject(It)}}return jr.E}))}))}resetRootComponentType(D){this.rootComponentType=D,this.routerState.root.component=this.rootComponentType}setTransition(D){this.transitions.next({...this.transitions.value,...D})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(D=>{const L="popstate"===D.type?"popstate":"hashchange";"popstate"===L&&setTimeout(()=>{const U={replaceUrl:!0},X=D.state?.navigationId?D.state:null;if(X){const De={...X};delete De.navigationId,delete De.\u0275routerPageId,0!==Object.keys(De).length&&(U.state=De)}const pe=this.parseUrl(D.url);this.scheduleNavigation(pe,L,X,U)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(D){this.events.next(D)}resetConfig(D){this.config=D.map(wr),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(D,L={}){const{relativeTo:U,queryParams:X,fragment:pe,queryParamsHandling:De,preserveFragment:Ye}=L,It=U||this.routerState.root,Rn=Ye?this.currentUrlTree.fragment:pe;let en=null;switch(De){case"merge":en={...this.currentUrlTree.queryParams,...X};break;case"preserve":en=this.currentUrlTree.queryParams;break;default:en=X||null}return null!==en&&(en=this.removeEmptyProps(en)),function ms(M,C,D,L,U){if(0===D.length)return aa(C.root,C.root,C.root,L,U);const X=function Ho(M){if("string"==typeof M[0]&&1===M.length&&"/"===M[0])return new _l(!0,0,M);let C=0,D=!1;const L=M.reduce((U,X,pe)=>{if("object"==typeof X&&null!=X){if(X.outlets){const De={};return tt(X.outlets,(Ye,It)=>{De[It]="string"==typeof Ye?Ye.split("/"):Ye}),[...U,{outlets:De}]}if(X.segmentPath)return[...U,X.segmentPath]}return"string"!=typeof X?[...U,X]:0===pe?(X.split("/").forEach((De,Ye)=>{0==Ye&&"."===De||(0==Ye&&""===De?D=!0:".."===De?C++:""!=De&&U.push(De))}),U):[...U,X]},[]);return new _l(D,C,L)}(D);return X.toRoot()?aa(C.root,C.root,new xn([],{}),L,U):function pe(Ye){const It=function gs(M,C,D,L){return M.isAbsolute?new yl(C.root,!0,0):-1===L?new yl(D,D===C.root,0):function vl(M,C,D){let L=M,U=C,X=D;for(;X>U;){if(X-=U,L=L.parent,!L)throw new re.vHH(4005,!1);U=L.segments.length}return new yl(L,!1,U-X)}(D,L+(Ki(M.commands[0])?0:1),M.numberOfDoubleDots)}(X,C,M.snapshot?._urlSegment,Ye),Rn=It.processChildren?_s(It.segmentGroup,It.index,X.commands):Yl(It.segmentGroup,It.index,X.commands);return aa(C.root,It.segmentGroup,Rn,L,U)}(M.snapshot?._lastPathIndex)}(It,this.currentUrlTree,D,en,Rn??null)}navigateByUrl(D,L={skipLocationChange:!1}){const U=Bi(D)?D:this.parseUrl(D),X=this.urlHandlingStrategy.merge(U,this.rawUrlTree);return this.scheduleNavigation(X,"imperative",null,L)}navigate(D,L={skipLocationChange:!1}){return function Ha(M){for(let C=0;C<M.length;C++){if(null==M[C])throw new re.vHH(4008,!1)}}(D),this.navigateByUrl(this.createUrlTree(D,L),L)}serializeUrl(D){return this.urlSerializer.serialize(D)}parseUrl(D){let L;try{L=this.urlSerializer.parse(D)}catch(U){L=this.malformedUriErrorHandler(U,this.urlSerializer,D)}return L}isActive(D,L){let U;if(U=!0===L?{...fa}:!1===L?{...qr}:L,Bi(D))return Ue(this.currentUrlTree,D,U);const X=this.parseUrl(D);return Ue(this.currentUrlTree,X,U)}removeEmptyProps(D){return Object.keys(D).reduce((L,U)=>{const X=D[U];return null!=X&&(L[U]=X),L},{})}processNavigations(){this.navigations.subscribe(D=>{this.navigated=!0,this.lastSuccessfulId=D.id,this.currentPageId=D.targetPageId,this.events.next(new Jt(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),D.resolve(!0)},D=>{this.console.warn(`Unhandled Navigation Error: ${D}`)})}scheduleNavigation(D,L,U,X,pe){if(this.disposed)return Promise.resolve(!1);let De,Ye,It;pe?(De=pe.resolve,Ye=pe.reject,It=pe.promise):It=new Promise((zr,Wr)=>{De=zr,Ye=Wr});const Rn=++this.navigationId;let en;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(U=this.location.getState()),en=U&&U.\u0275routerPageId?U.\u0275routerPageId:X.replaceUrl||X.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):en=0,this.setTransition({id:Rn,targetPageId:en,source:L,restoredState:U,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:D,extras:X,resolve:De,reject:Ye,promise:It,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),It.catch(zr=>Promise.reject(zr))}setBrowserUrl(D,L){const U=this.urlSerializer.serialize(D),X={...L.extras.state,...this.generateNgRouterState(L.id,L.targetPageId)};this.location.isCurrentPathEqualTo(U)||L.extras.replaceUrl?this.location.replaceState(U,"",X):this.location.go(U,"",X)}restoreHistory(D,L=!1){if("computed"===this.canceledNavigationResolution){const U=this.currentPageId-D.targetPageId;"popstate"!==D.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===U?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===U&&(this.resetState(D),this.browserUrlTree=D.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(U)}else"replace"===this.canceledNavigationResolution&&(L&&this.resetState(D),this.resetUrlToCurrentUrlTree())}resetState(D){this.routerState=D.currentRouterState,this.currentUrlTree=D.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,D.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(D,L){const U=new ui(D.id,this.serializeUrl(D.extractedUrl),L);this.triggerEvent(U),D.resolve(!1)}generateNgRouterState(D,L){return"computed"===this.canceledNavigationResolution?{navigationId:D,\u0275routerPageId:L}:{navigationId:D}}}return M.\u0275fac=function(D){re.$Z()},M.\u0275prov=re.Yz7({token:M,factory:M.\u0275fac}),M})();function pa(M){return"imperative"!==M}let Hs=(()=>{class M{constructor(D,L,U,X,pe){this.router=D,this.route=L,this.tabIndexAttribute=U,this.renderer=X,this.el=pe,this.commands=null,this.onChanges=new hn.x,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(D){if(null!=this.tabIndexAttribute)return;const L=this.renderer,U=this.el.nativeElement;null!==D?L.setAttribute(U,"tabindex",D):L.removeAttribute(U,"tabindex")}ngOnChanges(D){this.onChanges.next(this)}set routerLink(D){null!=D?(this.commands=Array.isArray(D)?D:[D],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const D={skipLocationChange:(0,re.D6c)(this.skipLocationChange),replaceUrl:(0,re.D6c)(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,D),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:(0,re.D6c)(this.preserveFragment)})}}return M.\u0275fac=function(D){return new(D||M)(re.Y36(hi),re.Y36(Io),re.$8M("tabindex"),re.Y36(re.Qsj),re.Y36(re.SBq))},M.\u0275dir=re.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(D,L){1&D&&re.NdJ("click",function(){return L.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[re.TTD]}),M})(),ma=(()=>{class M{constructor(D,L,U){this.router=D,this.route=L,this.locationStrategy=U,this.commands=null,this.href=null,this.onChanges=new hn.x,this.subscription=D.events.subscribe(X=>{X instanceof Jt&&this.updateTargetUrlAndHref()})}set routerLink(D){this.commands=null!=D?Array.isArray(D)?D:[D]:null}ngOnChanges(D){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(D,L,U,X,pe){if(0!==D||L||U||X||pe||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const De={skipLocationChange:(0,re.D6c)(this.skipLocationChange),replaceUrl:(0,re.D6c)(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,De),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:(0,re.D6c)(this.preserveFragment)})}}return M.\u0275fac=function(D){return new(D||M)(re.Y36(hi),re.Y36(Io),re.Y36(ge.S$))},M.\u0275dir=re.lG2({type:M,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(D,L){1&D&&re.NdJ("click",function(X){return L.onClick(X.button,X.ctrlKey,X.shiftKey,X.altKey,X.metaKey)}),2&D&&re.uIk("target",L.target)("href",L.href,re.LSH)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[re.TTD]}),M})(),Zs=(()=>{class M{constructor(D,L,U,X,pe,De){this.router=D,this.element=L,this.renderer=U,this.cdr=X,this.link=pe,this.linkWithHref=De,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new re.vpe,this.routerEventsSubscription=D.events.subscribe(Ye=>{Ye instanceof Jt&&this.update()})}ngAfterContentInit(){Ae(this.links.changes,this.linksWithHrefs.changes,Ae(null)).pipe((0,Qe.J)()).subscribe(D=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const D=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(L=>!!L).map(L=>L.onChanges);this.linkInputChangesSubscription=(0,u.D)(D).pipe((0,Qe.J)()).subscribe(L=>{this.isActive!==this.isLinkActive(this.router)(L)&&this.update()})}set routerLinkActive(D){const L=Array.isArray(D)?D:D.split(" ");this.classes=L.filter(U=>!!U)}ngOnChanges(D){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const D=this.hasActiveLinks();this.isActive!==D&&(this.isActive=D,this.cdr.markForCheck(),this.classes.forEach(L=>{D?this.renderer.addClass(this.element.nativeElement,L):this.renderer.removeClass(this.element.nativeElement,L)}),D&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(D))})}isLinkActive(D){const L=function Eu(M){return!!M.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return U=>!!U.urlTree&&D.isActive(U.urlTree,L)}hasActiveLinks(){const D=this.isLinkActive(this.router);return this.link&&D(this.link)||this.linkWithHref&&D(this.linkWithHref)||this.links.some(D)||this.linksWithHrefs.some(D)}}return M.\u0275fac=function(D){return new(D||M)(re.Y36(hi),re.Y36(re.SBq),re.Y36(re.Qsj),re.Y36(re.sBO),re.Y36(Hs,8),re.Y36(ma,8))},M.\u0275dir=re.lG2({type:M,selectors:[["","routerLinkActive",""]],contentQueries:function(D,L,U){if(1&D&&(re.Suo(U,Hs,5),re.Suo(U,ma,5)),2&D){let X;re.iGM(X=re.CRH())&&(L.links=X),re.iGM(X=re.CRH())&&(L.linksWithHrefs=X)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[re.TTD]}),M})();class Za{buildTitle(C){let D,L=C.root;for(;void 0!==L;)D=this.getResolvedTitleForRoute(L)??D,L=L.children.find(U=>U.outlet===In);return D}getResolvedTitleForRoute(C){return C.data[$s]}}let zc=(()=>{class M extends Za{constructor(D){super(),this.title=D}updateTitle(D){const L=this.buildTitle(D);void 0!==L&&this.title.setTitle(L)}}return M.\u0275fac=function(D){return new(D||M)(re.LFG(Bo.Dx))},M.\u0275prov=re.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();class qs{}let ga=(()=>{class M{constructor(D,L,U,X,pe){this.router=D,this.injector=U,this.preloadingStrategy=X,this.loader=pe}setUpPreloading(){this.subscription=this.router.events.pipe(An(D=>D instanceof Jt),io(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(D,L){const U=[];for(const X of L){X.providers&&!X._injector&&(X._injector=(0,re.MMx)(X.providers,D,`Route: ${X.path}`));const pe=X._injector??D,De=X._loadedInjector??pe;X.loadChildren&&!X._loadedRoutes||X.loadComponent&&!X._loadedComponent?U.push(this.preloadConfig(pe,X)):(X.children||X._loadedRoutes)&&U.push(this.processRoutes(De,X.children??X._loadedRoutes))}return(0,u.D)(U).pipe((0,Qe.J)())}preloadConfig(D,L){return this.preloadingStrategy.preload(L,()=>{let U;U=L.loadChildren&&void 0===L.canLoad?this.loader.loadChildren(D,L):Ae(null);const X=U.pipe((0,En.z)(pe=>null===pe?Ae(void 0):(L._loadedRoutes=pe.routes,L._loadedInjector=pe.injector,this.processRoutes(pe.injector??D,pe.routes))));if(L.loadComponent&&!L._loadedComponent){const pe=this.loader.loadComponent(L);return(0,u.D)([X,pe]).pipe((0,Qe.J)())}return X})}}return M.\u0275fac=function(D){return new(D||M)(re.LFG(hi),re.LFG(re.Sil),re.LFG(re.lqb),re.LFG(qs),re.LFG(Cs))},M.\u0275prov=re.Yz7({token:M,factory:M.\u0275fac}),M})();const Ws=new re.OlP("");let Tu=(()=>{class M{constructor(D,L,U={}){this.router=D,this.viewportScroller=L,this.options=U,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},U.scrollPositionRestoration=U.scrollPositionRestoration||"disabled",U.anchorScrolling=U.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(D=>{D instanceof ts?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=D.navigationTrigger,this.restoredId=D.restoredState?D.restoredState.navigationId:0):D instanceof Jt&&(this.lastId=D.id,this.scheduleScrollEvent(D,this.router.parseUrl(D.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(D=>{D instanceof Oi&&(D.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(D.position):D.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(D.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(D,L){this.router.triggerEvent(new Oi(D,"popstate"===this.lastSource?this.store[this.restoredId]:null,L))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return M.\u0275fac=function(D){re.$Z()},M.\u0275prov=re.Yz7({token:M,factory:M.\u0275fac}),M})();const Ss=new re.OlP("ROUTER_CONFIGURATION",{providedIn:"root",factory:()=>({})}),Bc=new re.OlP("ROUTER_FORROOT_GUARD"),Nc=new re.OlP(""),Uc=[ge.Ye,{provide:Do,useClass:Ot},{provide:hi,useFactory:function cc(M,C,D,L,U,X,pe={},De,Ye,It,Rn){const en=new hi(null,M,C,D,L,U,Oe(X));return It&&(en.urlHandlingStrategy=It),Rn&&(en.routeReuseStrategy=Rn),en.titleStrategy=Ye??De,function os(M,C){M.errorHandler&&(C.errorHandler=M.errorHandler),M.malformedUriErrorHandler&&(C.malformedUriErrorHandler=M.malformedUriErrorHandler),M.onSameUrlNavigation&&(C.onSameUrlNavigation=M.onSameUrlNavigation),M.paramsInheritanceStrategy&&(C.paramsInheritanceStrategy=M.paramsInheritanceStrategy),M.relativeLinkResolution&&(C.relativeLinkResolution=M.relativeLinkResolution),M.urlUpdateStrategy&&(C.urlUpdateStrategy=M.urlUpdateStrategy),M.canceledNavigationResolution&&(C.canceledNavigationResolution=M.canceledNavigationResolution)}(pe,en),en},deps:[Do,Mo,ge.Ye,re.zs3,re.Sil,Ds,Ss,zc,[Za,new re.FiY],[class sc{},new re.FiY],[class is{},new re.FiY]]},Mo,{provide:Io,useFactory:function uc(M){return M.routerState.root},deps:[hi]},Cs];function Xo(){return new re.PXZ("Router",hi)}let Vc=(()=>{class M{constructor(D,L){}static forRoot(D,L){return{ngModule:M,providers:[Uc,[],lc(D),{provide:Bc,useFactory:Ut,deps:[[hi,new re.FiY,new re.tp0]]},{provide:Ss,useValue:L||{}},L?.useHash?{provide:ge.S$,useClass:ge.Do}:{provide:ge.S$,useClass:ge.b0},{provide:Ws,useFactory:()=>{const M=(0,re.f3M)(hi),C=(0,re.f3M)(ge.EM),D=(0,re.f3M)(Ss);return D.scrollOffset&&C.setOffset(D.scrollOffset),new Tu(M,C,D)}},L?.preloadingStrategy?Ys(L.preloadingStrategy):[],{provide:re.PXZ,multi:!0,useFactory:Xo},L?.initialNavigation?Cu(L):[],[{provide:Er,useFactory:Du},{provide:re.tb,multi:!0,useExisting:Er}]]}}static forChild(D){return{ngModule:M,providers:[lc(D)]}}}return M.\u0275fac=function(D){return new(D||M)(re.LFG(Bc,8),re.LFG(hi,8))},M.\u0275mod=re.oAB({type:M}),M.\u0275inj=re.cJS({}),M})();function Ut(M){return"guarded"}function lc(M){return[{provide:re.deG,multi:!0,useValue:M},{provide:Ds,multi:!0,useValue:M}]}function Du(){const M=(0,re.f3M)(re.zs3);return C=>{const D=M.get(re.z2F);if(C!==D.components[0])return;const L=M.get(hi),U=M.get(Iu);null===M.get(qa,null,re.XFs.Optional)&&L.initialNavigation(),M.get(Nc,null,re.XFs.Optional)?.setUpPreloading(),M.get(Ws,null,re.XFs.Optional)?.init(),L.resetRootComponentType(D.componentTypes[0]),U.next(),U.complete()}}const Er=new re.OlP("");function Cu(M){return["disabled"===M.initialNavigation?[{provide:re.ip1,multi:!0,useFactory:()=>{const M=(0,re.f3M)(hi);return()=>{M.setUpLocationChangeListener()}}},{provide:qa,useValue:"disabled"}]:[],"enabledBlocking"===M.initialNavigation?[{provide:qa,useValue:"enabledBlocking"},{provide:re.ip1,multi:!0,deps:[re.zs3],useFactory:M=>{const C=M.get(ge.V_,Promise.resolve(null));let D=!1;return()=>C.then(()=>new Promise(U=>{const X=M.get(hi),pe=M.get(Iu);(function L(U){const X=M.get(hi);X.events.pipe(An(pe=>pe instanceof Jt||pe instanceof ui||pe instanceof vr),(0,dt.U)(pe=>{if(pe instanceof Jt)return!0;const De=X.navigationId!==pe.id,Ye=pe instanceof ui&&-1!==pe.reason.indexOf(To);return!(!De&&!Ye)&&null}),An(pe=>null!==pe),Yr(1)).subscribe(()=>{U()})})(()=>{U(!0),D=!0}),X.afterPreactivation=()=>(U(!0),D||pe.closed?Ae(void 0):pe),X.initialNavigation()}))}}]:[]]}const Iu=new re.OlP("",{factory:()=>new hn.x}),qa=new re.OlP("");function Ys(M){return[ga,{provide:Nc,useExisting:ga},{provide:qs,useExisting:M}]}}},nr=>{nr(nr.s=782)}]);